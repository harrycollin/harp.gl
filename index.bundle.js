!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=128)}([function(e,t){e.exports=THREE},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(141),t),n(i(161),t)},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(23),t),n(i(5),t),n(i(43),t),n(i(76),t),n(i(34),t),n(i(179),t),n(i(78),t),n(i(33),t),n(i(180),t),n(i(181),t),n(i(182),t),n(i(183),t),n(i(184),t),n(i(79),t),n(i(186),t),n(i(80),t),n(i(187),t),n(i(31),t)},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(20),t),n(i(129),t),n(i(21),t),n(i(7),t),n(i(63),t),n(i(64),t),n(i(12),t),n(i(65),t),n(i(130),t),n(i(15),t),n(i(27),t),n(i(66),t),n(i(131),t),n(i(67),t),n(i(68),t),n(i(28),t),n(i(132),t),n(i(69),t),n(i(133),t),n(i(29),t),n(i(70),t),n(i(71),t),n(i(22),t),n(i(134),t),n(i(135),t),n(i(136),t),n(i(137),t),n(i(138),t),n(i(13),t),n(i(14),t),n(i(8),t),n(i(139),t),n(i(140),t)},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(188),t),n(i(81),t),n(i(189),t),n(i(190),t),n(i(194),t),n(i(195),t),n(i(196),t),n(i(197),t),n(i(198),t),n(i(35),t),n(i(44),t),n(i(199),t),n(i(200),t),n(i(201),t),n(i(202),t),n(i(9),t),n(i(203),t)},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.InterpolateExpr=t.StepExpr=t.CaseExpr=t.MatchExpr=t.CallExpr=t.HasAttributeExpr=t.ObjectLiteralExpr=t.StringLiteralExpr=t.NumberLiteralExpr=t.BooleanLiteralExpr=t.NullLiteralExpr=t.LiteralExpr=t.VarExpr=t.Expr=t.ExprScope=t.isJsonExpr=t.ExprDependencies=void 0;const o=i(163),s=i(177),a=i(178),l=i(33),c=i(34),h=i(0),d=i(42),u=i(30);n(i(32),t);const m=new o.ExprEvaluator,p=new s.ExprInstantiator;class f{constructor(){this.properties=new Set}}t.ExprDependencies=f;let g=(()=>{class e{static of(e){const t=new f;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitCallExpr(e,t){switch(e.args.forEach(e=>e.accept(this,t)),e.op){case"dynamic-properties":t.volatile=!0;break;case"feature-state":t.featureState=!0,t.properties.add("$state"),t.properties.add("$id");break;case"id":t.properties.add("$id");break;case"zoom":case"world-ppi-scale":case"world-discrete-ppi-scale":t.properties.add("$zoom");break;case"geometry-type":t.properties.add("$geometryType")}}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach(([e,i])=>i.accept(this,t)),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach(([e,i])=>{e.accept(this,t),i.accept(this,t)}),e.fallback.accept(this,t)}visitStepExpr(e,t){e.input.accept(this,t),e.defaultValue.accept(this,t),e.stops.forEach(([e,i])=>i.accept(this,t))}visitInterpolateExpr(e,t){e.input.accept(this,t),e.stops.forEach(([e,i])=>i.accept(this,t))}}return e.instance=new e,e})();function v(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]}var y;t.isJsonExpr=v,function(e){e[e.Value=0]="Value",e[e.Condition=1]="Condition",e[e.Dynamic=2]="Dynamic"}(y=t.ExprScope||(t.ExprScope={}));class _{static isExpr(e){return e instanceof _}static parse(e){return new a.ExprParser(e).parse()}static fromJSON(e,t,i){return F(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:i||new Map}:void 0)}evaluate(e,t=y.Value,i){return this.accept(m,new o.ExprEvaluatorContext(m,e,t,i))}instantiate(e){return this.accept(p,e)}dependencies(){return this.m_dependencies||(this.m_dependencies=g.of(this)),this.m_dependencies}intern(e){return e.add(this)}toJSON(){return(new O).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}}t.Expr=_;class x extends _{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}}t.VarExpr=x;class S extends _{static fromValue(e){switch(typeof e){case"boolean":return new T(e);case"number":return new w(e);case"string":return new M(e);case"object":return null===e?b.instance:new E(e);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=S;let b=(()=>{class e extends S{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}}return e.instance=new e,e})();t.NullLiteralExpr=b;class T extends S{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=T;class w extends S{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=w;class M extends S{constructor(e){super(),this.value=e}get promotedValue(){var e,t,i;return void 0===this.m_promotedValue&&(this.m_promotedValue=null!==(t=null!==(e=u.RGBA.parse(this.value))&&void 0!==e?e:d.Pixels.parse(this.value))&&void 0!==t?t:null),null!==(i=this.m_promotedValue)&&void 0!==i?i:void 0}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=M;class E extends S{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=E;class P extends _{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}}t.HasAttributeExpr=P;class C extends _{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){const e=this.descriptor||o.ExprEvaluator.getOperator(this.op);return!!(e&&e.isDynamicOperator&&e.isDynamicOperator(this))||this.args.some(e=>e.isDynamic())}}t.CallExpr=C;class A extends _{constructor(e,t,i){super(),this.value=e,this.branches=t,this.fallback=i}static isValidMatchLabel(e){switch(typeof e){case"number":case"string":return!0;case"object":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every(e=>typeof e===t);default:return!1}}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some(([e,t])=>t.isDynamic())||this.fallback.isDynamic()}}t.MatchExpr=A;class L extends _{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some(([e,t])=>e.isDynamic()||t.isDynamic())||this.fallback.isDynamic()}}t.CaseExpr=L;class R extends _{constructor(e,t,i){super(),this.input=e,this.defaultValue=t,this.stops=i}accept(e,t){return e.visitStepExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.defaultValue.isDynamic()||this.stops.some(([e,t])=>t.isDynamic())}}t.StepExpr=R;class D extends _{constructor(e,t,i){super(),this.mode=e,this.input=t,this.stops=i}accept(e,t){return e.visitInterpolateExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.stops.some(([e,t])=>t.isDynamic())}}t.InterpolateExpr=D;class O{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value instanceof h.Vector2?["make-vector",e.value.x,e.value.y]:e.value instanceof h.Vector3?["make-vector",e.value.x,e.value.y,e.value.z]:e.value instanceof h.Vector4?["make-vector",e.value.x,e.value.y,e.value.z,e.value.w]:["literal",e.value]}visitVarExpr(e,t){return["get",e.name]}visitHasAttributeExpr(e,t){return["has",e.name]}visitCallExpr(e,t){return[e.op,...e.args.map(e=>this.serialize(e))]}visitMatchExpr(e,t){const i=[];for(const[t,r]of e.branches)i.push(t,this.serialize(r));return["match",this.serialize(e.value),...i,this.serialize(e.fallback)]}visitCaseExpr(e,t){const i=[];for(const[t,r]of e.branches)i.push(this.serialize(t),this.serialize(r));return["case",...i,this.serialize(e.fallback)]}visitStepExpr(e,t){const i=["step"];return i.push(this.serialize(e.input)),i.push(this.serialize(e.defaultValue)),e.stops.forEach(([e,t])=>{i.push(e),i.push(this.serialize(t))}),i}visitInterpolateExpr(e,t){const i=["interpolate",e.mode];return i.push(this.serialize(e.input)),e.stops.forEach(([e,t])=>{i.push(e),i.push(this.serialize(t))}),i}}function F(e,t){if(Array.isArray(e))return function e(t,i){const r=t[0];if("string"!=typeof r)throw new Error("expected a builtin function name");switch(r){case"!has":case"!in":return new C("!",[e([r.slice(1),...t.slice(1)])]);case"ref":return function(e,t){if("string"!=typeof e[1])throw new Error("expected the name of an attribute");if(void 0===t)throw new Error("ref used with no definitions");const i=e[1];if(t.lockedNames.has(i))throw new Error(`circular referene to '${i}'`);if(!(i in t.definitions))throw new Error(`definition '${i}' not found`);const r=t.cache.get(i);if(void 0!==r)return r;let n,o=t.definitions[i];if(c.isLiteralDefinition(o))return _.fromJSON(o);if(c.isBoxedDefinition(o)){if(l.isInterpolatedPropertyDefinition(o.value))return _.fromJSON(l.interpolatedPropertyDefinitionToJsonExpr(o.value));if(!v(o.value))return _.fromJSON(o.value);o=o.value}if(!v(o))throw new Error(`unsupported definition ${i}`);t.lockedNames.add(i);try{n=F(o,t)}finally{t.lockedNames.delete(i)}return t.cache.set(i,n),n}(t,i);case"get":return function(e,t){if(void 0!==e[2])return I("get",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new x(i)}(t,i);case"has":return function(e,t){if(void 0!==e[2])return I("has",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new P(i)}(t,i);case"literal":return function(e){const t=e[1];if(null===t||"object"!=typeof t)throw new Error("expected an object or array literal");return new E(t)}(t);case"match":return function(e,t){if(e.length<4)throw new Error("not enough arguments");if(!(e.length%2))throw new Error("fallback is missing in 'match' expression");const i=F(e[1],t),r=[];for(let i=2;i<e.length-1;i+=2){const n=e[i];if(!A.isValidMatchLabel(n))throw new Error(`'${JSON.stringify(n)}' is not a valid label for 'match'`);const o=F(e[i+1],t);r.push([n,o])}const n=F(e[e.length-1],t);return new A(i,r,n)}(t,i);case"case":return function(e,t){if(e.length<3)throw new Error("not enough arguments");if(e.length%2)throw new Error("fallback is missing in 'case' expression");const i=[];for(let r=1;r<e.length-1;r+=2){const n=F(e[r],t),o=F(e[r+1],t);i.push([n,o])}const r=F(e[e.length-1],t);return new L(i,r)}(t,i);case"interpolate":return function(e,t){const i=e[1];if(!function(e){if(!Array.isArray(e))return!1;switch(e[0]){case"discrete":case"linear":case"cubic":case"exponential":return!0;default:return!1}}(i))throw new Error("expected an interpolation type");if("exponential"===i[0]&&"number"!=typeof i[1])throw new Error("expected the base of the exponential interpolation");const r=e[2]?F(e[2],t):void 0;if(!_.isExpr(r))throw new Error("expected the input of the interpolation");if(3===e.length||!(e.length%2))throw new Error("invalid number of samples");const n=[];for(let i=3;i<e.length-1;i+=2){const r=e[i],o=F(e[i+1],t);n.push([r,o])}return new D(i,r,n)}(t,i);case"step":return function(e,t){if(e.length<2)throw new Error("expected the input of the 'step' operator");if(e.length<3||!(e.length%2))throw new Error("not enough arguments");const i=F(e[1],t),r=F(e[2],t),n=[];for(let i=3;i<e.length;i+=2){const r=e[i],o=F(e[i+1],t);n.push([r,o])}return new R(i,r,n)}(t,i);default:return I(r,t,i)}}(e,t);if(null===e)return b.instance;if("boolean"==typeof e)return new T(e);if("number"==typeof e)return new w(e);if("string"==typeof e)return new M(e);throw new Error(`failed to create expression from: ${JSON.stringify(e)}`)}function I(e,t,i){return new C(e,t.slice(1).map(e=>F(e,i)))}},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(204),t),n(i(46),t),n(i(18),t),n(i(87),t),n(i(207),t),n(i(210),t),n(i(88),t),n(i(48),t),n(i(24),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoCoordinates=void 0;const r=i(21),n=i(63),o=i(64),s=i(0);class a{constructor(e,t,i){this.latitude=e,this.longitude=t,this.altitude=i}static fromDegrees(e,t,i){return new a(e,t,i)}static fromRadians(e,t,i){return new a(s.MathUtils.radToDeg(e),s.MathUtils.radToDeg(t),i)}static fromLatLng(e){return new a(e.lat,e.lng)}static fromGeoPoint(e){return new a(e[1],e[0],e[2])}static fromObject(e){if(n.isGeoPointLike(e))return a.fromGeoPoint(e);if(r.isGeoCoordinatesLike(e))return a.fromDegrees(e.latitude,e.longitude,e.altitude);if(o.isLatLngLike(e))return a.fromDegrees(e.lat,e.lng);throw new Error("Invalid input coordinate format.")}get latitudeInRadians(){return s.MathUtils.degToRad(this.latitude)}get longitudeInRadians(){return s.MathUtils.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;if(isNaN(e)||isNaN(t))return this;if(e>90){let i=(e+90)%360;i>=180&&(t+=180,i=360-i),e=i-90}if(e<-90){let i=(e-90)%360;i<=-180&&(t+=180,i=-360-i),e=i+90}if(t<-180||t>180){const e=Math.sign(t);t=(t%360+180*e)%360-180*e}return e===this.latitude&&t===this.longitude?this:new a(e,t,this.altitude)}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new a(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}}t.GeoCoordinates=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0;const r=i(0);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function i(e,i){const r=(e=t(e))-(i=t(i));return r>180?r-360:r<=-180?r+360:r}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,i,r){return void 0===r?{x:e,y:t,z:i}:(r.x=e,r.y=t,r.z=i,r)},e.copyVector3=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.degToRad=r.MathUtils.degToRad,e.radToDeg=r.MathUtils.radToDeg,e.clamp=r.MathUtils.clamp,e.normalizeAngleDeg=t,e.normalizeLongitudeDeg=function(e){return(e=t(e))>180&&(e-=360),e},e.angleDistanceDeg=i,e.interpolateAnglesDeg=function(e,t,r){return(e+i(t,e)*r)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShaderDefine=t.setShaderDefine=t.getShaderMaterialDefine=t.setShaderMaterialDefine=t.disableBlending=t.enableBlending=t.enforceBlending=t.insertShaderInclude=t.DEFINE_BOOL_FALSE=t.DEFINE_BOOL_TRUE=void 0;const r=i(1),n=i(0);function o(e){e.transparent||e.forcedBlending||(e.blending=n.CustomBlending,!0===e.premultipliedAlpha?(e.blendSrc=n.OneFactor,e.blendDst=n.OneMinusSrcAlphaFactor,e.blendSrcAlpha=n.OneFactor,e.blendDstAlpha=n.OneMinusSrcAlphaFactor):(e.blendSrc=n.SrcAlphaFactor,e.blendDst=n.OneMinusSrcAlphaFactor,e.blendSrcAlpha=n.OneFactor,e.blendDstAlpha=n.OneMinusSrcAlphaFactor))}function s(e,t,i=!1){return void 0===e.defines?i:l(e.defines,t)}function a(e,i,r){let n=!1;return"number"==typeof r?(n=e[i]!==r,e[i]=r):!0===r?(n=e[i]!==t.DEFINE_BOOL_TRUE,e[i]=t.DEFINE_BOOL_TRUE):!1===r&&void 0!==e[i]&&(delete e[i],n=!0),n}function l(e,i){const r=e[i];return r!==t.DEFINE_BOOL_FALSE&&(r===t.DEFINE_BOOL_TRUE||r)}t.DEFINE_BOOL_TRUE="",t.DEFINE_BOOL_FALSE=void 0,t.insertShaderInclude=function(e,t,i,r){const n=!0===r?"\t":"";return e.replace(`#include <${t}>`,`#include <${t}>\n${n}#include <${i}>`)},t.enforceBlending=function(e){e.transparent||(o(e),e.forcedBlending=!0)},t.enableBlending=o,t.disableBlending=function(e){e.transparent||e.forcedBlending||(e.blending=n.NormalBlending)},t.setShaderMaterialDefine=function(e,t,i){r.assert(void 0!==e.defines,"Do not use this function in ShaderMaterial derived c-tor.");const n=i!==s(e,t);return!!n&&(a(e.defines,t,i),e.needsUpdate=n,!0)},t.getShaderMaterialDefine=s,t.setShaderDefine=a,t.getShaderDefine=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileOffsetUtils=t.MapViewUtils=void 0;const r=i(0),n=i(3),o=i(12),s=i(4),a=i(1),l=i(36),c=a.LoggerManager.instance.create("MapViewUtils"),h=new r.Vector3(0,0,1),d=new r.Plane(h.clone()),u=new r.Sphere(void 0,o.EarthConstants.EQUATORIAL_RADIUS),m=new r.Raycaster,p={x:new r.Vector3,y:new r.Vector3,z:new r.Vector3},f={x:new r.Vector3,y:new r.Vector3,z:new r.Vector3},g={quaternions:[new r.Quaternion,new r.Quaternion],vector3:[new r.Vector3,new r.Vector3,new r.Vector3],matrix4:[new r.Matrix4,new r.Matrix4],transforms:[{xAxis:new r.Vector3,yAxis:new r.Vector3,zAxis:new r.Vector3,position:new r.Vector3}]};!function(e){function t(t,i,n,o=e.MAX_TILT_RAD){const s=t.target,a=M(t,t.camera,s),l=Math.max(Math.min(r.MathUtils.radToDeg(o),n+r.MathUtils.radToDeg(a.tilt)),0),c=r.MathUtils.radToDeg(a.azimuth+Math.PI)+i;t.lookAt({target:s,distance:t.targetDistance,tilt:l,heading:c})}function i(e,t,i){const s=g.vector3[0].copy(e.position),a=e.getWorldDirection(g.vector3[1]);m.set(s,a),void 0!==i&&(d.constant-=i,u.radius+=i);const l=new r.Vector3,c=t.type===n.ProjectionType.Planar?m.ray.intersectPlane(d,l):m.ray.intersectSphere(u,l);return void 0!==i&&(d.constant=0,u.radius=o.EarthConstants.EQUATORIAL_RADIUS),c}function h(e,t,i,s,a,l=new r.Vector3){const c=r.MathUtils.degToRad(s),h=Math.cos(c)*t,d=r.MathUtils.degToRad(i);a.projectPoint(e,l);const u=t*Math.sin(c);if(a.type===n.ProjectionType.Planar)l.x=l.x+Math.sin(d)*u,l.y=l.y-Math.cos(d)*u,l.z=l.z+h;else if(a.type===n.ProjectionType.Spherical){f.z.copy(l).normalize(),f.y.set(0,0,1).projectOnPlane(f.z).normalize(),g.quaternions[0].setFromAxisAngle(f.z,d-Math.PI),f.y.applyQuaternion(g.quaternions[0]),f.y.setLength(u);const e=t*Math.cos(c);l.add(f.y).add(f.z.setLength(e));const i=o.EarthConstants.EQUATORIAL_RADIUS+h,r=Math.sin(c)*t,n=Math.sqrt(i*i+r*r);l.setLength(n)}return l}function v(e,t){const i=t.clone().normalize();for(const r of e)if(r.angleTo(t)>Math.PI/2){const e=r.length();r.projectOnPlane(i).setLength(e)}}function y(e,t,i){const n=new r.Matrix4;n.extractRotation(i.matrixWorld);const o=new r.Vector3(0,1,0).applyMatrix4(n),s=new r.Vector3(1,0,0).applyMatrix4(n),a=(new r.Plane).setFromCoplanarPoints(i.position,t,t.clone().add(o)),l=(new r.Plane).setFromCoplanarPoints(i.position,t,t.clone().add(s)),c=g.vector3[0];c.copy(i.position);const h=r.MathUtils.degToRad(i.fov/2),d=r.MathUtils.degToRad(i.fov/2*i.aspect),u=1/Math.tan(h),m=1/Math.tan(d),p=g.vector3[1];p.copy(c).sub(t).negate();const f=(new r.Vector3).copy(p).normalize(),v=new r.Vector3,y=new r.Vector3,_=new r.Vector3;function x(e,t,i,r){t.projectPoint(e,_),y.copy(c).sub(_).negate();const n=p.angleTo(y);if(n<=i)return;const o=y.length(),s=p.length(),a=o*(Math.sin(n)*r-Math.cos(n))+s;v.copy(f).multiplyScalar(s-a),c.add(v),p.sub(v)}for(const t of e)x(t,a,h,u),x(t,l,d,m);return p.length()}function _(e,t,i,s){const a=g.vector3[0].set(t,i,0),l=g.vector3[1].copy(e.camera.position);g.matrix4[0].extractRotation(e.camera.matrixWorld),g.matrix4[1].multiplyMatrices(g.matrix4[0],g.matrix4[1].getInverse(e.camera.projectionMatrix));const c=a.applyMatrix4(g.matrix4[1]);m.set(l,c.normalize()),void 0!==s&&(d.constant-=s,u.radius+=s);const h=new r.Vector3,p=e.projection.type===n.ProjectionType.Planar?m.ray.intersectPlane(d,h):m.ray.intersectSphere(u,h);return void 0!==s&&(d.constant=0,u.radius=o.EarthConstants.EQUATORIAL_RADIUS),p}function x(e,t,i){e.camera.position.x+=t,e.camera.position.y+=i}function S(e,t,i){g.quaternions[0].setFromUnitVectors(t.normalize(),i.normalize()).inverse(),g.matrix4[0].makeRotationFromQuaternion(g.quaternions[0]),e.camera.applyMatrix4(g.matrix4[0]),e.camera.updateMatrixWorld()}function b(e,t,i,n,o=new r.Quaternion){const s=g.transforms[0];return e.localTangentSpace(t,s),g.matrix4[0].makeBasis(s.xAxis,s.yAxis,s.zAxis),o.setFromRotationMatrix(g.matrix4[0]),g.quaternions[0].setFromAxisAngle(g.vector3[1].set(0,0,1),r.MathUtils.degToRad(i)),g.quaternions[1].setFromAxisAngle(g.vector3[1].set(1,0,0),r.MathUtils.degToRad(n)),o.multiply(g.quaternions[0]),o.multiply(g.quaternions[1]),o}function T(t,i){if(i.type===n.ProjectionType.Planar){const e=t.getWorldDirection(g.vector3[0]).normalize(),n=i.surfaceNormal(t.position,g.vector3[1]).negate(),o=e.dot(n);return Math.acos(r.MathUtils.clamp(o,-1,1))}{a.assert(i.type===n.ProjectionType.Spherical);const r=e.getGeoTargetFromCamera(t,i);return null!==r?e.extractTiltAngleFromLocation(i,t,r):(c.warn("MapView camera is pointing in the void, using maxTilt: ",e.MAX_TILT_RAD),e.MAX_TILT_RAD)}}function w(e,t){g.vector3[1].setFromMatrixPosition(t.matrixWorld),e.projection.localTangentSpace(e.projection.unprojectPoint(g.vector3[1]),{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]}),g.matrix4[1].makeBasis(f.x,f.y,f.z),g.matrix4[0].getInverse(g.matrix4[1]).multiply(t.matrixWorld),p.x.setFromMatrixColumn(g.matrix4[0],0),p.y.setFromMatrixColumn(g.matrix4[0],1),p.z.setFromMatrixColumn(g.matrix4[0],2);let i=0,r=0,n=0;const o=p.z.dot(g.vector3[1].set(0,0,1));return o<.99999?o>-.99999?(i=Math.atan2(p.z.x,-p.z.y),r=Math.acos(p.z.z),n=Math.atan2(p.x.z,p.y.z)):(i=-Math.atan2(-p.y.x,p.x.x),r=180,n=0):(i=Math.atan2(-p.y.x,p.x.x),r=0,n=0),{yaw:i,pitch:r,roll:n}}function M(e,t,i){e.projection.localTangentSpace(i,{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]});let r=0,n=0;return g.vector3[1].copy(t.position).sub(g.vector3[0]).normalize(),g.vector3[1].dot(f.z)>.99999?(n=Math.PI-w(e,t).yaw,n=Math.atan2(Math.sin(n),Math.cos(n)),r=0,{tilt:r,azimuth:n}):(r=g.vector3[1].angleTo(f.z),g.vector3[1].copy(t.position).sub(g.vector3[0]).projectOnPlane(f.z).normalize(),n=g.vector3[1].angleTo(f.y),g.vector3[1].cross(f.y).dot(f.z)<0&&(n=-n),{tilt:r,azimuth:n})}function E(e,t){const i=w(e,e.camera).pitch,r=o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*r/256*Math.cos(i)}function P(e,t,i){if(null==e||void 0===e.image)return;if(void 0!==e.uuid&&!0===i.get(e.uuid))return;i.set(e.uuid,!0);const r=e.image,n=4*r.width*r.height;t.heapSize+=n,t.gpuSize+=n}function C(e,t,i){if(void 0===e.uuid||!0!==i.get(e.uuid))if(i.set(e.uuid,!0),e instanceof r.RawShaderMaterial||e instanceof r.ShaderMaterial){const n=e;for(const e in n.uniforms)if(void 0!==n.uniforms[e]){const o=n.uniforms[e];o instanceof r.Texture&&P(o,t,i)}}else if(e instanceof r.MeshBasicMaterial||e instanceof s.MapMeshBasicMaterial){const r=e;P(r.map,t,i),P(r.aoMap,t,i),P(r.specularMap,t,i),P(r.alphaMap,t,i),P(r.envMap,t,i)}else if(e instanceof s.MapMeshStandardMaterial){const r=e;P(r.map,t,i),P(r.lightMap,t,i),P(r.aoMap,t,i),P(r.emissiveMap,t,i),P(r.bumpMap,t,i),P(r.normalMap,t,i),P(r.displacementMap,t,i),P(r.roughnessMap,t,i),P(r.metalnessMap,t,i),P(r.alphaMap,t,i),P(r.envMap,t,i)}else e instanceof r.LineBasicMaterial||e instanceof r.LineDashedMaterial||c.warn("estimateMeshSize: unidentified material: ",e)}function A(e,t,i,n){if(void 0===e.uuid&&(e.uuid=r.MathUtils.generateUUID()),!0===n.get(e.uuid))return;n.set(e.uuid,!0);let o=0,s=4;void 0!==e.array.BYTES_PER_ELEMENT&&(s=e.array.BYTES_PER_ELEMENT),e instanceof r.InterleavedBufferAttribute||e instanceof r.BufferAttribute?o=s*e.count*e.itemSize:c.warn("estimateMeshSize: unidentified attribute: ",t),i.heapSize+=o+56,i.gpuSize+=o}function L(e,t,i){if(!(void 0===e.uuid||!0!==i.get(e.uuid)))return;let n;if(i.set(e.uuid,!0),e instanceof r.Geometry?(t.heapSize+=24*e.vertices.length,t.heapSize+=48*e.faces.length,n=e._bufferGeometry):e instanceof r.BufferGeometry&&(n=e),void 0===n)return;const o=n.attributes;if(void 0!==o){for(const e in o)void 0!==o[e]&&A(o[e],e,t,i);null!==n.index&&A(n.index,"index",t,i)}else c.warn("estimateGeometrySize: unidentified geometry: ",e)}function R(e){return e.substring(0,2)}e.MAX_TILT_DEG=89,e.MAX_TILT_RAD=e.MAX_TILT_DEG*r.MathUtils.DEG2RAD,e.zoomOnTargetPosition=function(i,r,s,a,l=e.MAX_TILT_RAD){const{elevationProvider:c,camera:h}=i,d=c?c.getHeight(i.projection.unprojectPoint(h.position),4):void 0,u=_(i,r,s,d),m=E(i,a)+(null!=d?d:0);if(i.projection.type===n.ProjectionType.Planar?h.position.setZ(m):i.projection.type===n.ProjectionType.Spherical&&h.position.setLength(o.EarthConstants.EQUATORIAL_RADIUS+m),i.projection.type===n.ProjectionType.Spherical){const e=T(h,i.projection)-l;e>0&&t(i,0,e,l)}const p=_(i,r,s,d);u&&p&&(i.projection.type===n.ProjectionType.Planar?(u.sub(p),x(i,u.x,u.y)):i.projection.type===n.ProjectionType.Spherical&&S(i,u,p))},e.orbitFocusPoint=t,e.getGeoTargetFromCamera=function(e,t,r){const n=i(e,t,r);return null!==n?t.unprojectPoint(n):null},e.getWorldTargetFromCamera=i,e.getTargetAndDistance=function(t,r,s){const a=w({projection:t},r).pitch,l=s?s.getHeight(t.unprojectPoint(r.position),4):void 0,c=a<e.MAX_TILT_RAD?i(r,t,l):null;if(null!==c){return{target:c,distance:r.position.distanceTo(c)}}{const i=function(e,t,i,r){if(void 0!==i){const n=t.unprojectPoint(e),o=i.getHeight(n,r);if(void 0!==o){const i=t.unprojectAltitude(e)-o;return Math.max(i,1)}}return Math.abs(t.groundDistance(e))}(r.position,t,s,4),l=t.type===n.ProjectionType.Planar?i/Math.cos(Math.min(a,e.MAX_TILT_RAD)):Math.sqrt(Math.pow(i+o.EarthConstants.EQUATORIAL_RADIUS,2)-Math.pow(o.EarthConstants.EQUATORIAL_RADIUS,2)),c=r.getWorldDirection(g.vector3[0]);c.multiplyScalar(l);const h=g.vector3[1];return h.copy(r.position).add(c),{target:h,distance:l}}},e.getCameraPositionFromTargetCoordinates=h,e.wrapGeoPointsToScreen=function(e,t){let i=0;void 0===t&&(t=n.GeoCoordinates.fromObject(e[0]),i=1);let r=t.latitude,o=t.latitude,s=n.MathUtils.normalizeLongitudeDeg(t.longitude),a=0,l=t.longitude,c=t.longitude;const h=[];h.push(new n.GeoCoordinates(r,s));for(let t=i;t<e.length;t++){const i=n.GeoCoordinates.fromObject(e[t]);i.latitude>r?r=i.latitude:i.latitude<o&&(o=i.latitude);let d=n.MathUtils.normalizeLongitudeDeg(i.longitude);const u=n.MathUtils.angleDistanceDeg(s,d);d=s-u,u<0&&-u>a/2?(l=Math.max(l,s-u),a=l-c,s=(l+c)/2):u>0&&u>a/2&&(c=Math.min(c,d),a=l-c,s=(l+c)/2),h.push(new n.GeoCoordinates(i.latitude,d))}return h},e.wrapWorldPointsToView=v,e.geoBoxToGeoPoints=function(e){const t=e.center;return[new n.GeoCoordinates(e.north,e.west),new n.GeoCoordinates(e.north,e.east),new n.GeoCoordinates(t.latitude,e.west),new n.GeoCoordinates(t.latitude,e.east),new n.GeoCoordinates(e.south,e.west),new n.GeoCoordinates(e.south,e.east),new n.GeoCoordinates(e.north,t.longitude),new n.GeoCoordinates(e.south,t.longitude)]},e.getFitBoundsDistance=y,e.getFitBoundsLookAtParams=function(e,t,i,r){const{tilt:o,heading:s,projection:a}=r,l=r.minDistance,c=r.camera.clone();return b(a,e,-s,o,c.quaternion),h(e,l,-s,o,a,c.position),c.updateMatrixWorld(!0),a.type===n.ProjectionType.Spherical&&v(i,c.position),{target:e,distance:y(i,t,c),heading:s,tilt:o}},e.getCameraCoordinatesFromTargetCoordinates=function(e,t,i,r,n){return n.projection.unprojectPoint(h(e,t,i,r,n.projection,g.vector3[1]))},e.rayCastWorldCoordinates=_,e.panCameraAboveFlatMap=x,e.panCameraAroundGlobe=S,e.rotate=function(t,i,s=0,a=Math.PI/4){if(t.camera.rotateOnWorldAxis(t.projection.type===n.ProjectionType.Spherical?g.vector3[0].copy(t.camera.position).normalize():g.vector3[0].set(0,0,1),r.MathUtils.degToRad(-i)),t.camera.updateMatrixWorld(),0===s)return;const l=e.extractAttitude(t,t.camera).pitch;let c=r.MathUtils.clamp(l+r.MathUtils.degToRad(s),0,a);if(t.projection.type===n.ProjectionType.Spherical){const e=Math.asin(o.EarthConstants.EQUATORIAL_RADIUS*Math.sin(Math.PI-a)/t.camera.position.length());c=Math.min(c,e)}t.camera.rotateX(c-l)},e.getCameraRotationAtTarget=b,e.setRotation=function(e,t,i){b(e.projection,e.geoCenter,t,i,e.camera.quaternion)},e.extractCameraTilt=T,e.extractAttitude=w,e.extractSphericalCoordinatesFromLocation=M,e.extractTiltAngleFromLocation=function(e,t,i){e.localTangentSpace(i,{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]});const n=g.vector3[1].copy(t.position).sub(g.vector3[0]),o=n.length();if(o<1e-5)return c.error("Can not calculate tilt for the zero length vector!"),0;n.divideScalar(o);const s=n.dot(f.z);return s>.99999?0:Math.acos(r.MathUtils.clamp(s,-1,1))},e.getCameraFrustumPlanes=function(e){const t=e.near,i=e.far;let n=t*Math.tan(r.MathUtils.degToRad(.5*e.fov))/e.zoom,o=2*n,s=e.aspect*o,a=-.5*s;const l=e.view;if(null!==l&&l.enabled){const e=l.fullWidth,t=l.fullHeight;a+=l.offsetX*s/e,n-=l.offsetY*o/t,s*=l.width/e,o*=l.height/t}return a+=0!==e.filmOffset?t*e.filmOffset/e.getFilmWidth():0,{left:a,right:a+s,top:n,bottom:n-o,near:t,far:i}},e.rayCastGeoCoordinates=function(e,t,i){const r=_(e,t,i);return r?e.projection.unprojectPoint(r):null},e.calculateDistanceToGroundFromZoomLevel=E,e.calculateDistanceFromZoomLevel=function(e,t){const i=o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*i/256},e.calculateZoomLevelFromDistance=function(e,t){const i=256*t/e.focalLength;return function(e){const t=Math.ceil(e);return t-e<1e-6?t:e}(r.MathUtils.clamp(Math.log2(o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/i),e.minZoomLevel,e.maxZoomLevel))},e.calculateDepthFromClipDistance=function(e,t){const i=t,r=i.far-i.near,n=e*i.far;return(1-i.near/n)*(i.far/r)},e.cameraToWorldDistance=function(e,t){return e*t.far},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)*t)},e.calculateFocalLengthByVerticalFov=function(e,t){return t/2/Math.tan(e/2)},e.calculateFovByFocalLength=function(e,t){return r.MathUtils.radToDeg(2*Math.atan(t/2/e))},e.calculateScreenSizeByFocalLength=function(e,t,i){return e*i/t},e.calculateWorldSizeByFocalLength=function(e,t,i){return t*i/e},e.estimateObject3dSize=function e(t,i,n){const o=void 0!==i?i:{heapSize:0,gpuSize:0};if(void 0===n&&(n=new Map),function(e,t,i){if(!e.isObject3D||e instanceof r.Scene)return;if(void 0!==e.uuid&&!0===i.get(e.uuid))return;if(i.set(e.uuid,!0),e.isMesh||e.isLine||e.isPoints){let r=1e3;const n=0,o=e;if(void 0!==o.material)if(Array.isArray(o.material)){const e=o.material;for(const r of e)C(r,t,i)}else{C(o.material,t,i)}if(void 0!==o.geometries)for(const e of o.geometries)L(e,t,i);else void 0!==o.geometry&&L(o.geometry,t,i);const s=void 0!==e.userData?e.userData.feature:void 0;void 0!==s&&(r+=l.getFeatureDataSize(s)),t.heapSize+=r,t.gpuSize+=n}else c.warn("estimateMeshSize: unidentified object",e)}(t,o,n),t.children.length>0)for(const i of t.children)e(i,o,n);return o},e.mapViewIsLoading=function(e){let t=0;for(const i of e.visibleTileSet.dataSourceTileList){t+=i.numTilesLoading;for(const e of i.visibleTiles)void 0===e.tileLoader||e.tileLoader.isFinished||t++,void 0===e.tileGeometryLoader||e.tileGeometryLoader.isFinished||t++}let i=t>0;return void 0!==e.textElementsRenderer&&(i=i||e.textElementsRenderer.loading),i=i||!e.poiTableManager.finishedLoading||!e.visibleTileSet.allVisibleTilesLoaded,i},e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const e=[];for(const t of navigator.languages)e.push(R(t));return e}if(void 0!==navigator.language)return[R(navigator.language)]}}(t.MapViewUtils||(t.MapViewUtils={}));const v=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];!function(e){function t(e,t,i=4){const r=function(e,t=4){let i=0;const r=v[t];e+=r/2;for(;e<0;)e+=r;for(;e>=r;)e-=r;for(let r=0;r<t&&e>0;r++)1&e&&(i+=v[53-t+r]),e>>>=1;return a.assert(0===e),i}(t,i);return e.mortonCode()+r}function i(e,t=4){let i=0,r=e,n=0;for(;n<t;n++){const e=v[52-n];r>=e&&(r-=e,i+=v[t-1-n])}return i-=v[t-1],{offset:i,mortonCode:r}}e.getKeyForTileKeyAndOffset=t,e.extractOffsetAndMortonKeyFromKey=i,e.getParentKeyFromKey=function(e,r=4){const{offset:o,mortonCode:s}=i(e,r);return t(n.TileKey.fromMortonCode(n.TileKey.parentMortonCode(s)),o,r)}}(t.TileOffsetUtils||(t.TileOffsetUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EarthConstants=void 0;let r=(()=>{class e{}return e.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,e.EQUATORIAL_RADIUS=6378137,e.MIN_ELEVATION=-433,e.MAX_ELEVATION=8848,e.MAX_BUILDING_HEIGHT=828,e})();t.EarthConstants=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=void 0,t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=void 0,t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Projection=t.ProjectionType=void 0;const r=i(21),n=i(8);!function(e){e[e.Planar=0]="Planar",e[e.Spherical=1]="Spherical"}(t.ProjectionType||(t.ProjectionType={}));t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return r.isGeoCoordinatesLike(e)?this.projectPoint(e,t.position):n.MathUtils.copyVector3(e,t.position),n.MathUtils.newVector3(1,0,0,t.xAxis),n.MathUtils.newVector3(0,1,0,t.yAxis),n.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,i){return e===this?void 0===i?{x:t.x,y:t.y,z:t.z}:(i.x=t.x,i.y=t.y,i.z=t.z,i):this.projectPoint(e.unprojectPoint(t),i)}}},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(72),t),n(i(83),t),n(i(49),t),n(i(50),t),n(i(89),t),n(i(51),t),n(i(51),t),n(i(94),t),n(i(94),t),n(i(219),t),n(i(59),t),n(i(254),t),n(i(121),t),n(i(255),t),n(i(53),t),n(i(117),t),n(i(19),t),n(i(102),t),n(i(258),t),n(i(259),t),n(i(110),t),n(i(260),t),n(i(112),t),n(i(111),t),n(i(113),t),n(i(52),t),n(i(261),t),n(i(114),t),n(i(56),t),n(i(58),t),n(i(262),t),n(i(115),t),n(i(116),t),n(i(37),t),n(i(17),t),n(i(39),t),n(i(109),t),n(i(263),t),n(i(119),t),n(i(36),t),n(i(264),t),n(i(123),t),n(i(10),t),n(i(120),t),n(i(93),t),n(i(95),t),n(i(92),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElement=t.LoadingState=t.poiIsRenderable=void 0;const r=i(6),n=i(1),o=i(0),s=i(25);t.poiIsRenderable=function(e){return void 0!==e.poiRenderBatch},function(e){e[e.Requested=0]="Requested",e[e.Loaded=1]="Loaded",e[e.Initialized=2]="Initialized"}(t.LoadingState||(t.LoadingState={}));let a=(()=>{class e{constructor(e,t,i,n,a=0,l=0,c=0,h,d,u,m,p,f){this.text=e,this.points=t,this.renderParams=i,this.layoutParams=n,this.priority=a,this.xOffset=l,this.yOffset=c,this.featureId=h,this.style=d,this.fadeNear=u,this.fadeFar=m,this.tileOffset=p,this.offsetDirection=f,this.visible=!0,this.distanceScale=.5,this.renderOrder=0,this.elevated=!1,i instanceof r.TextRenderStyle&&(this.renderStyle=i),n instanceof r.TextLayoutStyle&&(this.layoutStyle=n),this.type=t instanceof o.Vector3?s.TextElementType.PoiLabel:s.TextElementType.PathLabel}get position(){if(this.points instanceof Array){return this.points[0]}return this.points}get path(){if(this.points instanceof Array)return this.points}get textMayOverlap(){return!0===this.mayOverlap}set textMayOverlap(e){this.mayOverlap=e}get textReservesSpace(){return!1!==this.reserveSpace}set textReservesSpace(e){this.reserveSpace=e}get poiInfo(){return this.m_poiInfo}set poiInfo(e){if(this.m_poiInfo=e,void 0!==e){void 0!==this.path&&(this.type=s.TextElementType.LineMarker);const t=void 0!==this.renderOrder?this.renderOrder:0;e.renderOrder=t}}get renderStyle(){return this.m_renderStyle}set renderStyle(e){this.m_renderStyle=e}get layoutStyle(){return this.m_layoutStyle}set layoutStyle(e){this.m_layoutStyle=e}hasFeatureId(){return void 0!==this.featureId&&0!==this.featureId}updateMinMaxZoomLevelsFromPoiInfo(){void 0!==this.poiInfo&&(void 0===this.minZoomLevel&&(this.minZoomLevel=n.MathUtils.min2(this.poiInfo.iconMinZoomLevel,this.poiInfo.textMinZoomLevel)),void 0===this.maxZoomLevel&&(this.maxZoomLevel=n.MathUtils.max2(this.poiInfo.iconMaxZoomLevel,this.poiInfo.textMaxZoomLevel)))}}return e.HIGHEST_PRIORITY=Number.MAX_SAFE_INTEGER,e})();t.TextElement=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolvePlacementAndAlignment=t.TextLayoutStyle=t.TextRenderStyle=t.DefaultTextStyle=t.vPlacementFromAlignment=t.hPlacementFromAlignment=t.vAlignFromPlacement=t.hAlignFromPlacement=t.WrappingMode=t.HorizontalPlacement=t.VerticalPlacement=t.HorizontalAlignment=t.VerticalAlignment=t.FontVariant=t.FontStyle=t.FontUnit=void 0;const r=i(0);var n,o,s,a,l,c,h;function d(e){return e}function u(e){return e}!function(e){e[e.Em=0]="Em",e[e.Pixel=1]="Pixel",e[e.Point=2]="Point",e[e.Percent=3]="Percent"}(n=t.FontUnit||(t.FontUnit={})),function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic"}(o=t.FontStyle||(t.FontStyle={})),function(e){e[e.Regular=0]="Regular",e[e.AllCaps=1]="AllCaps",e[e.SmallCaps=2]="SmallCaps"}(s=t.FontVariant||(t.FontVariant={})),function(e){e[e.Above=0]="Above",e[e.Center=-.5]="Center",e[e.Below=-1]="Below"}(a=t.VerticalAlignment||(t.VerticalAlignment={})),function(e){e[e.Left=0]="Left",e[e.Center=-.5]="Center",e[e.Right=-1]="Right"}(l=t.HorizontalAlignment||(t.HorizontalAlignment={})),function(e){e[e.Top=0]="Top",e[e.Center=-.5]="Center",e[e.Bottom=-1]="Bottom"}(t.VerticalPlacement||(t.VerticalPlacement={})),function(e){e[e.Left=-1]="Left",e[e.Center=-.5]="Center",e[e.Right=0]="Right"}(t.HorizontalPlacement||(t.HorizontalPlacement={})),function(e){e[e.None=0]="None",e[e.Character=1]="Character",e[e.Word=2]="Word"}(c=t.WrappingMode||(t.WrappingMode={})),t.hAlignFromPlacement=d,t.vAlignFromPlacement=u,t.hPlacementFromAlignment=function(e){return e},t.vPlacementFromAlignment=function(e){return e},function(e){e.DEFAULT_FONT_NAME="",e.DEFAULT_FONT_SIZE={unit:Object.freeze(n.Pixel),size:Object.freeze(16),backgroundSize:Object.freeze(0)},e.DEFAULT_FONT_STYLE=o.Regular,e.DEFAULT_FONT_VARIANT=s.Regular,e.DEFAULT_ROTATION=0,e.DEFAULT_COLOR=new r.Color(0),e.DEFAULT_OPACITY=1,e.DEFAULT_BACKGROUND_COLOR=new r.Color(0),e.DEFAULT_BACKGROUND_OPACITY=0,e.DEFAULT_TRACKING=0,e.DEFAULT_LEADING=0,e.DEFAULT_MAX_LINES=1/0,e.DEFAULT_LINE_WIDTH=1/0,e.DEFAULT_CANVAS_ROTATION=0,e.DEFAULT_LINE_ROTATION=0,e.DEFAULT_WRAPPING_MODE=c.Word,e.DEFAULT_VERTICAL_ALIGNMENT=a.Above,e.DEFAULT_HORIZONTAL_ALIGNMENT=l.Left,e.DEFAULT_PLACEMENTS=[]}(h=t.DefaultTextStyle||(t.DefaultTextStyle={}));class m{constructor(e={}){this.m_params={fontName:void 0!==e.fontName?e.fontName:h.DEFAULT_FONT_NAME,fontSize:void 0!==e.fontSize?Object.assign({},e.fontSize):{unit:h.DEFAULT_FONT_SIZE.unit,size:h.DEFAULT_FONT_SIZE.size,backgroundSize:h.DEFAULT_FONT_SIZE.backgroundSize},fontStyle:void 0!==e.fontStyle?e.fontStyle:h.DEFAULT_FONT_STYLE,fontVariant:void 0!==e.fontVariant?e.fontVariant:h.DEFAULT_FONT_VARIANT,rotation:void 0!==e.rotation?e.rotation:h.DEFAULT_ROTATION,color:void 0!==e.color?e.color.clone():h.DEFAULT_COLOR.clone(),opacity:void 0!==e.opacity?e.opacity:h.DEFAULT_OPACITY,backgroundColor:void 0!==e.backgroundColor?e.backgroundColor.clone():h.DEFAULT_BACKGROUND_COLOR.clone(),backgroundOpacity:void 0!==e.backgroundOpacity?e.backgroundOpacity:h.DEFAULT_BACKGROUND_OPACITY}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get fontName(){return this.m_params.fontName}set fontName(e){this.m_params.fontName=e}get fontSize(){return this.m_params.fontSize}set fontSize(e){this.m_params.fontSize=Object.assign({},e)}get fontStyle(){return this.m_params.fontStyle}set fontStyle(e){this.m_params.fontStyle=e}get fontVariant(){return this.m_params.fontVariant}set fontVariant(e){this.m_params.fontVariant=e}get rotation(){return this.m_params.rotation}set rotation(e){this.m_params.rotation=e}get color(){return this.m_params.color}set color(e){this.m_params.color.copy(e)}get backgroundColor(){return this.m_params.backgroundColor}set backgroundColor(e){this.m_params.backgroundColor.copy(e)}get opacity(){return this.m_params.opacity}set opacity(e){this.m_params.opacity=e}get backgroundOpacity(){return this.m_params.backgroundOpacity}set backgroundOpacity(e){this.m_params.backgroundOpacity=e}clone(e={}){return new m(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.m_params.fontName=e.fontName,this.m_params.fontSize=Object.assign({},e.fontSize),this.m_params.fontStyle=e.fontStyle,this.m_params.fontVariant=e.fontVariant,this.m_params.rotation=e.rotation,this.m_params.color.copy(e.color),this.m_params.backgroundColor.copy(e.backgroundColor),this.m_params.opacity=e.opacity,this.m_params.backgroundOpacity=e.backgroundOpacity,this}}t.TextRenderStyle=m;class p{constructor(e={}){const{horizontalAlignment:t,verticalAlignment:i,placements:r}=f(e.horizontalAlignment,e.verticalAlignment,e.placements);this.m_params={tracking:void 0!==e.tracking?e.tracking:h.DEFAULT_TRACKING,leading:void 0!==e.leading?e.leading:h.DEFAULT_LEADING,maxLines:void 0!==e.maxLines?e.maxLines:h.DEFAULT_MAX_LINES,lineWidth:void 0!==e.lineWidth?e.lineWidth:h.DEFAULT_LINE_WIDTH,canvasRotation:void 0!==e.canvasRotation?e.canvasRotation:h.DEFAULT_CANVAS_ROTATION,lineRotation:void 0!==e.lineRotation?e.lineRotation:h.DEFAULT_LINE_ROTATION,wrappingMode:void 0!==e.wrappingMode?e.wrappingMode:h.DEFAULT_WRAPPING_MODE,verticalAlignment:i,horizontalAlignment:t,placements:r}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get tracking(){return this.m_params.tracking}set tracking(e){this.m_params.tracking=e}get leading(){return this.m_params.leading}set leading(e){this.m_params.leading=e}get maxLines(){return this.m_params.maxLines}set maxLines(e){this.m_params.maxLines=e}get lineWidth(){return this.m_params.lineWidth}set lineWidth(e){this.m_params.lineWidth=e}get canvasRotation(){return this.m_params.canvasRotation}set canvasRotation(e){this.m_params.canvasRotation=e}get lineRotation(){return this.m_params.lineRotation}set lineRotation(e){this.m_params.lineRotation=e}get wrappingMode(){return this.m_params.wrappingMode}set wrappingMode(e){this.m_params.wrappingMode=e}get verticalAlignment(){return this.m_params.verticalAlignment}set verticalAlignment(e){this.m_params.verticalAlignment=e}get horizontalAlignment(){return this.m_params.horizontalAlignment}set horizontalAlignment(e){this.m_params.horizontalAlignment=e}get placements(){return this.m_params.placements}set placements(e){const{horizontalAlignment:t,verticalAlignment:i,placements:r}=f(this.horizontalAlignment,this.verticalAlignment,e);this.m_params.horizontalAlignment=t,this.m_params.verticalAlignment=i,this.m_params.placements=r}clone(e={}){return new p(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.params=Object.assign({},e.params),this}}function f(e,t,i){var r;const n=null!==(r=null==i?void 0:i.map(e=>Object.assign({},e)))&&void 0!==r?r:h.DEFAULT_PLACEMENTS.map(e=>Object.assign({},e));return{horizontalAlignment:n.length>0?n[0].h:null!=e?e:h.DEFAULT_HORIZONTAL_ALIGNMENT,verticalAlignment:n.length>0?n[0].v:null!=t?t:h.DEFAULT_VERTICAL_ALIGNMENT,placements:n}}t.TextLayoutStyle=p,t.resolvePlacementAndAlignment=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateColorProperty=t.applyBaseColorToMaterial=t.applySecondaryColorToMaterial=t.evaluateBaseColorProperty=t.buildMetricValueEvaluator=t.getMaterialConstructor=t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=t.buildObject=t.usesObject3D=t.getBufferAttribute=t.createMaterial=void 0;const r=i(2),n=i(4),o=i(1),s=i(0),a=i(222),l=i(224),c=i(55),h=i(56),d=i(101),u=o.LoggerManager.instance.create("DecodedTileHelpers");function m(e,t){if(void 0!==e.name)switch(e.name){case"extruded-line":if(!r.isExtrudedLineTechnique(e))throw new Error("Invalid extruded-line technique");return"standard"===e.shading?n.MapMeshStandardMaterial:n.MapMeshBasicMaterial;case"standard":case"terrain":case"extruded-polygon":return n.MapMeshStandardMaterial;case"dashed-line":case"solid-line":return n.SolidLineMaterial;case"fill":return t?n.MapMeshStandardMaterial:n.MapMeshBasicMaterial;case"squares":return s.PointsMaterial;case"circles":return n.CirclePointsMaterial;case"line":case"segments":return s.LineBasicMaterial;case"shader":return s.ShaderMaterial;case"text":case"labeled-icon":case"line-marker":case"label-rejection-line":return}}function p(e,t){return null==e?e:("string"==typeof e&&(e.endsWith("px")?(t="Pixel",e=Number.parseFloat(e)):e.endsWith("m")&&(e=Number.parseFloat(e))),"Pixel"===t?t=>{var i;return(null!==(i=t.env.lookup("$pixelToMeters"))&&void 0!==i?i:1)*r.getPropertyValue(e,t.env)}:e)}function f(e,t,i){let n=y(t,i);void 0!==n&&(r.ColorUtils.hasAlphaInHex(n)&&(u.warn("Used RGBA value for technique color without transparency support!"),n=r.ColorUtils.removeAlphaFromHex(n)),e.setHex(n))}function g(e,t,i,o,a){const l=y(o,a);if(void 0===l)return;const{r:c,g:h,b:d,a:u}=r.ColorUtils.getRgbaFromHex(l),m=i;let p=u;void 0!==m.opacity&&(p*=v(m.opacity,a)),p=s.MathUtils.clamp(p,0,1),e.opacity=p,t.setRGB(c,h,d),p>=1?n.disableBlending(e):n.enableBlending(e)}function v(e,t){return void 0!==t&&r.Expr.isExpr(e)&&(e=r.getPropertyValue(e,t)),e}function y(e,t){if(null!=(e=v(e,t))){if("number"==typeof e)return e;if("string"==typeof e){const t=r.parseStringEncodedColor(e);if(void 0!==t)return t}u.error(`Unsupported color format: '${e}'`)}}function _(e){const t=r.techniqueDescriptors[e.name];return void 0!==t?t.attrTransparencyColor:void 0}t.createMaterial=function(e,t){const i=e.technique,a=m(i,!0===e.shadowsEnabled),l={};if(void 0===a)return;a.prototype instanceof s.RawShaderMaterial&&a!==n.HighPrecisionLineMaterial&&(l.fog=e.fog),!0===e.shadowsEnabled&&"fill"===i.name&&(l.removeDiffuseLight=!0);const h=new a(l);return void 0!==i.id&&(h.name=i.id),r.isExtrudedPolygonTechnique(i)&&(h.flatShading=!0),h.depthTest=r.isExtrudedPolygonTechnique(i)&&!1!==i.depthTest,(r.isStandardTechnique(i)||r.isTerrainTechnique(i)||r.isExtrudedPolygonTechnique(i))&&r.TEXTURE_PROPERTY_KEYS.forEach(e=>{const n=i[e];if(void 0===n)return;const o=r=>{const n=i[e+"Properties"];void 0!==n&&(void 0!==n.wrapS&&(r.wrapS=d.toWrappingMode(n.wrapS)),void 0!==n.wrapT&&(r.wrapT=d.toWrappingMode(n.wrapT)),void 0!==n.magFilter&&(r.magFilter=d.toTextureFilter(n.magFilter)),void 0!==n.minFilter&&(r.minFilter=d.toTextureFilter(n.minFilter)),void 0!==n.flipY&&(r.flipY=n.flipY),void 0!==n.repeatU&&(r.repeat.x=n.repeatU),void 0!==n.repeatV&&(r.repeat.y=n.repeatV)),h[e]=r,r.needsUpdate=!0,h.needsUpdate=!0,t&&t(r)},a=e=>{u.error("#createMaterial: Failed to load texture: ",e)};let l;if("string"==typeof n)l=n;else if(r.isTextureBuffer(n))if("image/raw"===n.type){const e=n.dataTextureProperties;if(void 0!==e){const t=e.type?d.toTextureDataType(e.type):void 0,i=function(e,t){if(void 0===t)return new Uint8Array(e);switch(t){case s.UnsignedByteType:return new Uint8Array(e);case s.ByteType:return new Int8Array(e);case s.ShortType:return new Int16Array(e);case s.UnsignedShortType:return new Uint16Array(e);case s.IntType:return new Int32Array(e);case s.UnsignedIntType:return new Uint32Array(e);case s.FloatType:return new Float32Array(e);case s.HalfFloatType:return new Uint16Array(e)}throw new Error("Unsupported texture data type")}(n.buffer,t);o(new s.DataTexture(i,e.width,e.height,e.format?d.toPixelFormat(e.format):void 0,t))}else a("no data texture properties provided.")}else{const e=new Blob([n.buffer],{type:n.type});l=URL.createObjectURL(e)}l&&(new s.TextureLoader).load(l,o,void 0,a)}),r.isShaderTechnique(i)?function(e,t){e.transparent?n.enableBlending(t):n.disableBlending(t);const i=e.params,o=_(e),a=o&&o in e.params;if(Object.getOwnPropertyNames(i).filter(e=>{if(o===e||a&&r.TRANSPARENCY_PROPERTY_KEYS.indexOf(e)!==-1){return false}const t=e;if(t==="name"){return false}return true}).forEach(e=>{!function(e,t,i,r){const n=e;if(n[t]instanceof s.Color)f(e[t],i,r);else{const e=v(i,r);null!==e&&(n[t]=e)}}(t,e,i[e])}),a){const r=o;g(t,t[r],e,i[r])}}(i,h):c.MapMaterialAdapter.create(h,function(e){var t;switch(e.name){case"dashed-line":case"solid-line":{const i=o.pick(e,["color","outlineColor","transparent","opacity","caps","drawRangeStart","drawRangeEnd","dashes","dashColor","polygonOffset","polygonOffsetFactor","polygonOffsetUnits"]);return i.lineWidth=p(null!==(t=e.lineWidth)&&void 0!==t?t:0,e.metricUnit),i.outlineWidth=p(e.outlineWidth,e.metricUnit),i.dashSize=p(e.dashSize,e.metricUnit),i.gapSize=p(e.gapSize,e.metricUnit),i.offset=p(e.offset,e.metricUnit),i}case"fill":return o.pick(e,["color","transparent","opacity","polygonOffset","polygonOffsetFactor","polygonOffsetUnits"]);case"standard":case"terrain":case"extruded-polygon":{const t=o.pick(e,["vertexColors","wireframe","roughness","metalness","alphaTest","depthTest","transparent","opacity","emissive","emissiveIntensity","refractionRatio","normalMapType"]);return!0!==e.vertexColors&&(t.color=e.color),t}case"circles":case"squares":return o.pick(e,["color","size","opacity","transparent"]);case"extruded-line":return o.pick(e,["color","wireframe","transparent","opacity","polygonOffset","polygonOffsetFactor","polygonOffsetUnits"]);case"line":case"segments":return o.pick(e,["color","transparent","opacity"]);default:return{}}}(i)),h},t.getBufferAttribute=function(e){switch(e.type){case"float":return new s.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint8":return new s.BufferAttribute(new Uint8Array(e.buffer),e.itemCount,e.normalized);case"uint16":return new s.BufferAttribute(new Uint16Array(e.buffer),e.itemCount,e.normalized);case"uint32":return new s.BufferAttribute(new Uint32Array(e.buffer),e.itemCount,e.normalized);case"int8":return new s.BufferAttribute(new Int8Array(e.buffer),e.itemCount,e.normalized);case"int16":return new s.BufferAttribute(new Int16Array(e.buffer),e.itemCount,e.normalized);case"int32":return new s.BufferAttribute(new Int32Array(e.buffer),e.itemCount,e.normalized);default:throw new Error(`unsupported buffer of type ${e.type}`)}},t.usesObject3D=function(e){const t=e.name;return void 0!==t&&"text"!==t&&"labeled-icon"!==t&&"line-marker"!==t&&"label-rejection-line"!==t},t.buildObject=function(e,t,i,n,c){switch(o.assert(void 0!==e.name),e.name){case"extruded-line":case"standard":case"extruded-polygon":case"fill":return c?new a.DisplacedMesh(t,i,()=>({min:n.elevationRange.minElevation,max:n.elevationRange.maxElevation})):new s.Mesh(t,i);case"terrain":return new s.Mesh(t,i);case"dashed-line":case"solid-line":return c?new a.DisplacedMesh(t,i,()=>({min:n.elevationRange.minElevation,max:n.elevationRange.maxElevation}),l.SolidLineMesh.raycast):new l.SolidLineMesh(t,i);case"circles":return new h.Circles(t,i);case"squares":return new h.Squares(t,i);case"line":case"segments":return new s.LineSegments(t,i);case"shader":switch(o.assert(r.isShaderTechnique(e),"Invalid technique"),e.primitive){case"line":return new s.Line(t,i);case"segments":return new s.LineSegments(t,i);case"point":return new s.Points(t,i);case"mesh":return new s.Mesh(t,i)}}return o.assert(!1,"Invalid technique"),new s.Object3D},t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=["name","id","renderOrder","transient"],t.getMaterialConstructor=m,t.buildMetricValueEvaluator=p,t.evaluateBaseColorProperty=function(e,t){const i=function(e){const t=_(e);if(void 0!==t){if(r.isShaderTechnique(e)){return e.params[t]}return e[t]}return}(e);if(void 0!==i)return y(i,t)},t.applySecondaryColorToMaterial=f,t.applyBaseColorToMaterial=g,t.evaluateColorProperty=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoBox=void 0;const r=i(7),n=i(0);class o{constructor(e,t){this.southWest=e,this.northEast=t}static fromCoordinates(e,t){return new o(e,t)}static fromCenterAndExtents(e,t){return new o(new r.GeoCoordinates(e.latitude-t.latitudeSpan/2,e.longitude-t.longitudeSpan/2),new r.GeoCoordinates(e.latitude+t.latitudeSpan/2,e.longitude+t.longitudeSpan/2))}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:i}=this,{minAltitude:n,altitudeSpan:o}=this;let s;if(void 0!==n&&void 0!==o&&(s=n+.5*o),t<i)return new r.GeoCoordinates(e,.5*(t+i),s);let a=.5*(360+i+t);return a>360&&(a-=360),new r.GeoCoordinates(e,a,s)}get latitudeSpanInRadians(){return n.MathUtils.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return n.MathUtils.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,i=this.minAltitude===e.altitude,r=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!!(t?i:r)&&this.containsHelper(e)}clone(){return new o(this.southWest,this.northEast)}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:i}=this;return i>t?e.longitude>=t&&e.longitude<i:e.longitude>i||e.longitude<=t}}t.GeoBox=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=void 0,t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilingScheme=void 0;const r=i(67),n=i(70),o=i(71);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new r.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new o.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return n.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return n.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorUtils=void 0;const r=i(1),n=i(0),o=i(30),s=new n.Color;!function(e){e.getHexFromRgba=function(e,t,i,n){return r.assert(n>=0&&n<=1),255-Math.floor(255*n)<<24^255*e<<16^255*t<<8^255*i<<0},e.getHexFromRgb=function(e,t,i){return r.assert(e>=0&&e<=1),r.assert(t>=0&&t<=1),r.assert(i>=0&&i<=1),255*e<<16^255*t<<8^255*i<<0},e.getHexFromHsl=function(e,t,i){return r.assert(e>=0&&e<=1),r.assert(t>=0&&t<=1),r.assert(i>=0&&i<=1),s.setHSL(e,t,i).getHex()},e.getRgbaFromHex=function(e,t=new o.RGBA){return r.assert(0==(0&e),"Wrong hex format"),t.r=(e>>16&255)/255,t.g=(e>>8&255)/255,t.b=(e>>0&255)/255,t.a=(255-(e>>24&255))/255,t},e.hasAlphaInHex=function(e){return r.assert(0==(0&e),"Wrong hex format"),e>>24!=0},e.getAlphaFromHex=function(e){return r.assert(0==(0&e),"Wrong hex format"),(255-(e>>24)&255)/255},e.removeAlphaFromHex=function(e){return r.assert(0==(0&e),"Wrong hex format"),16777215&e}}(t.ColorUtils||(t.ColorUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeUtils=void 0,function(e){let t;e.whiteSpaceRanges=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]],e.isWhiteSpace=function(t){for(const i of e.whiteSpaceRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.newLineRanges=[[10,13],[133,133],[8232,8233]],e.isNewLine=function(t){for(const i of e.newLineRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.nonPrintableRanges=[[0,31],[127,159]],e.isPrintable=function(t){for(const i of e.nonPrintableRanges)if(t>=i[0]&&t<=i[1])return!1;return!0},function(e){e[e.Neutral=0]="Neutral",e[e.Weak=.5]="Weak",e[e.LTR=1]="LTR",e[e.RTL=-1]="RTL"}(t=e.Direction||(e.Direction={})),e.rtlBlocks=["Hebrew","Alphabetic Presentation Forms","Arabic","Arabic Supplement","Arabic Extended-A","Arabic Presentation Forms-A","Arabic Presentation Forms-B","Arabic Mathematical Alphabetic Symbols","Indic Siyaq Numbers","Rumi Numeral Symbols","Syriac","Syriac Supplement","Samaritan","Mandaic","Thaana","Mende Kikakui","NKo","Adlam","Hanifi Rohingya"],e.neutralBidirectionalRanges=[[32,47],[58,64],[91,96],[123,126]],e.weakBidirectionalRanges=[[48,57],[1632,1641],[1776,1785]],e.getDirection=function(i,r){for(const r of e.weakBidirectionalRanges)if(i>=r[0]&&i<=r[1])return t.Weak;for(const r of e.neutralBidirectionalRanges)if(i>=r[0]&&i<=r[1])return t.Neutral;return void 0!==e.rtlBlocks.find(e=>e===r)?t.RTL:t.LTR},e.rtlMirroredCodePoints=[40,41,60,62,91,93,123,125],e.isRtlMirrored=function(t){return void 0!==e.rtlMirroredCodePoints.find(e=>e===t)}}(t.UnicodeUtils||(t.UnicodeUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementType=void 0,function(e){e[e.PoiLabel=0]="PoiLabel",e[e.PathLabel=1]="PathLabel",e[e.LineMarker=2]="LineMarker"}(t.TextElementType||(t.TextElementType={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderPass=t.RenderPass=t.Pass=void 0;const r=i(0);class n{constructor(){this.enabled=!1,this.renderToScreen=!1}setSize(e,t){}render(e,t,i,r,n,o){}}t.Pass=n;t.RenderPass=class extends n{constructor(){super()}render(e,t,i,r,n){e.setRenderTarget(this.renderToScreen?null:r),e.render(t,i)}};t.ShaderPass=class extends n{constructor(e,t="tDiffuse"){super(),this.textureID=t,e instanceof r.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=r.UniformsUtils.clone(e.uniforms),this.material=new r.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new o(this.material)}render(e,t,i,r,n,o){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,e.setRenderTarget(this.renderToScreen?null:r),this.fsQuad.render(e)}};class o{constructor(e){this.m_camera=new r.OrthographicCamera(-1,1,1,-1,0,1);const t=new r.PlaneBufferGeometry(2,2);this.m_mesh=new r.Mesh(t,e)}get material(){return this.m_mesh.material}set material(e){this.m_mesh.material=e}render(e){e.render(this.m_mesh,this.m_camera)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorProjection=t.mercatorProjection=t.MercatorConstants=void 0;const r=i(20),n=i(7),o=i(21),s=i(13),a=i(8),l=i(14),c=i(12),h=i(15),d=i(0);class u extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Planar}static clamp(e,t,i){return Math.min(Math.max(t,e),i)}static latitudeClamp(e){return u.clamp(e,-m.MAXIMUM_LATITUDE,m.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return u.latitudeProject(u.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,i){return i||(i=new d.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){let i;return i=e instanceof n.GeoCoordinates?e:new n.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(i.longitude+180)/360*this.unitScale,t.y=(.5*u.latitudeClampProject(i.latitudeInRadians)+.5)*this.unitScale,t.z=i.altitude||0,t}unprojectPoint(e){return n.GeoCoordinates.fromRadians(u.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const i=this.projectPoint(e.center),r=(.5*u.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,n=(.5*u.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,o=.5*(r+n);i.y=o;const c=r-n,h=e.longitudeSpan/360*this.unitScale;if(t||(t=new d.Box3),s.isBox3Like(t)){t.min.x=i.x-.5*h,t.min.y=i.y-.5*c,t.max.x=i.x+.5*h,t.max.y=i.y+.5*c;const r=e.altitudeSpan;void 0!==r?(t.min.z=i.z-.5*r,t.max.z=i.z+.5*r):(t.min.z=0,t.max.z=0)}else{if(!l.isOrientedBox3Like(t))throw new Error("invalid bounding box");a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=i.x,t.position.y=i.y,t.position.z=i.z,t.extents.x=.5*h,t.extents.y=.5*c,t.extents.z=Math.max(Number.EPSILON,.5*(e.altitudeSpan||0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,i,r){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,i,r):(void 0===r&&(r={}),r.x=i.x,r.y=this.unitScale-i.y,r.z=i.z,r)}}let m=(()=>{class e{}return e.MAXIMUM_LATITUDE=1.4844222297453322,e})();t.MercatorConstants=m,t.mercatorProjection=new u(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends u{projectPoint(e,t){let i;i=e instanceof n.GeoCoordinates?e:new n.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(i.longitude+180)/360*this.unitScale;const r=Math.sin(u.latitudeClamp(i.latitudeInRadians));return t.y=(.5-Math.log((1+r)/(1-r))/(4*Math.PI))*this.unitScale,t.z=i.altitude||0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,i=.5-e.y/this.unitScale,r=360*t,o=90-360*Math.atan(Math.exp(2*-i*Math.PI))/Math.PI;return new n.GeoCoordinates(o,r,e.z)}projectBox(e,t){const i=super.projectBox(e,t);if(s.isBox3Like(i)){const e=i.max.y;i.max.y=this.unitScale-i.min.y,i.min.y=this.unitScale-e}else l.isOrientedBox3Like(i)&&(a.MathUtils.newVector3(1,0,0,i.xAxis),a.MathUtils.newVector3(0,-1,0,i.yAxis),a.MathUtils.newVector3(0,0,-1,i.zAxis),i.position.y=this.unitScale-i.position.y);return i}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return new r.GeoBox(new n.GeoCoordinates(i.latitude,t.longitude,t.altitude),new n.GeoCoordinates(t.latitude,i.longitude,i.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return o.isGeoCoordinatesLike(e)?this.projectPoint(e,t.position):a.MathUtils.copyVector3(e,t.position),a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,-1,0,t.yAxis),a.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quadTreeSubdivisionScheme=void 0;t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKey=void 0;const r=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class n{constructor(e,t,i){this.row=e,this.column=t,this.level=i}static fromRowColumnLevel(e,t,i){return new n(e,t,i)}static fromQuadKey(e){const t=e.length;let i=0,r=0;for(let n=0;n<e.length;++n){const o=1<<n,s=parseInt(e.charAt(t-n-1),10);1&s&&(r|=o),2&s&&(i|=o)}return n.fromRowColumnLevel(i,r,t)}static fromMortonCode(e){let t=0,i=0,r=0,o=e;for(;o>1;){const e=1<<t;1&o&&(r|=e),2&o&&(i|=e),t++,o=(o-(3&o))/4}const s=n.fromRowColumnLevel(i,r,t);return s.m_mortonCode=e,s}static fromHereTile(e){const t=n.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,i,r,o){return n.fromRowColumnLevel(Math.floor(i/(o/n.rowsAtLevel(e))),Math.floor(t/(r/n.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return n.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let i=this.row,r=this.column;return e>=0?(i<<=e,r<<=e):(i>>>=-e,r>>>=-e),n.fromRowColumnLevel(i,r,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,i=r[this.level<<1];for(let n=0;n<this.level;++n)1&e&&(i+=r[2*n]),1&t&&(i+=r[2*n+1]),e>>>=1,t>>>=1;this.m_mortonCode=i}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const i=1<<t-1,r=0!=(this.column&i),n=0!=(this.row&i);e+=r&&n?"3":n?"2":r?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=n.fromQuadKey(0===e.length?"-":e),i=this.changedLevelBy(t.level);return n.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}addedSubHereTile(e){const t=n.fromHereTile(e),i=this.changedLevelBy(t.level);return n.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return n.rowsAtLevel(this.level)}columnCount(){return n.columnsAtLevel(this.level)}}t.TileKey=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGBA=void 0;const r=i(0),n=i(23),o=i(31);class s{constructor(e=1,t=1,i=1,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){const t=o.parseStringEncodedColor(e);if(void 0!==t)return n.ColorUtils.getRgbaFromHex(t)}clone(){return new s(this.r,this.g,this.b,this.a)}getHex(){return n.ColorUtils.getHexFromRgba(this.r,this.g,this.b,this.a)}lerp(e,t){return this.r=r.MathUtils.lerp(this.r,e.r,t),this.g=r.MathUtils.lerp(this.g,e.g,t),this.b=r.MathUtils.lerp(this.b,e.b,t),this.a=r.MathUtils.lerp(this.a,e.a,t),this}toJSON(){return`rgba(${255*this.r<<0}, ${255*this.g<<0}, ${255*this.b<<0}, ${this.a})`}}t.RGBA=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringEncodedColor=t.parseStringEncodedNumeral=t.StringEncodedNumeralFormatMaxSize=t.StringEncodedNumeralFormats=t.StringEncodedColorFormats=t.StringEncodedMetricFormats=t.StringEncodedNumeralType=void 0;const r=i(1),n=i(23),o=i(162);var s;!function(e){e[e.Meters=0]="Meters",e[e.Pixels=1]="Pixels",e[e.Hex=2]="Hex"}(s=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const a={type:s.Meters,size:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))m$/,decoder:(e,t)=>{const i=a.regExp.exec(e);return!!i&&void 0!==(t[0]=Number(i[1]))}},l={type:s.Pixels,size:1,mask:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/,decoder:(e,t)=>{const i=l.regExp.exec(e);return null!==i&&(t[0]=Number(i[1]),!0)}},c={type:s.Hex,size:4,regExp:/^\#((?:[0-9A-Fa-f][0-9A-Fa-f]){4}|[0-9A-Fa-f]{4})$/,decoder:(e,t)=>{const i=c.regExp.exec(e);if(null===i)return!1;const n=i[1],o=n.length;return r.assert(4===o||8===o,"Matched incorrect hex color format"),4===o?(t[0]=parseInt(n.charAt(0)+n.charAt(0),16)/255,t[1]=parseInt(n.charAt(1)+n.charAt(1),16)/255,t[2]=parseInt(n.charAt(2)+n.charAt(2),16)/255,t[3]=4===o?parseInt(n.charAt(3)+n.charAt(3),16)/255:1):8===o&&(t[0]=parseInt(n.charAt(0)+n.charAt(1),16)/255,t[1]=parseInt(n.charAt(2)+n.charAt(3),16)/255,t[2]=parseInt(n.charAt(4)+n.charAt(5),16)/255,t[3]=8===o?parseInt(n.charAt(6)+n.charAt(7),16)/255:1),!0}};t.StringEncodedMetricFormats=[a,l];const h=t.StringEncodedMetricFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedColorFormats=[c];const d=t.StringEncodedColorFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(d,h);const u=new Array(t.StringEncodedNumeralFormatMaxSize);function m(e,t,i=1){const r=t.find(t=>!!t.decoder(e,u));if(void 0===r){const t=o.parseCSSColor(e);return Array.isArray(t)&&!t.some(e=>isNaN(e))?n.ColorUtils.getHexFromRgba(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}switch(null==r?void 0:r.type){case s.Pixels:return u[0]*i;case s.Hex:return n.ColorUtils.getHexFromRgba(u[0],u[1],u[2],u[3]);default:return u[0]}}t.parseStringEncodedNumeral=function(e,i=1){return m(e,t.StringEncodedNumeralFormats,i)},t.parseStringEncodedColor=function(e){return m(e,t.StringEncodedColorFormats)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapEnv=t.Env=void 0;class r{static isEnv(e){return e instanceof r}lookup(e){}unmap(){return{}}}t.Env=r;t.MapEnv=class extends r{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.interpolatedPropertyDefinitionToJsonExpr=t.isInterpolatedPropertyDefinition=t.InterpolationMode=void 0,function(e){e[e.Discrete=0]="Discrete",e[e.Linear=1]="Linear",e[e.Cubic=2]="Cubic",e[e.Exponential=3]="Exponential"}(t.InterpolationMode||(t.InterpolationMode={})),t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||"Discrete"===e.interpolation){const t=["step",["zoom"],e.values[0]];for(let i=1;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}const t=["interpolate"];switch(e.interpolation){case"Linear":t.push(["linear"]);break;case"Cubic":t.push(["cubic"]);break;case"Exponential":t.push(["exponential",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push(["zoom"]);for(let i=0;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isActualSelectorDefinition=t.isJsonExprReference=t.isLiteralDefinition=t.isBoxedDefinition=void 0;const r=i(5),n=i(33);t.isBoxedDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&("string"==typeof t.type||void 0===t.type)&&("string"==typeof t.value||"number"==typeof t.value||"boolean"==typeof t.value||n.isInterpolatedPropertyDefinition(t.value)||r.isJsonExpr(t.value))},t.isLiteralDefinition=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e},t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&"ref"===e[0]&&"string"==typeof e[1]},t.isActualSelectorDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&!Array.isArray(t)&&"string"==typeof t.technique}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeatureDefs=void 0,function(e){e.DEFAULT_RATIO_MIN=0,e.DEFAULT_RATIO_MAX=1,e.MIN_BUILDING_HEIGHT=.01}(t.ExtrusionFeatureDefs||(t.ExtrusionFeatureDefs={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=t.TileLoaderState=t.getFeatureDataSize=void 0;const r=i(3),n=i(1),o=i(0),s=i(84),a=i(37),l=i(17),c=i(211),h=i(212),d=i(213),u=i(10),m=n.LoggerManager.instance.create("Tile");var p;t.getFeatureDataSize=function(e){let t=100;return void 0!==e.starts&&(t+=8*e.starts.length),void 0!==e.objInfos&&(t+=16*e.objInfos.length),t},function(e){e[e.Initialized=0]="Initialized",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Decoding=3]="Decoding",e[e.Ready=4]="Ready",e[e.Canceled=5]="Canceled",e[e.Failed=6]="Failed"}(p=t.TileLoaderState||(t.TileLoaderState={}));t.Tile=class{constructor(e,t,i=0,n){this.dataSource=e,this.tileKey=t,this.objects=[],this.dependencies=new Array,this.frameNumLastRequested=-1,this.frameNumVisible=-1,this.frameNumLastVisible=-1,this.numFramesVisible=0,this.visibilityCounter=-1,this.levelOffset=0,this.skipRendering=!1,this.m_boundingBox=new r.OrientedBox3,this.m_disposed=!1,this.m_localTangentSpace=!1,this.m_forceHasGeometry=void 0,this.m_textElementGroups=new h.TextElementGroupPriorityList,this.m_pathBlockingElements=[],this.m_worldCenter=new o.Vector3,this.m_visibleArea=0,this.m_elevationRange={minElevation:0,maxElevation:0},this.m_ownedTextures=new WeakSet,this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.updateBoundingBox(),this.m_worldCenter.copy(this.boundingBox.position),this.m_localTangentSpace=void 0!==n&&n,this.m_textStyleCache=new d.TileTextStyleCache(this),this.m_offset=i,this.m_uniqueKey=u.TileOffsetUtils.getKeyForTileKeyAndOffset(this.tileKey,this.offset)}get isVisible(){return this.frameNumLastRequested>=this.dataSource.mapView.frameNumber-1}set isVisible(e){this.frameNumLastRequested=e?this.dataSource.mapView.frameNumber:-1}get projection(){return this.dataSource.projection}get mapView(){return this.dataSource.mapView}get localTangentSpace(){return this.m_localTangentSpace}get memoryUsage(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo.heapSize}get center(){return this.m_worldCenter}get uniqueKey(){return this.m_uniqueKey}get offset(){return this.m_offset}set offset(e){this.m_offset!==e&&(this.m_uniqueKey=u.TileOffsetUtils.getKeyForTileKeyAndOffset(this.tileKey,e)),this.m_offset=e}getResourceInfo(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo}invalidateResourceInfo(){this.m_resourceInfo=void 0}addOwnedTexture(e){this.m_ownedTextures.add(e)}get userTextElements(){let e=this.m_textElementGroups.groups.get(l.TextElement.HIGHEST_PRIORITY);return void 0===e&&(e=new c.TextElementGroup(l.TextElement.HIGHEST_PRIORITY),this.m_textElementGroups.groups.set(e.priority,e)),e}addUserTextElement(e){e.priority=l.TextElement.HIGHEST_PRIORITY,this.addTextElement(e)}removeUserTextElement(e){return e.priority=l.TextElement.HIGHEST_PRIORITY,this.removeTextElement(e)}addTextElement(e){this.textElementGroups.add(e),!1===this.m_textElementsChanged&&(this.m_textElementGroups=this.textElementGroups.clone()),this.textElementsChanged=!0}addBlockingElement(e){this.m_pathBlockingElements.push(e)}removeTextElement(e){const t=this.textElementGroups;return!!t.remove(e)&&(!1===this.m_textElementsChanged&&(this.m_textElementGroups=t.clone()),this.textElementsChanged=!0,!0)}get textElementGroups(){return this.m_textElementGroups}get textElementsChanged(){var e;return null!==(e=this.m_textElementsChanged)&&void 0!==e&&e}set textElementsChanged(e){this.m_textElementsChanged=e}hasTextElements(){return this.m_textElementGroups.count()>0}get blockingElements(){return this.m_pathBlockingElements}willRender(e){return!this.skipRendering}didRender(){}get visibleArea(){return this.m_visibleArea}set visibleArea(e){this.m_visibleArea=e,void 0!==this.tileLoader&&this.tileLoader.updatePriority(e)}get elevationRange(){return this.m_elevationRange}set elevationRange(e){var t;e.minElevation===this.m_elevationRange.minElevation&&e.maxElevation===this.m_elevationRange.maxElevation&&e.calculationStatus===this.m_elevationRange.calculationStatus||(this.m_elevationRange.minElevation=e.minElevation,this.m_elevationRange.maxElevation=e.maxElevation,this.m_elevationRange.calculationStatus=e.calculationStatus,this.elevateGeoBox(),void 0!==this.m_maxGeometryHeight&&(n.assert(void 0===(null===(t=this.decodedTile)||void 0===t?void 0:t.boundingBox)),this.updateBoundingBox()))}get decodedTile(){return this.m_decodedTile}set decodedTile(e){var t;if(this.m_decodedTile=e,this.invalidateResourceInfo(),void 0===e)return;0===e.geometries.length&&this.forceHasGeometry(!0),this.m_maxGeometryHeight=e.boundingBox?void 0:null!==(t=e.maxGeometryHeight)&&void 0!==t?t:0,this.elevateGeoBox(),this.updateBoundingBox(e.boundingBox);const i=a.PerformanceStatistics.instance;i.enabled&&void 0!==e.decodeTime&&(i.currentFrame.addValue("decode.decodingTime",e.decodeTime),i.currentFrame.addValue("decode.decodedTiles",1)),void 0!==e.copyrightHolderIds&&(this.copyrightInfo=e.copyrightHolderIds.map(e=>({id:e}))),this.dataSource.requestUpdate()}removeDecodedTile(){this.m_decodedTile=void 0,this.invalidateResourceInfo()}loadingFinished(){}shouldDisposeObjectGeometry(e){return!0}shouldDisposeObjectMaterial(e){return!0}shouldDisposeTexture(e){return this.m_ownedTextures.has(e)}get disposed(){return this.m_disposed}get tileGeometryLoader(){return this.m_tileGeometryLoader}set tileGeometryLoader(e){this.m_tileGeometryLoader=e}get basicGeometryLoaded(){return void 0===this.m_tileGeometryLoader?this.hasGeometry:this.m_tileGeometryLoader.basicGeometryLoaded||this.m_tileGeometryLoader.isFinished}get allGeometryLoaded(){return void 0===this.m_tileGeometryLoader?this.hasGeometry:this.m_tileGeometryLoader.allGeometryLoaded||this.m_tileGeometryLoader.isFinished}get hasGeometry(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry}forceHasGeometry(e){this.m_forceHasGeometry=e}resetVisibilityCounter(){this.visibilityCounter=-1}get tileLoader(){return this.m_tileLoader}set tileLoader(e){this.m_tileLoader=e}load(){const e=this.tileLoader;void 0!==e&&e.loadAndDecode().then(t=>{n.assert(t===p.Ready);const i=e.decodedTile;this.decodedTile=i}).catch(e=>{e!==p.Canceled&&e!==p.Failed&&m.error("Unknown error"+e)})}get textStyleCache(){return this.m_textStyleCache}clear(){const e=e=>{Object.getOwnPropertyNames(e).forEach(t=>{const i=e[t];if(void 0!==i&&i instanceof o.Texture){const e=i;this.shouldDisposeTexture(e)&&e.dispose()}}),e.dispose()},t=t=>{if(this.shouldDisposeObjectGeometry(t)&&(void 0!==t.geometry&&t.geometry.dispose(),void 0!==t.geometries))for(const e of t.geometries)e.dispose();void 0!==t.material&&this.shouldDisposeObjectMaterial(t)&&(t.material instanceof Array?t.material.forEach(t=>{void 0!==t&&e(t)}):e(t.material))};this.objects.forEach(e=>{e.traverse(e=>{t(e)}),t(e)}),this.objects.length=0,this.preparedTextPaths&&(this.preparedTextPaths=[]),this.m_textStyleCache.clear(),this.clearTextElements(),this.invalidateResourceInfo()}clearTextElements(){this.hasTextElements()&&(this.textElementsChanged=!0,this.m_pathBlockingElements.splice(0),this.textElementGroups.clear())}addDisposeCallback(e){this.m_disposeCallback=n.chainCallbacks(this.m_disposeCallback,e)}dispose(){this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.cancel(),this.m_tileLoader=void 0),void 0!==this.m_tileGeometryLoader&&(this.m_tileGeometryLoader.dispose(),this.m_tileGeometryLoader=void 0),this.clear(),this.m_disposed=!0,this.frameNumLastRequested=0,this.m_disposeCallback&&this.m_disposeCallback(this))}computeWorldOffsetX(){return this.projection.worldExtent(0,0).max.x*this.offset}update(e){for(const t of this.objects)t instanceof s.LodMesh&&t.setLevelOfDetail(e-this.tileKey.level)}get boundingBox(){return this.m_boundingBox}updateBoundingBox(e){e?(this.m_boundingBox.copy(e),this.m_worldCenter.copy(this.boundingBox.position)):this.projection.projectBox(this.geoBox,this.boundingBox)}elevateGeoBox(){var e;this.geoBox.southWest.altitude=this.m_elevationRange.minElevation,this.geoBox.northEast.altitude=this.m_elevationRange.maxElevation+(null!==(e=this.m_maxGeometryHeight)&&void 0!==e?e:0)}computeResourceInfo(){let e=0,t=0,i=0;const r={heapSize:0,gpuSize:0},n=new Map;for(const e of this.objects)e.visible&&t++,u.MapViewUtils.estimateObject3dSize(e,r,n);for(const e of this.textElementGroups.groups)i+=e[1].elements.length;e+=312*i,void 0!==this.m_decodedTile&&void 0!==this.m_decodedTile.tileInfo&&(r.heapSize+=this.m_decodedTile.tileInfo.numBytes),this.m_resourceInfo={heapSize:r.heapSize+e,gpuSize:r.gpuSize,num3dObjects:t,numTextElements:i,numUserTextElements:0}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceStatistics=t.FrameStatsArray=t.FrameStats=t.Statistics=t.MultiStageTimer=t.computeArrayAverage=t.computeArrayStats=t.SampledTimer=t.SimpleTimer=t.RingBuffer=void 0;const r=i(1),n=r.LoggerManager.instance.create("Statistics");class o{constructor(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}clear(){this.head=this.tail=this.size=0}enqOne(e){let t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)}enq(...e){for(const t of e)this.enqOne(t)}deq(){if(0===this.size)throw new Error("Ringbuffer underrun");const e=this.buffer[this.tail];let t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e}get top(){if(0===this.size)throw new Error("Ringbuffer underrun");return this.buffer[this.tail]}get bottom(){if(0===this.size)throw new Error("Ringbuffer underrun");let e=this.head-1;return e<0&&(e=this.capacity-1),this.buffer[e]}iterator(){return new o.Iterator(this)}asArray(){const e=new Array;for(let t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e}}t.RingBuffer=o,function(e){e.Iterator=class{constructor(e,t=0){this.m_buffer=e,this.m_index=t}get value(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]}next(){return this.m_index++,this.m_index<this.m_buffer.size}}}(o=t.RingBuffer||(t.RingBuffer={}));class s{constructor(e,t){this.statistics=e,this.name=t,this.running=!1}get value(){return this.m_currentValue}setValue(e){this.m_currentValue=e}reset(){this.m_currentValue=void 0}start(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=r.PerformanceTimer.now()}stop(){if(!this.statistics.enabled)return-1;if(this.running){const e=r.PerformanceTimer.now()-(this.m_currentValue||0);return this.m_currentValue=e,this.setValue(e),this.running=!1,e}throw new Error("Timer '"+this.name+"' has not been started")}now(){if(!this.statistics.enabled)return-1;if(this.running){return r.PerformanceTimer.now()-(this.m_currentValue||0)}throw new Error("Timer '"+this.name+"' has not been started")}}t.SimpleTimer=s;class a extends s{constructor(e,t){super(e,t),this.statistics=e,this.name=t,this.numResets=0,this.maxNumSamples=1e3,this.samples=new o(this.maxNumSamples)}reset(){super.reset(),this.getStats(),this.samples.clear(),this.numResets++}setValue(e){super.setValue(e),void 0!==e&&this.samples.enqOne(e)}getStats(){return l(this.samples.asArray())}}function l(e){if(0===e.length)return;e.sort((e,t)=>e-t);const t=e[0],i=e[e.length-1];let r,n,o,s,a,l,c;if(1===e.length)n=o=s=a=l=c=r=e[0];else if(2===e.length)r=.5*e[0]+.5*e[1],n=o=s=a=l=c=e[1];else{const t=Math.floor(e.length/2);r=e.length%2==0?.5*e[t-1]+.5*e[t]:e[t],n=e[Math.round(.75*e.length)-1],o=e[Math.round(.9*e.length)-1],s=e[Math.round(.95*e.length)-1],a=e[Math.round(.97*e.length)-1],l=e[Math.round(.99*e.length)-1],c=e[Math.round(.999*e.length)-1]}let h=0;for(let t=0,i=e.length;t<i;t++)h+=e[t];return{min:t,max:i,avg:h/e.length,median:r,median75:n,median90:o,median95:s,median97:a,median99:l,median999:c,numSamples:e.length}}t.SampledTimer=a,t.computeArrayStats=l,t.computeArrayAverage=function(e){if(0===e.length)return;let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i];return t/e.length};t.MultiStageTimer=class{constructor(e,t,i){if(this.statistics=e,this.name=t,this.stages=i,i.length<1)throw new Error("MultiStageTimer needs stages");i.forEach(t=>{if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)})}get value(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value}reset(){this.statistics.enabled&&this.stages.forEach(e=>{this.statistics.getTimer(e).reset()})}start(){return this.stage=this.stages[0],this.statistics.getTimer(this.stages[0]).value||-1}stop(){return this.stage=void 0,void 0!==this.value?this.value:-1}get stage(){return this.currentStage}set stage(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())}};t.Statistics=class{constructor(e,t=!1){this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new s(this,"<null>")}createTimer(e,t=!0){const i=t?new a(this,e):new s(this,e);return this.addTimer(i)}addTimer(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e}getTimer(e){if(!this.enabled)return this.nullTimer;const t=this.timers.get(e);return void 0===t?this.nullTimer:t}hasTimer(e){return void 0!==this.timers.get(e)}reset(){this.timers.forEach(e=>{e.reset()})}log(e,t){void 0===e&&void 0===this.name||n.log(void 0!==e?e:this.name);let i=0;this.timers.forEach(e=>{i=Math.max(i,e.name.length)});const r=e=>void 0!==e?e.toFixed(5):"?";this.timers.forEach(e=>{let t=e.name+": "+" ".repeat(i-e.name.length);if(t+=r(e.value),e instanceof a){const i=e.getStats();void 0!==i&&(t+=`  [ min=${r(i.min)}, max=${r(i.max)}, `+`avg=${r(i.avg)}, med=${r(i.median)}, `+`med95=${r(i.median95)}, med99=${r(i.median99)}, `+`N=${r(i.numSamples)} ]`)}n.log(t)}),void 0!==t&&n.log(t)}};class c{constructor(){this.entries=new Map,this.messages=void 0}getValue(e){return this.entries.get(e)}setValue(e,t){this.entries.set(e,t)}addValue(e,t){const i=this.entries.get(e);this.entries.set(e,t+(void 0===i?0:i))}addMessage(e){void 0===this.messages&&(this.messages=[]),this.messages.push(e)}reset(){this.entries.forEach((e,t)=>{this.entries.set(t,0)}),this.messages=void 0}}t.FrameStats=c;class h{constructor(e=0){this.capacity=e,this.frameEntries=new Map,this.messages=new o(e)}get length(){return this.messages.size}reset(){this.frameEntries.forEach((e,t)=>{e.clear()}),this.messages.clear()}addFrame(e){const t=this.length,i=this.frameEntries;e.entries.forEach((e,r)=>{let n=i.get(r);if(void 0===n){n=new o(this.capacity);for(let e=0;e<t;e++)n.enqOne(0);this.frameEntries.set(r,n)}n.enqOne(e)}),this.messages.enq(e.messages)}log(){let e=0;this.frameEntries.forEach((t,i)=>{e=Math.max(e,i.length)});const t=e=>void 0!==e?e.toFixed(5):"?";this.frameEntries.forEach((i,r)=>{let o=r+": "+" ".repeat(e-r.length);const s=l(i.asArray());void 0!==s&&(o+=`  [ min=${t(s.min)}, max=${t(s.max)}, `+`avg=${t(s.avg)}, med=${t(s.median)}, `+`med95=${t(s.median95)}, med99=${t(s.median99)}, `+`N=${t(s.numSamples)} ]`),n.log(o)})}}t.FrameStatsArray=h;let d=(()=>{class e{constructor(t=!0,i=1e3){this.enabled=t,this.maxNumFrames=i,this.currentFrame=new c,this.appResults=new Map,this.configs=new Map,e.m_instance=this,this.m_frameEvents=new h(i)}get isFull(){return this.m_frameEvents.length>=this.maxNumFrames}static get instance(){return void 0===e.m_instance&&(e.m_instance=new e(!1,0)),e.m_instance}get frameEvents(){return this.m_frameEvents}clear(){this.clearFrames(),this.configs.clear(),this.appResults.clear()}clearFrames(){this.m_frameEvents.reset(),this.currentFrame.reset()}addWebGLInfo(e){void 0!==e.render&&(this.currentFrame.setValue("gl.numCalls",null===e.render.calls?0:e.render.calls),this.currentFrame.setValue("gl.numPoints",null===e.render.points?0:e.render.points),this.currentFrame.setValue("gl.numLines",null===e.render.lines?0:e.render.lines),this.currentFrame.setValue("gl.numTriangles",null===e.render.triangles?0:e.render.triangles)),void 0!==e.memory&&(this.currentFrame.setValue("gl.numGeometries",null===e.memory.geometries?0:e.memory.geometries),this.currentFrame.setValue("gl.numTextures",null===e.memory.textures?0:e.memory.textures)),void 0!==e.programs&&this.currentFrame.setValue("gl.numPrograms",null===e.programs?0:e.programs.length)}addMemoryInfo(){if(void 0!==window&&void 0!==window.performance){const e=window.performance.memory;void 0!==e&&(this.currentFrame.setValue("memory.totalJSHeapSize",e.totalJSHeapSize),this.currentFrame.setValue("memory.usedJSHeapSize",e.usedJSHeapSize),this.currentFrame.setValue("memory.jsHeapSizeLimit",e.jsHeapSizeLimit))}}storeAndClearFrameInfo(){return!(this.m_frameEvents.length>=this.maxNumFrames)&&(this.m_frameEvents.addFrame(this.currentFrame),this.currentFrame.reset(),!0)}log(e,t){n.log(void 0!==e?e:"PerformanceStatistics"),this.appResults.forEach((e,t)=>{n.log(t,e)}),this.configs.forEach((e,t)=>{n.log(t,e)}),this.m_frameEvents.log(),void 0!==t&&n.log(t)}getAsPlainObject(e=!1){const t={},i={},r={},n={configs:i,appResults:t,frames:r};if(this.appResults.forEach((e,i)=>{t[i]=e}),this.configs.forEach((e,t)=>{i[t]=e}),e)for(const[e,t]of this.m_frameEvents.frameEntries)r[e]=t.bottom;else for(const[e,t]of this.m_frameEvents.frameEntries)r[e]=t.asArray();return n.messages=this.m_frameEvents.messages.asArray(),n}getLastFrameStatistics(){return this.getAsPlainObject(!0)}getAsSimpleFrameStatistics(e=!1){const t=new Map,i=new Map,r=new Map,n={configs:t,appResults:i,frames:r,messages:this.m_frameEvents.messages.asArray()};if(this.appResults.forEach((e,t)=>{i.set(t,e)}),this.configs.forEach((e,i)=>{t.set(i,e)}),e)for(const[e,t]of this.m_frameEvents.frameEntries)r.set(e,t.bottom);else for(const[e,t]of this.m_frameEvents.frameEntries)r.set(e,t.asArray());return n}}return e.m_instance=void 0,e})();t.PerformanceStatistics=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapObjectAdapter=void 0;const r=i(55);class n{constructor(e,t){this.m_lastUpdateFrameNumber=-1,this.m_notCompletlyTransparent=!0,this.object=e,this.technique=t.technique,this.kind=t.kind,this.m_notCompletlyTransparent=this.getObjectMaterials().some(e=>e.opacity>0)}static get(e){var t;return(null===(t=e.userData)||void 0===t?void 0:t.mapAdapter)instanceof n?e.userData.mapAdapter:void 0}static install(e){return e.object.userData||(e.object.userData={}),e.object.userData.mapAdapter=e}static create(e,t){return n.install(new n(e,t))}static ensureUpdated(e,t){var i,r;return null!==(r=null===(i=n.get(e))||void 0===i?void 0:i.ensureUpdated(t))&&void 0!==r&&r}toJSON(){return{kind:this.kind,technique:this.technique}}ensureUpdated(e){return this.m_lastUpdateFrameNumber!==e.frameNumber&&(this.m_lastUpdateFrameNumber=e.frameNumber,this.updateMaterials(e))}isVisible(){return this.object.visible&&this.m_notCompletlyTransparent}updateMaterials(e){let t=!1;const i=this.getObjectMaterials();for(const n of i){const i=r.MapMaterialAdapter.ensureUpdated(n,e);t=t||i}return t&&(this.m_notCompletlyTransparent=i.some(e=>e.opacity>0)),t}getObjectMaterials(){const e=this.object;return Array.isArray(e.material)?e.material:void 0!==e.material?[e.material]:[]}}t.MapObjectAdapter=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementsRenderer=t.DEFAULT_TEXT_DISTANCE_SCALE=void 0;const r=i(6),n=i(1),o=i(0),s=i(57),a=i(103),l=i(58),c=i(104),h=(i(228),i(229)),d=i(17),u=i(230),m=i(231),p=i(25),f=i(109);i(236);var g;!function(e){e[e.PersistentLabels=0]="PersistentLabels",e[e.NewLabels=1]="NewLabels"}(g||(g={})),t.DEFAULT_TEXT_DISTANCE_SCALE=.5;const v=n.LoggerManager.instance.create("TextElementsRenderer",{level:n.LogLevel.Log}),y=void 0,_=void 0,x=new o.Vector3,S=new o.Vector2,b=[],T=new o.Vector2,w={},M={},E={};class P{constructor(e,t){this.tile=e,this.group=t}}class C{constructor(e){this.lists=e}get priority(){return n.assert(this.lists.length>0),this.lists[0].group.priority}count(){let e=0;for(const t of this.lists)e+=t.group.elements.length;return e}}function A(e,t,i,r,n){M.path=r,M.pathOverflow=n,M.layer=e.renderOrder,M.letterCaseArray=e.glyphCaseArray,M.pickingData=e.userData?e:void 0,t.addText(e.glyphs,i,M)}function L(e){if(void 0===e)return!1;return n.PerformanceTimer.now()-e>10&&(v.debug("Placement time limit exceeded."),!0)}t.TextElementsRenderer=class{constructor(e,t,i,r,n,s,a,l,c,h,d){this.m_viewState=e,this.m_viewCamera=t,this.m_viewUpdateCallback=i,this.m_screenCollisions=r,this.m_screenProjector=n,this.m_textCanvasFactory=s,this.m_poiManager=a,this.m_poiRendererFactory=l,this.m_fontCatalogLoader=c,this.m_theme=h,this.m_initialized=!1,this.m_glyphLoadingCount=0,this.m_textRenderers=[],this.m_tmpVector=new o.Vector2,this.m_tmpVector3=new o.Vector3,this.m_cameraLookAt=new o.Vector3,this.m_overloaded=!1,this.m_cacheInvalidated=!1,this.m_forceNewLabelsPass=!1,this.m_addNewLabels=!0,this.m_textElementStateCache=new m.TextElementStateCache,this.m_textStyleCache=new f.TextStyleCache(this.m_theme),this.m_options=Object.assign({},d),u.initializeDefaultOptions(this.m_options),this.m_textCanvasFactory.setGlyphCountLimits(this.m_options.minNumGlyphs,this.m_options.maxNumGlyphs)}set disableFading(e){this.m_options.disableFading=e}get disableFading(){return!0===this.m_options.disableFading}get styleCache(){return this.m_textStyleCache}get delayLabelsUntilMovementFinished(){return!0===this.m_options.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.m_options.delayLabelsUntilMovementFinished=e}renderText(e){if(this.initialized){this.updateGlyphDebugMesh();for(const t of this.m_textRenderers)t.textCanvas.render(e)}}invalidateCache(){this.m_cacheInvalidated=!0}movementStarted(){this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!1)}movementFinished(){this.invalidateCache(),this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!0)}get overloaded(){return this.m_overloaded}placeText(e,t){const i=function(e){let t=!1;return e.forEach(({renderedTiles:e})=>{e.forEach(e=>{e.textElementsChanged&&(e.textElementsChanged=!1,t=!0)})}),t}(e),r=this.hasOverlayText()||i;if(!this.initialize(r))return;const n=this.m_cacheInvalidated||i||this.m_viewState.renderedTilesChanged;v.debug(`FRAME: ${this.m_viewState.frameNumber}, ZOOM LEVEL: ${this.m_viewState.zoomLevel}`),n&&this.m_addNewLabels&&(this.m_textElementStateCache.clearVisited(),this.updateTextElements(e));const o=n&&this.m_addNewLabels,s=this.m_textElementStateCache.update(t,this.m_options.disableFading,o,this.m_viewState.zoomLevel);this.reset(),this.m_addNewLabels&&this.prepopulateScreenWithBlockingElements(e);const a=(n||s)&&this.m_addNewLabels;this.placeTextElements(t,a),this.placeOverlayTextElements(),this.updateTextRenderers()}addOverlayText(e){0!==e.length&&(this.m_overlayTextElements=void 0===this.m_overlayTextElements?e.slice():this.m_overlayTextElements.concat(e))}clearOverlayText(){this.m_overlayTextElements=[]}hasOverlayText(){return void 0!==this.m_overlayTextElements&&this.m_overlayTextElements.length>0}get overlayText(){return this.m_overlayTextElements}pickTextElements(e,t){const i=(i,r)=>{const n=i;if(void 0===n)return;let o=!1;if(void 0!==n.featureId&&(o=t.some(e=>void 0!==e&&r===e.type&&(void 0!==e.featureId&&e.featureId===n.featureId||void 0!==e.userData&&e.userData===n.userData)),!o)){const i={type:r,point:e,distance:0,featureId:n.featureId,userData:n.userData,text:n.text};t.push(i)}};for(const t of this.m_textRenderers)t.textCanvas.pickText(e,e=>{i(e,l.PickObjectType.Text)}),t.poiRenderer.pickTextElements(e,e=>{i(e,l.PickObjectType.Icon)})}get loading(){return this.m_fontCatalogLoader.loading||this.m_glyphLoadingCount>0}async waitLoaded(){return!!await this.waitInitialized()&&(void 0!==this.m_loadPromise&&(await this.m_loadPromise,!0))}clearRenderStates(){this.m_textElementStateCache.clear()}getMemoryUsage(){const e={heapSize:0,gpuSize:0};for(const t of this.m_textRenderers)t.textCanvas.getMemoryUsage(e),t.poiRenderer.getMemoryUsage(e);return e}get initialized(){return this.m_initialized}get initializing(){return void 0!==this.m_initPromise}async waitInitialized(){return!!this.initialized||!!this.initializing&&(await this.m_initPromise,!0)}initialize(e){return this.initialized||this.initializing||!e||(this.initializeDefaultAssets(),this.m_initPromise=this.initializeTextCanvases().then(()=>{this.m_initialized=!0,this.m_initPromise=void 0,this.invalidateCache(),this.m_viewUpdateCallback()})),this.initialized}reset(){this.m_cameraLookAt.copy(this.m_viewState.lookAtVector),this.m_screenCollisions.reset();for(const e of this.m_textRenderers)e.textCanvas.clear(),e.poiRenderer.reset()}updateTextRenderers(){for(const e of this.m_textRenderers)e.poiRenderer.update()}prepopulateScreenWithBlockingElements(e){const t=[];e.forEach(e=>{const i=new o.Vector3,r=new o.Vector3;for(const n of e.renderedTiles.values())for(const e of n.blockingElements)if(!(e.points.length<2)){this.m_screenProjector.project3(e.points[0],i);for(let n=1;n<e.points.length;n++){this.m_screenProjector.project3(e.points[n],r);const o=e.screenSpaceLines[n-1];o.start.copy(i),o.end.copy(r);const s={minX:Math.min(i.x,r.x),maxX:Math.max(i.x,r.x),minY:Math.min(i.y,r.y),maxY:Math.max(i.y,r.y),line:o};t.push(s),i.copy(r)}}}),this.m_screenCollisions.allocateIBoxes(t)}placeTextElementGroup(e,t,i,o){if(n.assert(e.visited),0===this.m_textRenderers.length)return v.warn("No text renderers initialized."),!1;const s=[],l=this.m_viewState.hiddenGeometryKinds,h=this.m_viewState.projection,d=this.m_viewState.elevationProvider,u=null==d?void 0:d.getDisplacementMap(e.tileKey);for(const n of e.textElementStates){if(o===g.PersistentLabels)_&&++_.total;else if(i>=0&&t.numRenderedTextElements>=i)return v.debug("Placement label limit exceeded."),!1;if(!n.initialized){_&&++_.uninitialized;continue}if(void 0===n.viewDistance){_&&++_.tooFar;continue}const e=n.visible;if(o===g.PersistentLabels&&!e||o===g.NewLabels&&e)continue;const m=n.element,f=this.m_textStyleCache.getTextElementStyle(m.style),y=f.textCanvas,x=f.poiRenderer;if(void 0===y||void 0===x){v.warn("Text canvas or poi renderer not ready.");continue}if(void 0!==l&&void 0!==m.kind&&l.hasOrIntersects(m.kind))continue;if(void 0!==d&&!m.elevated){if(!u){this.m_viewUpdateCallback(),this.m_forceNewLabelsPass=!0;continue}a.overlayTextElement(m,d,u,h)}const S=m.type;if(S===p.TextElementType.PathLabel&&c.isPathLabelTooSmall(m,this.m_screenProjector,b)){_&&_.numNotVisible++,!0===m.dbgPathTooSmall&&_&&_.numPathTooSmall++,n.reset();continue}const T=!0;if(!this.initializeGlyphs(m,f,T))continue;const w=y.getLayer(m.renderOrder||r.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==w&&w.storage.drawCount+m.glyphs.length>w.storage.capacity)_&&++_.numCannotAdd,v.warn("layer glyph storage capacity exceeded.");else switch(y.textRenderStyle=m.renderStyle,y.textLayoutStyle=m.layoutStyle,S){case p.TextElementType.PoiLabel:this.addPoiLabel(n,x,y,t);break;case p.TextElementType.LineMarker:this.addLineMarkerLabel(n,x,s,y,t);break;case p.TextElementType.PathLabel:this.addPathLabel(n,b,y,t)}}return!0}initializeGlyphs(e,t,i){if(e.loadingState===d.LoadingState.Initialized)return!0;n.assert(void 0!==t.textCanvas);const o=t.textCanvas;if(void 0===e.loadingState)if(e.loadingState=d.LoadingState.Requested,void 0===e.renderStyle&&(e.renderStyle=new r.TextRenderStyle(Object.assign(Object.assign({},t.renderParams),e.renderParams))),void 0===e.layoutStyle&&(e.layoutStyle=new r.TextLayoutStyle(Object.assign(Object.assign({},t.layoutParams),e.layoutParams))),""===e.text)e.loadingState=d.LoadingState.Loaded;else{const t=o.fontCatalog.loadCharset(e.text,e.renderStyle).then(()=>{--this.m_glyphLoadingCount,e.loadingState=d.LoadingState.Loaded,this.m_forceNewLabelsPass=this.m_forceNewLabelsPass||i,this.m_viewUpdateCallback()});0===this.m_glyphLoadingCount&&(this.m_loadPromise=void 0),++this.m_glyphLoadingCount,this.m_loadPromise=void 0===this.m_loadPromise?t:Promise.all([this.m_loadPromise,t])}return e.loadingState===d.LoadingState.Loaded&&(o.textRenderStyle=e.renderStyle,o.textLayoutStyle=e.layoutStyle,e.glyphCaseArray=[],e.bounds=void 0,e.glyphs=o.fontCatalog.getGlyphs(e.text,o.textRenderStyle,e.glyphCaseArray),e.loadingState=d.LoadingState.Initialized),void 0!==e.glyphs}initializeDefaultAssets(){const e=this.m_fontCatalogLoader.initialize(this.m_options.fontCatalog);this.m_textStyleCache.initializeDefaultTextElementStyle(e)}async initializeTextCanvases(){return this.m_fontCatalogLoader.loadCatalogs((e,t)=>{const i=this.m_textCanvasFactory.createTextCanvas(t);this.m_textRenderers.push({fontCatalog:e,textCanvas:i,poiRenderer:this.m_poiRendererFactory.createPoiRenderer(i)})}).then(()=>{let e;this.m_textRenderers.forEach(t=>{void 0===e&&(e=t.textCanvas)});const t=this.m_poiRendererFactory.createPoiRenderer(e);this.m_textStyleCache.initializeTextElementStyles(t,e,this.m_textRenderers)})}updateGlyphDebugMesh(){const e=s.debugContext.getValue("DEBUG_GLYPHS");void 0!==e&&(e&&void 0===this.m_debugGlyphTextureCacheMesh&&this.initializeGlyphDebugMesh(),n.assert(void 0!==this.m_debugGlyphTextureCacheMesh),n.assert(void 0!==this.m_debugGlyphTextureCacheWireMesh),this.m_debugGlyphTextureCacheMesh.visible=e,this.m_debugGlyphTextureCacheWireMesh.visible=e)}initializeGlyphDebugMesh(){const e=this.m_textRenderers[0].textCanvas.fontCatalog,t=new o.PlaneGeometry(e.textureSize.width/2.5,e.textureSize.height/2.5,e.textureSize.width/e.maxWidth,e.textureSize.height/e.maxHeight),i=new o.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:e.texture});this.m_debugGlyphTextureCacheMesh=new o.Mesh(t,i),this.m_debugGlyphTextureCacheMesh.renderOrder=1e4,this.m_debugGlyphTextureCacheMesh.visible=!1,this.m_debugGlyphTextureCacheMesh.name="glyphDebug";const n=new o.WireframeGeometry(t),s=new o.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheWireMesh=new o.LineSegments(n,s),this.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,this.m_debugGlyphTextureCacheWireMesh.visible=!1,this.m_debugGlyphTextureCacheWireMesh.name="glyphDebug",this.m_textRenderers[0].textCanvas.getLayer(r.DEFAULT_TEXT_CANVAS_LAYER).storage.scene.add(this.m_debugGlyphTextureCacheMesh,this.m_debugGlyphTextureCacheWireMesh)}updateTextElements(e){v.debug("updateTextElements"),y&&y.clear(),this.m_textElementStateCache.clearTextCache(),this.m_cacheInvalidated=!1,this.checkIfOverloaded(e);const t=this.overloaded&&this.m_viewState.isDynamic?n.PerformanceTimer.now():void 0;e.forEach(e=>{this.updateTextElementsFromSource(e.dataSource,e.storageLevel,Array.from(e.renderedTiles.values()),t)}),y&&y.log()}updateTextElementsFromSource(e,t,i,r){y&&(y.tiles+=i.length);const o=i;o.sort((e,t)=>e.tileKey.mortonCode()-t.tileKey.mortonCode());const s=[];this.createSortedGroupsForSorting(e,t,o,s);let a=0;for(const e of s)if(this.selectTextElementsToUpdateByDistance(e),void 0!==r){if(n.PerformanceTimer.now()-r>5){v.debug("Update time limit exceeded.");break}if(a+=e.count(),a>=100){v.debug("Update label limit exceeded.");break}}}prepareTextElementGroup(e,t,i){if(0===e.elements.length)return;const[,r]=this.m_textElementStateCache.getOrSet(e,t,e=>{let{result:t,viewDistance:r}=c.checkReadyForPlacement(e.element,this.m_viewState,this.m_viewCamera,this.m_poiManager,i);return t!==c.PrePlacementResult.Ok||this.m_textElementStateCache.deduplicateElement(this.m_viewState.zoomLevel,e)||(t=c.PrePlacementResult.Duplicate,r=void 0),y&&(y.totalLabels++,y.results[t]++),r});y&&(++y.totalGroups,r||++y.newGroups)}createSortedGroupsForSorting(e,t,i,r){if(0===i.length)return;const n=[];for(const r of i)e.shouldRenderText(t,r.tileKey)&&n.push(r);const o=new Map;for(const e of n)for(const t of e.textElementGroups.groups.values()){if(0===t.elements.length)continue;const i=o.get(t.priority);void 0===i?o.set(t.priority,new C([new P(e,t)])):i.lists.push(new P(e,t))}if(0===o.size)return;for(const e of o){const t=e[1];r.push(t)}r.sort((e,t)=>t.priority-e.priority)}selectTextElementsToUpdateByDistance(e){const t=Math.max(this.m_options.maxDistanceRatioForTextLabels,this.m_options.maxDistanceRatioForPoiLabels),i=c.getMaxViewDistance(this.m_viewState,t);for(const t of e.lists)this.prepareTextElementGroup(t.group,t.tile.tileKey,i)}placeTextElements(e,t){const i={numRenderedTextElements:0,fadeAnimationRunning:!1,time:e},r=this.overloaded&&this.m_viewState.isDynamic?n.PerformanceTimer.now():void 0;if(_&&_.clear(),0===this.m_textElementStateCache.size)return void v.debug("Text element cache empty.");const o=this.m_forceNewLabelsPass||t;this.m_forceNewLabelsPass&&(t||v.debug("Force new label pass"),this.m_forceNewLabelsPass=!1);const s=this.m_options.maxNumVisibleLabels,a=this.m_textElementStateCache.sortedGroupStates;let l=a[0].priority,c=0;for(let e=0;e<a.length;++e){const t=a[e];_&&++_.totalGroups;const n=t.priority;if(o&&l!==n){if(this.placeNewTextElements(c,e,i),L(r))break;l=n,c=e}if(!this.placeTextElementGroup(t,i,s,g.PersistentLabels))break;if(L(r))break}o&&this.placeNewTextElements(c,a.length,i),_&&(_.numRenderedTextElements=i.numRenderedTextElements,_.log()),i.fadeAnimationRunning&&this.m_viewUpdateCallback()}placeNewTextElements(e,t,i){const r=this.m_textElementStateCache.sortedGroupStates;for(let n=e;n<t&&this.placeTextElementGroup(r[n],i,this.m_options.maxNumVisibleLabels,g.NewLabels);++n);}placeOverlayTextElements(){if(void 0===this.m_overlayTextElements||0===this.m_overlayTextElements.length)return;const e=this.m_tmpVector.set(this.m_screenProjector.width,this.m_screenProjector.height),t=-e.width/2,i=e.height/2;for(const n of this.m_overlayTextElements){const s=this.m_textStyleCache.getTextElementStyle(n.style),a=s.textCanvas;if(void 0===a)continue;const l=!1;if(this.initializeGlyphs(n,s,l),n.loadingState!==d.LoadingState.Initialized)continue;const c=a.getLayer(n.renderOrder||r.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==c&&c.storage.drawCount+n.glyphs.length>c.storage.capacity)continue;let u;if(a.textRenderStyle=n.renderStyle,a.textLayoutStyle=n.layoutStyle,n.type!==p.TextElementType.PathLabel)S.x=t+n.position.x*e.width,S.y=i-n.position.y*e.height,void 0!==n.xOffset&&(S.x+=n.xOffset),void 0!==n.yOffset&&(S.y-=n.yOffset),x.x=S.x,x.y=S.y,x.z=0,A(n,a,x);else{S.x=t,S.y=i,void 0!==n.xOffset&&(S.x+=n.xOffset),void 0!==n.yOffset&&(S.y-=n.yOffset);const r=[];for(const t of n.path){const i=S.x+t.x*e.width,n=S.y-t.y*e.height;r.push(new o.Vector2(i,n))}u=new h.SimplePath;for(let e=0;e<r.length-1;++e)u.add(new o.LineCurve(r[e],r[e+1]));A(n,a,x,u,!0)}}}getDistanceScalingFactor(e,t,i){let r=i/t;return r=1+(r-1)*e.distanceScale,r=Math.max(r,this.m_options.labelDistanceScaleMin),r=Math.min(r,this.m_options.labelDistanceScaleMax),r}getDistanceFadingFactor(e,t,i){let r=1;const n=t.viewDistance;if(void 0!==n&&void 0!==e.fadeFar&&e.fadeFar>0){const t=void 0===e.fadeNear?0:e.fadeNear,s=e.fadeFar;s>t&&(r=1-o.MathUtils.clamp((n/i-t)/(s-t),0,1))}return r}addPointLabel(e,t,i,r,o,s,a){const l=e.element,h=e.textRenderState;n.assert(void 0===a||void 0!==e.iconRenderStates);const d=void 0!==a?e.iconRenderStates[a]:e.iconRenderState;n.assert(void 0!==d),S.x=T.x=i.x,S.y=T.y=i.y;const u=c.pointToPlaneDistance(t,this.m_viewState.worldCenter,this.m_cameraLookAt);if(void 0!==l.fadeFar&&(l.fadeFar<=0||l.fadeFar*this.m_viewState.maxVisibilityDist<u))return _&&++_.tooFar,!1;e.setViewDistance(u);const m=l.poiInfo;let f=!1;const g=void 0!==m&&n.MathUtils.isClamped(this.m_viewState.zoomLevel,m.iconMinZoomLevel,m.iconMaxZoomLevel)&&!1!==m.isValid,v=this.getDistanceScalingFactor(l,u,this.m_viewState.lookAtDistance),y=g&&r.prepareRender(l,this.m_viewState.env);if(y){const e=c.placeIcon(d,m,T,v,this.m_viewState.env,this.m_screenCollisions);if(e===c.PlacementResult.Invisible)return d.reset(),_&&++_.numNotVisible,!1;f=e===c.PlacementResult.Rejected}else g&&!1!==m.isValid&&(this.m_forceNewLabelsPass=!0);const b=this.getDistanceFadingFactor(l,e,this.m_viewState.maxVisibilityDist);if(function(e,t,i){const r=e.textRenderState,o=e.element,s=o.poiInfo;if(n.assert(o.type!==p.TextElementType.PathLabel),!(void 0!==r&&""!==o.text))return!1;if(!(void 0===s||void 0===t.zoomLevel||n.MathUtils.isClamped(t.zoomLevel,s.iconMinZoomLevel,s.iconMaxZoomLevel)))return!1;const a=c.getMaxViewDistance(t,i.maxDistanceRatioForPoiLabels);return!!(!0===o.ignoreDistance||void 0===e.viewDistance||e.viewDistance<a)&&(void 0===s||!0===s.isValid||!1!==s.iconIsOptional)}(e,this.m_viewState,this.m_options)){const t=c.placePointLabel(e,S,v,o,this.m_viewState.env,this.m_screenCollisions,f,x,void 0===a);if(t===c.PlacementResult.Invisible)return _&&_.numPoiTextsInvisible++,e.reset(),!1;const i=t===c.PlacementResult.Rejected;if(!f){const e=void 0!==l.poiInfo&&!0===l.poiInfo.textIsOptional;f=i&&!e}i&&h.startFadeOut(s.time),(!i&&function(e,t){const i=e.element.poiInfo;return!t.cameraIsMoving||void 0===i||!0===i.renderTextDuringMovements}(e,this.m_viewState)||h.isFading())&&(i||h.startFadeIn(s.time),s.fadeAnimationRunning=s.fadeAnimationRunning||h.isFading(),function(e,t,i,r,n){const o=e.element,s=e.textRenderState.opacity*r*o.renderStyle.opacity;if(0===s)return!1;w.letterCaseArray=o.glyphCaseArray,void 0===o.textBufferObject&&(o.textBufferObject=t.createTextBufferObject(o.glyphs,w));const a=o.renderStyle.backgroundOpacity>0&&t.textRenderStyle.fontSize.backgroundSize>0;return E.layer=o.renderOrder,E.position=i,E.scale=n,E.opacity=s,E.backgroundOpacity=a?E.opacity*o.renderStyle.backgroundOpacity:0,E.pickingData=o.userData?o:void 0,t.addTextBufferObject(o.textBufferObject,E),!0}(e,o,x,b,v)&&_&&_.numRenderedPoiTexts++)}if(y){f?d.startFadeOut(s.time):d.startFadeIn(s.time),s.fadeAnimationRunning=s.fadeAnimationRunning||d.isFading();const t=d.opacity*b;if(t>0){const i=!1!==m.reserveSpace&&!f;r.renderPoi(m,T,this.m_screenCollisions,e.renderDistance,v,i,t,this.m_viewState.env),_&&_.numRenderedPoiIcons++}}return s.numRenderedTextElements++,!0}addPoiLabel(e,t,i,r){const n=c.getWorldPosition(e.element,this.m_viewState.projection,this.m_viewState.env,this.m_tmpVector3);return void 0!==this.m_screenProjector.project(n,S)&&this.addPointLabel(e,n,S,t,i,r)}addLineMarkerLabel(e,t,i,r,o){const s=e.element,a=s.points,l=s.poiInfo;if(0===a.length||!t.prepareRender(s,this.m_viewState.env))return;let c;void 0!==l.shieldGroupIndex&&(c=i[l.shieldGroupIndex],void 0===c&&(c=[],i[l.shieldGroupIndex]=c));const h=l.technique,d=void 0!==h.minDistance?h.minDistance*h.minDistance:0;if(d>0&&void 0!==c)for(let i=0;i<a.length;++i){const s=a[i];if(void 0!==this.m_screenProjector.project(s,S)){let a=!1;for(let e=0;e<c.length;e+=2){if(a=n.Math2D.distSquared(c[e],c[e+1],S.x,S.y)<d,a)break}a||this.addPointLabel(e,s,S,t,r,o,i)&&c.push(S.x,S.y)}}else for(let i=0;i<a.length;++i){const n=a[i];void 0!==this.m_screenProjector.project(n,S)&&this.addPointLabel(e,n,S,t,r,o,i)}}addPathLabel(e,t,i,r){const n=c.getMaxViewDistance(this.m_viewState,this.m_options.maxDistanceRatioForTextLabels),s=e.element;if(!(!0===s.ignoreDistance||void 0===e.viewDistance||e.viewDistance<n))return _&&++_.tooFar,e.textRenderState.reset(),!1;if(void 0!==s.fadeFar&&(s.fadeFar<=0||s.fadeFar*this.m_viewState.maxVisibilityDist<e.renderDistance))return _&&++_.tooFar,e.textRenderState.reset(),!1;let a=new o.Path;S.copy(t[0]);for(let e=0;e<t.length-1;++e)a.add(new h.SimpleLineCurve(t[e],t[e+1]));if(a.getPoint(.5).x-a.getPoint(.51).x>0){S.copy(t[t.length-1]),a=new o.Path;for(let e=t.length-1;e>0;--e)a.add(new h.SimpleLineCurve(t[e],t[e-1]))}e.setViewDistance(c.computeViewDistance(s,this.m_viewState.worldCenter,this.m_cameraLookAt));const l=-e.renderDistance,d=this.getDistanceScalingFactor(s,l,this.m_viewState.lookAtDistance),u=i.textRenderStyle.fontSize.size;if(i.textRenderStyle.fontSize.size*=d,c.placePathLabel(e,a,S,i,this.m_screenCollisions)!==c.PlacementResult.Ok)return i.textRenderStyle.fontSize.size=u,_&&++_.numNotVisible,e.textRenderState.reset(),!1;e.textRenderState.startFadeIn(r.time);let m=s.renderStyle.opacity;if(e.textRenderState.isFading()&&(m*=e.textRenderState.opacity,r.fadeAnimationRunning=!0),0===e.textRenderState.opacity)return i.textRenderStyle.fontSize.size=u,!1;const p=i.textRenderStyle.opacity,f=i.textRenderStyle.backgroundOpacity,g=this.getDistanceFadingFactor(s,e,this.m_viewState.maxVisibilityDist);return i.textRenderStyle.opacity=m*g,i.textRenderStyle.backgroundOpacity=i.textRenderStyle.opacity*s.renderStyle.backgroundOpacity,x.z=e.renderDistance,A(s,i,x,a),r.numRenderedTextElements++,i.textRenderStyle.fontSize.size=u,i.textRenderStyle.opacity=p,i.textRenderStyle.backgroundOpacity=f,!0}checkIfOverloaded(e){let t=0;e.forEach(e=>{for(const i of e.renderedTiles.values())t+=i.textElementGroups.count()});const i=t>2e4;return i&&!this.m_overloaded&&v.debug("Overloaded Mode enabled."),this.m_overloaded=i,this.m_overloaded}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerOptions=t.LogLevel=void 0,function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(t.LogLevel||(t.LogLevel={}));t.LoggerOptions=class{}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUrlHostAndProtocol=t.getUrlOrigin=t.baseUrl=t.resolveReferenceUri=void 0,t.resolveReferenceUri=function(e,t){if(r.test(t))return t;if(t.startsWith("/")){return o(e)+t}return t.startsWith("./")&&(t=t.substr(2)),n(e)+t};const r=new RegExp("^(((?:[a-z]+:)?//)|(file:/)|(data:))","i");function n(e){if(void 0===e)return"./";let t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf("?"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),-1===t?"./":e.substring(0,t+1)}function o(e){if(void 0===e)return"";const t=s(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function s(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),i=e.match(t);if(!i)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:i[1],host:i[2]}}t.baseUrl=n,t.getUrlOrigin=o,t.getUrlHostAndProtocol=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pixels=void 0;const r=/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/;class n{constructor(e){this.value=e}static parse(e){const t=r.exec(e);if(null!==t)return new n(Number(t[1]))}toJSON(){return`${this.value}px`}}t.Pixels=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.composeTechniqueTextureName=t.addBuffersToTransferList=t.textureCoordinateType=t.needsVertexNormals=t.isLabelRejectionLineTechnique=t.isShaderTechnique=t.isTextTechnique=t.isTerrainTechnique=t.isStandardTechnique=t.isExtrudedPolygonTechnique=t.isFillTechnique=t.isStandardExtrudedLineTechnique=t.isBasicExtrudedLineTechnique=t.isExtrudedLineTechnique=t.isSegmentsTechnique=t.isSpecialDashesLineTechnique=t.isSolidLineTechnique=t.isLineTechnique=t.isLineMarkerTechnique=t.isPoiTechnique=t.isSquaresTechnique=t.isCirclesTechnique=t.lineTechniqueDescriptor=t.solidLineTechniqueDescriptor=t.circlesTechniquePropTypes=t.squaresTechniquePropTypes=t.pointTechniquePropTypes=t.baseTechniqueParamsDescriptor=t.techniqueDescriptors=t.TRANSPARENCY_PROPERTY_KEYS=t.TEXTURE_PROPERTY_KEYS=void 0;const r=i(76),n=i(77);t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap"],t.TRANSPARENCY_PROPERTY_KEYS=["opacity","transparent"],t.techniqueDescriptors={},t.baseTechniqueParamsDescriptor={attrTransparencyColor:"color",attrScopes:{renderOrder:n.AttrScope.TechniqueGeometry,enabled:n.AttrScope.FeatureGeometry,kind:n.AttrScope.TechniqueGeometry,transient:n.AttrScope.TechniqueGeometry,fadeFar:n.AttrScope.TechniqueRendering,fadeNear:n.AttrScope.TechniqueRendering}},t.pointTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{texture:n.AttrScope.TechniqueGeometry,enablePicking:n.AttrScope.TechniqueGeometry,color:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueGeometry}}),t.squaresTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,t.pointTechniquePropTypes),t.techniqueDescriptors.squares=t.squaresTechniquePropTypes,t.circlesTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,t.pointTechniquePropTypes),t.techniqueDescriptors.circles=t.circlesTechniquePropTypes;const o=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{text:n.AttrScope.FeatureGeometry,label:n.AttrScope.FeatureGeometry,useAbbreviation:n.AttrScope.FeatureGeometry,useIsoCode:n.AttrScope.FeatureGeometry,priority:n.AttrScope.TechniqueGeometry,textMinZoomLevel:n.AttrScope.TechniqueGeometry,textMaxZoomLevel:n.AttrScope.TechniqueGeometry,iconMinZoomLevel:n.AttrScope.TechniqueGeometry,iconMaxZoomLevel:n.AttrScope.TechniqueGeometry,distanceScale:n.AttrScope.TechniqueGeometry,textMayOverlap:n.AttrScope.TechniqueGeometry,iconMayOverlap:n.AttrScope.TechniqueGeometry,textReserveSpace:n.AttrScope.TechniqueGeometry,iconReserveSpace:n.AttrScope.TechniqueGeometry,renderTextDuringMovements:n.AttrScope.TechniqueGeometry,alwaysOnTop:n.AttrScope.TechniqueGeometry,textIsOptional:n.AttrScope.TechniqueGeometry,showOnMap:n.AttrScope.TechniqueGeometry,stackMode:n.AttrScope.TechniqueGeometry,minDistance:n.AttrScope.TechniqueGeometry,iconIsOptional:n.AttrScope.TechniqueGeometry,iconFadeTime:n.AttrScope.TechniqueGeometry,textFadeTime:n.AttrScope.TechniqueGeometry,xOffset:n.AttrScope.TechniqueGeometry,yOffset:n.AttrScope.TechniqueGeometry,iconXOffset:n.AttrScope.TechniqueGeometry,iconYOffset:n.AttrScope.TechniqueGeometry,iconScale:n.AttrScope.TechniqueGeometry,screenHeight:n.AttrScope.TechniqueGeometry,screenWidth:n.AttrScope.TechniqueGeometry,poiTable:n.AttrScope.TechniqueGeometry,poiName:n.AttrScope.FeatureGeometry,poiNameField:n.AttrScope.TechniqueGeometry,imageTexture:n.AttrScope.FeatureGeometry,imageTextureField:n.AttrScope.TechniqueGeometry,imageTexturePrefix:n.AttrScope.TechniqueGeometry,imageTexturePostfix:n.AttrScope.TechniqueGeometry,iconColor:n.AttrScope.TechniqueRendering,iconBrightness:n.AttrScope.TechniqueRendering,style:n.AttrScope.TechniqueGeometry,fontName:n.AttrScope.TechniqueGeometry,fontStyle:n.AttrScope.TechniqueGeometry,fontVariant:n.AttrScope.TechniqueGeometry,rotation:n.AttrScope.TechniqueGeometry,tracking:n.AttrScope.TechniqueGeometry,leading:n.AttrScope.TechniqueGeometry,maxLines:n.AttrScope.TechniqueGeometry,lineWidth:n.AttrScope.TechniqueGeometry,canvasRotation:n.AttrScope.TechniqueGeometry,lineRotation:n.AttrScope.TechniqueGeometry,wrappingMode:n.AttrScope.TechniqueGeometry,hAlignment:n.AttrScope.TechniqueGeometry,vAlignment:n.AttrScope.TechniqueGeometry,placements:n.AttrScope.TechniqueGeometry,backgroundColor:n.AttrScope.TechniqueRendering,backgroundSize:n.AttrScope.TechniqueRendering,backgroundOpacity:n.AttrScope.TechniqueRendering,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,size:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors["line-marker"]=o,t.techniqueDescriptors["labeled-icon"]=o;const s={attrScopes:{polygonOffset:n.AttrScope.TechniqueRendering,polygonOffsetFactor:n.AttrScope.TechniqueRendering,polygonOffsetUnits:n.AttrScope.TechniqueRendering,lineColor:n.AttrScope.TechniqueRendering,lineFadeFar:n.AttrScope.TechniqueRendering,lineFadeNear:n.AttrScope.TechniqueRendering}};t.solidLineTechniqueDescriptor=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,s,{attrScopes:{clipping:n.AttrScope.TechniqueGeometry,secondaryRenderOrder:n.AttrScope.TechniqueGeometry,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering,secondaryWidth:n.AttrScope.TechniqueRendering,secondaryColor:n.AttrScope.TechniqueRendering,dashSize:n.AttrScope.TechniqueRendering,gapSize:n.AttrScope.TechniqueRendering}}),t.techniqueDescriptors["solid-line"]=t.solidLineTechniqueDescriptor,t.techniqueDescriptors["dashed-line"]=t.solidLineTechniqueDescriptor,t.lineTechniqueDescriptor=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.FeatureGeometry}}),t.techniqueDescriptors.line=t.lineTechniqueDescriptor;const a=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,s,{attrScopes:{color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors.fill=a;const l=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{color:n.AttrScope.FeatureGeometry,vertexColors:n.AttrScope.FeatureGeometry,wireframe:n.AttrScope.TechniqueRendering,roughness:n.AttrScope.TechniqueRendering,metalness:n.AttrScope.TechniqueRendering,alphaTest:n.AttrScope.TechniqueRendering,depthTest:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,emissive:n.AttrScope.TechniqueRendering,emissiveIntensity:n.AttrScope.TechniqueRendering,refractionRatio:n.AttrScope.TechniqueRendering,map:n.AttrScope.TechniqueGeometry,mapProperties:n.AttrScope.TechniqueGeometry,normalMap:n.AttrScope.TechniqueGeometry,normalMapProperties:n.AttrScope.TechniqueGeometry,displacementMap:n.AttrScope.TechniqueGeometry,displacementMapProperties:n.AttrScope.TechniqueGeometry,roughnessMap:n.AttrScope.TechniqueGeometry,roughnessMapProperties:n.AttrScope.TechniqueGeometry,emissiveMap:n.AttrScope.TechniqueGeometry,emissiveMapProperties:n.AttrScope.TechniqueGeometry,bumpMap:n.AttrScope.TechniqueGeometry,bumpMapProperties:n.AttrScope.TechniqueGeometry,metalnessMap:n.AttrScope.TechniqueGeometry,metalnessMapProperties:n.AttrScope.TechniqueGeometry,alphaMap:n.AttrScope.TechniqueGeometry,alphaMapProperties:n.AttrScope.TechniqueGeometry}});t.techniqueDescriptors.standard=l;const c=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,l,{attrScopes:{height:n.AttrScope.FeatureGeometry,floorHeight:n.AttrScope.FeatureGeometry,color:n.AttrScope.FeatureGeometry,defaultColor:n.AttrScope.FeatureGeometry,defaultHeight:n.AttrScope.FeatureGeometry,constantHeight:n.AttrScope.FeatureGeometry,boundaryWalls:n.AttrScope.FeatureGeometry,footprint:n.AttrScope.FeatureGeometry,maxSlope:n.AttrScope.FeatureGeometry,enableDepthPrePass:n.AttrScope.TechniqueGeometry,animateExtrusionDuration:n.AttrScope.TechniqueGeometry,animateExtrusion:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering,lineFadeNear:n.AttrScope.TechniqueRendering,lineFadeFar:n.AttrScope.TechniqueRendering,lineColorMix:n.AttrScope.TechniqueGeometry,lineColor:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors["extruded-polygon"]=c;const h=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{text:n.AttrScope.FeatureGeometry,label:n.AttrScope.FeatureGeometry,useAbbreviation:n.AttrScope.FeatureGeometry,useIsoCode:n.AttrScope.FeatureGeometry,minZoomLevel:n.AttrScope.TechniqueGeometry,maxZoomLevel:n.AttrScope.TechniqueGeometry,distanceScale:n.AttrScope.TechniqueGeometry,mayOverlap:n.AttrScope.TechniqueGeometry,reserveSpace:n.AttrScope.TechniqueGeometry,textFadeTime:n.AttrScope.TechniqueGeometry,xOffset:n.AttrScope.TechniqueGeometry,yOffset:n.AttrScope.TechniqueGeometry,style:n.AttrScope.TechniqueGeometry,fontName:n.AttrScope.TechniqueGeometry,fontStyle:n.AttrScope.TechniqueGeometry,fontVariant:n.AttrScope.TechniqueGeometry,rotation:n.AttrScope.TechniqueGeometry,tracking:n.AttrScope.TechniqueGeometry,leading:n.AttrScope.TechniqueGeometry,maxLines:n.AttrScope.TechniqueGeometry,lineWidth:n.AttrScope.TechniqueGeometry,canvasRotation:n.AttrScope.TechniqueGeometry,lineRotation:n.AttrScope.TechniqueGeometry,wrappingMode:n.AttrScope.TechniqueGeometry,hAlignment:n.AttrScope.TechniqueGeometry,vAlignment:n.AttrScope.TechniqueGeometry,backgroundColor:n.AttrScope.TechniqueRendering,backgroundSize:n.AttrScope.TechniqueRendering,backgroundOpacity:n.AttrScope.TechniqueRendering,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,priority:n.AttrScope.TechniqueRendering,size:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors.text=h;const d=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{primitive:n.AttrScope.TechniqueGeometry,params:n.AttrScope.TechniqueRendering}});function u(e){return"extruded-line"===e.name}function m(e){return u(e)&&"standard"===e.shading}function p(e){return"fill"===e.name}function f(e){return"extruded-polygon"===e.name}function g(e){return"standard"===e.name}function v(e){return"terrain"===e.name}function y(e){return"shader"===e.name}t.techniqueDescriptors.shader=d,t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=function(e){return"labeled-icon"===e.name},t.isLineMarkerTechnique=function(e){return"line-marker"===e.name},t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name||"dashed-line"===e.name},t.isSpecialDashesLineTechnique=function(e){return("solid-line"===e.name||"dashed-line"===e.name)&&void 0!==e.dashes&&"Square"!==e.dashes},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=u,t.isBasicExtrudedLineTechnique=function(e){return u(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=m,t.isFillTechnique=p,t.isExtrudedPolygonTechnique=f,t.isStandardTechnique=g,t.isTerrainTechnique=v,t.isTextTechnique=function(e){return"text"===e.name},t.isShaderTechnique=y,t.isLabelRejectionLineTechnique=function(e){return"label-rejection-line"===e.name},t.needsVertexNormals=function(e){return p(e)||g(e)||v(e)||m(e)},t.textureCoordinateType=function(e){return g(e)||f(e)||v(e)||y(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,i){if(g(e)||f(e)||v(e))for(const n of t.TEXTURE_PROPERTY_KEYS){const t=e[n];r.isTextureBuffer(t)&&t.buffer instanceof ArrayBuffer&&i.push(t.buffer)}},t.composeTechniqueTextureName=function(e,t){let i=e;return"string"==typeof t.imageTexturePrefix&&(i=t.imageTexturePrefix+i),"string"==typeof t.imageTexturePostfix&&(i+=t.imageTexturePostfix),i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshStandardMaterial=t.MapMeshDepthMaterial=t.MapMeshBasicMaterial=t.ExtrusionFeatureMixin=t.ExtrusionFeature=t.FadingFeatureMixin=t.FadingFeature=t.DisplacementFeatureMixin=t.hasExtrusionFeature=void 0;const r=i(1),n=i(9),o=i(0),s=i(35),a=i(191),l=i(192),c=i(193),h=new o.Texture;function d(e,t){return e*t.maximum}function u(e,t){void 0===t.defines&&(t.defines={}),e.shaderDefines=t.defines,void 0===e.shaderUniforms&&(e.shaderUniforms={})}function m(e,t){Object.assign(t.uniforms,e.shaderUniforms),e.shaderUniforms=t.uniforms}var p,f,g;t.hasExtrusionFeature=function(e){return"extrusionRatio"in e},function(e){function t(e){return null!==e.displacementMap}e.isEnabled=t,e.updateDisplacementFeature=function(e){r.assert(void 0!==e.shaderDefines),r.assert(void 0!==e.shaderUniforms);const i=t(e),o=n.setShaderDefine(e.shaderDefines,"USE_DISPLACEMENTMAP",i);if(e.needsUpdate=o,i){const t=e.displacementMap;t.needsUpdate=!0,e.shaderUniforms.displacementMap.value=t}else o&&(e.shaderUniforms.displacementMap.value=h)},e.onBeforeCompile=function(e,i){t(e)&&(r.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=i.vertexShader.replace("#include <skinbase_vertex>","#include <skinbase_vertex>\n#ifndef USE_ENVMAP\n    vec3 objectNormal = vec3( normal );\n#endif"),i.vertexShader=n.insertShaderInclude(i.vertexShader,"uv2_pars_vertex","displacementmap_pars_vertex"),i.vertexShader=n.insertShaderInclude(i.vertexShader,"skinning_vertex","displacementmap_vertex",!0))}}(p||(p={}));class v{constructor(){this.m_displacementMap=null}get displacementMap(){return this.m_displacementMap}set displacementMap(e){this.setDisplacementMap(e)}getDisplacementMap(){return this.m_displacementMap}setDisplacementMap(e){e!==this.m_displacementMap&&(this.m_displacementMap=e,p.updateDisplacementFeature(this))}addDisplacementProperties(){Object.defineProperty(this,"displacementMap",{get:()=>this.getDisplacementMap(),set:e=>{this.setDisplacementMap(e)}})}applyDisplacementParameters(e){u(this,this),r.assert(void 0!==this.shaderDefines),r.assert(void 0!==this.shaderUniforms);const t=this.shaderUniforms;t.displacementMap=new o.Uniform(h),t.displacementScale=new o.Uniform(1),t.displacementBias=new o.Uniform(0),void 0!==e&&void 0!==e.displacementMap&&this.setDisplacementMap(e.displacementMap),this.onBeforeCompile=r.chainCallbacks(this.onBeforeCompile,e=>{p.onBeforeCompile(this,e)}),this.needsUpdate=p.isEnabled(this)}copyDisplacementParameters(e){return this.setDisplacementMap(e.displacementMap),this}}t.DisplacementFeatureMixin=v,function(e){function t(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar&&e.fadeFar>0}e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.isEnabled=t,e.isDefined=function(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar},e.patchGlobalShaderChunks=function(){void 0===o.ShaderChunk.fading_pars_vertex&&Object.assign(o.ShaderChunk,l.default)},e.updateFadingFeature=function(i){r.assert(void 0!==i.shaderDefines),r.assert(void 0!==i.shaderUniforms);const o=t(i),s=n.setShaderDefine(i.shaderDefines,"FADING_MATERIAL",o);i.needsUpdate=s,r.assert(void 0!==i.shaderUniforms.fadeNear&&void 0!==i.shaderUniforms.fadeFar),o?(i.shaderUniforms.fadeNear.value=i.fadeNear,i.shaderUniforms.fadeFar.value=i.fadeFar,s&&n.enableBlending(i)):s&&(i.shaderUniforms.fadeNear.value=e.DEFAULT_FADE_NEAR,i.shaderUniforms.fadeFar.value=e.DEFAULT_FADE_FAR,n.disableBlending(i))},e.onBeforeCompile=function(e,i){t(e)&&(r.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=n.insertShaderInclude(i.vertexShader,"fog_pars_vertex","fading_pars_vertex"),i.vertexShader=n.insertShaderInclude(i.vertexShader,"fog_vertex","fading_vertex",!0),i.fragmentShader=n.insertShaderInclude(i.fragmentShader,"fog_pars_fragment","fading_pars_fragment"),i.fragmentShader=n.insertShaderInclude(i.fragmentShader,"fog_fragment","fading_fragment",!0))},e.addRenderHelper=function(t,i,n,o,s,a){t.onBeforeRender=r.chainCallbacks(t.onBeforeRender,(t,r,s,l,c,h)=>{const u=c;u.fadeNear=void 0===n||n===e.DEFAULT_FADE_NEAR?e.DEFAULT_FADE_NEAR:d(n,i),u.fadeFar=void 0===o||o===e.DEFAULT_FADE_FAR?e.DEFAULT_FADE_FAR:d(o,i),void 0!==a&&a(t,c)})}}(f=t.FadingFeature||(t.FadingFeature={}));class y{constructor(){this.m_fadeNear=f.DEFAULT_FADE_NEAR,this.m_fadeFar=f.DEFAULT_FADE_FAR}getFadeNear(){return this.m_fadeNear}setFadeNear(e){e!==this.m_fadeNear&&(this.m_fadeNear=e,f.updateFadingFeature(this))}getFadeFar(){return this.m_fadeFar}setFadeFar(e){e!==this.m_fadeFar&&(this.m_fadeFar=e,f.updateFadingFeature(this))}addFadingProperties(){Object.defineProperty(this,"fadeNear",{get:()=>this.getFadeNear(),set:e=>{this.setFadeNear(e)}}),Object.defineProperty(this,"fadeFar",{get:()=>this.getFadeFar(),set:e=>{this.setFadeFar(e)}})}applyFadingParameters(e){u(this,this),r.assert(void 0!==this.shaderDefines),r.assert(void 0!==this.shaderUniforms),this.shaderUniforms.fadeNear=new o.Uniform(f.DEFAULT_FADE_NEAR),this.shaderUniforms.fadeFar=new o.Uniform(f.DEFAULT_FADE_FAR),void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=r.chainCallbacks(this.onBeforeCompile,e=>{f.onBeforeCompile(this,e)}),this.needsUpdate=f.isEnabled(this)}copyFadingParameters(e){return this.setFadeNear(void 0===e.fadeNear?f.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?f.DEFAULT_FADE_FAR:e.fadeFar),this}}t.FadingFeatureMixin=y,function(e){function t(e){return void 0!==e.extrusionRatio&&e.extrusionRatio>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===o.ShaderChunk.extrusion_pars_vertex&&Object.assign(o.ShaderChunk,a.default)},e.updateExtrusionFeature=function(e){r.assert(void 0!==e.shaderDefines),r.assert(void 0!==e.shaderUniforms);const i=t(e),o=n.setShaderDefine(e.shaderDefines,"EXTRUSION_MATERIAL",i);e.needsUpdate=o,i?e.shaderUniforms.extrusionRatio.value=e.extrusionRatio:o&&(e.shaderUniforms.extrusionRatio.value=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX)},e.onBeforeCompile=function(e,i){t(e)&&(r.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=n.insertShaderInclude(i.vertexShader,"common","extrusion_pars_vertex"),i.vertexShader=n.insertShaderInclude(i.vertexShader,"begin_vertex","extrusion_vertex",!0),i.fragmentShader=n.insertShaderInclude(i.fragmentShader,"fog_pars_fragment","extrusion_pars_fragment"),i.fragmentShader=i.fragmentShader.replace("#include <normal_fragment_begin>","#include <extrusion_normal_fragment_begin>"),i.fragmentShader=n.insertShaderInclude(i.fragmentShader,"fog_fragment","extrusion_fragment",!0))}}(g=t.ExtrusionFeature||(t.ExtrusionFeature={}));class _{constructor(){this.m_extrusion=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}getExtrusionRatio(){return this.m_extrusion}setExtrusionRatio(e){e!==this.m_extrusion&&(this.m_extrusion=e,g.updateExtrusionFeature(this))}addExtrusionProperties(){Object.defineProperty(this,"extrusionRatio",{get:()=>this.getExtrusionRatio(),set:e=>{this.setExtrusionRatio(e)}})}applyExtrusionParameters(e){u(this,this),r.assert(void 0!==this.shaderDefines),r.assert(void 0!==this.shaderUniforms),e&&!0===e.zFightingWorkaround&&(this.shaderDefines.ZFIGHTING_WORKAROUND=""),this.shaderUniforms.extrusionRatio=new o.Uniform(s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),void 0!==e&&void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this.onBeforeCompile=r.chainCallbacks(this.onBeforeCompile,e=>{g.onBeforeCompile(this,e)}),this.needsUpdate=g.isEnabled(this)}copyExtrusionParameters(e){return void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this}}t.ExtrusionFeatureMixin=_;class x extends o.MeshBasicMaterial{constructor(e){super(e),f.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.addDisplacementProperties(),this.applyDisplacementParameters(e)}clone(){return(new x).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.copyDisplacementParameters(e),this}get fadeNear(){return f.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return f.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get displacementMap(){return null}set displacementMap(e){}setDisplacementMap(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}addDisplacementProperties(){}applyDisplacementParameters(e){}copyDisplacementParameters(e){}}t.MapMeshBasicMaterial=x;class S extends o.MeshDepthMaterial{constructor(e){super(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!1})),this.flatShading=!1}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshDepthMaterial=S;class b extends o.MeshStandardMaterial{constructor(e){super(e),f.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),!0===(null==e?void 0:e.removeDiffuseLight)&&(this.onBeforeCompile=r.chainCallbacks(this.onBeforeCompile,e=>{e.fragmentShader=o.ShaderChunk.meshphysical_frag.replace("#include <lights_physical_pars_fragment>",c.simpleLightingShadowChunk)}))}clone(){return(new b).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this}get displacementMap(){return void 0===super.displacementMap?null:super.displacementMap}set displacementMap(e){e!==this.displacementMap&&(e&&this.displacementMap||(this.needsUpdate=!0),e&&(e.needsUpdate=!0),super.displacementMap=e)}get fadeNear(){return f.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return f.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get removeDiffuseLight(){return!1}set removeDiffuseLight(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshStandardMaterial=b,r.applyMixinsWithoutProperties(x,[y]),r.applyMixinsWithoutProperties(b,[y]),r.applyMixinsWithoutProperties(x,[_]),r.applyMixinsWithoutProperties(b,[_]),r.applyMixinsWithoutProperties(S,[_]),r.applyMixinsWithoutProperties(x,[v])},function(e,t,i){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LineCapsModes=void 0,function(e){e[e.CAPS_NONE=0]="CAPS_NONE",e[e.CAPS_SQUARE=1]="CAPS_SQUARE",e[e.CAPS_ROUND=2]="CAPS_ROUND",e[e.CAPS_TRIANGLE_IN=3]="CAPS_TRIANGLE_IN",e[e.CAPS_TRIANGLE_OUT=4]="CAPS_TRIANGLE_OUT"}(r=t.LineCapsModes||(t.LineCapsModes={})),t.default={extrude_line_vert_func:"\nvec3 extrudeLine(\n        in vec3 vertexPosition,\n        in float linePosition,\n        in float extrusionWidth,\n        in vec4 bitangent,\n        in vec3 tangent,\n        in float tanHalfAngle,\n        inout vec2 uv\n    ) {\n    vec3 result = vertexPosition;\n    // Retrieve the angle between this segment and the previous one (stored in the bitangent w\n    // component).\n    float angle = bitangent.w;\n    // Extrude according to the angle between segments to properly render narrow joints...\n    if (angle != 0.0) {\n        result += uv.y * extrusionWidth * bitangent.xyz / cos(angle / 2.0);\n        uv.x = linePosition + uv.x * extrusionWidth * uv.y * tanHalfAngle;\n    }\n    // ... or extrude in a simple manner for segments that keep the same direction.\n    else {\n        result += uv.y * extrusionWidth * bitangent.xyz + uv.x * extrusionWidth * tangent;\n        uv.x = linePosition + uv.x * extrusionWidth;\n    }\n    uv.y *= extrusionWidth;\n    return result;\n}\n",round_edges_and_add_caps:`\n#define CAPS_NONE ${r.CAPS_NONE}\n#define CAPS_SQUARE ${r.CAPS_SQUARE}\n#define CAPS_ROUND ${r.CAPS_ROUND}\n#define CAPS_TRIANGLE_IN ${r.CAPS_TRIANGLE_IN}\n#define CAPS_TRIANGLE_OUT ${r.CAPS_TRIANGLE_OUT}\n\nfloat roundEdgesAndAddCaps(in vec4 coords, in vec3 range) {\n    // Compute the line's width to length ratio.\n    float widthRatio = range.y / range.x;\n\n    // Compute the inner segment distance (same for all cap mode).\n    float dist = abs(coords.y);\n    float segmentBeginMask = clamp(ceil(coords.z - coords.x), 0.0, 1.0);\n    float segmentEndMask = clamp(ceil(coords.x - coords.w), 0.0, 1.0);\n    dist = max(dist, segmentBeginMask * length(vec2((coords.x - coords.z) / widthRatio, coords.y)));\n    dist = max(dist, segmentEndMask * length(vec2((coords.x - coords.w) / widthRatio, coords.y)));\n\n    #if CAPS_MODE != CAPS_ROUND\n    // Compute the caps mask.\n    float capRangeMask = clamp(1.0 - ceil(range.z - drawRange.y), 0.0, 1.0);\n    float beginCapMask = clamp(ceil(drawRange.x - coords.x), 0.0, 1.0);\n    float endCapMask = clamp(ceil(coords.x - drawRange.y), 0.0, 1.0);\n    float capMask = capRangeMask * max(beginCapMask, endCapMask);\n\n    // Compute the outer segment distance (specific for each cap mode).\n    float capDist = max(coords.x - drawRange.y, drawRange.x - coords.x) / widthRatio;\n    #if CAPS_MODE == CAPS_NONE\n    dist = mix(dist, max(abs(coords.y), (capDist + 0.1) / 0.1), capMask);\n    #elif CAPS_MODE == CAPS_SQUARE\n    dist = mix(dist, max(abs(coords.y), capDist), capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_OUT\n    dist = mix(dist, abs(coords.y) + capDist, capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_IN\n    dist = mix(dist, max(abs(coords.y), (capDist - abs(coords.y)) + capDist), capMask);\n    #endif\n    #endif // CAPS_MODE != CAPS_ROUND\n\n    return dist;\n}\n`,tile_clip_func:"\nvoid tileClip(vec2 tilePos, vec2 tileSize) {\n    if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n        discard;\n    if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n        discard;\n}\n",high_precision_vert_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphData=void 0;const r=i(0),n=i(24);class o{constructor(e,t,i,o,s,a,l,c,h,d,u,m,p){this.codePoint=e,this.block=t,this.width=i,this.height=o,this.advanceX=s,this.offsetX=a,this.offsetY=l,this.texture=m,this.font=p,this.positions=[],this.sourceTextureCoordinates=[],this.dynamicTextureCoordinates=[],this.copyIndex=0,this.isInCache=!1,this.character=String.fromCodePoint(e),this.direction=n.UnicodeUtils.getDirection(e,t);const f=this.offsetX,g=f+this.width,v=p.metrics.lineHeight-this.offsetY,y=v-this.height;this.positions.push(new r.Vector3(f,y,1),new r.Vector3(g,y,1),new r.Vector3(f,v,1),new r.Vector3(g,v,1)),this.sourceTextureCoordinates.push(new r.Vector2(c,h),new r.Vector2(d,h),new r.Vector2(c,u),new r.Vector2(d,u)),this.dynamicTextureCoordinates.push(new r.Vector2(0,0),new r.Vector2(1,0),new r.Vector2(0,1),new r.Vector2(1,1))}clone(){return new o(this.codePoint,this.block,this.width,this.height,this.advanceX,this.offsetX,this.offsetY,this.sourceTextureCoordinates[0].x,this.sourceTextureCoordinates[0].y,this.sourceTextureCoordinates[3].x,this.sourceTextureCoordinates[3].y,this.texture,this.font)}}t.GlyphData=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextGeometry=t.QUAD_INDEX_MEMORY_FOOTPRINT=t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD=t.VERTICES_PER_QUAD=t.INDEX_BUFFER_STRIDE=t.VERTEX_BUFFER_STRIDE=t.MAX_CAPACITY=void 0;const r=i(0);t.MAX_CAPACITY=65536,t.VERTEX_BUFFER_STRIDE=16,t.INDEX_BUFFER_STRIDE=1,t.VERTICES_PER_QUAD=4,t.INDICES_PER_QUAD=6,t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.VERTICES_PER_QUAD*t.VERTEX_BUFFER_STRIDE,t.QUAD_INDEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD*t.INDEX_BUFFER_STRIDE;t.TextGeometry=class{constructor(e,i,n,o,s){this.scene=e,this.capacity=Math.min(s,t.MAX_CAPACITY),this.m_currentCapacity=Math.min(o,s),this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingCount=0,this.m_vertexBuffer=new r.InterleavedBuffer(new Float32Array(this.m_currentCapacity*t.QUAD_VERTEX_MEMORY_FOOTPRINT),t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(r.DynamicDrawUsage),this.m_positionAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,12),this.m_indexBuffer=new r.BufferAttribute(new Uint32Array(this.m_currentCapacity*t.QUAD_INDEX_MEMORY_FOOTPRINT),t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(r.DynamicDrawUsage),this.m_geometry=new r.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray=new Array(this.m_currentCapacity),this.m_mesh=new r.Mesh(this.m_geometry,i),this.m_bgMesh=new r.Mesh(this.m_geometry,n),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}get drawCount(){return this.m_drawCount}get mesh(){return this.m_mesh}get backgroundMesh(){return this.m_bgMesh}dispose(){this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_geometry.dispose()}clear(){this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingCount=0}update(){this.drawCount>this.m_updateOffset&&(this.m_vertexBuffer.needsUpdate=!0,this.m_vertexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_vertexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_indexBuffer.needsUpdate=!0,this.m_indexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_INDEX_MEMORY_FOOTPRINT,this.m_indexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_INDEX_MEMORY_FOOTPRINT),this.m_updateOffset=this.m_drawCount,this.m_geometry.setDrawRange(0,this.m_drawCount*t.INDICES_PER_QUAD)}add(e,i,r,n,o,s){if(this.m_drawCount>=this.capacity)return!1;if(this.m_drawCount>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const a=this.m_drawCount*t.VERTICES_PER_QUAD,l=this.m_drawCount*t.INDICES_PER_QUAD;for(let l=0;l<t.VERTICES_PER_QUAD;++l){this.m_positionAttribute.setXYZW(a+l,i[l].x,i[l].y,i[l].z,(o?-1:1)*s.rotation);const t=o?(l+1)%2+2*Math.floor(l/2):l;this.m_uvAttribute.setXYZW(a+l,e.dynamicTextureCoordinates[t].x,e.dynamicTextureCoordinates[t].y,r,n),this.m_colorAttribute.setXYZW(a+l,s.color.r,s.color.g,s.color.b,s.opacity),this.m_bgColorAttribute.setXYZW(a+l,s.backgroundColor.r,s.backgroundColor.g,s.backgroundColor.b,s.backgroundOpacity)}return this.m_indexBuffer.setX(l,a),this.m_indexBuffer.setX(l+1,a+1),this.m_indexBuffer.setX(l+2,a+2),this.m_indexBuffer.setX(l+3,a+2),this.m_indexBuffer.setX(l+4,a+1),this.m_indexBuffer.setX(l+5,a+3),++this.m_drawCount,!0}addToBuffer(e,i,r,n,o,s,a,l){for(let c=0;c<t.VERTICES_PER_QUAD;++c){const h=i+t.VERTEX_BUFFER_STRIDE*c;e[h]=n[c].x,e[h+1]=n[c].y,e[h+2]=n[c].z,e[h+3]=(a?-1:1)*l.rotation;const d=a?(c+1)%2+2*Math.floor(c/2):c;e[h+4]=r.dynamicTextureCoordinates[d].x,e[h+5]=r.dynamicTextureCoordinates[d].y,e[h+6]=o,e[h+7]=s,e[h+8]=l.color.r,e[h+9]=l.color.g,e[h+10]=l.color.b,e[h+11]=l.opacity,e[h+12]=l.backgroundColor.r,e[h+13]=l.backgroundColor.g,e[h+14]=l.backgroundColor.b,e[h+15]=l.backgroundOpacity}}addTextBufferObject(e,i,r,n,o,s,a,l){if(this.m_drawCount+e.glyphs.length>=this.capacity)return!1;if(this.m_drawCount+e.glyphs.length>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const c=r||1,h=n||0,d=Math.cos(h),u=Math.sin(h),m=void 0!==i?i.x:0,p=void 0!==i?i.y:0,f=void 0!==i?i.z:0,g=e.buffer,v=g[3]<0?-1:1,y=void 0!==o?o.r:g[8],_=void 0!==o?o.g:g[9],x=void 0!==o?o.b:g[10],S=void 0!==s?s:g[11],b=void 0!==a?a.r:g[12],T=void 0!==a?a.g:g[13],w=void 0!==a?a.b:g[14],M=void 0!==l?l:g[15],E=this.m_drawCount*t.VERTICES_PER_QUAD;for(let i=0;i<e.glyphs.length;++i){const r=i*t.QUAD_VERTEX_MEMORY_FOOTPRINT,n=e.glyphs[i];if(!n.isInCache)return!1;const o=g[r+4]>g[r+t.VERTEX_BUFFER_STRIDE+4],s=g[r+6],a=g[r+7];for(let e=0;e<t.VERTICES_PER_QUAD;++e){const l=g[r+e*t.VERTEX_BUFFER_STRIDE],P=g[r+e*t.VERTEX_BUFFER_STRIDE+1];this.m_positionAttribute.setXYZW(E+i*t.VERTICES_PER_QUAD+e,l*c*d+P*c*-u+m,l*c*u+P*c*d+p,g[r+e*t.VERTEX_BUFFER_STRIDE+2]+f,g[r+e*t.VERTEX_BUFFER_STRIDE+3]+v*h);const C=o?(e+1)%2+2*Math.floor(e/2):e;this.m_uvAttribute.setXYZW(E+i*t.VERTICES_PER_QUAD+e,n.dynamicTextureCoordinates[C].x,n.dynamicTextureCoordinates[C].y,s,(a-s)/c+s),this.m_colorAttribute.setXYZW(E+i*t.VERTICES_PER_QUAD+e,y,_,x,S),this.m_bgColorAttribute.setXYZW(E+i*t.VERTICES_PER_QUAD+e,b,T,w,M)}this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD,(this.m_drawCount+i)*t.VERTICES_PER_QUAD),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+1,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+2,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+3,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+4,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+5,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+3)}return this.m_drawCount+=e.glyphs.length,!0}addPickingData(e,t,i){return!(this.m_pickingCount>=this.m_currentCapacity)&&(this.m_pickingDataArray[this.m_pickingCount]={start:Math.min(e,this.capacity),end:Math.min(t,this.capacity),data:i},++this.m_pickingCount,!0)}pick(e,i){for(const r of this.m_pickingDataArray){if(void 0===r)return;for(let n=r.start;n<r.end;++n){const o=n*t.VERTICES_PER_QUAD,s=Math.min(this.m_positionAttribute.getX(o+2),this.m_positionAttribute.getX(o+1));if(e.x<s)continue;const a=Math.max(this.m_positionAttribute.getX(o+2),this.m_positionAttribute.getX(o+1));if(e.x>a)continue;const l=Math.min(this.m_positionAttribute.getY(o+2),this.m_positionAttribute.getY(o+1));if(e.y<l)continue;const c=Math.max(this.m_positionAttribute.getY(o+2),this.m_positionAttribute.getY(o+1));if(!(e.y>c)){i(r.data);break}}}}updateMemoryUsage(e){const t=4*this.m_vertexBuffer.count+4*this.m_indexBuffer.count;e.heapSize+=t,e.gpuSize+=t}resizeBuffers(e){this.m_currentCapacity=e;const i=new Float32Array(e*t.QUAD_VERTEX_MEMORY_FOOTPRINT);i.set(this.m_vertexBuffer.array),this.m_vertexBuffer=new r.InterleavedBuffer(i,t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(r.DynamicDrawUsage),this.m_positionAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,12);const n=new Uint32Array(e*t.QUAD_INDEX_MEMORY_FOOTPRINT);n.set(this.m_indexBuffer.array),this.m_indexBuffer=new r.BufferAttribute(n,t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(r.DynamicDrawUsage),this.m_geometry.dispose(),this.m_geometry=new r.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray.length=this.m_currentCapacity,this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_mesh=new r.Mesh(this.m_geometry,this.m_mesh.material),this.m_bgMesh=new r.Mesh(this.m_geometry,this.m_bgMesh.material),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypesettingUtils=void 0;const r=i(0),n=i(18),o=i(24);!function(e){e.EM_TO_PX=16,e.PT_TO_PX=1.25,e.OBLIQUE_ANGLE=.174533,e.OBLIQUE_OFFSET=Math.tan(e.OBLIQUE_ANGLE),e.getPixelSize=function(t,i,r){let o=t;switch(i){case n.FontUnit.Em:o*=e.EM_TO_PX;break;case n.FontUnit.Point:o*=e.PT_TO_PX;break;case n.FontUnit.Percent:o*=.01*r}return o},e.getSmallCapsScale=function(e,t,i,r){return t[i]&&r===n.FontVariant.SmallCaps?e[i].font.metrics.xHeight/e[i].font.metrics.capHeight:1},e.getDirection=function(e,t){let i=o.UnicodeUtils.Direction.LTR,r=t;for(;e[r].direction!==o.UnicodeUtils.Direction.LTR&&e[r].direction!==o.UnicodeUtils.Direction.RTL&&r<e.length-1;)++r;return 1===Math.abs(e[r].direction)&&(i=e[r].direction),i},e.computeGlyphTransform=function(e,t,i,r,n){const o=Math.cos(r),s=Math.sin(r),a=Math.cos(n),l=Math.sin(n);e.set(i*a,i*-l,o*t.x-s*t.y,i*l,i*a,s*t.x+o*t.y,0,0,1)},e.updateBounds=function(e,t,i){const n=Math.min(e[0].x,e[1].x,e[2].x,e[3].x),o=Math.max(e[0].x,e[1].x,e[2].x,e[3].x),s=Math.min(e[0].y,e[1].y,e[2].y,e[3].y),a=Math.max(e[0].y,e[1].y,e[2].y,e[3].y);void 0!==i&&(void 0!==i.array[i.offset]?(i.array[i.offset].min.set(n,s),i.array[i.offset].max.set(o,a)):i.array.push(new r.Box2(new r.Vector2(n,s),new r.Vector2(o,a))),++i.offset),t.min.set(Math.min(t.min.x,n),Math.min(t.min.y,s)),t.max.set(Math.max(t.max.x,o),Math.max(t.max.y,a))}}(t.TypesettingUtils||(t.TypesettingUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDefaultClipPlanesEvaluator=t.FixedClipPlanesEvaluator=t.TiltViewClipPlanesEvaluator=t.TopViewClipPlanesEvaluator=t.ElevationBasedClipPlanesEvaluator=t.InterpolatedClipPlanesEvaluator=void 0;const r=i(3),n=i(1),o=i(0),s=i(10);t.InterpolatedClipPlanesEvaluator=class{constructor(e=.1,t=.1,i=50,r=200){this.nearMin=e,this.nearMultiplier=t,this.nearFarMultiplier=i,this.farOffset=r,this.m_tmpVectors=[new o.Vector3,new o.Vector3,new o.Vector3],this.m_tmpQuaternion=new o.Quaternion,n.assert(e>0),n.assert(i>=0),n.assert(r>=0),this.farMin=e*i+r}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e,t,i){let o=this.nearMin,s=this.farMin;if(t.type===r.ProjectionType.Spherical){const i=r.EarthConstants.EQUATORIAL_RADIUS,n=e.position.length(),a=Math.asin(i/n);e.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],a);const l=this.m_tmpVectors[2].negate(),c=this.m_tmpVectors[1].copy(l).applyQuaternion(this.m_tmpQuaternion),h=this.m_tmpVectors[0].copy(e.position);h.addScaledVector(c,Math.sqrt(n*n-i*i)),s=h.sub(e.position).dot(l)+this.farOffset,o=Math.max(this.nearMin,t.groundDistance(e.position)*this.nearMultiplier)}else if(t.type===r.ProjectionType.Planar){const i=t.groundDistance(e.position);o=Math.max(this.nearMin,i*this.nearMultiplier),s=o*this.nearFarMultiplier+this.farOffset}else n.assert(!1,"Unsupported projection type");return{near:o,far:s,minimum:this.nearMin,maximum:s}}};class a{constructor(e,t){n.assert(e>=t),this.m_minElevation=t,this.m_maxElevation=e}set maxElevation(e){this.m_maxElevation=e,this.m_minElevation=Math.min(e,this.m_minElevation)}get maxElevation(){return this.m_maxElevation}set minElevation(e){this.m_minElevation=e,this.m_maxElevation=Math.max(e,this.m_maxElevation)}get minElevation(){return this.m_minElevation}}t.ElevationBasedClipPlanesEvaluator=a;class l extends a{constructor(e=r.EarthConstants.MAX_BUILDING_HEIGHT,t=0,i=1,s=.05,a=6){super(e,t),this.nearMin=i,this.nearFarMarginRatio=s,this.farMaxRatio=a,this.m_tmpVectors=[new o.Vector3,new o.Vector3,new o.Vector3],this.m_tmpQuaternion=new o.Quaternion,n.assert(i>0),n.assert(s>1e-6),n.assert(a>1);const l=s*i;this.m_minimumViewRange={near:i,far:i+l,minimum:this.nearMin,maximum:Math.max(i*a,i+l)}}evaluateClipPlanes(e,t,i){return t.type===r.ProjectionType.Spherical?this.evaluateDistanceSphericalProj(e,t,i):t.type===r.ProjectionType.Planar?this.evaluateDistancePlanarProj(e,t,i):(n.assert(!1,"Unsupported projection type"),Object.assign({},this.minimumViewRange))}get minimumViewRange(){return this.m_minimumViewRange}getCameraAltitude(e,t){return t.groundDistance(e.position)}evaluateDistancePlanarProj(e,t,i){n.assert(t.type!==r.ProjectionType.Spherical);let o=this.nearMin,s=this.nearMin*this.farMaxRatio;const a=this.getCameraAltitude(e,t),l=a*this.farMaxRatio;o=a-this.maxElevation,s=a-this.minElevation,o=Math.max(o,this.nearMin),s=Math.min(s,l);const c=this.nearFarMarginRatio*(o+s)/2;return o=Math.max(o-c/2,this.nearMin),s=Math.max(s+c/2,o+c),{near:o,far:s,minimum:this.nearMin,maximum:Math.max(l,s)}}evaluateDistanceSphericalProj(e,t,i){n.assert(t.type===r.ProjectionType.Spherical);let s=this.nearMin,a=this.nearMin*this.farMaxRatio;const l=this.getCameraAltitude(e,t);s=l-this.maxElevation;const c=r.EarthConstants.EQUATORIAL_RADIUS;let h=e.position.length();if(h=0===h?1e-6:h,"PerspectiveCamera"===e.type){const i=Math.asin(c/h),r=e,n=r.aspect>1?r.aspect:1/r.aspect,s=o.MathUtils.degToRad(r.fov*n/2),l=this.getTangentBasedFarPlane(r,h,c,i);a=s>i?l:this.getFovBasedFarPlane(r,h,c,2*s,t)}else a=this.getOrthoBasedFarPlane(h,c);const d=l-this.minElevation,u=l*this.farMaxRatio;s=Math.max(s,this.nearMin),a=Math.max(a,d);const m=this.nearFarMarginRatio*(s+a)/2;return s=Math.max(s-m/2,this.nearMin),a=Math.max(a+m/2,s+m),{near:s,far:a,minimum:this.nearMin,maximum:u}}getTangentDistance(e,t){return e-t<1e-6?0:Math.sqrt(e*e-t*t)}getTangentBasedFarPlane(e,t,i,r){const n=this.getTangentDistance(t,i),o=this.getTangentDistance(i+this.maxElevation,i);return Math.cos(r)*(n+o)}getFovBasedFarPlane(e,t,i,r,o){const s=e.position;e.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],r/2);const a=this.m_tmpVectors[2],l=this.m_tmpVectors[1].copy(a).applyQuaternion(this.m_tmpQuaternion),c=s.dot(l);if(c<0){return this.getCameraAltitude(e,o)*this.farMaxRatio}const h=s.dot(s)-c*c,d=i*i;return n.assert(h<=d,"Please use this evaluator only for top view camera poses."),c-Math.sqrt(d-h)}getOrthoBasedFarPlane(e,t){return e+(this.maxElevation<1e-6?0:Math.sqrt(t+this.maxElevation)*(t+this.maxElevation)-t*t)}}t.TopViewClipPlanesEvaluator=l;class c extends l{getFrustumGroundIntersectionDist(e,t){n.assert(t.type!==r.ProjectionType.Spherical);const i=Math.PI/2-1e-6,a=this.getCameraAltitude(e,t),l=s.MapViewUtils.extractCameraTilt(e,t);let c,h,d,u;if("PerspectiveCamera"===e.type){const t=e,r=1,n=o.MathUtils.degToRad(t.fov*r/2);c=o.MathUtils.clamp(l+n,-i,i),h=o.MathUtils.clamp(l-n,-i,i),d=u=a}else{const t=e;c=h=l;const i=Math.sin(l);u=a+i*t.top,d=a-i*t.bottom}const m=(u-this.minElevation)/Math.cos(c),p=(d-this.maxElevation)/Math.cos(h);return{top:Math.max(m,0),bottom:Math.max(p,0)}}evaluateDistancePlanarProj(e,t,i){n.assert(t.type!==r.ProjectionType.Spherical);const a=Object.assign({},this.minimumViewRange),l=this.getFrustumGroundIntersectionDist(e,t);if("PerspectiveCamera"===e.type){const t=e,i=1,r=o.MathUtils.degToRad(t.fov*i/2),n=Math.cos(r);a.near=l.bottom*n,a.far=l.top*n}else a.near=l.bottom,a.far=l.top;const{distance:c}=s.MapViewUtils.getTargetAndDistance(t,e,i),h=c*this.farMaxRatio;a.near=Math.max(a.near,this.nearMin),a.far=Math.min(a.far,h);const d=this.nearFarMarginRatio*(a.near+a.far)/2;return a.near=Math.max(a.near-d/2,this.nearMin),a.far=Math.max(a.far+d/2,a.near+d),a.minimum=this.nearMin,a.maximum=h,a}evaluateDistanceSphericalProj(e,t,i){n.assert(t.type===r.ProjectionType.Spherical);const a=Object.assign({},this.minimumViewRange),l=this.getCameraAltitude(e,t);a.near=l-this.maxElevation;let c=0;if(e instanceof o.PerspectiveCamera){const t=e.aspect>1?e.aspect:1/e.aspect;c=o.MathUtils.degToRad(e.fov*t/2),a.near*=Math.cos(c)}const h=this.m_tmpVectors[0].copy(e.position).negate(),d=r.EarthConstants.EQUATORIAL_RADIUS,u=h.length();let m;if(e instanceof o.PerspectiveCamera){const t=Math.asin(d/u),i=this.getCameraPitch(h,e),r=Math.abs(t-i),n=this.getTangentBasedFarPlane(e,u,d,r);m=c>=r?n:this.getTiltedFovBasedFarPlane(u,d,c,i)}else m=this.getOrthoBasedFarPlane(u,d);a.far=m;const{distance:p}=s.MapViewUtils.getTargetAndDistance(t,e,i),f=l-this.minElevation,g=p*this.farMaxRatio;a.near=Math.max(a.near,this.nearMin),a.far=o.MathUtils.clamp(a.far,f,g);const v=this.nearFarMarginRatio*(a.near+a.far)/2;return a.near=Math.max(a.near-v/2,this.nearMin),a.far=Math.max(a.far+v/2,a.near+v),a.minimum=this.nearMin,a.maximum=g,a}getTiltedFovBasedFarPlane(e,t,i,r){const o=Math.cos(r+i),s=e*e,a=e*o-Math.sqrt(s*o*o-s+t*t);return n.assert(!isNaN(a),"Field of view does not intersect sphere. Use tangent based far plane instead."),Math.cos(i)*a}getCameraPitch(e,t){e.normalize();const i=t.getWorldDirection(this.m_tmpVectors[1]).normalize(),r=e.dot(i);return Math.acos(o.MathUtils.clamp(r,-1,1))}}t.TiltViewClipPlanesEvaluator=c;t.FixedClipPlanesEvaluator=class{constructor(e=1,t=10){this.minNear=e,this.minFarOffset=t,this.minFar=e+t,this.m_nearPlane=e,this.m_farPlane=this.minFar}get nearPlane(){return this.m_nearPlane}set nearPlane(e){this.invalidatePlanes(e,this.m_farPlane)}get farPlane(){return this.m_farPlane}set farPlane(e){this.invalidatePlanes(this.m_nearPlane,e)}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e,t,i){return{near:this.m_nearPlane,far:this.m_farPlane,minimum:this.minNear,maximum:this.m_farPlane}}invalidatePlanes(e,t){const i=Math.max(this.minNear,e),r=Math.max(this.minFar,t,i+this.minFarOffset);this.m_nearPlane=i,this.m_farPlane=r}},t.createDefaultClipPlanesEvaluator=()=>new c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCache=void 0;const r=i(0);let n=(()=>{class e{constructor(){this.m_map=new Map}static get instance(){return this.m_instance}getColor(e){"number"==typeof e&&(e="#"+e.toString(16).padStart(6,"0"));let t=this.m_map.get(e);return void 0!==t||(t=new r.Color(e),this.m_map.set(e,t)),t}get size(){return this.m_map.size}clear(){this.m_map.clear()}}return e.m_instance=new e,e})();t.ColorCache=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentDecoderFacade=void 0;const r=i(91),n=i(93);let o=(()=>{class e{static getTileDecoder(e,t,i){const r=this.getWorkerSet(t,i);return new n.WorkerBasedDecoder(r,e)}static getWorkerSet(e,t){void 0===e&&(e=this.defaultScriptUrl);let i=this.workerSets[e];return void 0===i&&(i=new r.ConcurrentWorkerSet({scriptUrl:e,workerCount:void 0===t?this.defaultWorkerCount:t}),this.workerSets[e]=i),i}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach(e=>{this.workerSets[e].destroy()}),this.workerSets={}}}return e.defaultScriptUrl="./decoder.bundle.js",e.defaultWorkerCount=void 0,e.workerSets={},e})();t.ConcurrentDecoderFacade=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapView=t.MapViewPowerPreference=t.FALLBACK_RENDER_ORDER_OFFSET=t.MapViewEventNames=void 0;const r=i(2),n=i(3),o=i(1),s=i(0),a=i(72),l=i(96),c=i(83),h=i(49),d=i(89),u=i(51),m=i(59),p=i(237),f=i(103),g=i(239),v=i(111),y=i(113),_=i(38),x=i(114),S=i(58),b=i(241),T=i(115),w=i(242),M=i(116),E=i(117),P=i(107),C=i(248),A=i(249),L=i(37),R=i(251),D=i(252),O=i(253),F=i(39),I=i(101),U=i(119),k=i(10),V=i(120);var B;o.LoggerManager.instance.setLogLevelForAll(o.LogLevel.Error),function(e){e.Update="update",e.Resize="resize",e.Render="render",e.AfterRender="didrender",e.FirstFrame="first-render",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.CopyrightChanged="copyright-changed",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored",e.CameraPositionChanged="camera-changed"}(B=t.MapViewEventNames||(t.MapViewEventNames={}));const G=o.LoggerManager.instance.create("MapView"),z={type:"dynamic",fov:40};t.FALLBACK_RENDER_ORDER_OFFSET=2e4;const j={type:B.Update},N={type:B.Render},q={type:B.AfterRender},W={type:B.FirstFrame},H={type:B.FrameComplete},$={type:B.ThemeLoaded},K={type:B.AnimationStarted},X={type:B.AnimationFinished},Y={type:B.MovementStarted},Z={type:B.MovementFinished},Q={type:B.ContextLost},J={type:B.ContextRestored},ee={type:B.CopyrightChanged},te={vector2:[new s.Vector2],vector3:[new s.Vector3,new s.Vector3,new s.Vector3],rayCaster:new s.Raycaster,groundPlane:new s.Plane,groundSphere:new s.Sphere(void 0,n.EarthConstants.EQUATORIAL_RADIUS),frustumPoints:[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3],matrix4:[new s.Matrix4,new s.Matrix4],transform:[{position:new s.Vector3,xAxis:new s.Vector3,yAxis:new s.Vector3,zAxis:new s.Vector3}]};var ie;!function(e){e.Default="default",e.LowPower="low-power",e.HighPerformance="high-performance"}(ie=t.MapViewPowerPreference||(t.MapViewPowerPreference={}));const re={projection:n.mercatorProjection,addBackgroundDatasource:!0,maxVisibleDataSourceTiles:100,extendedFrustumCulling:!0,tileCacheSize:200,resourceComputationType:V.ResourceComputationType.EstimationInMb,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2,pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1,target:new n.GeoCoordinates(25,0),zoomLevel:5,tilt:0,heading:0,theme:{}};class ne extends s.EventDispatcher{constructor(e){super(),this.m_renderLabels=!0,this.m_screenCollisions=new P.ScreenCollisions,this.m_visibleTileSetLock=!1,this.m_tileWrappingEnabled=!0,this.m_zoomLevel=1,this.m_minZoomLevel=1,this.m_maxZoomLevel=20,this.m_minCameraHeight=20,this.m_screenCamera=new s.OrthographicCamera(-1,1,1,-1),this.m_rteCamera=new s.PerspectiveCamera,this.m_yaw=0,this.m_pitch=0,this.m_roll=0,this.m_focalLength=0,this.m_targetDistance=0,this.m_targetGeoPos=n.GeoCoordinates.fromObject(re.target),this.m_targetWorldPos=new s.Vector3,this.m_viewRanges={near:.1,far:4e6,minimum:.1,maximum:4e6},this.m_scene=new s.Scene,this.m_overlayScene=new s.Scene,this.m_fog=new x.MapViewFog(this.m_scene),this.m_sceneRoot=new s.Object3D,this.m_overlaySceneRoot=new s.Object3D,this.m_mapAnchors=new y.MapAnchors,this.m_animationCount=0,this.m_drawing=!1,this.m_updatePending=!1,this.m_frameNumber=0,this.m_forceCameraAspect=void 0,this.m_tileDataSources=[],this.m_connectedDataSources=new Set,this.m_failedDataSources=new Set,this.m_enablePolarDataSource=!0,this.m_plane=new s.Plane(new s.Vector3(0,0,1)),this.m_sphere=new s.Sphere(void 0,n.EarthConstants.EQUATORIAL_RADIUS),this.m_theme={},this.m_themeIsLoading=!1,this.m_firstFrameRendered=!1,this.m_firstFrameComplete=!1,this.m_initialTextPlacementDone=!1,this.m_imageCache=new v.MapViewImageCache(this),this.m_poiManager=new T.PoiManager(this),this.m_poiTableManager=new M.PoiTableManager(this),this.m_lastTileIds="",this.m_copyrightInfo=[],this.m_env=new r.MapEnv({}),this.onWebGLContextLost=e=>{this.dispatchEvent(Q),G.warn("WebGL context lost",e)},this.onWebGLContextRestored=e=>{this.dispatchEvent(J),void 0!==this.m_renderer&&(void 0!==this.m_theme&&void 0!==this.m_theme.clearColor?this.m_renderer.setClearColor(new s.Color(this.m_theme.clearColor)):this.m_renderer.setClearColor(15722977),this.update()),G.warn("WebGL context restored",e)},this.m_options=Object.assign({},e),this.m_uriResolver=this.m_options.uriResolver,void 0!==this.m_options.minZoomLevel&&(this.m_minZoomLevel=this.m_options.minZoomLevel),void 0!==this.m_options.maxZoomLevel&&(this.m_maxZoomLevel=this.m_options.maxZoomLevel),void 0!==this.m_options.minCameraHeight&&(this.m_minCameraHeight=this.m_options.minCameraHeight),void 0!==this.m_options.decoderUrl&&(u.ConcurrentDecoderFacade.defaultScriptUrl=this.m_uriResolver?this.m_uriResolver.resolveUri(this.m_options.decoderUrl):this.m_options.decoderUrl),void 0!==this.m_options.decoderCount&&(u.ConcurrentDecoderFacade.defaultWorkerCount=this.m_options.decoderCount),this.m_visibleTileSetOptions=Object.assign(Object.assign({},re),{clipPlanesEvaluator:void 0!==e.clipPlanesEvaluator?e.clipPlanesEvaluator:h.createDefaultClipPlanesEvaluator()}),void 0!==e.projection&&(this.m_visibleTileSetOptions.projection=e.projection),void 0!==e.extendedFrustumCulling&&(this.m_visibleTileSetOptions.extendedFrustumCulling=e.extendedFrustumCulling),void 0!==e.maxVisibleDataSourceTiles&&(this.m_visibleTileSetOptions.maxVisibleDataSourceTiles=e.maxVisibleDataSourceTiles),void 0!==e.tileCacheSize&&(this.m_visibleTileSetOptions.tileCacheSize=e.tileCacheSize),void 0!==e.resourceComputationType&&(this.m_visibleTileSetOptions.resourceComputationType=e.resourceComputationType),void 0!==e.quadTreeSearchDistanceUp&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceUp=e.quadTreeSearchDistanceUp),void 0!==e.quadTreeSearchDistanceDown&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceDown=e.quadTreeSearchDistanceDown),void 0!==e.enablePolarDataSource&&(this.m_enablePolarDataSource=e.enablePolarDataSource),this.m_pixelRatio=e.pixelRatio,this.maxFps=void 0===e.maxFps?0:e.maxFps,this.m_options.enableStatistics=!0===this.m_options.enableStatistics,this.m_languages=this.m_options.languages,this.m_politicalView=this.m_options.politicalView,void 0!==this.m_options.collisionDebugCanvas&&null!==this.m_options.collisionDebugCanvas&&(this.m_collisionDebugCanvas=this.m_options.collisionDebugCanvas,this.m_screenCollisions=new P.ScreenCollisionsDebug(this.m_collisionDebugCanvas)),this.handleRequestAnimationFrame=this.renderLoop.bind(this),this.m_pickHandler=new S.PickHandler(this,this.m_rteCamera,!0===this.m_options.enablePickTechnique),void 0!==this.m_options.tileWrappingEnabled&&(this.m_tileWrappingEnabled=this.m_options.tileWrappingEnabled),this.setupStats(this.m_options.enableStatistics),this.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.m_renderer=new s.WebGLRenderer({canvas:this.canvas,context:this.m_options.context,antialias:this.nativeWebglAntialiasEnabled,alpha:this.m_options.alpha,preserveDrawingBuffer:!0===this.m_options.preserveDrawingBuffer,powerPreference:void 0===this.m_options.powerPreference?ie.Default:this.m_options.powerPreference}),this.m_renderer.autoClear=!1,this.m_renderer.debug.checkShaderErrors=!1,this.m_renderer.info.autoReset=!1,this.setupRenderer(),this.m_options.fovCalculation=void 0===this.m_options.fovCalculation?z:this.m_options.fovCalculation,this.m_options.fovCalculation.fov=s.MathUtils.clamp(this.m_options.fovCalculation.fov,10,140);const{width:t,height:i}=this.getCanvasClientSize(),o=t/i;this.m_camera=new s.PerspectiveCamera(this.m_options.fovCalculation.fov,o,.1,4e6),this.m_camera.up.set(0,0,1),this.projection.projectPoint(this.m_targetGeoPos,this.m_targetWorldPos),this.m_scene.add(this.m_camera),this.m_screenProjector=new C.ScreenProjector(this.m_camera),this.setupCamera(),this.m_raycaster=new b.PickingRaycaster(t,i),this.m_movementDetector=new c.CameraMovementDetector(this.m_options.movementThrottleTimeout,()=>this.movementStarted(),()=>this.movementFinished());const m=this.m_options.customAntialiasSettings;if(this.mapRenderingManager=new d.MapRenderingManager(t,i,this.m_options.dynamicPixelRatio,m),this.m_tileGeometryManager=new g.TileGeometryManager(this),void 0!==e.enableMixedLod&&(this.m_enableMixedLod=e.enableMixedLod),this.m_visibleTiles=this.createVisibleTileSet(),this.m_animatedExtrusionHandler=new a.AnimatedExtrusionHandler(this),!1!==this.m_options.addBackgroundDatasource&&(this.m_backgroundDataSource=new l.BackgroundDataSource,this.addDataSource(this.m_backgroundDataSource)),this.m_enablePolarDataSource){const t=void 0!==e.polarStyleSetName?e.polarStyleSetName:"polar";this.m_polarDataSource=new E.PolarTileDataSource({styleSetName:t,geometryLevelOffset:e.polarGeometryLevelOffset}),this.updatePolarDataSource()}void 0!==this.m_options.backgroundTilingScheme&&void 0!==this.m_backgroundDataSource&&this.m_backgroundDataSource.setTilingScheme(this.m_options.backgroundTilingScheme),this.initTheme(),this.m_textElementsRenderer=this.createTextRenderer(),this.update()}get lights(){var e;return null!==(e=this.m_createdLights)&&void 0!==e?e:[]}get renderLabels(){return this.m_renderLabels}set renderLabels(e){this.m_renderLabels=e}get delayLabelsUntilMovementFinished(){return this.textElementsRenderer.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.textElementsRenderer.delayLabelsUntilMovementFinished=e}get textElementsRenderer(){return this.m_textElementsRenderer}get cameraMovementDetector(){return this.m_movementDetector}get animatedExtrusionHandler(){return this.m_animatedExtrusionHandler}get tileGeometryManager(){return this.m_tileGeometryManager}get enableMixedLod(){return this.m_enableMixedLod}set enableMixedLod(e){this.m_enableMixedLod!==e&&(this.m_enableMixedLod=e,this.m_visibleTiles=this.createVisibleTileSet(),this.resetTextRenderer(),this.update())}dispose(){this.m_movementFinishedUpdateTimerId&&(clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=void 0),void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);for(const e of this.m_tileDataSources)e.dispose();this.m_visibleTiles.clearTileCache(),this.m_textElementsRenderer.clearRenderStates(),this.m_renderer.dispose(),this.m_imageCache.clear(),this.m_movementDetector.dispose()}get resourceComputationType(){return this.m_visibleTiles.resourceComputationType}set resourceComputationType(e){this.m_visibleTiles.resourceComputationType=e}getCacheSize(){return this.m_visibleTiles.getDataSourceCacheSize()}setCacheSize(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.updateImages(),this.updateLighting(),this.m_textElementsRenderer.invalidateCache(),this.updateSkyBackground(),this.update()}get extendedFrustumCulling(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling}set extendedFrustumCulling(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e}get lockVisibleTileSet(){return this.m_visibleTileSetLock}set lockVisibleTileSet(e){this.m_visibleTileSetLock=e}get pointOfView(){return this.m_pointOfView}set pointOfView(e){this.m_pointOfView=e,this.update()}loadPostEffects(e){fetch(e).then(e=>e.json()).then(e=>{this.m_postEffects=e,this.setPostEffects()})}get postEffects(){return this.m_postEffects}set postEffects(e){this.m_postEffects=e,this.setPostEffects()}get theme(){return this.m_theme}set theme(e){if(!U.ThemeLoader.isThemeLoaded(e))return this.m_themeIsLoading=!0,void U.ThemeLoader.load(e,{uriResolver:this.m_uriResolver}).then(e=>{this.m_themeIsLoading=!1,this.theme=e}).catch(e=>{this.m_themeIsLoading=!1,G.error(`failed to set theme: ${e}`,e)});this.m_theme.fog=e.fog,this.m_theme.sky=e.sky,this.updateSkyBackground(),this.m_fog.reset(this.m_theme),this.m_theme.lights=e.lights,this.updateLighting(),this.m_theme.clearColor=e.clearColor,this.m_theme.clearAlpha=e.clearAlpha,this.renderer.setClearColor(new s.Color(e.clearColor),e.clearAlpha),this.m_theme.images=e.images,this.m_theme.imageTextures=e.imageTextures,this.updateImages(),this.m_theme.poiTables=e.poiTables,this.loadPoiTables(),this.m_theme.textStyles=e.textStyles,this.m_theme.defaultTextStyle=e.defaultTextStyle,this.m_theme.fontCatalogs=e.fontCatalogs,this.resetTextRenderer(),Array.isArray(e.priorities)&&(this.m_theme.priorities=e.priorities),Array.isArray(e.labelPriorities)&&(this.m_theme.labelPriorities=e.labelPriorities),void 0===this.m_theme.styles&&(this.m_theme.styles={}),this.m_backgroundDataSource&&this.m_backgroundDataSource.setTheme(this.m_theme),this.m_theme.styles=e.styles||{},this.m_theme.definitions=e.definitions;for(const e of this.m_tileDataSources)e.setTheme(this.m_theme);$.time=Date.now(),this.dispatchEvent($),this.update()}get uriResolver(){return this.m_uriResolver}get forceCameraAspect(){return this.m_forceCameraAspect}set forceCameraAspect(e){this.m_forceCameraAspect=e}get languages(){return this.m_languages}set languages(e){this.m_languages=e,this.m_tileDataSources.forEach(e=>{e.setLanguages(this.m_languages)}),this.update()}get politicalView(){return this.m_politicalView}set politicalView(e){this.m_politicalView!==e&&(this.m_politicalView=e,this.m_tileDataSources.forEach(t=>{t.setPoliticalView(e)}))}get copyrightInfo(){return this.m_copyrightInfo}set disableFading(e){this.m_textElementsRenderer.disableFading=e}get disableFading(){return this.m_textElementsRenderer.disableFading}get frameNumber(){return this.m_frameNumber}resetFrameNumber(){this.m_frameNumber=0,this.m_previousFrameTimeStamp=void 0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get canvas(){return this.m_options.canvas}get collisionDebugCanvas(){return this.m_collisionDebugCanvas}get scene(){return this.m_scene}get camera(){return this.m_camera}get renderer(){return this.m_renderer}get clearColor(){const e=this.m_renderer.getClearColor();return void 0!==e?e.getHex():0}set clearColor(e){this.m_renderer.setClearColor(e)}get clearAlpha(){const e=this.m_renderer.getClearAlpha();return void 0!==e?e:0}set clearAlpha(e){this.m_renderer.setClearAlpha(e)}get projection(){return this.m_visibleTileSetOptions.projection}set projection(e){const t=this.tilt,i=this.heading;this.m_visibleTileSetOptions.projection=e,this.updatePolarDataSource(),this.clearTileCache(),this.textElementsRenderer.clearRenderStates(),this.m_visibleTiles=this.createVisibleTileSet(),this.lookAtImpl({tilt:t,heading:i})}get clipPlanesEvaluator(){return this.m_visibleTileSetOptions.clipPlanesEvaluator}set clipPlanesEvaluator(e){this.m_visibleTileSetOptions.clipPlanesEvaluator=e}get focalLength(){return this.m_focalLength}get target(){return this.m_targetGeoPos}get worldTarget(){return this.m_targetWorldPos}get targetDistance(){return this.m_targetDistance}get viewRanges(){return this.m_viewRanges}get geoCenter(){return this.projection.unprojectPoint(this.m_camera.position).normalized()}set geoCenter(e){if(void 0!==e.altitude)this.projection.projectPoint(e,this.m_camera.position);else{const t=this.geoCenter.altitude;this.projection.projectPoint(new n.GeoCoordinates(e.latitude,e.longitude,t),this.m_camera.position)}this.update()}get mapAnchors(){return this.m_mapAnchors}get worldCenter(){return this.m_camera.position}get pickHandler(){return this.m_pickHandler}get imageCache(){return this.m_imageCache}get poiManager(){return this.m_poiManager}get poiTableManager(){return this.m_poiTableManager}get minCameraHeight(){return this.m_minCameraHeight}get minZoomLevel(){return this.m_minZoomLevel}set minZoomLevel(e){this.m_minZoomLevel=e,this.update()}get maxZoomLevel(){return this.m_maxZoomLevel}set maxZoomLevel(e){this.m_maxZoomLevel=e,this.update()}get zoomLevel(){return this.m_zoomLevel}set zoomLevel(e){this.lookAtImpl({zoomLevel:e})}get tilt(){return s.MathUtils.radToDeg(this.m_pitch)}set tilt(e){this.lookAtImpl({tilt:e})}get heading(){return-s.MathUtils.radToDeg(this.m_yaw)}set heading(e){this.lookAtImpl({heading:e})}get env(){return this.m_env}get storageLevel(){return s.MathUtils.clamp(Math.floor(this.m_zoomLevel),this.m_minZoomLevel,this.m_maxZoomLevel)}get viewportHeight(){return this.canvas.height}get nativeWebglAntialiasEnabled(){return void 0===this.m_options.enableNativeWebglAntialias?this.pixelRatio<2:this.m_options.enableNativeWebglAntialias}get dataSources(){return this.m_tileDataSources}setFovCalculation(e){this.m_options.fovCalculation=e,this.calculateFocalLength(this.m_renderer.getSize(te.vector2[0]).height),this.updateCameras()}getDataSourceByName(e){return this.m_tileDataSources.find(t=>t.name===e)}getDataSourcesByStyleSetName(e){return this.m_tileDataSources.filter(t=>t.styleSetName===e)}isDataSourceEnabled(e){return e.enabled&&e.ready()&&this.m_connectedDataSources.has(e.name)&&e.isVisible(this.zoomLevel)}addDataSource(e){if(void 0!==this.getDataSourceByName(e.name))throw new Error(`A DataSource with the name "${e.name}" already exists in this MapView.`);return e.attach(this),e.setEnableElevationOverlay(void 0!==this.m_elevationProvider),this.m_tileDataSources.push(e),this.m_backgroundDataSource&&this.m_backgroundDataSource.updateStorageLevelOffset(),e.connect().then(()=>new Promise(e=>{if(void 0!==this.theme&&void 0!==this.theme.styles)return void e();const t=()=>{this.removeEventListener(B.ThemeLoaded,t),e()};this.addEventListener(B.ThemeLoaded,t)})).then(()=>{-1===this.m_tileDataSources.indexOf(e)||(e.addEventListener(B.Update,()=>{this.update()}),e.setTheme(this.m_theme),this.m_connectedDataSources.add(e.name),this.dispatchEvent({type:B.DataSourceConnect,dataSourceName:e.name}),this.update())}).catch(t=>{G.error(`Failed to connect to datasource ${e.name}: ${t.message}`),this.m_failedDataSources.add(e.name),this.dispatchEvent({type:B.DataSourceConnect,dataSourceName:e.name,error:t})})}removeDataSource(e){const t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detach(this),this.m_visibleTiles.removeDataSource(e),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.m_failedDataSources.delete(e.name),this.m_backgroundDataSource&&this.m_backgroundDataSource.updateStorageLevelOffset(),this.update())}get visibleTileSet(){return this.m_visibleTiles}addOverlayText(e){this.m_textElementsRenderer.addOverlayText(e),this.update()}clearOverlayText(){this.m_textElementsRenderer.clearOverlayText()}lookAt(e,t,i,r){if(n.isGeoCoordinatesLike(e)){const n={target:e,zoomLevel:void 0!==t?k.MapViewUtils.calculateZoomLevelFromDistance(this,t):void 0,tilt:i,heading:r};this.lookAtImpl(n)}else"object"==typeof e&&this.lookAtImpl(e)}setCameraGeolocationAndZoom(e,t,i=0,r=0){this.geoCenter=e;let o=Math.min(k.MapViewUtils.MAX_TILT_DEG,r);if(this.projection.type===n.ProjectionType.Spherical){const e=Math.asin(n.EarthConstants.EQUATORIAL_RADIUS/(k.MapViewUtils.calculateDistanceToGroundFromZoomLevel(this,t)+n.EarthConstants.EQUATORIAL_RADIUS)),i=s.MathUtils.radToDeg(e);o=Math.min(o,i)}k.MapViewUtils.zoomOnTargetPosition(this,0,0,t),k.MapViewUtils.setRotation(this,i,o),this.update()}setDynamicProperty(e,t){if(e.startsWith("$"))throw new Error(`failed to update the value of the dynamic property '${e}'`);this.m_env.entries[e]=t,this.update()}removeDynamicProperty(e){if(e.startsWith("$"))throw new Error(`failed to remove the dynamic property '${e}'`);delete this.m_env.entries[e],this.update()}get animating(){return this.m_animationCount>0}beginAnimation(){0==this.m_animationCount++&&(this.update(),K.time=Date.now(),this.dispatchEvent(K))}endAnimation(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(X.time=Date.now(),this.dispatchEvent(X))}get cameraIsMoving(){return this.m_movementDetector.cameraIsMoving}get isDynamicFrame(){return this.cameraIsMoving||this.animating||this.m_updatePending||this.m_animatedExtrusionHandler.isAnimating}get pixelToWorld(){if(void 0===this.m_pixelToWorld){o.assert(void 0!==this.m_options.fovCalculation);const e=this.m_targetDistance;this.m_pixelToWorld=k.MapViewUtils.calculateWorldSizeByFocalLength(this.m_focalLength,e,1)}return this.m_pixelToWorld}get worldToPixel(){return 1/this.pixelToWorld}get pixelRatio(){return void 0!==this.m_pixelRatio?this.m_pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1}set pixelRatio(e){this.m_pixelRatio=e,this.renderer.getPixelRatio()!==this.pixelRatio&&this.renderer.setPixelRatio(this.pixelRatio)}set dynamicPixelRatio(e){this.mapRenderingManager.lowResPixelRatio=e}get dynamicPixelRatio(){return this.mapRenderingManager.lowResPixelRatio}getScreenPosition(e){this.projection.projectPoint(e,te.vector3[0]);const t=this.m_screenProjector.project(te.vector3[0]);if(void 0!==t){const{width:e,height:i}=this.getCanvasClientSize();t.x=t.x+e/2,t.y=i-(t.y+i/2)}return t}raycasterFromScreenPoint(e,t){return this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_rteCamera),this.m_raycaster}getWorldPositionAt(e,t){return this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera),this.projection.type===n.ProjectionType.Spherical?this.m_raycaster.ray.intersectSphere(this.m_sphere,te.vector3[0]):this.m_raycaster.ray.intersectPlane(this.m_plane,te.vector3[0])}getGeoCoordinatesAt(e,t){const i=this.getWorldPositionAt(e,t);return i?this.projection.unprojectPoint(i):null}getNormalizedScreenCoordinates(e,t){const{width:i,height:r}=this.getCanvasClientSize();return new s.Vector3(e/i*2-1,-t/r*2+1,0)}intersectMapObjects(e,t){return this.m_pickHandler.intersectMapObjects(e,t)}resize(e,t){this.m_renderer.setSize(e,t,!1),this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update(),this.dispatchEvent({type:B.Resize,size:{width:e,height:t}})}renderSync(e){void 0===e&&(e=o.PerformanceTimer.now()),this.render(e)}update(){this.dispatchEvent(j),this.m_updatePending||(this.m_updatePending=!0,this.startRenderLoop())}get updatePending(){return this.m_updatePending}requestUpdateIfNeeded(){this.update()}clearTileCache(e){if(void 0!==this.m_visibleTiles){if(void 0!==e){const t=this.getDataSourceByName(e);t&&(this.m_visibleTiles.clearTileCache(t),t.clearCache())}else this.m_visibleTiles.clearTileCache(),this.m_tileDataSources.forEach(e=>e.clearCache());void 0!==this.m_elevationProvider&&this.m_elevationProvider.clearCache()}}forEachVisibleTile(e){this.m_visibleTiles.forEachVisibleTile(e)}forEachCachedTile(e){this.m_visibleTiles.forEachCachedTile(e)}markTilesDirty(e){this.m_visibleTiles.markTilesDirty(e)}async setElevationSource(e,t,i){this.m_elevationSource&&this.m_elevationSource!==e&&this.removeDataSource(this.m_elevationSource),-1!==this.m_tileDataSources.indexOf(e)||await this.addDataSource(e),this.m_elevationSource=e,this.m_elevationRangeSource=t,this.m_elevationRangeSource.ready()||await this.m_elevationRangeSource.connect(),this.m_elevationProvider=i,this.dataSources.forEach(e=>{e.setEnableElevationOverlay(!0)}),this.m_tileGeometryManager.setTileUpdateCallback(e=>{f.overlayOnElevation(e)}),this.clearTileCache()}clearElevationSource(e){this.removeDataSource(e),this.m_elevationSource=void 0,this.m_elevationRangeSource=void 0,this.m_elevationProvider=void 0,this.dataSources.forEach(e=>{e.setEnableElevationOverlay(!1)}),this.m_tileGeometryManager.setTileUpdateCallback(void 0),this.clearTileCache()}get fog(){return this.m_fog}setPostEffects(){this.mapRenderingManager.bloom.enabled=!1,this.mapRenderingManager.outline.enabled=!1,this.mapRenderingManager.vignette.enabled=!1,this.mapRenderingManager.sepia.enabled=!1,void 0!==this.m_postEffects&&(void 0!==this.m_postEffects.bloom&&(this.mapRenderingManager.bloom=this.m_postEffects.bloom),void 0!==this.m_postEffects.outline&&(this.mapRenderingManager.outline.enabled=this.m_postEffects.outline.enabled,this.mapRenderingManager.updateOutline(this.m_postEffects.outline)),void 0!==this.m_postEffects.vignette&&(this.mapRenderingManager.vignette=this.m_postEffects.vignette),void 0!==this.m_postEffects.sepia&&(this.mapRenderingManager.sepia=this.m_postEffects.sepia))}get elevationProvider(){return this.m_elevationProvider}get shadowsEnabled(){return!0===this.m_options.enableShadows}set shadowsEnabled(e){void 0!==this.m_renderer.shadowMap&&e!==this.m_renderer.shadowMap.enabled&&(this.m_options.enableShadows=e,this.m_renderer.shadowMap.enabled=e,this.m_renderer.shadowMap.type=s.PCFSoftShadowMap,this.clearTileCache())}extractAttitude(){const e=this.m_camera,t=this.projection,i=te.vector3[1],r=te.transform[0],n=te.matrix4[1];i.setFromMatrixPosition(e.matrixWorld),t.localTangentSpace(this.m_targetGeoPos,r),n.makeBasis(r.xAxis,r.yAxis,r.zAxis),te.matrix4[0].getInverse(n).multiply(e.matrixWorld),r.xAxis.setFromMatrixColumn(te.matrix4[0],0),r.yAxis.setFromMatrixColumn(te.matrix4[0],1),r.zAxis.setFromMatrixColumn(te.matrix4[0],2);let o=0,s=0,a=0;const l=r.zAxis.dot(i.set(0,0,1));return l<1-1e-10?l>1e-10-1?(o=Math.atan2(r.zAxis.x,-r.zAxis.y),s=Math.acos(r.zAxis.z),a=Math.atan2(r.xAxis.x,r.yAxis.z)):(o=-Math.atan2(-r.yAxis.x,r.xAxis.x),s=180,a=0):(o=Math.atan2(-r.yAxis.x,r.xAxis.x),s=0,a=0),{yaw:o,pitch:s,roll:a}}lookAtImpl(e){const t=Math.min(o.getOptionValue(e.tilt,this.tilt),k.MapViewUtils.MAX_TILT_DEG),i=o.getOptionValue(e.heading,this.heading);let r;if(void 0!==e.bounds){let o;if(e.bounds instanceof n.GeoBox)r=e.target?n.GeoCoordinates.fromObject(e.target):e.bounds.center,o=k.MapViewUtils.geoBoxToGeoPoints(e.bounds);else if(n.isGeoBoxExtentLike(e.bounds)){r=e.target?n.GeoCoordinates.fromObject(e.target):this.target;const t=n.GeoBox.fromCenterAndExtents(r,e.bounds);o=k.MapViewUtils.geoBoxToGeoPoints(t)}else{if(!Array.isArray(e.bounds))throw Error("#lookAt: Invalid 'bounds' value");o=e.bounds,void 0!==e.target&&(r=n.GeoCoordinates.fromObject(e.target))}this.m_tileWrappingEnabled&&this.projection.type===n.ProjectionType.Planar&&(o=k.MapViewUtils.wrapGeoPointsToScreen(o,r));const a=o.map(e=>this.projection.projectPoint(n.GeoCoordinates.fromObject(e),new s.Vector3)),l=new s.Vector3;if(void 0===r){(new s.Box3).setFromPoints(a).getCenter(l),this.projection.scalePointToSurface(l),r=this.projection.unprojectPoint(l)}else this.projection.projectPoint(r,l);return this.lookAtImpl(k.MapViewUtils.getFitBoundsLookAtParams(r,l,a,{tilt:t,heading:i,minDistance:k.MapViewUtils.calculateDistanceFromZoomLevel(this,this.maxZoomLevel),projection:this.projection,camera:this.camera}))}r=void 0!==e.target?n.GeoCoordinates.fromObject(e.target):this.target;const a=void 0!==e.zoomLevel?k.MapViewUtils.calculateDistanceFromZoomLevel(this,s.MathUtils.clamp(e.zoomLevel,this.m_minZoomLevel,this.m_maxZoomLevel)):void 0!==e.distance?e.distance:this.m_targetDistance;k.MapViewUtils.getCameraRotationAtTarget(this.projection,r,-i,t,this.camera.quaternion),k.MapViewUtils.getCameraPositionFromTargetCoordinates(r,a,-i,t,this.projection,this.camera.position),this.camera.updateMatrixWorld(!0),this.updateLookAtSettings(),this.update()}updatePolarDataSource(){const e=this.m_polarDataSource;if(!0===this.m_enablePolarDataSource&&void 0!==e){const t=this.getDataSourceByName(e.name);this.projection.type===n.ProjectionType.Spherical?void 0===t&&this.addDataSource(e):void 0!==t&&this.removeDataSource(e)}}updateCameras(e){this.m_camera.updateMatrixWorld(!1),this.updateLookAtSettings();const{width:t,height:i}=this.m_renderer.getSize(te.vector2[0]);this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:t/i,this.setFovOnCamera(this.m_options.fovCalculation,i);const r=this.projection.getScaleFactor(this.camera.position)*this.m_tileDataSources.reduce((e,t)=>Math.max(e,t.maxGeometryHeight),0);Object.assign(this.m_viewRanges,void 0===e?this.m_visibleTiles.updateClipPlanes(r):e),this.m_camera.near=this.m_viewRanges.near,this.m_camera.far=this.m_viewRanges.far,this.m_camera.updateProjectionMatrix(),this.m_rteCamera.copy(this.m_camera),this.m_rteCamera.position.setScalar(0),this.m_rteCamera.updateMatrixWorld(!0),this.m_screenCamera.left=t/-2,this.m_screenCamera.right=t/2,this.m_screenCamera.bottom=i/-2,this.m_screenCamera.top=i/2,this.m_screenCamera.updateProjectionMatrix(),this.m_screenCamera.updateMatrixWorld(!1),this.m_screenProjector.update(this.camera,t,i),this.m_screenCollisions.update(t,i),this.m_pixelToWorld=void 0,this.m_fog.update(this,this.m_viewRanges.maximum)}updateLookAtSettings(){const{target:e,distance:t}=k.MapViewUtils.getTargetAndDistance(this.projection,this.camera,this.elevationProvider);this.m_targetWorldPos.copy(e),this.m_targetGeoPos=this.projection.unprojectPoint(this.m_targetWorldPos),this.m_targetDistance=t,this.m_zoomLevel=k.MapViewUtils.calculateZoomLevelFromDistance(this,this.m_targetDistance);const{yaw:i,pitch:r,roll:n}=this.extractAttitude();this.m_yaw=i,this.m_pitch=r,this.m_roll=n}updateEnv(){this.m_env.entries.$zoom=this.m_zoomLevel,this.m_env.entries.$pixelToMeters=this.pixelToWorld,this.m_env.entries.$frameNumber=this.m_frameNumber}ndcToView(e,t){return t.set(e.x,e.y,e.z).applyMatrix4(this.camera.projectionMatrixInverse).applyMatrix4(this.m_rteCamera.matrixWorld),t}viewToLightSpace(e,t){return e.applyMatrix4(t.matrixWorldInverse)}updateLights(){if(!this.shadowsEnabled||this.projection.type===n.ProjectionType.Spherical||void 0===this.m_createdLights||0===this.m_createdLights.length)return;const e=[{x:-1,y:-1,z:-1},{x:1,y:-1,z:-1},{x:-1,y:1,z:-1},{x:1,y:1,z:-1},{x:-1,y:-1,z:1},{x:1,y:-1,z:1},{x:-1,y:1,z:1},{x:1,y:1,z:1}].map((e,t)=>this.ndcToView(e,te.frustumPoints[t]));this.m_createdLights.forEach(t=>{const i=t;if(!0===i.isDirectionalLight){const t=te.vector3[0];t.copy(i.target.position),t.sub(i.position),t.normalize();const r=te.vector3[1];this.projection.type===n.ProjectionType.Planar&&r.set(0,0,-1);const o=this.m_pitch,a=this.targetDistance*Math.cos(o)/r.dot(t);i.target.position.copy(this.worldTarget).sub(this.camera.position),i.position.copy(this.worldTarget),i.position.addScaledVector(t,-a),i.position.sub(this.camera.position),i.updateMatrixWorld(),i.shadow.updateMatrices(i);const l=i.shadow.camera,c=e.map(e=>this.viewToLightSpace(e.clone(),l)),h=new s.Box3;c.forEach(e=>{h.expandByPoint(e)}),l.left=h.min.x,l.right=h.max.x,l.top=h.max.y,l.bottom=h.min.y,l.near=.95*-h.max.z,l.far=-h.min.z,l.updateProjectionMatrix()}})}renderLoop(e){if(!this.m_options.synchronousRendering){if(0===this.maxFps)this.render(e);else{const t=3,i=1e3/this.maxFps;e>=(void 0===this.m_previousFrameTimeStamp?0:this.m_previousFrameTimeStamp)+i-t&&this.render(e)}this.m_updatePending||this.animating?this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame):this.m_animationFrameHandle=void 0}}startRenderLoop(){void 0!==this.m_animationFrameHandle||this.m_options.synchronousRendering||(this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame))}getEnabledTileDataSources(){const e=[];for(const t of this.m_tileDataSources)this.isDataSourceEnabled(t)&&e.push(t);return e}render(e){if(this.m_drawing)return;let t;N.time=e,this.dispatchEvent(N),++this.m_frameNumber;const i=L.PerformanceStatistics.instance,r=i.enabled;if(r){if(t=i.currentFrame,void 0!==this.m_previousFrameTimeStamp){const i=e-this.m_previousFrameTimeStamp;t.setValue("render.fps",1e3/i)}i.storeAndClearFrameInfo(),t=t,t.setValue("renderCount.frameNumber",this.m_frameNumber)}let s,a,l,c,h,d;if(this.m_previousFrameTimeStamp=e,this.m_renderer.info.reset(),this.m_updatePending=!1,this.m_thisFrameTilesChanged=void 0,this.m_drawing=!0,this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),this.updateCameras(),this.updateEnv(),this.updateLights(),this.m_renderer.clear(),this.m_sceneRoot.children.length=0,this.m_overlaySceneRoot.children.length=0,r&&(s=o.PerformanceTimer.now()),!this.lockVisibleTileSet){const e=this.m_visibleTiles.updateRenderList(this.storageLevel,Math.floor(this.zoomLevel),this.getEnabledTileDataSources(),this.m_elevationRangeSource);e.viewRangesChanged&&this.updateCameras(e.viewRanges)}r&&(a=o.PerformanceTimer.now());const u=this.m_visibleTiles.dataSourceTileList;if(u.forEach(({zoomLevel:e,renderedTiles:t})=>{t.forEach(t=>{this.renderTileObjects(t,e),t.frameNumLastVisible=this.m_frameNumber})}),this.m_initialTextPlacementDone||this.m_firstFrameComplete||this.isDynamicFrame||this.m_themeIsLoading||!this.m_poiTableManager.finishedLoading||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_connectedDataSources.size+this.m_failedDataSources.size!==this.m_tileDataSources.length||this.m_textElementsRenderer.initializing||this.m_textElementsRenderer.loading||(this.m_initialTextPlacementDone=!0),this.m_mapAnchors.update(this.projection,this.camera.position,this.m_sceneRoot,this.m_overlaySceneRoot,this.m_theme.priorities),this.m_animatedExtrusionHandler.update(this.zoomLevel),void 0!==t&&(t.addValue("renderCount.numTilesRendered",0),t.addValue("renderCount.numTilesVisible",0),t.addValue("renderCount.numTilesLoading",0),u.forEach(({zoomLevel:e,renderedTiles:i,visibleTiles:r,numTilesLoading:n})=>{t.addValue("renderCount.numTilesRendered",i.size),t.addValue("renderCount.numTilesVisible",r.length),t.addValue("renderCount.numTilesLoading",n)})),this.m_movementDetector.checkCameraMoved(this,e)){const{latitude:e,longitude:t,altitude:i}=this.geoCenter;this.dispatchEvent({type:B.CameraPositionChanged,latitude:e,longitude:t,altitude:i,yaw:this.m_yaw,pitch:this.m_pitch,roll:this.m_roll,tilt:this.tilt,heading:this.heading,zoom:this.zoomLevel})}const m=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_rteCamera;if(this.renderLabels&&this.prepareRenderTextElements(e),r&&(l=o.PerformanceTimer.now()),void 0!==this.m_skyBackground&&this.projection.type===n.ProjectionType.Planar&&this.m_skyBackground.updateCamera(this.m_camera),this.mapRenderingManager.render(this.m_renderer,this.m_scene,m,!this.isDynamicFrame),r&&(c=o.PerformanceTimer.now()),this.renderLabels&&this.finishRenderTextElements(),this.m_overlaySceneRoot.children.length>0&&this.m_renderer.render(this.m_overlayScene,m),r&&(h=o.PerformanceTimer.now()),this.m_firstFrameRendered||(this.m_firstFrameRendered=!0,r&&i.appResults.set("firstFrame",e),W.time=e,this.dispatchEvent(W)),this.m_visibleTiles.disposePendingTiles(),this.m_drawing=!1,this.checkCopyrightUpdates(),void 0!==t){d=o.PerformanceTimer.now();const r=d-e;t.setValue("render.setupTime",s-e),t.setValue("render.cullTime",a-s),t.setValue("render.textPlacementTime",l-a),t.setValue("render.drawTime",c-l),t.setValue("render.textDrawTime",h-c),t.setValue("render.cleanupTime",d-h),t.setValue("render.frameRenderTime",r),t.setValue("render.fullFrameTime",r),t.setValue("render.geometryCreationTime",0),i.addWebGLInfo(this.m_renderer.info),i.addMemoryInfo()}q.time=e,this.dispatchEvent(q),this.m_firstFrameComplete||!this.m_initialTextPlacementDone||this.isDynamicFrame||this.textElementsRenderer.loading||(this.m_firstFrameComplete=!0,r&&i.appResults.set("firstFrameComplete",e),H.time=e,this.dispatchEvent(H))}renderTileObjects(e,i){var n;const o=e.computeWorldOffsetX();if(e.willRender(i)){for(const i of e.objects){const s=_.MapObjectAdapter.get(i);if(!this.processTileObject(e,i,s))continue;i.position.copy(e.center),void 0!==i.displacement&&i.position.add(i.displacement),i.position.x+=o,i.position.sub(this.m_camera.position),e.localTangentSpace&&i.setRotationFromMatrix(e.boundingBox.getRotationMatrix()),i.frustumCulled=!1,void 0===i._backupRenderOrder&&(i._backupRenderOrder=i.renderOrder);const a=null===(n=null==s?void 0:s.kind)||void 0===n?void 0:n.includes(r.GeometryKind.Building);i.renderOrder=i._backupRenderOrder+(!a&&e.levelOffset<0?t.FALLBACK_RENDER_ORDER_OFFSET*e.levelOffset:0),this.m_sceneRoot.add(i)}e.didRender()}}processTileObject(e,t,i){return!!t.visible&&(!!this.processTileObjectFeatures(e,t)&&!(i&&(i.ensureUpdated(this),!i.isVisible())))}processTileObjectFeatures(e,t){const i=t.userData.technique;if(!i||void 0===i.enabled)return!0;const n=t.userData.feature;if(!n||!r.Expr.isExpr(i.enabled))return Boolean(r.getPropertyValue(i.enabled,this.m_env));const{starts:o,objInfos:s}=n;if(!Array.isArray(s)||!Array.isArray(o))return!0;const a=t.geometry;if(!a||!a.isBufferGeometry)return!0;const l=a.getIndex();let c;return a.clearGroups(),s.forEach((t,n)=>{var s;const h=r.getFeatureId(t);let d=!0;if(r.Expr.isExpr(i.enabled)){const n=e.dataSource.getFeatureState(h),o=n?new r.MapEnv(n):null,s="object"==typeof t?new r.MapEnv(t,this.m_env):this.m_env,a=new r.MapEnv({$state:o},s);d=Boolean(r.getPropertyValue(i.enabled,a))}if(!d)return;const u=o[n],m=(null!==(s=o[n+1])&&void 0!==s?s:l.count)-u;u===c?a.groups[a.groups.length-1].count+=m:a.addGroup(u,m),c=u+m}),a.groups.length>0}prepareRenderTextElements(e){void 0!==this.m_pointOfView||this.m_textElementsRenderer.placeText(this.m_visibleTiles.dataSourceTileList,e)}finishRenderTextElements(){void 0===this.m_pointOfView&&(this.m_screenCamera.far=this.m_viewRanges.maximum,this.m_textElementsRenderer.renderText(this.m_screenCamera))}initTheme(){const e=o.getOptionValue(this.m_options.theme,re.theme);this.m_themeIsLoading=!0,Promise.resolve(e).then(e=>U.ThemeLoader.load(e,{uriResolver:this.m_uriResolver})).then(e=>{this.m_themeIsLoading=!1,this.theme=e}).catch(e=>{this.m_themeIsLoading=!1;const t="string"==typeof this.m_options.theme?` from ${this.m_options.theme}`:"";G.error(`Failed to load theme${t}: ${e}`,e)})}setupCamera(){const{width:e,height:t}=this.getCanvasClientSize();this.calculateFocalLength(t),this.m_visibleTiles=this.createVisibleTileSet(),this.m_options.target=n.GeoCoordinates.fromObject(o.getOptionValue(this.m_options.target,re.target)),this.m_options.target.altitude=0,this.m_options.tilt=o.getOptionValue(this.m_options.tilt,re.tilt),this.m_options.heading=o.getOptionValue(this.m_options.heading,re.heading),this.m_options.zoomLevel=o.getOptionValue(this.m_options.zoomLevel,re.zoomLevel),this.lookAtImpl(this.m_options),this.resize(e,t),this.m_screenCamera.position.z=1,this.m_screenCamera.near=0}createVisibleTileSet(){const e=void 0===this.m_enableMixedLod?this.projection.type===n.ProjectionType.Spherical:this.m_enableMixedLod;return new V.VisibleTileSet(new p.FrustumIntersection(this.m_camera,this,this.m_visibleTileSetOptions.extendedFrustumCulling,this.m_tileWrappingEnabled,e),this.m_tileGeometryManager,this.m_visibleTileSetOptions)}updateSkyBackground(){if(void 0===this.m_theme)return;const e=this.m_theme;if(this.m_skyBackground instanceof A.SkyBackground&&void 0!==e.sky)this.updateSkyBackgroundColors(e.sky,e.clearColor);else{if(void 0===this.m_skyBackground&&void 0!==e.sky)return void this.addNewSkyBackground(e.sky,e.clearColor);this.m_skyBackground instanceof A.SkyBackground&&void 0===e.sky&&this.removeSkyBackGround()}}addNewSkyBackground(e,t){"gradient"===e.type&&void 0===e.groundColor&&(e.groundColor=o.getOptionValue(t,"#000000")),this.m_skyBackground=new A.SkyBackground(e,this.projection.type,this.m_camera),this.m_scene.background=this.m_skyBackground.texture}removeSkyBackGround(){this.m_scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.dispose(),this.m_skyBackground=void 0)}updateSkyBackgroundColors(e,t){"gradient"===e.type&&void 0===e.groundColor&&(e.groundColor=o.getOptionValue(t,"#000000")),void 0!==this.m_skyBackground&&this.m_skyBackground.updateTexture(e,this.projection.type)}updateLighting(){var e;if(!this.m_theme)return;const t=this.m_theme;void 0!==t.clearColor&&this.m_renderer.setClearColor(new s.Color(t.clearColor)),this.m_createdLights&&this.m_createdLights.forEach(e=>{this.m_scene.remove(e)}),null===(e=this.m_overlayCreatedLights)||void 0===e||e.forEach(e=>{this.m_overlayScene.remove(e),e instanceof s.DirectionalLight&&this.m_overlayScene.remove(e.target)}),void 0!==t.lights&&(this.m_createdLights=[],this.m_overlayCreatedLights=[],t.lights.forEach(e=>{const t=I.createLight(e);if(!t)return void G.warn(`MapView: failed to create light ${e.name} of type ${e.type}`);if(this.m_scene.add(t),t.isDirectionalLight){const e=t;this.m_scene.add(e.target)}this.m_createdLights.push(t);const i=t.clone();this.m_overlayScene.add(i),i instanceof s.DirectionalLight&&this.m_overlayScene.add(i.target.clone())}))}movementStarted(){this.m_textElementsRenderer.movementStarted(),Y.time=Date.now(),this.dispatchEvent(Y)}movementFinished(){this.m_textElementsRenderer.movementFinished(),Z.time=Date.now(),this.dispatchEvent(Z),this.animating||(void 0!==this.m_movementFinishedUpdateTimerId&&clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=setTimeout(()=>{this.m_movementFinishedUpdateTimerId=void 0,this.update()},0))}checkIfTilesChanged(){if(void 0!==this.m_thisFrameTilesChanged)return this.m_thisFrameTilesChanged;const e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach(({dataSource:e,renderedTiles:i})=>{i.forEach(i=>{t.push(e.name+"-"+i.tileKey.mortonCode())})}),t.sort();const i=t.join("#");return i!==this.m_lastTileIds?(this.m_lastTileIds=i,this.m_thisFrameTilesChanged=!0):this.m_thisFrameTilesChanged=!1,this.m_thisFrameTilesChanged}checkCopyrightUpdates(){if(!this.checkIfTilesChanged())return;const e=this.getRenderedTilesCopyrightInfo();if(e!==this.m_copyrightInfo){if(e.length===this.m_copyrightInfo.length){let t=!0;for(let i=0;i<e.length;i++){const r=e[i],n=this.m_copyrightInfo[i];if(r.label!==n.label){t=!1;break}}if(t)return}this.m_copyrightInfo=e,this.dispatchEvent(ee)}}getRenderedTilesCopyrightInfo(){let e=[];for(const t of this.m_visibleTiles.dataSourceTileList)for(const i of t.renderedTiles.values()){const t=i.copyrightInfo;void 0!==t&&0!==t.length&&(e=m.CopyrightInfo.mergeArrays(e,t))}return e}updateImages(){if(!this.m_theme)return;const e=this.m_theme;if(this.m_imageCache.clear(),this.poiManager.clear(),void 0!==e.images)for(const t of Object.keys(e.images)){const i=e.images[t];this.m_imageCache.addImage(t,i.url,!0===i.preload),"string"==typeof i.atlas&&this.poiManager.addTextureAtlas(t,i.atlas)}void 0!==e.imageTextures&&e.imageTextures.forEach(e=>{this.poiManager.addImageTexture(e)})}loadPoiTables(){void 0!==this.m_theme&&(this.poiTableManager.clear(),this.poiTableManager.loadPoiTables(this.m_theme).then(()=>this.update()).catch(()=>this.update()))}setupStats(e){new L.PerformanceStatistics(e,1e3)}setupRenderer(){var e;this.m_renderer.setClearColor(15722977),this.m_scene.add(this.m_sceneRoot),this.m_overlayScene.add(this.m_overlaySceneRoot),this.shadowsEnabled=null!==(e=this.m_options.enableShadows)&&void 0!==e&&e}createTextRenderer(){return new F.TextElementsRenderer(new D.MapViewState(this,this.checkIfTilesChanged.bind(this)),this.m_camera,()=>{this.update()},this.m_screenCollisions,this.m_screenProjector,new O.TextCanvasFactory(this.m_renderer),this.m_poiManager,new w.PoiRendererFactory(this),new R.FontCatalogLoader(this.m_theme),this.m_theme,this.m_options)}resetTextRenderer(){const e=this.m_textElementsRenderer.overlayText;this.m_textElementsRenderer=this.createTextRenderer(),void 0!==e&&this.m_textElementsRenderer.addOverlayText(e)}limitFov(e,t){e=s.MathUtils.clamp(e,10,140);let i=s.MathUtils.radToDeg(k.MapViewUtils.calculateHorizontalFovByVerticalFov(s.MathUtils.degToRad(e),t));return(i>140||i<10)&&(i=s.MathUtils.clamp(i,10,140),e=s.MathUtils.radToDeg(k.MapViewUtils.calculateVerticalFovByHorizontalFov(s.MathUtils.degToRad(i),t))),e}setFovOnCamera(e,t){let i=0;"fixed"===e.type?(this.calculateFocalLength(t),i=e.fov):(o.assert(0!==this.m_focalLength),i=k.MapViewUtils.calculateFovByFocalLength(this.m_focalLength,t)),this.m_camera.fov=this.limitFov(i,this.m_camera.aspect)}calculateFocalLength(e){o.assert(void 0!==this.m_options.fovCalculation),this.m_focalLength=k.MapViewUtils.calculateFocalLengthByVerticalFov(s.MathUtils.degToRad(this.m_options.fovCalculation.fov),e)}getCanvasClientSize(){const{clientWidth:e,clientHeight:t}=this.canvas;if(0===e||0===t||"number"!=typeof e||"number"!=typeof t){const e=this.m_renderer.getPixelRatio();return{width:Math.round(this.canvas.width/e),height:Math.round(this.canvas.height/e)}}return{width:e,height:t}}}t.MapView=ne},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSource=void 0;const r=i(97),n=i(1),o=i(0),s=n.LoggerManager.instance.create("DataSource"),a={type:"update"};let l=(()=>{class e extends o.EventDispatcher{constructor(t={}){super(),this.enabled=!0,this.cacheable=!1,this.useGeometryLoader=!1,this.addGroundPlane=!1,this.minDataLevel=1,this.maxDataLevel=20,this.minDisplayLevel=1,this.maxDisplayLevel=20,this.allowOverlappingTiles=!0,this.exprPool=new r.ExprPool,this.m_maxGeometryHeight=0,this.m_storageLevelOffset=0,this.m_featureStateMap=new Map;let{name:i}=t;const{styleSetName:n,minZoomLevel:o,maxZoomLevel:s,minDataLevel:a,maxDataLevel:l,minDisplayLevel:c,maxDisplayLevel:h,storageLevelOffset:d,allowOverlappingTiles:u}=t;void 0!==i&&0!==i.length||(i=`anonymous-datasource#${++e.uniqueNameCounter}`),this.name=i,this.styleSetName=n,void 0!==a&&(this.minDataLevel=a),void 0!==l&&(this.maxDataLevel=l),void 0!==o&&(this.minZoomLevel=o),void 0!==s&&(this.maxZoomLevel=s),void 0!==c&&(this.minDisplayLevel=c),void 0!==h&&(this.maxDisplayLevel=h),void 0!==d&&(this.m_storageLevelOffset=d),void 0!==u&&(this.allowOverlappingTiles=u)}getFeatureState(e){return this.m_featureStateMap.get(e)}clearFeatureState(){this.m_featureStateMap.clear()}setFeatureState(e,t){this.m_featureStateMap.set(e,t)}removeFeatureState(e){this.m_featureStateMap.delete(e)}get styleSetName(){return this.m_styleSetName}set styleSetName(e){this.m_styleSetName=e,void 0!==this.m_mapView&&void 0!==e&&this.setTheme(this.m_mapView.theme)}dispose(){}clearCache(){}isFullyCovering(){return this.addGroundPlane}ready(){return!0}get mapView(){if(void 0===this.m_mapView)throw new Error("This DataSource was not added to MapView");return this.m_mapView}get projection(){return this.mapView.projection}async connect(){}attach(e){this.m_mapView=e}detach(e){n.assert(this.m_mapView===e),this.m_mapView=void 0}setStyleSet(e,t,i){}setTheme(e,t){}setLanguages(e){}setPoliticalView(e){}updateTile(e){}shouldPreloadTiles(){return!1}get minZoomLevel(){return s.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and maxDataLevel instead."),this.minDataLevel}set minZoomLevel(e){s.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and minDisplayLevel instead."),this.minDataLevel=e}get maxZoomLevel(){return s.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel}set maxZoomLevel(e){s.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel=e}get maxGeometryHeight(){return this.m_maxGeometryHeight}set maxGeometryHeight(e){this.m_maxGeometryHeight=e}get storageLevelOffset(){return this.m_storageLevelOffset}set storageLevelOffset(e){this.m_storageLevelOffset=e}setEnableElevationOverlay(e){}getDataZoomLevel(e){return o.MathUtils.clamp(e+this.m_storageLevelOffset,this.minDataLevel,this.maxDataLevel)}isVisible(e){return e>=this.minDisplayLevel&&e<=this.maxDisplayLevel}canGetTile(e,t){return t.level<=e}shouldSubdivide(e,t){return t.level<=e}shouldRenderText(e,t){return!0}requestUpdate(){this.dispatchEvent(a)}}return e.uniqueNameCounter=0,e})();t.DataSource=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryCreator=void 0;const r=i(2),n=i(220),o=i(221),s=i(3),a=i(4),l=i(6),c=i(1),h=i(0),d=i(19),u=i(102),m=i(55),p=i(38),f=i(52),g=i(225),v=i(17),y=i(39),_=i(84),x=c.LoggerManager.instance.create("TileGeometryCreator"),S=new h.Vector3,b=new h.Vector2;class T{constructor(){this.bufferAttributes=new Map,this.interleavedAttributes=new Map}}class w extends r.CallExpr{constructor(e){super("memo",[e]),this.m_cachedProperties=[],this.m_deps=Array.from(e.dependencies().properties),this.descriptor=this}call(e){let t=!1;return this.m_deps.forEach((i,r)=>{const n=e.env.lookup(i);t||n===this.m_cachedProperties[r]||(t=!0),t&&(this.m_cachedProperties[r]=n)}),(t||void 0===this.m_cachedValue)&&(this.m_cachedValue=e.evaluate(this.args[0])),this.m_cachedValue}}class M{constructor(e,t,i){this.geometry=e,this.info=t,this.cache=i}getBufferAttribute(e){if(this.cache.bufferAttributes.has(e))return this.cache.bufferAttributes.get(e);const t=d.getBufferAttribute(e);return this.cache.bufferAttributes.set(e,t),t}getInterleavedBufferAttributes(e){const t=this.cache.interleavedAttributes.get(e);if(t)return t;const i=new(r.getArrayConstructor(e.type))(e.buffer),n=new h.InterleavedBuffer(i,e.stride),o=e.attributes.map(e=>{const t=new h.InterleavedBufferAttribute(n,e.itemSize,e.offset,!1);return{name:e.name,attribute:t}});return this.cache.interleavedAttributes.set(e,o),o}}function E(e,t){if(Array.isArray(e)){const i=e;t.push(...i)}else t.push(e)}class P{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new P)}initDecodedTile(e,t,i){for(const r of e.techniques){const e=r.kind;void 0===e||e instanceof Set&&0===e.size?r._kindState=!0:r._kindState=!(void 0!==i&&i.hasOrIntersects(e))||void 0!==t&&t.hasOrIntersects(e)}for(const t of e.geometries)for(const e of t.groups)e.createdOffsets=[]}createAllGeometries(e,t){const i=e=>!1!==e._kindState;this.createObjects(e,t,i),this.preparePois(e,t);this.createTextElements(e,t,e=>!!(r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)||r.isTextTechnique(e))&&i(e)),this.createLabelRejectionElements(e,t),e.dataSource.addGroundPlane&&e.projection.type===s.ProjectionType.Planar&&P.instance.addGroundPlane(e,-f.FALLBACK_RENDER_ORDER_OFFSET/2)}createLabelRejectionElements(e,t){if(void 0!==t.pathGeometries)for(const i of t.pathGeometries)e.addBlockingElement(new g.PathBlockingElement(i.path))}processTechniques(e,t,i){const n=e.decodedTile;if(void 0===n)return;this.processPriorities(e),this.initDecodedTile(n,t,i);const o=e.dataSource.exprPool;n.techniques.forEach(e=>{for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];if(r.isJsonExpr(i)&&"kind"!==t)try{let n=r.Expr.fromJSON(i);!0!==n.dependencies().volatile&&(n=new w(r.Expr.fromJSON(i))),e[t]=n.intern(o)}catch(e){x.error("Failed to compile expression:",e)}}})}registerTileObject(e,t,i,r){const n=i instanceof Set?Array.from(i.values()):Array.isArray(i)?i:[i];p.MapObjectAdapter.create(t,Object.assign({kind:n},r)),void 0===t.userData&&(t.userData={});const o=t.userData;o.tileKey=e.tileKey,o.dataSource=e.dataSource.name,o.kind=n,e.resetVisibilityCounter()}prepareTextPaths(e,t,i){const n=new Array,o=e.slice();for(;o.length>0;){const e=o.pop();if(void 0===e)break;const s=t.techniques[e.technique];r.isTextTechnique(s)&&(void 0===i||i(s))&&n.push(e)}return n}createTextElements(e,t,i){const n=e.mapView,o=e.textStyleCache,s=e.computeWorldOffsetX(),a=Math.floor(n.zoomLevel),c=new r.MapEnv({$zoom:a},n.env);if(void 0!==t.textPathGeometries){const a=this.prepareTextPaths(t.textPathGeometries,t,i);for(const d of a){const a=t.techniques[d.technique];if(!1===a._kindState||!r.isTextTechnique(a)||void 0!==i&&!i(a))continue;const u=[];for(let e=0;e<d.path.length;e+=3)u.push(new h.Vector3(d.path[e]+s,d.path[e+1],d.path[e+2]));const m=void 0!==a.priority?r.getPropertyValue(a.priority,c):0,p=void 0!==a.fadeNear?r.getPropertyValue(a.fadeNear,c):a.fadeNear,f=void 0!==a.fadeFar?r.getPropertyValue(a.fadeFar,c):a.fadeFar,g=d.objInfos,_=r.getFeatureId(g),x=new v.TextElement(l.ContextualArabicConverter.instance.convert(d.text),u,o.getRenderStyle(a),o.getLayoutStyle(a),m,void 0!==a.xOffset?a.xOffset:0,void 0!==a.yOffset?a.yOffset:0,_,a.style,p,f,e.offset);x.pathLengthSqr=d.pathLengthSqr,x.minZoomLevel=void 0!==a.minZoomLevel?a.minZoomLevel:n.minZoomLevel,x.maxZoomLevel=void 0!==a.maxZoomLevel?a.maxZoomLevel:n.maxZoomLevel,x.distanceScale=void 0!==a.distanceScale?a.distanceScale:y.DEFAULT_TEXT_DISTANCE_SCALE,x.mayOverlap=!0===a.mayOverlap,x.reserveSpace=!1!==a.reserveSpace,x.kind=a.kind,x.userData=d.objInfos,x.textFadeTime=a.textFadeTime,e.addTextElement(x)}}if(void 0!==t.textGeometries)for(const a of t.textGeometries){if(void 0===a.technique||void 0===a.stringCatalog)continue;const d=t.techniques[a.technique];if(!1===d._kindState||!r.isTextTechnique(d)||void 0!==i&&!i(d))continue;const u=new h.BufferAttribute(new Float32Array(a.positions.buffer),a.positions.itemCount),m=u.count;if(m<1)continue;const p=void 0!==d.priority?r.getPropertyValue(d.priority,c):0,f=void 0!==d.fadeNear?r.getPropertyValue(d.fadeNear,c):d.fadeNear,g=void 0!==d.fadeFar?r.getPropertyValue(d.fadeFar,c):d.fadeFar;for(let t=0;t<m;++t){const i=u.getX(t)+s,c=u.getY(t),m=u.getZ(t),y=a.stringCatalog[a.texts[t]];if(void 0===y)continue;const _=void 0!==a.objInfos?a.objInfos[t]:void 0,x=r.getFeatureId(_),S=new v.TextElement(l.ContextualArabicConverter.instance.convert(y),new h.Vector3(i,c,m),o.getRenderStyle(d),o.getLayoutStyle(d),p,d.xOffset||0,d.yOffset||0,x,d.style,void 0,void 0,e.offset);S.minZoomLevel=void 0!==d.minZoomLevel?d.minZoomLevel:n.minZoomLevel,S.maxZoomLevel=void 0!==d.maxZoomLevel?d.maxZoomLevel:n.maxZoomLevel,S.mayOverlap=!0===d.mayOverlap,S.reserveSpace=!1!==d.reserveSpace,S.kind=d.kind,S.fadeNear=f,S.fadeFar=g,S.textFadeTime=d.textFadeTime,S.userData=_,e.addTextElement(S)}}}createObjects(e,t,i){var n,o,l,p,f,g;const v=e.mapView,y=[],_=[],x=v.animatedExtrusionHandler,T=e.dataSource,w=Math.floor(v.zoomLevel),M=new r.MapEnv({$zoom:w},v.env),P=e.objects,C=v.viewRanges,A=void 0!==v.elevationProvider;for(const w of this.getAttachments(t)){const L=w.geometry,R=w.info.groups,D=R.length;for(let O=0;O<D;){const F=R[O++],I=F.start,U=F.technique,k=t.techniques[U];if(void 0===F.createdOffsets&&(F.createdOffsets=[]),-1!==F.createdOffsets.indexOf(e.offset)||!1===k._kindState||void 0!==i&&!i(k))continue;let V=F.count;for(F.createdOffsets.push(e.offset);O<D&&R[O].technique===U&&I+V===R[O].start;++O)V+=R[O].count,R[O].createdOffsets.push(e.offset);if(!d.usesObject3D(k))continue;const B=null!==(n=null==x?void 0:x.setAnimationProperties(k,M))&&void 0!==n&&n;let G=y[U];if(void 0===G){const t=t=>{T.requestUpdate(),void 0!==t&&e.addOwnedTexture(t)};if(G=d.createMaterial({technique:k,env:v.env,fog:null!==v.scene.fog,shadowsEnabled:v.shadowsEnabled},t),void 0===G)continue;B&&a.hasExtrusionFeature(G)&&E(G,_),y[U]=G}const z=k.kind;r.isTerrainTechnique(k)&&this.setupTerrainMaterial(k,G,e.mapView.clearColor);const j=new h.BufferGeometry;null===(o=L.vertexAttributes)||void 0===o||o.forEach(e=>{const t=w.getBufferAttribute(e);j.setAttribute(e.name,t)}),null===(l=L.interleavedVertexAttributes)||void 0===l||l.forEach(e=>{w.getInterleavedBufferAttributes(e).forEach(({name:e,attribute:t})=>j.setAttribute(e,t))});const N=null!==(p=w.info.index)&&void 0!==p?p:L.index;N&&j.setIndex(w.getBufferAttribute(N));const q=r.isExtrudedPolygonTechnique(k)&&void 0!==w.info.edgeIndex;if(j.getAttribute("normal")||!q&&!r.needsVertexNormals(k)||j.computeVertexNormals(),j.addGroup(I,V),r.isSolidLineTechnique(k)){c.assert(!a.isHighPrecisionLineMaterial(G));const t=G;!1!==k.clipping&&e.projection.type===s.ProjectionType.Planar&&(e.boundingBox.getSize(S),b.set(S.x,S.y),t.clipTileSize=b),j.getAttribute("color")&&a.setShaderMaterialDefine(t,"USE_COLOR",!0)}const W=r.isSolidLineTechnique(k)&&void 0!==k.secondaryWidth,H=r.Expr.isExpr(k.enabled)&&L.featureStarts&&L.featureStarts.length>0,$=d.buildObject(k,j,H?[G]:G,e,A);if($.renderOrder=r.getPropertyValue(k.renderOrder,v.env),void 0!==w.info.uuid&&($.uuid=w.info.uuid,$.userData.geometryId=w.info.uuid),(r.isCirclesTechnique(k)||r.isSquaresTechnique(k))&&void 0!==k.enablePicking&&($.enableRayTesting=k.enablePicking),r.isLineTechnique(k)||r.isSegmentsTechnique(k)){const e=this.getFadingParams(M,k);a.FadingFeature.addRenderHelper($,C,e.fadeNear,e.fadeFar,!1)}if(r.isSolidLineTechnique(k)){const e=this.getFadingParams(M,k);a.FadingFeature.addRenderHelper($,C,e.fadeNear,e.fadeFar,!1)}if(r.isExtrudedLineTechnique(k)&&void 0!==k.fadeFar){const e=this.getFadingParams(v.env,k);a.FadingFeature.addRenderHelper($,C,e.fadeNear,e.fadeFar,!0)}if(this.addUserData(e,L,k,$),r.isExtrudedPolygonTechnique(k)?($.castShadow=v.shadowsEnabled,$.receiveShadow=v.shadowsEnabled):(r.isStandardTechnique(k)||r.isFillTechnique(k))&&($.receiveShadow=v.shadowsEnabled),(r.isExtrudedPolygonTechnique(k)||r.isStandardTechnique(k)||r.isFillTechnique(k))&&void 0!==k.fadeFar){const e=this.getFadingParams(M,k);a.FadingFeature.addRenderHelper($,C,e.fadeNear,e.fadeFar,!0)}if(r.isExtrudedPolygonTechnique(k)&&u.isRenderDepthPrePassEnabled(k,M)){const t=u.createDepthPrePassMesh($);this.registerTileObject(e,t,z,{technique:k}),P.push(t),B&&E(t.material,_),u.setDepthPrePassStencil(t,$)}if(this.registerTileObject(e,$,z,{technique:k}),P.push($),q){const t=k,i=new h.BufferGeometry;i.setAttribute("position",j.getAttribute("position"));const r=j.getAttribute("color");void 0!==r&&i.setAttribute("color",r);const n=j.getAttribute("extrusionAxis");void 0!==n&&i.setAttribute("extrusionAxis",n);const o=j.getAttribute("normal");void 0!==o&&i.setAttribute("normal",o);const s=j.getAttribute("uv");void 0!==s&&i.setAttribute("uv",s),i.setIndex(w.getBufferAttribute(w.info.edgeIndex));const l=k,c=this.getPolygonFadingParams(M,l),d={color:c.color,colorMix:c.colorMix,fadeNear:c.lineFadeNear,fadeFar:c.lineFadeFar,extrusionRatio:B?0:void 0},u=new a.EdgeMaterial(d),p=new h.LineSegments(i,u);p.renderOrder=$.renderOrder+.1,a.FadingFeature.addRenderHelper(p,C,c.lineFadeNear,c.lineFadeFar,!1),B&&E(p.material,_),this.registerTileObject(e,p,z,{technique:k}),m.MapMaterialAdapter.create(u,{color:t.lineColor,opacity:t.opacity}),P.push(p)}if(r.isExtrudedPolygonTechnique(k)&&B&&($.customDepthMaterial=new a.MapMeshDepthMaterial({depthPacking:h.RGBADepthPacking}),E($.customDepthMaterial,_)),r.isFillTechnique(k)&&w.info.edgeIndex){const t=new h.BufferGeometry;t.setAttribute("position",j.getAttribute("position")),t.setIndex(w.getBufferAttribute(w.info.edgeIndex));const i=k,r=this.getPolygonFadingParams(v.env,i),n={color:r.color,colorMix:r.colorMix,fadeNear:r.lineFadeNear,fadeFar:r.lineFadeFar},o=new a.EdgeMaterial(n),s=new h.LineSegments(t,o);s.renderOrder=$.renderOrder+.1,a.FadingFeature.addRenderHelper(s,C,r.lineFadeNear,r.lineFadeFar,!1),this.registerTileObject(e,s,z,{technique:k}),m.MapMaterialAdapter.create(o,{color:i.lineColor,opacity:i.opacity}),P.push(s)}if(W){const t=k,i=G.clone();d.applyBaseColorToMaterial(i,i.color,t,null!==(f=t.secondaryColor)&&void 0!==f?f:0,M),void 0!==t.secondaryCaps&&(i.caps=r.getPropertyValue(t.secondaryCaps,v.env));const n=d.buildObject(k,j,i,e,A);n.renderOrder=(null!==(g=r.getPropertyValue(t.secondaryRenderOrder,v.env))&&void 0!==g?g:0)-1e-7,this.addUserData(e,L,k,n);const o=this.getFadingParams(M,k);a.FadingFeature.addRenderHelper(n,C,o.fadeNear,o.fadeFar,!1);const s=d.buildMetricValueEvaluator(t.secondaryWidth,t.metricUnit);this.registerTileObject(e,n,z,{technique:k});const l=m.MapMaterialAdapter.get(G),c=m.MapMaterialAdapter.create(i,{color:t.secondaryColor,opacity:t.opacity,caps:t.secondaryCaps,lineWidth:e=>{if(!l)return;l.ensureUpdated(e);const t=l.currentStyledProperties.lineWidth,i=r.getPropertyValue(s,v.env),n=c.currentStyledProperties.opacity;return"number"==typeof t&&"number"==typeof i?i<=t&&(null==n||1===n)?0:i:0}});P.push(n)}}}_.length>0&&v.animatedExtrusionHandler.add(e,_)}preparePois(e,t){void 0!==t.poiGeometries&&e.mapView.poiManager.addPois(e,t)}createGroundPlane(e,t,i,r){const{dataSource:a,projection:l,mapView:c}=e,d=a.getTilingScheme().projection,u=l.type===s.ProjectionType.Spherical,m=new h.Vector3;function p(t){const i=t.getAttribute("position"),r=i.array;for(let t=0;t<r.length;t+=3)m.set(r[t],r[t+1],r[t+2]),l.reprojectPoint(d,m,m),m.sub(e.center),r[t]=m.x,r[t+1]=m.y,r[t+2]=m.z;i.needsUpdate=!0}const{east:f,west:g,north:v,south:y}=e.geoBox,x=new h.BufferGeometry,S=d.projectPoint(new s.GeoCoordinates(y,g),new h.Vector3),b=d.projectPoint(new s.GeoCoordinates(y,f),new h.Vector3),T=d.projectPoint(new s.GeoCoordinates(v,g),new h.Vector3),w=d.projectPoint(new s.GeoCoordinates(v,f),new h.Vector3),M=new h.BufferAttribute(new Float32Array([...S.toArray(),...b.toArray(),...T.toArray(),...w.toArray()]),3);if(x.setAttribute("position",M),!0===r){d.surfaceNormal(S,m),m.negate();const e=new h.BufferAttribute(new Float32Array([...m.toArray(),...m.toArray(),...m.toArray(),...m.toArray()]),3);x.setAttribute("normal",e)}if(x.setIndex(new h.BufferAttribute(new Uint16Array([0,1,2,2,1,3]),1)),i){const e=new h.BufferAttribute(new Float32Array([0,0,1,0,0,1,1,1]),2);x.setAttribute("uv",e)}if(u){const i=[],r=new o.SphericalGeometrySubdivisionModifier(h.MathUtils.degToRad(10),d);if(c.enableMixedLod||void 0===c.enableMixedLod){for(let t=0;t<4;++t){const o=Math.pow(2,t),s=x.clone();if(o>1){new n.EdgeLengthGeometrySubdivisionModifier(o,e.geoBox,n.SubdivisionMode.All,d).modify(s)}r.modify(s),p(s),i.push(s)}return new _.LodMesh(i,t)}return r.modify(x),p(x),new h.Mesh(x,t)}return p(x),new h.Mesh(x,t)}addGroundPlane(e,t){const i=e.mapView.shadowsEnabled,n=this.createGroundPlaneMaterial(new h.Color(e.mapView.clearColor),e.mapView.shadowsEnabled,e.mapView.projection.type===s.ProjectionType.Spherical),o=this.createGroundPlane(e,n,!1,i);o.receiveShadow=i,o.renderOrder=t,this.registerTileObject(e,o,r.GeometryKind.Background),e.objects.push(o)}createGroundPlaneMaterial(e,t,i){return t?new a.MapMeshStandardMaterial({color:e,visible:!0,depthWrite:i,removeDiffuseLight:!0}):new a.MapMeshBasicMaterial({color:e,visible:!0,depthWrite:i})}*getAttachments(e){const t=new T;for(const i of e.geometries){const e={index:i.index,edgeIndex:i.edgeIndex,uuid:i.uuid,groups:i.groups};if(yield new M(i,e,t),i.attachments)for(const e of i.attachments)yield new M(i,e,t)}}processPriorities(e){const t=e.decodedTile;if(void 0===t)return;if(!e.mapView)return;const{priorities:i,labelPriorities:n}=e.mapView.theme;t.techniques.forEach(e=>{if(r.isTextTechnique(e)||r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)){if(n&&"string"==typeof e._category){const t=n.indexOf(e._category);-1!==t&&(e.priority=n.length-t)}}else if(i&&void 0!==e._styleSet){const t=t=>{const r=null==i?void 0:i.findIndex(i=>i.group===e._styleSet&&i.category===t);return void 0!==r&&-1!==r?10*(r+1):void 0};if("string"==typeof e._category){const i=t(e._category);void 0!==i&&(e.renderOrder=i)}if("string"==typeof e._secondaryCategory){const i=t(e._secondaryCategory);void 0!==i&&(e.secondaryRenderOrder=i)}}})}setupTerrainMaterial(e,t,i){if(void 0!==e.displacementMap)t.onBeforeCompile=e=>{e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>","#include <map_pars_fragment>\n    uniform sampler2D displacementMap;\n    uniform float displacementScale;\n    uniform float displacementBias;"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#ifdef USE_MAP\n    float minElevation = ${s.EarthConstants.MIN_ELEVATION.toFixed(1)};\n    float maxElevation = ${s.EarthConstants.MAX_ELEVATION.toFixed(1)};\n    float elevationRange = maxElevation - minElevation;\n\n    float disp = texture2D( displacementMap, vUv ).x * displacementScale + displacementBias;\n    vec4 texelColor = texture2D( map, vec2((disp - minElevation) / elevationRange, 0.0) );\n    texelColor = mapTexelToLinear( texelColor );\n    diffuseColor *= texelColor;\n#endif`),e.vertexShader=e.vertexShader.replace("#include <displacementmap_vertex>","")},t.displacementMap.needsUpdate=!0;else{t.color.set(i)}}addUserData(e,t,i,n){if(r.isTerrainTechnique(i)){c.assert(0===Object.keys(n.userData).length,"Unexpected user data in terrain object"),c.assert("object"==typeof t.objInfos[0],"Wrong attribute map type for terrain geometry");const i=t.objInfos[0],r={tileKey:e.tileKey,texture:new h.DataTexture(i.buffer,i.xCountVertices,i.yCountVertices,h.LuminanceFormat,h.FloatType),displacementMap:i,geoBox:e.geoBox};n.userData=r}else{const e={geometryType:t.type,starts:t.featureStarts,objInfos:t.objInfos};n.userData.feature=e,n.userData.technique=i}}getFadingParams(e,t){return{fadeNear:void 0!==t.fadeNear?r.getPropertyValue(t.fadeNear,e):a.FadingFeature.DEFAULT_FADE_NEAR,fadeFar:void 0!==t.fadeFar?r.getPropertyValue(t.fadeFar,e):a.FadingFeature.DEFAULT_FADE_FAR}}getPolygonFadingParams(e,t){let i,n=a.EdgeMaterial.DEFAULT_COLOR_MIX;if(void 0!==t.lineColor&&(i=r.getPropertyValue(t.lineColor,e),r.isExtrudedPolygonTechnique(t))){const e=t;n=void 0!==e.lineColorMix?e.lineColorMix:a.EdgeMaterial.DEFAULT_COLOR_MIX}const o=void 0!==t.fadeNear?r.getPropertyValue(t.fadeNear,e):a.FadingFeature.DEFAULT_FADE_NEAR,s=void 0!==t.fadeFar?r.getPropertyValue(t.fadeFar,e):a.FadingFeature.DEFAULT_FADE_FAR,l=void 0!==t.lineFadeNear?r.getPropertyValue(t.lineFadeNear,e):o,c=void 0!==t.lineFadeFar?r.getPropertyValue(t.lineFadeFar,e):s;return void 0===i&&(i=a.EdgeMaterial.DEFAULT_COLOR),{color:i,colorMix:n,fadeNear:o,fadeFar:s,lineFadeNear:l,lineFadeFar:c}}}t.TileGeometryCreator=P},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMaterialAdapter=void 0;const r=i(0),n=i(2),o=i(4),s=i(19);class a{constructor(e,t){this.m_lastUpdateFrameNumber=-1,this.material=e,this.styledProperties=t,this.currentStyledProperties={},this.m_dynamicProperties=[];for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];n.Expr.isExpr(i)||"function"==typeof i?this.m_dynamicProperties.push([e,i]):this.currentStyledProperties[e]=i}this.setupStaticProperties()}static get(e){var t;const i=null===(t=e.userData)||void 0===t?void 0:t.mapAdapter;return i instanceof a?i:void 0}static install(e){return e.material.userData||(e.material.userData={}),e.material.userData.mapAdapter=e}static create(e,t){return a.install(new a(e,t))}static ensureUpdated(e,t){var i,r;return null!==(r=null===(i=a.get(e))||void 0===i?void 0:i.ensureUpdated(t))&&void 0!==r&&r}toJSON(){return{styledProperties:this.styledProperties}}ensureUpdated(e){return this.m_lastUpdateFrameNumber!==e.frameNumber&&(this.m_lastUpdateFrameNumber=e.frameNumber,this.updateDynamicProperties(e))}setupStaticProperties(){var e,t;let i=!1;for(const e in this.styledProperties){if(!this.styledProperties.hasOwnProperty(e))continue;const t=this.currentStyledProperties[e];null!=t&&("color"===e||"opacity"===e?i=!0:this.applyMaterialGenericProp(e,t))}if(i){const i=null!==(e=this.currentStyledProperties.color)&&void 0!==e?e:16711680,r=null!==(t=this.currentStyledProperties.opacity)&&void 0!==t?t:1;this.applyMaterialBaseColor(i,r)}}updateDynamicProperties(e){var t,i;let r=!1;if(this.m_dynamicProperties.length>0){let o=!1;for(const[t,i]of this.m_dynamicProperties){const s=n.Expr.isExpr(i)?n.getPropertyValue(i,e.env):i(e);s!==this.currentStyledProperties[t]&&(this.currentStyledProperties[t]=s,"color"===t||"opacity"===t?o=!0:(this.applyMaterialGenericProp(t,s),r=!0))}if(o){const e=null!==(t=this.currentStyledProperties.color)&&void 0!==t?t:16711680,n=null!==(i=this.currentStyledProperties.opacity)&&void 0!==i?i:1;this.applyMaterialBaseColor(e,n),r=!0}}return r}applyMaterialGenericProp(e,t){const i=this.material;if(i[e]instanceof r.Color){let r=t;if("number"!=typeof r){const e=s.evaluateColorProperty(r);if(void 0===e)return;r=e}const o=n.ColorUtils.removeAlphaFromHex(r);i[e].set(o)}else i[e]=t}applyMaterialBaseColor(e,t){if("number"!=typeof e){const t=s.evaluateColorProperty(e);if(void 0===t)return;e=t}const{r:i,g:a,b:l,a:c}=n.ColorUtils.getRgbaFromHex(null!=e?e:16711680),h=c*r.MathUtils.clamp(null!=t?t:1,0,1);this.material.opacity=h,this.material.color.setRGB(i,a,l),h>=1?o.disableBlending(this.material):o.enableBlending(this.material)}}t.MapMaterialAdapter=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Squares=t.Circles=t.MapViewPoints=void 0;const r=i(0);class n extends r.Points{constructor(){super(...arguments),this.enableRayTesting=!0}raycast(e,t){if(!this.enableRayTesting)return;const i=this.geometry,n=this.matrixWorld,s=e.ray.origin.clone().add(e.ray.direction).project(e.camera),a=new r.Vector2(Math.ceil((s.x+1)/2*e.width),Math.ceil((1-s.y)/2*e.height));if(i instanceof r.BufferGeometry){const s=new r.Vector3,l=i.index,c=i.attributes.position.array;if(null!==l){const i=l.array;for(let r=0,l=i.length;r<l;r++){const l=i[r];s.fromArray(c,3*l);const h=o(s,n,e);h.pointIsOnScreen&&this.testPoint(s,h.absoluteScreenPosition,a,r,h.distance,t)}}else for(let i=0,r=c.length/3;i<r;i++){s.fromArray(c,3*i);const r=o(s,n,e);r.pointIsOnScreen&&this.testPoint(s,r.absoluteScreenPosition,a,i,r.distance,t)}}else{const r=i.vertices;for(let i=0;i<r.length;i++){const s=r[i],l=o(s,n,e);l.pointIsOnScreen&&this.testPoint(s,l.absoluteScreenPosition,a,i,l.distance,t)}}}}function o(e,t,i){const n=e.clone();n.applyMatrix4(t);const o=n.distanceTo(i.ray.origin);n.project(i.camera);const s=new r.Vector2(n.x,n.y),a=s.x<1&&s.x>-1&&s.y<1&&s.y>-1;if(a){return n.x=(n.x+1)/2*i.width,n.y=(1-n.y)/2*i.height,{absoluteScreenPosition:new r.Vector2(n.x,n.y),pointIsOnScreen:a,distance:o}}return{pointIsOnScreen:a}}t.MapViewPoints=n;t.Circles=class extends n{testPoint(e,t,i,r,n,o){const s=t.x-i.x,a=t.y-i.y;Math.sqrt(s*s+a*a)<=this.material.size/2&&o.push({point:e,distance:n,index:r,object:this})}};t.Squares=class extends n{testPoint(e,t,i,r,n,o){const s=t.x-i.x,a=t.y-i.y,l=this.material.size/2;Math.abs(s)<=l&&Math.abs(a)<=l&&o.push({point:e,distance:n,index:r,object:this})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugContext=t.DebugContext=void 0;const r=i(0),n="undefined"==typeof window;let o=(()=>{class e extends r.EventDispatcher{constructor(e){super(),this.value=e}set(t,i){this.value=t,this.dispatchEvent({type:e.SET_EVENT_TYPE,name:i,value:t})}}return e.SET_EVENT_TYPE="set",e})();class s{constructor(){if(this.m_optionsMap=new Map,!n&&"undefined"!=typeof window&&window){window.__debugContext=this}}setValue(e,t){let i=this.m_optionsMap.get(e);i?i.set(t,e):(i=new o(t),this.m_optionsMap.set(e,i))}getValue(e){const t=this.m_optionsMap.get(e);return t?t.value:void 0}hasOption(e){return void 0!==this.m_optionsMap.get(e)}addEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.addEventListener(o.SET_EVENT_TYPE,t)}hasEventListener(e,t){const i=this.m_optionsMap.get(e);if(i)return i.hasEventListener(o.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)}removeEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.removeEventListener(o.SET_EVENT_TYPE,t)}get options(){return this.m_optionsMap}clear(){this.m_optionsMap.forEach(e=>{e.set(void 0,"")})}}t.DebugContext=s,t.debugContext=new s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickHandler=t.PickObjectType=void 0;const r=i(2),n=i(0),o=i(3),s=i(56);var a;!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(a=t.PickObjectType||(t.PickObjectType={}));const l=new o.OrientedBox3;t.PickHandler=class{constructor(e,t,i=!1){this.mapView=e,this.camera=t,this.enablePickTechnique=i}intersectMapObjects(e,t){const i=this.mapView.getNormalizedScreenCoordinates(e,t),o=this.mapView.raycasterFromScreenPoint(e,t),s=[];if(void 0!==this.mapView.textElementsRenderer){const{clientWidth:e,clientHeight:t}=this.mapView.canvas,r=i.x*e*.5,o=i.y*t*.5,a=new n.Vector2(r,o);this.mapView.textElementsRenderer.pickTextElements(a,s)}const c=[];this.mapView.visibleTileSet.dataSourceTileList.forEach(e=>{e.renderedTiles.forEach(e=>{l.copy(e.boundingBox),l.position.sub(this.mapView.worldCenter);const t=e.computeWorldOffsetX();l.position.x+=t,void 0!==l.intersectsRay(o.ray)&&o.intersectObjects(e.objects,!0,c)})});for(const e of c){const t={type:a.Unspecified,point:e.point,distance:e.distance,intersection:e};if(void 0===e.object.userData||void 0===e.object.userData.feature){s.push(t);continue}const i=e.object.userData.feature;if(this.enablePickTechnique&&(t.technique=e.object.userData.technique),this.addObjInfo(i,e,t),void 0!==i.objInfos){const e=1===i.objInfos.length?r.getFeatureId(i.objInfos[0]):void 0;t.featureId=e}let n;switch(i.geometryType){case r.GeometryType.Point:case r.GeometryType.Text:n=a.Point;break;case r.GeometryType.Line:case r.GeometryType.ExtrudedLine:case r.GeometryType.SolidLine:case r.GeometryType.TextPath:n=a.Line;break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:n=a.Area;break;case r.GeometryType.Object3D:n=a.Object3D;break;default:n=a.Unspecified}t.type=n,s.push(t)}return s.sort((e,t)=>e.distance-t.distance),s}addObjInfo(e,t,i){if(void 0===e.objInfos)return;if(i.intersection.object instanceof s.MapViewPoints)return void(i.userData=e.objInfos[t.index]);if(void 0===e.starts||0===e.starts.length||void 0===t.faceIndex&&void 0===t.index)return;if(1===e.starts.length)return void(i.userData=e.objInfos[0]);const r=void 0!==t.faceIndex?3*t.faceIndex:t.index;let n=0;for(const t of e.starts){if(t>r)break;n++}i.userData=e.objInfos[n-1]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightInfo=void 0;const r=i(1);!function(e){e.mergeArrays=function(e,t){const i=[];for(const n of[e,t])if(void 0!==n)for(const e of n){const t=i.find(t=>t.id===e.id||void 0!==t.label&&t.label===e.label);void 0===t?i.push(Object.assign({},e)):(t.year=r.MathUtils.max2(e.year,t.year),t.label=r.getOptionValue(e.label,t.label),t.link=r.getOptionValue(e.link,t.link))}return i},e.formatAsHtml=function(e){if(0===e.length)return"";const t=e.filter(e=>""!==e.label);return 0===t.length?"":"© "+t.map(e=>{var t;const i=null!==(t=e.label)&&void 0!==t?t:e.id,r=void 0!==e.year?`${e.year} ${i}`:i,n=e.link;return n?`<a href="${n}" target="_blank" rel="noreferrer noopener">${r}</a>`:`${r}`}).join(", ")}}(t.CopyrightInfo||(t.CopyrightInfo={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionUtils=void 0;const r=i(4),n=i(0),o=i(125),s=i(267),a=i(124);!function(e){function t(e){return new n.Vector3(Math.fround(e.x),Math.fround(e.y),Math.fround(e.z))}function i(e,i){const r=(new n.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),o=new n.Vector3(0,0,0).applyMatrix4(i),s=t(o);return{viewProjection:r,eyePosHi:s,eyePosLo:t(o.sub(s))}}function l(e){if(e.length>0){const t=e[0];if(null==t)throw Error("Empty element in positions");const i=new Array,r=new Array,o=(...e)=>{for(const t of e){const e=Math.fround(t);r.push(t-e),i.push(e)}},s=e=>{o(e.x,e.y,e.z)};if(void 0!==t.z)e.forEach(e=>{s(e)});else{if(i.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach(e=>{o(e)})}return{positionHigh:new n.Float32BufferAttribute(i,3),positionLow:new n.Float32BufferAttribute(r,3)}}return{positionHigh:new n.Float32BufferAttribute([],3),positionLow:new n.Float32BufferAttribute([],3)}}function c(e,t,i=0){const r=new Array,n=e.length;for(let o=0;o<n;o+=t){for(let t=0;t<i;t++)r.push(e[o+t]);const n=e[o+i],s=e[o+i+1],a=e[o+i+2],l=Math.fround(n),c=n-l,h=Math.fround(s),d=s-h,u=Math.fround(a),m=a-u;r.push(l,h,u,c,d,m);for(let n=i+3;n<t;n++)r.push(e[o+n])}return r}function h(e,t){const i=l(t);return e.bufferGeometry.setAttribute("position",i.positionHigh),e.bufferGeometry.setAttribute("positionLow",i.positionLow),i.positionHigh.itemSize}e.doubleToFloatVec=t,e.makeFloatVec=function(e){const t=Math.fround(e.x),i=Math.fround(e.y),r=Math.fround(e.z),o=new n.Vector3(e.x-t,e.y-i,e.z-r);return e.x=Math.fround(t),e.y=Math.fround(i),e.z=Math.fround(r),o},e.createHighPrecisionCameraPos=i,e.updateHpUniforms=function(e,t,r){const n=i(t,e.matrixWorldInverse),o=n.viewProjection;if(void 0===r||!r.isMaterial)throw Error("High pecision line has no high precision material");if(!(r.uniforms&&r.uniforms.u_mvp&&r.uniforms.u_eyepos&&r.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");r.uniforms.u_mvp.value=new Float32Array(o.elements),r.uniforms.u_eyepos.value=new Float32Array(n.eyePosHi.toArray()),r.uniforms.u_eyepos_lowpart.value=new Float32Array(n.eyePosLo.toArray())},e.createAttributes=l,e.addInterleavedAttributes3=c,e.setPositions=h,e.convertPositions=function(e){if(e.length<=0)return{positions:[]};const t=e[0];if(null==t)throw Error("Empty element in positions");const i=t;if(void 0===i.y&&void 0===i.z)return{positions:e};const r=new Array;return e.forEach(e=>{r.push(e.x,e.y,e.z)}),{positions:r}},e.createLine=function(e,t){const i=void 0!==t.lineWidth?t.lineWidth:5,s=void 0!==t.addCircles&&t.addCircles,l=void 0!==t.wireFrame&&t.wireFrame,h=[],d=[];a.triangulateLine(e,i,h,d,s);const u=new n.BufferGeometry,m=c(h,3),p=new n.InterleavedBuffer(new Float32Array(m),6),f=new n.InterleavedBufferAttribute(p,3,0,!1),g=new n.InterleavedBufferAttribute(p,3,3,!1);u.setAttribute("position",f),u.setAttribute("positionLow",g),u.setIndex(new n.BufferAttribute(new Uint32Array(d),1));const v=new r.HighPrecisionLineMaterial(t),y=l?new o.HighPrecisionWireFrameLine(u,v):new o.HighPrecisionLine(u,v);return y.setupForRendering(),y},e.createPoints=function(e,t){const i=[];for(let t=0;t<e.length;t++)i.push(i.length/3);const o=new n.BufferGeometry,a=r.isHighPrecisionPointMaterial(t)?t:new r.HighPrecisionPointMaterial(t),l=new s.HighPrecisionPoints(o,a);return h(l,e),l.setupForRendering(),l}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OMV_TILER_SERVICE_TYPE=t.OMV_TILE_DECODER_SERVICE_TYPE=t.OmvGeometryType=t.OmvFilterString=t.FeatureModifierId=void 0,function(e){e[e.default=0]="default",e[e.tomTom=1]="tomTom"}(t.FeatureModifierId||(t.FeatureModifierId={})),function(e){let t;!function(e){e[e.Any=0]="Any",e[e.Match=1]="Match",e[e.StartsWith=2]="StartsWith",e[e.Contains=3]="Contains",e[e.EndsWith=4]="EndsWith"}(t=e.StringMatch||(e.StringMatch={})),e.matchString=function(t,i){switch(i.match){case e.StringMatch.Any:return!0;case e.StringMatch.Match:return t===i.value;case e.StringMatch.StartsWith:return i.value.startsWith(t);case e.StringMatch.EndsWith:return i.value.endsWith(t);default:return t.indexOf(i.value)>=0}}}(t.OmvFilterString||(t.OmvFilterString={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.POINT=1]="POINT",e[e.LINESTRING=2]="LINESTRING",e[e.POLYGON=3]="POLYGON"}(t.OmvGeometryType||(t.OmvGeometryType={})),t.OMV_TILE_DECODER_SERVICE_TYPE="omv-tile-decoder",t.OMV_TILER_SERVICE_TYPE="omv-tiler"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvTile=void 0;const r=i(16);class n extends r.Tile{constructor(e,t){super(e,t)}}t.OmvTile=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPointLike=void 0,t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,i,r]=e;return"number"==typeof t&&"number"==typeof i&&(void 0===r||"number"==typeof r)}return!1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLatLngLike=void 0,t.isLatLngLike=function(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.equirectangularProjection=t.normalizedEquirectangularProjection=void 0;const r=i(20),n=i(7),o=i(13),s=i(8),a=i(14),l=i(12),c=i(15),h=i(0);let d=(()=>{class e extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new h.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale/2,i.max.z=t,i}projectPoint(t,i){return void 0===i&&(i={x:0,y:0,z:0}),i.x=(h.MathUtils.degToRad(t.longitude)+Math.PI)*e.geoToWorldScale*this.unitScale,i.y=(h.MathUtils.degToRad(t.latitude)+.5*Math.PI)*e.geoToWorldScale*this.unitScale,i.z=t.altitude||0,i}unprojectPoint(t){return n.GeoCoordinates.fromRadians(t.y*e.worldToGeoScale/this.unitScale-.5*Math.PI,t.x*e.worldToGeoScale/this.unitScale-Math.PI,t.z)}unprojectAltitude(e){return e.z}projectBox(t,i){const r=this.projectPoint(new n.GeoCoordinates(t.center.latitude,t.center.longitude,0)),{latitudeSpanInRadians:l,longitudeSpanInRadians:c,altitudeSpan:d}=t,u=c*e.geoToWorldScale,m=l*e.geoToWorldScale;return i||(i=new h.Box3),o.isBox3Like(i)?(i.min.x=r.x-.5*u*this.unitScale,i.min.y=r.y-.5*m*this.unitScale,i.max.x=r.x+.5*u*this.unitScale,i.max.y=r.y+.5*m*this.unitScale,void 0!==d?(i.min.z=r.z-.5*d,i.max.z=r.z+.5*d):(i.min.z=0,i.max.z=0)):a.isOrientedBox3Like(i)&&(s.MathUtils.newVector3(1,0,0,i.xAxis),s.MathUtils.newVector3(0,1,0,i.yAxis),s.MathUtils.newVector3(0,0,1,i.zAxis),i.position.x=r.x,i.position.y=r.y,i.position.z=r.z,i.extents.x=.5*u*this.unitScale,i.extents.y=.5*m*this.unitScale,i.extents.z=Math.max(Number.EPSILON,.5*(d||0))),i}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}return e.geoToWorldScale=1/(2*Math.PI),e.worldToGeoScale=2*Math.PI/1,e})();t.normalizedEquirectangularProjection=new d(1),t.equirectangularProjection=new d(l.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transverseMercatorProjection=t.TransverseMercatorUtils=void 0;const r=i(20),n=i(7),o=i(13),s=i(8),a=i(14),l=i(12),c=i(15),h=i(0);class d extends c.Projection{constructor(e){super(e),this.unitScale=e,this.type=c.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}static clampGeoPoint(e,t){const i=e.latitude,r=e.longitude,o=u.POLE_RADIUS,s=u.POLE_RADIUS_SQ,a=Math.round(r/90),l=90*a-r;if(a%2==0||Math.abs(l)>o)return e;const c=i-0,h=l*l+c*c;if(h<s){const e=Math.sqrt(h),t=(o-e)/e,s=1,a=0===l&&0===c?o*s:l;return new n.GeoCoordinates(i+c*t,r+a*t)}return e}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,i){return i||(i=new h.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){t||(t={x:0,y:0,z:0});const i=d.clampGeoPoint(e,this.unitScale),r=i.longitude/360+.5,n=1===r?0:Math.floor(r),o=h.MathUtils.degToRad(i.latitude),s=h.MathUtils.degToRad(i.longitude-360*n)-this.m_lambda0,a=Math.cos(o)*Math.sin(s);t.x=Math.atanh(a),t.y=Math.atan2(Math.tan(o),Math.cos(s))-this.m_phi0;const l=.5/Math.PI;return t.x=this.unitScale*(h.MathUtils.clamp(t.x*l+.5,0,1)+n),t.y=this.unitScale*h.MathUtils.clamp(t.y*l+.5,0,1),t.z=e.altitude||0,t}unprojectPoint(e){const t=2*Math.PI,i=e.x/this.unitScale,r=e.y/this.unitScale,o=1===i?0:Math.floor(i),s=t*(i-.5-o),a=t*(r-.5),l=e.z||0,c=a+this.m_phi0,h=Math.asin(Math.sin(c)/Math.cosh(s)),d=this.m_lambda0+Math.atan2(Math.sinh(s),Math.cos(c))+o*t;return n.GeoCoordinates.fromRadians(h,d,l)}projectBox(e,t){const{north:i,south:r,east:l,west:c}=e,d=[e.center,e.northEast,e.southWest,new n.GeoCoordinates(r,l),new n.GeoCoordinates(i,c)],m=u.POLE_EDGE_DEG,p=c<90&&l>90,f=c<0&&l>0,g=c<m&&l>-m&&i>0&&r<0;c<-90&&l>-90&&(d.push(new n.GeoCoordinates(i,-90)),d.push(new n.GeoCoordinates(r,-90))),p&&(d.push(new n.GeoCoordinates(i,90)),d.push(new n.GeoCoordinates(r,90))),f&&(d.push(new n.GeoCoordinates(i,0)),d.push(new n.GeoCoordinates(r,0))),g&&(d.push(new n.GeoCoordinates(0,c)),d.push(new n.GeoCoordinates(0,l))),u.alignLatitude(d,d[0]);const v=d.map(e=>this.projectPoint(e)),y=v.map(e=>e.x),_=v.map(e=>e.y),x=v.map(e=>e.z),S=Math.min(...y),b=Math.min(..._),T=Math.min(...x),w=Math.max(...y),M=Math.max(..._),E=Math.max(...x);if(t||(t=new h.Box3),o.isBox3Like(t))t.min.x=S,t.min.y=b,t.min.z=T,t.max.x=w,t.max.y=M,t.max.z=E;else{if(!a.isOrientedBox3Like(t))throw new Error("invalid bounding box");s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(S+w)/2,t.position.y=(b+M)/2,t.position.z=(T+E)/2,t.extents.x=(w-S)/2,t.extents.y=(M-b)/2,t.extents.z=(E-T)/2}return t}unprojectBox(e){const t=this.unitScale,i=e.min,o=e.max,s=[{x:(i.x+o.x)/2,y:(i.y+o.y)/2,z:0},i,o,{x:i.x,y:o.y,z:0},{x:o.x,y:i.y,z:0}],a=.5*t,l=.25*t,c=.75*t,h=i.x<a&&o.x>a,d=i.y<a&&o.y>a,m=i.y<l&&o.y>l,p=i.y<c&&o.y>c;d&&(s.push({x:i.x,y:a,z:0}),s.push({x:o.x,y:a,z:0}),h&&s.push({x:a,y:a,z:0})),m&&(s.push({x:i.x,y:l,z:0}),s.push({x:o.x,y:l,z:0}),h&&s.push({x:a,y:l,z:0})),p&&(s.push({x:i.x,y:c,z:0}),s.push({x:o.x,y:c,z:0}),h&&s.push({x:a,y:c,z:0}));const f=s.map(e=>this.unprojectPoint(e));u.alignLongitude(f,f[0]);const g=f.map(e=>e.latitude),v=f.filter(e=>Math.abs(e.latitude)<90).map(e=>e.longitude),y=f.map(e=>e.altitude||0),_=new n.GeoCoordinates(Math.min(...g),Math.min(...v),Math.min(...y)),x=new n.GeoCoordinates(Math.max(...g),Math.max(...v),Math.max(...y));return r.GeoBox.fromCoordinates(_,x)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}let u=(()=>{class e{static alignLatitude(e,t){for(const i of e)0===i.latitude&&(i.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const i=t.longitude<0?180:-180,r=t.longitude<0?-180:180;for(const t of e)t.longitude===i&&(t.longitude=r)}}return e.POLE_EDGE=1.4844222297453322,e.POLE_EDGE_DEG=h.MathUtils.radToDeg(e.POLE_EDGE),e.POLE_RADIUS=90-e.POLE_EDGE_DEG,e.POLE_RADIUS_SQ=Math.pow(e.POLE_RADIUS,2),e})();t.TransverseMercatorUtils=u,t.transverseMercatorProjection=new d(l.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlatTileBoundingBoxGenerator=void 0;const r=i(0);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,i=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=i,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,i);const{min:r,max:n}=this.m_worldBox;this.m_worldDimensions={x:n.x-r.x,y:n.y-r.y,z:n.z-r.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const i=e.level,n=this.subdivisionScheme.getLevelDimensionX(i),o=this.subdivisionScheme.getLevelDimensionY(i),s=this.m_worldDimensions.x/n,a=this.m_worldDimensions.y/o,l=this.m_worldBox.min.x+s*e.column,c=this.m_worldBox.min.y+a*e.row;return t||(t=new r.Box3),t.min.x=l,t.min.y=c,t.min.z=this.m_worldBox.min.z,t.max.x=l+s,t.max.y=c+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.halfQuadTreeSubdivisionScheme=void 0;t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubTiles=void 0;const r=i(29);class n{constructor(e,t,i){this.tileKey=e,this.sizeX=t,this.sizeY=i}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?n.ZCurveIterator(this.tileKey):n.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=n,function(e){e.RowColumnIterator=function*(e,t,i){for(let n=0;n<i;n++)for(let o=0;o<t;o++)yield r.TileKey.fromRowColumnLevel(e.row*i+n,e.column*t+o,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield r.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(n=t.SubTiles||(t.SubTiles={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKeyUtils=void 0;const r=i(7),n=i(29);class o{static geoCoordinatesToTileKey(e,t,i){const r=e.projection.projectPoint(t);return this.worldCoordinatesToTileKey(e,r,i)}static worldCoordinatesToTileKey(e,t,i){const r=e.projection,o=e.subdivisionScheme,s=o.getLevelDimensionX(i),a=o.getLevelDimensionY(i),{min:l,max:c}=r.worldExtent(0,0),h=c.x-l.x,d=c.y-l.y;if(t.x<l.x||t.x>c.x)return null;if(t.y<l.y||t.y>c.y)return null;const u=Math.min(s-1,Math.floor(s*(t.x-l.x)/h)),m=Math.min(a-1,Math.floor(a*(t.y-l.y)/d));return n.TileKey.fromRowColumnLevel(m,u,i)}static geoRectangleToTileKeys(e,t,i){const s=(e,t,i)=>e<t?i-(t-e)%(i-t):t+(e-t)%(i-t),a=(e,t,i)=>Math.min(Math.max(e,t),i),l=s(t.southWest.longitudeInRadians,-Math.PI,Math.PI),c=a(t.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=s(t.northEast.longitudeInRadians,-Math.PI,Math.PI),d=a(t.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),u=o.geoCoordinatesToTileKey(e,r.GeoCoordinates.fromRadians(c,l),i),m=o.geoCoordinatesToTileKey(e,r.GeoCoordinates.fromRadians(d,h),i),p=e.subdivisionScheme.getLevelDimensionX(i);if(!u||!m)throw new Error("Invalid coordinates");const f=u.column;let g=m.column;l>h&&(g+=g!==f?p:p-1);const v=Math.min(u.row,m.row),y=Math.max(u.row,m.row),_=new Array;for(let e=v;e<=y;++e)for(let t=f;t<=g;++t)_.push(n.TileKey.fromRowColumnLevel(e,t%p,i));return _}}t.TileKeyUtils=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTreeTraverse=void 0;const r=i(69);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),i=this.m_subdivisionScheme.getSubdivisionY(e.level);return new r.SubTiles(e,t,i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimatedExtrusionHandler=t.AnimatedExtrusionState=void 0;const r=i(2),n=i(4),o=i(1);var s;!function(e){e[e.None=0]="None",e[e.Started=1]="Started",e[e.Finished=2]="Finished"}(s=t.AnimatedExtrusionState||(t.AnimatedExtrusionState={}));t.AnimatedExtrusionHandler=class{constructor(e){this.m_mapView=e,this.enabled=!0,this.duration=750,this.m_minZoomLevel=16,this.m_forceEnabled=!1,this.m_tileMap=new Map,this.m_state=s.None,this.m_startTime=-1}get forceEnabled(){return this.m_forceEnabled}set forceEnabled(e){this.m_forceEnabled=e,this.duration=750}get minZoomLevel(){return this.m_minZoomLevel}setAnimationProperties(e,t){if(!r.isExtrudedPolygonTechnique(e))return!1;if("minZoomLevel"in e&&(this.m_minZoomLevel=e.minZoomLevel),this.forceEnabled)return this.enabled;void 0!==e.animateExtrusionDuration&&(this.duration=e.animateExtrusionDuration);const i=r.getPropertyValue(e.animateExtrusion,t);return null===i?this.enabled:"boolean"==typeof i?i:"number"==typeof i&&0!==i}update(e){const t=this.m_tileMap.size>0&&e>=this.m_minZoomLevel;this.m_state===s.None&&t?this.m_state=s.Started:this.m_state===s.None||t||this.resetAnimation(!0),this.animateExtrusion()}add(e,t){e.addDisposeCallback(this.removeTile.bind(this));let i=!1;this.m_state!==s.None&&(i=this.skipAnimation(e),i?this.setTileExtrusionRatio(t,1):this.m_state===s.Finished&&this.resetAnimation(!1)),this.m_tileMap.set(e.tileKey.mortonCode(),{materials:t,animated:i})}get isAnimating(){return this.m_state!==s.Finished&&this.m_state!==s.None}skipAnimation(e){return this.wasAnyAncestorAnimated(e)||this.wasAnyDescendantAnimated(e)}wasAnyAncestorAnimated(e){var t,i;const r=e.dataSource.getDataZoomLevel(this.m_minZoomLevel),n=Math.max(0,e.tileKey.level-r),o=Math.min(n,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceUp);let s=e.tileKey;for(let e=1;e<=o;++e)if(s=s.parent(),null!==(i=null===(t=this.m_tileMap.get(s.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;return!1}wasAnyDescendantAnimated(e){var t,i;const r=e.dataSource.maxDataLevel-e.tileKey.level,n=Math.min(r,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceDown),o=e.dataSource.getTilingScheme();let s=[e.tileKey],a=[];for(let e=1;e<=n;++e){a.length=0;for(const e of s)for(const r of o.getSubTileKeys(e)){if(null!==(i=null===(t=this.m_tileMap.get(r.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;a.push(r)}[s,a]=[a,s]}return!1}removeTile(e){this.m_tileMap.delete(e.tileKey.mortonCode())}animateExtrusion(){if(this.m_state!==s.Started)return;const e=Date.now();this.m_startTime<0&&(this.m_startTime=e);const t=this.duration,i=Math.min(e-this.m_startTime,t),r=o.MathUtils.easeInOutCubic(n.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN,n.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX,i/t);this.setExtrusionRatio(r),i>=t&&(this.m_state=s.Finished),this.m_mapView.update()}resetAnimation(e){this.m_state=s.None,this.m_startTime=-1,e&&this.m_tileMap.forEach(e=>{e.animated=!1})}setExtrusionRatio(e){this.m_tileMap.forEach(t=>{t.animated||(this.setTileExtrusionRatio(t.materials,e),e>=1&&(t.animated=!0))})}setTileExtrusionRatio(e,t){e.forEach(e=>{e.extrusionRatio=t})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleChannel=void 0;t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const r=i(40);t.Logger=class{constructor(e,t,i){this.name=e,this.m_channel=t,this.enabled=!0,this.level=r.LogLevel.Trace,void 0!==i&&this.update(i)}error(e,...t){this.enabled&&this.level<=r.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=r.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=r.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=r.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=r.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=r.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerChannel=t.WORKERCHANNEL_MSG_TYPE=void 0;const r=i(40);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";t.WorkerChannel=class{error(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Error};self.postMessage(n)}debug(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Debug};self.postMessage(n)}info(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Info};self.postMessage(n)}log(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Log};self.postMessage(n)}trace(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Trace};self.postMessage(n)}warn(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Warn};self.postMessage(n)}}},function(e,t,i){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.isTextureBuffer=t.PlacementToken=t.PoiStackMode=t.TextureCoordinateType=t.GeometryKindSet=t.GeometryKind=t.StandardGeometryKind=void 0,function(e){e.All="_all_",e.Background="background",e.Terrain="terrain",e.Area="area",e.Line="line",e.Water="water",e.Border="border",e.Road="road",e.Building="building",e.Label="label",e.Detail="detail"}(r=t.StandardGeometryKind||(t.StandardGeometryKind={})),t.GeometryKind=r;class n extends Set{isSuperset(e){for(const t of e)if(!this.has(t))return!1;return!0}hasIntersection(e){for(const t of e)if(this.has(t))return!0;return!1}hasOrIntersects(e){return e instanceof Set?this.hasIntersection(e):this.has(e)}hasOrIntersectsArray(e){for(const t of e)if(this.has(t))return!0;return!1}}t.GeometryKindSet=n,function(e){e.TileSpace="tile-space",e.EquirectangularSpace="equirectangular-space",e.FeatureSpace="feature-space"}(t.TextureCoordinateType||(t.TextureCoordinateType={})),function(e){e.Show="show-in-stack",e.Hide="hide-in-stack",e.ShowParent="show-parent"}(t.PoiStackMode||(t.PoiStackMode={})),function(e){e.TopLeft="TL",e.Top="T",e.TopRight="TR",e.Right="R",e.BottomRight="BR",e.Bottom="B",e.BottomLeft="BL",e.Left="L",e.Center="C",e.NorthWest="NW",e.North="N",e.NorthEast="NE",e.East="E",e.SouthEast="SE",e.South="S",e.SouthWest="SW",e.West="W"}(t.PlacementToken||(t.PlacementToken={})),t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeTechniqueDescriptor=t.AttrScope=void 0,function(e){e[e.FeatureGeometry=0]="FeatureGeometry",e[e.TechniqueGeometry=1]="TechniqueGeometry",e[e.TechniqueRendering=2]="TechniqueRendering"}(t.AttrScope||(t.AttrScope={})),t.mergeTechniqueDescriptor=function(...e){const t={attrScopes:{}};for(const i of e)void 0!==i.attrTransparencyColor&&(t.attrTransparencyColor=i.attrTransparencyColor),void 0!==i.attrScopes&&(t.attrScopes=Object.assign(Object.assign({},t.attrScopes),i.attrScopes));return t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPropertyValue=void 0;const r=i(1),n=i(5),o=i(42),s=i(30),a=i(31),l=r.LoggerManager.instance.create("PropertyValue");t.getPropertyValue=function(e,t,i){var r,c,h;if(n.Expr.isExpr(e))try{let a=e.evaluate(t,n.ExprScope.Dynamic,i);return"string"==typeof a&&(a=null!==(c=null!==(r=s.RGBA.parse(a))&&void 0!==r?r:o.Pixels.parse(a))&&void 0!==c?c:a),a instanceof s.RGBA?a.getHex():a instanceof o.Pixels?a.value*(null!==(h=Number(t.lookup("$pixelToMeters")))&&void 0!==h?h:1):a}catch(t){return l.error("failed to evaluate expression",JSON.stringify(e),"error",String(t)),null}if(null==e)return null;if("string"!=typeof e)return e;{const i=t.lookup("$pixelToMeters")||1,r=a.parseStringEncodedNumeral(e,i);return void 0!==r?r:e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFeatureText=t.getFeatureName=t.getFeatureId=t.getProjectionName=t.getProjection=t.GeometryType=t.getArrayConstructor=void 0;const r=i(3),n=i(5),o=i(185),s=i(43);function a(e,t,i,r,n){let o;if(void 0===t&&(t="name"),i){const i=e.lookup(`${t}:short`);if("string"==typeof i&&i.length>0)return i}if(r){const t=e.lookup("iso_code");if("string"==typeof t&&t.length>0)return t}if(void 0!==n)for(const i of n)if(o=e.lookup(`${t}:${i}`)||e.lookup(`${t}_${i}`),"string"==typeof o&&o.length>0)return o;if(o=e.lookup(t),"string"==typeof o)return o}t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.getProjection=function(e){switch(e){case"mercator":return r.mercatorProjection;case"webMercator":return r.webMercatorProjection;case"sphere":return r.sphereProjection;case"normalizedEquirectangular":return r.normalizedEquirectangularProjection;case"equirectangular":return r.equirectangularProjection;default:throw new Error(`Unknown projection ${e}`)}},t.getProjectionName=function(e){if(e===r.mercatorProjection)return"mercator";if(e===r.webMercatorProjection)return"webMercator";if(e===r.sphereProjection)return"sphere";if(e===r.normalizedEquirectangularProjection)return"normalizedEquirectangular";if(e===r.equirectangularProjection)return"equirectangular";throw new Error("Unknown projection")},t.getFeatureId=function(e){return void 0===e?0:"number"==typeof e?e:e.hasOwnProperty("$id")?e.$id:0},t.getFeatureName=a,t.getFeatureText=function(e,t,i){let r,l;const c=e instanceof n.Env?e:e.env;let h="name";if(s.isTextTechnique(t)||s.isPoiTechnique(t)||s.isLineMarkerTechnique(t)){if(void 0!==t.text)return o.evaluateTechniqueAttr(e,t.text);if(void 0!==t.label&&(h=o.evaluateTechniqueAttr(e,t.label),"string"!=typeof h))return;r=t.useAbbreviation,l=t.useIsoCode}return a(c,h,r,l,i)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyMaterial=t.CopyShader=void 0;const r=i(0);t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"};class n extends r.ShaderMaterial{constructor(e){super({name:"CopyMaterial",uniforms:e,vertexShader:t.CopyShader.vertexShader,fragmentShader:t.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!1,blending:r.NoBlending,depthTest:!1,depthWrite:!1})}}t.CopyMaterial=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={atmosphere_common_utils:"\n\n    float conditionalBranchFree(bool condition, float primary, float secondary) {\n        // Interpolate between primary and secondary:\n        // result = secondary * (1 - factor) + primary * factor\n        // where:\n        // factor = float(condition)\n        return mix(secondary, primary, float(condition));\n    }\n\n    vec3 conditionalBranchFree(bool condition, vec3 primary, vec3 secondary) {\n        return mix(secondary, primary, float(condition));\n    }\n    ",atmosphere_vertex_utils:"\n\n    const float RayleighScaleDepth = 0.25;\n\n    struct AtmosphereColor\n    {\n        vec3 mie;\n        vec3 rayleigh;\n    };\n\n    float scale(float cosAngle)\n    {\n        float x = 1.0 - cosAngle;\n        return RayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n    }\n\n    float getNearSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x0 (first point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        // To improve precision instead of simple projection: b = 2.0 * dot(vPos, v3Ray),\n        // we change the equation that gives better results especially around the poles.\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Intersection points distances are defined as follows:\n        // x0 = (-b - sqrt(det)) / 2*a ^ x1 = (-b + sqrt(det)) / 2*a\n        // we search for x0:\n        return 0.5 * (-fB - sqrt(fDet));\n    }\n\n    float getFarSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x1 (second point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Compute second intersection distance:\n        // x1 = (-b + sqrt(det)) / 2*a\n        return 0.5 * (-fB + sqrt(fDet));\n    }\n    ",atmosphere_fragment_utils:"\n\n    // Branch free RGB to HSV conversion.\n    // Based on article:\n    // http://lolengine.net/blog/2013/01/13/fast-rgb-to-hsv\n    // and optimized OpenGL SL algorithm\n    // http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl\n    vec3 rgb2Hsv(vec3 c)\n    {\n        const vec4 RGB_HSV_CONV = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        // Ternary operator may be used explicitly if compiler can use fast conditional move.\n        // vec4 p = c.g < c.b ? vec4(c.bg, RGB_HSV_CONV.wz) : vec4(c.gb, RGB_HSV_CONV.xy);\n        vec4 p = mix(vec4(c.bg, RGB_HSV_CONV.wz), vec4(c.gb, RGB_HSV_CONV.xy), step(c.b, c.g));\n        // vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    // Branch free HSV to RGB conversion\n    vec3 hsv2Rgb(vec3 c)\n    {\n        const vec4 HSV_RGB_CONV = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + HSV_RGB_CONV.xyz) * 6.0 - HSV_RGB_CONV.www);\n        return c.z * mix(HSV_RGB_CONV.xxx, clamp(p - HSV_RGB_CONV.xxx, 0.0, 1.0), c.y);\n    }\n\n    vec3 correctExposure(vec3 rgb, float exposure)\n    {\n        const vec3 fullColor = vec3(1.0);\n        return fullColor - exp(-exposure * rgb);\n    }\n\n    vec3 correctColor(vec3 rgb, vec3 hsvShift)\n    {\n        const float e = 0.0000001;\n        // Convert rgb color to hsv\n        vec3 hsv = rgb2Hsv(rgb);\n        // Shift hue value with angle wrapping\n        hsv.x = mod(hsv.x + hsvShift.x, 1.0);\n        // Shift and clamp saturation\n        hsv.y = clamp(hsv.y + hsvShift.y, 0.0, 1.0);\n        // Change value if it is significant (greater then epsilon)\n        hsv.z = hsv.z > e ? clamp(hsv.z + hsvShift.z, 0.0, 1.0) : 0.0;\n        // Convert shifted hsv back to rgb\n        return hsv2Rgb(hsv);\n    }\n    "}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraMovementDetector=void 0;const r=i(0),n=i(10);t.CameraMovementDetector=class{constructor(e,t,i){this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=i,this.m_lastCameraPos=new r.Vector3,this.m_newCameraPos=new r.Vector3,this.m_throttlingTimerId=void 0,this.m_movementDetectorDeadline=0,this.onDeadlineTimer=()=>{this.m_throttlingTimerId=void 0;const e=performance.now();e>=this.m_movementDetectorDeadline?this.movementFinished():this.startMovementFinishedTimer(e)},void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=300)}checkCameraMoved(e,t){const i=n.MapViewUtils.extractAttitude(e,e.camera),r=e.camera.getWorldPosition(this.m_newCameraPos);if(void 0===this.m_lastAttitude)return this.m_lastCameraPos.copy(r),this.m_lastAttitude=i,!1;const o=!this.m_lastCameraPos.equals(r)||i.yaw!==this.m_lastAttitude.yaw||i.pitch!==this.m_lastAttitude.pitch||i.roll!==this.m_lastAttitude.roll;return o&&(this.m_lastCameraPos.copy(r),this.m_lastAttitude=i),o!==this.m_cameraMovedLastFrame&&(o&&this.movementStarted(),this.m_cameraMovedLastFrame=o),o&&(this.m_movementDetectorDeadline=t+this.m_throttlingTimeout,this.startMovementFinishedTimer(t)),this.m_cameraMovedLastFrame}clear(e){const t=e.camera.getWorldPosition(this.m_newCameraPos);this.m_lastCameraPos.set(t.x,t.y,t.z);const i=n.MapViewUtils.extractAttitude(e,e.camera);this.m_lastAttitude=i}forceMoved(){this.m_lastCameraPos.set(Number.NaN,Number.NaN,Number.NaN)}get cameraIsMoving(){return void 0!==this.m_throttlingTimerId}dispose(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0}get cameraMovedLastFrame(){return!0===this.m_cameraMovedLastFrame}movementStarted(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()}movementFinished(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()}startMovementFinishedTimer(e){if(void 0===this.m_throttlingTimerId){const t=Math.max(0,this.m_movementDetectorDeadline-e);this.m_throttlingTimerId=setTimeout(this.onDeadlineTimer,t)}}removeMovementFinishedTimer(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LodMesh=void 0;const r=i(0);class n extends r.Mesh{constructor(e,t){super(void 0,t),this.geometries=e}set geometries(e){this.m_geometries!==e&&this.disposeGeometries(),this.m_geometries=e,this.geometries&&this.m_geometries.length>0&&(this.geometry=this.m_geometries[0])}get geometries(){return this.m_geometries}setLevelOfDetail(e){this.m_geometries&&0!==this.m_geometries.length&&(e=r.MathUtils.clamp(e,0,this.m_geometries.length-1),this.geometry=this.m_geometries[e])}disposeGeometries(){if(this.m_geometries)for(const e of this.m_geometries)e.dispose();this.geometry.dispose()}}t.LodMesh=n},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(206),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdfTextMaterial=t.GlyphCopyMaterial=t.GlyphClearMaterial=void 0;const r=i(0),n={sdf_attributes:"\n        attribute vec4 position;\n        attribute vec4 uv;\n        attribute vec4 color;\n        attribute vec4 bgColor;\n        ",sdf_varying:"\n        varying vec4 vColor;\n        varying float vWeight;\n        varying vec2 vUv;\n        varying float vRotation;\n        ",sdf_varying_computation:"\n        #if BG_TEXT\n        vColor = bgColor;\n        vWeight = uv.w;\n        #else\n        vColor = color;\n        vWeight = uv.z;\n        #endif\n        vUv = vec2(uv.xy);\n        vRotation = position.w;\n        ",sdf_frag_uniforms:"\n        uniform sampler2D sdfTexture;\n        uniform vec4 sdfParams;\n        ",sdf_sampling_functions:"\n        float median(float r, float g, float b) {\n            return max(min(r, g), min(max(r, g), b));\n        }\n\n        float getDistance(vec2 uvOffset) {\n            vec3 sample = texture2D(sdfTexture, vUv.xy + uvOffset).rgb;\n            #if MSDF\n            return median(sample.r, sample.g, sample.b);\n            #else\n            return sample.r;\n            #endif\n        }\n\n        float getOpacity(vec2 uvOffset, float weight) {\n            vec2 uv = vUv + uvOffset;\n            vec2 rotatedUVs = abs(vec2(\n                cos(vRotation) * uv.x - sin(vRotation) * uv.y,\n                sin(vRotation) * uv.x + cos(vRotation) * uv.y));\n\n            float dx = dFdx(rotatedUVs.x) * sdfParams.x;\n            float dy = dFdy(rotatedUVs.y) * sdfParams.y;\n            float toPixels = sdfParams.w * inversesqrt( dx * dx + dy * dy );\n\n            float dist = getDistance(uvOffset) + min(weight, 0.5 - 1.0 / sdfParams.w) - 0.5;\n            return clamp(dist * toPixels + 0.5, 0.0, 1.0);\n        }\n        "};Object.assign(r.ShaderChunk,n);class o extends r.RawShaderMaterial{constructor(){super({name:"GlyphClearMaterial",vertexShader:"\n    attribute vec2 position;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }",uniforms:{},depthTest:!1,depthWrite:!1})}}t.GlyphClearMaterial=o;class s extends r.RawShaderMaterial{constructor(){super({name:"GlyphCopyMaterial",vertexShader:"\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vUv;\n\n    void main() {\n        vUv = vec3(uv.xy, position.z);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    uniform float pageOffset;\n    uniform sampler2D page0;\n    uniform sampler2D page1;\n    uniform sampler2D page2;\n    uniform sampler2D page3;\n    uniform sampler2D page4;\n    uniform sampler2D page5;\n    uniform sampler2D page6;\n    uniform sampler2D page7;\n\n    varying vec3 vUv;\n\n    void main() {\n        vec4 sample = vec4(0.0);\n        if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n        else if (vUv.z < pageOffset + 1.0) sample = texture2D(page0, vUv.xy);\n        else if (vUv.z < pageOffset + 2.0) sample = texture2D(page1, vUv.xy);\n        else if (vUv.z < pageOffset + 3.0) sample = texture2D(page2, vUv.xy);\n        else if (vUv.z < pageOffset + 4.0) sample = texture2D(page3, vUv.xy);\n        else if (vUv.z < pageOffset + 5.0) sample = texture2D(page4, vUv.xy);\n        else if (vUv.z < pageOffset + 6.0) sample = texture2D(page5, vUv.xy);\n        else if (vUv.z < pageOffset + 7.0) sample = texture2D(page6, vUv.xy);\n        else sample = texture2D(page7, vUv.xy);\n\n        gl_FragColor = sample;\n    }",uniforms:{pageOffset:new r.Uniform(0),page0:new r.Uniform(r.Texture.DEFAULT_IMAGE),page1:new r.Uniform(r.Texture.DEFAULT_IMAGE),page2:new r.Uniform(r.Texture.DEFAULT_IMAGE),page3:new r.Uniform(r.Texture.DEFAULT_IMAGE),page4:new r.Uniform(r.Texture.DEFAULT_IMAGE),page5:new r.Uniform(r.Texture.DEFAULT_IMAGE),page6:new r.Uniform(r.Texture.DEFAULT_IMAGE),page7:new r.Uniform(r.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1})}}t.GlyphCopyMaterial=s;class a extends r.RawShaderMaterial{constructor(e){super({name:"SdfTextMaterial",vertexShader:void 0!==e.vertexSource?e.vertexSource:"\n    #include <sdf_attributes>\n    #include <sdf_varying>\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        #include <sdf_varying_computation>\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",fragmentShader:void 0!==e.fragmentSource?e.fragmentSource:"\n    precision highp float;\n    precision highp int;\n\n    #include <sdf_varying>\n    #include <sdf_frag_uniforms>\n    #include <sdf_sampling_functions>\n\n    void main() {\n        vec4 color = vColor;\n        color.a *= getOpacity(vec2(0.0), vWeight);\n        if (color.a < 0.05) {\n            discard;\n        }\n        gl_FragColor = color;\n    }",uniforms:{sdfTexture:new r.Uniform(e.texture),sdfParams:new r.Uniform(new r.Vector4(e.textureSize.x,e.textureSize.y,e.size,e.distanceRange))},defines:{MSDF:e.isMsdf?1:0,BG_TEXT:e.isBackground?1:0},depthTest:!0,depthWrite:!1,side:r.DoubleSide,transparent:!0}),this.extensions.derivatives=!0}}t.SdfTextMaterial=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBufferObject=void 0;t.TextBufferObject=class{constructor(e,t,i,r,n,o){this.glyphs=e,this.buffer=t,this.bounds=i,this.characterBounds=r,this.textRenderStyle=n,this.textLayoutStyle=o}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSdfTextMaterial=void 0;const r=i(86);t.createSdfTextMaterial=function(e){return new r.SdfTextMaterial({texture:e.fontCatalog.texture,textureSize:e.fontCatalog.textureSize,size:e.fontCatalog.size,distanceRange:e.fontCatalog.distanceRange,isMsdf:"msdf"===e.fontCatalog.type,isBackground:!0===e.isBackground,vertexSource:e.vertexSource,fragmentSource:e.fragmentSource})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(214);Object.defineProperty(t,"MapRenderingManager",{enumerable:!0,get:function(){return r.MapRenderingManager}});var n=i(26);Object.defineProperty(t,"Pass",{enumerable:!0,get:function(){return n.Pass}});var o=i(90);Object.defineProperty(t,"MSAARenderPass",{enumerable:!0,get:function(){return o.MSAARenderPass}}),Object.defineProperty(t,"MSAASampling",{enumerable:!0,get:function(){return o.MSAASampling}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAARenderPass=t.MSAASampling=void 0;const r=i(4),n=i(0),o=i(26);var s;!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(s=t.MSAASampling||(t.MSAASampling={}));let a=(()=>{class e extends o.Pass{constructor(){super(),this.samplingLevel=s.Level_1,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new n.Scene,this.m_quadUniforms=r.CopyShader.uniforms,this.m_quadMaterial=new r.MSAAMaterial(this.m_quadUniforms),this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad)}dispose(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}render(t,i,r,o,s){if(!this.enabled)return;null===this.m_renderTarget&&(this.m_renderTarget=new n.WebGLRenderTarget(s.width,s.height,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;const a=e.OffsetVectors[this.samplingLevel],l=t.getClearColor(),c=void 0!==l?l.getHex():0,h={enabled:null!==r.view&&r.view.enabled,fullWidth:s.width,fullHeight:s.height,x:0,y:0,width:s.width,height:s.height};h.enabled&&null!==r.view&&(h.fullWidth=r.view.fullWidth,h.fullHeight=r.view.fullHeight,h.x=r.view.offsetX,h.y=r.view.offsetY,h.width=r.view.width,h.height=r.view.height);const d=t.getRenderTarget();for(let e=0;e<a.length;e++){const n=a[e];r.setViewOffset(h.fullWidth,h.fullHeight,h.x+n[0]/16,h.y+n[1]/16,h.width,h.height);const s=(e+.5)/a.length-.5,d=1/a.length+s/32;this.m_quadUniforms.opacity.value=d,t.setRenderTarget(this.m_renderTarget),t.clear(),t.render(i,r),t.setRenderTarget(this.renderToScreen?null:o),0===e&&(t.setClearColor(0),t.clear()),t.render(this.m_quadScene,this.m_localCamera),0===e&&void 0!==l&&t.setClearColor(c)}t.setRenderTarget(d),null!==r.view&&(r.view.enabled=h.enabled,r.view.offsetX=h.x,r.view.offsetY=h.y)}setSize(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)}}return e.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],e})();t.MSAARenderPass=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentWorkerSet=t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=t.isLoggingMessage=void 0;const r=i(2),n=i(1),o=i(92),s=i(0),a=n.LoggerManager.instance.create("ConcurrentWorkerSet");function l(e){return e&&"number"==typeof e.level&&e.type===n.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=l;t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=1e4;t.ConcurrentWorkerSet=class{constructor(e){this.m_options=e,this.m_workerChannelLogger=n.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_availableWorkers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_workerRequestQueue=[],this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=(e,t)=>{if(r.WorkerServiceProtocol.isResponseMessage(t.data)){const i=t.data;if(null===i.messageId)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: no messageId`);const r=this.m_requests.get(i.messageId);if(void 0===r)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: invalid messageId`);if(e>=0&&e<this.m_workers.length){const t=this.m_workers[e];this.m_availableWorkers.push(t),this.checkWorkerRequestQueue()}else a.error(`[${this.m_options.scriptUrl}]: onWorkerMessage: invalid workerId`);if(void 0!==i.errorMessage){const e=new Error(i.errorMessage);void 0!==i.errorStack&&(e.stack=i.errorStack),r.resolver(e)}else r.resolver(void 0,i.response)}else if(r.WorkerServiceProtocol.isInitializedMessage(t.data)){const e=this.getReadyPromise(t.data.service);++e.count===this.m_workerPromises.length&&e.resolve()}else if(l(t.data))switch(t.data.level){case n.LogLevel.Trace:this.m_workerChannelLogger.trace(...t.data.message);break;case n.LogLevel.Debug:this.m_workerChannelLogger.debug(...t.data.message);break;case n.LogLevel.Log:this.m_workerChannelLogger.log(...t.data.message);break;case n.LogLevel.Info:this.m_workerChannelLogger.info(...t.data.message);break;case n.LogLevel.Warn:this.m_workerChannelLogger.warn(...t.data.message);break;case n.LogLevel.Error:this.m_workerChannelLogger.error(...t.data.message)}else this.eventHandler(t)},this.start()}addReference(){this.m_referenceCount+=1,1===this.m_referenceCount&&this.m_stopped&&this.start()}removeReference(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()}start(e){if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");this.m_workerCount=n.getOptionValue(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?s.MathUtils.clamp(navigator.hardwareConcurrency-1,1,2):void 0,2);const i=n.getOptionValue(this.m_options.workerConnectionTimeout,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT);for(let e=0;e<this.m_workerCount;++e){const t=o.WorkerLoader.startWorker(this.m_options.scriptUrl,i).then(t=>{const i=t=>{this.onWorkerMessage(e,t)};return t.addEventListener("message",i),this.m_workers.push(t),this.m_availableWorkers.push(t),{worker:t,listener:i}});this.m_workerPromises.push(t)}this.m_stopped=!1}get workerCount(){return this.m_workerCount}async stop(){this.m_stopped=!0,await this.waitForAllResponses().then(()=>{this.terminateWorkers()})}destroy(){this.m_stopped=!0,this.m_requests.forEach(e=>{e.resolver(new Error("worker destroyed"))}),this.m_requests.clear(),this.m_workerRequestQueue=[],this.terminateWorkers(),this.m_eventListeners.clear()}async connect(e){return this.ensureStarted(),await Promise.all(this.m_workerPromises),this.getReadyPromise(e).promise}addEventListener(e,t){this.m_eventListeners.set(e,t)}removeEventListener(e){this.m_eventListeners.delete(e)}invokeRequest(e,t,i,n){this.ensureStarted();const o=this.m_nextMessageId++;let s;const a=new Promise((e,t)=>{s=(i,r)=>{this.m_requests.delete(o),void 0!==i?t(i):e(r)}});this.m_requests.set(o,{promise:a,resolver:s});const l={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:o,request:t};return this.postRequestMessage(l,i,n),a}broadcastRequest(e,t,i){this.ensureStarted();const n=[];for(const o of this.m_workers){const s=this.m_nextMessageId++;let a;const l=new Promise((e,t)=>{a=(i,r)=>{this.m_requests.delete(s),void 0!==i?t(i):e(r)}});n.push(l),this.m_requests.set(s,{promise:l,resolver:a});const c={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:s,request:t};void 0!==i?o.postMessage(c,i):o.postMessage(c)}return Promise.all(n)}broadcastMessage(e,t){this.ensureStarted(),void 0!==t?this.m_workers.forEach(i=>i.postMessage(e,t)):this.m_workers.forEach(t=>t.postMessage(e))}get requestQueueSize(){return this.m_workerRequestQueue.length}get numWorkers(){return this.m_workers.length}get numIdleWorkers(){return this.m_availableWorkers.length}eventHandler(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)}postRequestMessage(e,t,i){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");if(void 0!==i&&i.signal.aborted){const t=this.m_requests.get(e.messageId);if(void 0===t)return void a.error(`[${this.m_options.scriptUrl}]: Bad RequestMessage: invalid messageId`);const i=new Error("Aborted");return i.name="AbortError",void t.resolver(i,void 0)}if(this.m_availableWorkers.length>0){const i=this.m_availableWorkers.pop();void 0!==t?i.postMessage(e,t):i.postMessage(e)}else void 0===i&&(i=new r.RequestController(0)),0===i.priority&&(i.priority=-this.m_nextMessageId),this.m_workerRequestQueue.unshift({message:e,buffers:t,requestController:i})}ensureStarted(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")}async waitForAllResponses(){const e=new Array;this.m_requests.forEach(t=>{e.push(t.promise)}),await Promise.all(e)}dispatchEvent(e,t){const i=this.m_eventListeners.get(e);void 0!==i&&i(t)}terminateWorkers(){this.m_workerPromises.forEach(e=>{e.then(e=>{void 0!==e&&(e.worker.removeEventListener("message",e.listener),e.worker.terminate())})}),this.m_workers=[],this.m_workerPromises=[],this.m_availableWorkers=[],this.m_readyPromises.clear()}getReadyPromise(e){const t=this.m_readyPromises.get(e);if(void 0!==t)return t;const i={count:0,promise:void 0,resolve:()=>{},reject:e=>{i.error=e},error:void 0};return i.promise=new Promise((e,t)=>{const r=i;void 0!==r.error?t(r.error):r.count===this.m_workerPromises.length&&e(),r.resolve=e,r.reject=t}),this.m_readyPromises.set(e,i),i}checkWorkerRequestQueue(){if(0!==this.m_workerRequestQueue.length&&0!==this.m_availableWorkers.length)for(this.m_workerRequestQueue.sort((e,t)=>e.requestController.priority-t.requestController.priority);this.m_availableWorkers.length>0&&this.m_workerRequestQueue.length>0;){const e=this.m_workerRequestQueue.pop();this.postRequestMessage(e.message,e.buffers,e.requestController)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerLoader=void 0,i(11);const r=i(1),n=i(218),o=r.LoggerManager.instance.create("WorkerLoader");let s=(()=>{class e{static startWorker(t,i=1e4){return t.startsWith("blob:")?this.startWorkerImmediately(t,i):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(t,i):this.startWorkerImmediately(t,i).catch(n=>{if("undefined"!=typeof window){const s=window.location.href,a=new URL(t,s).href;if(r.getUrlOrigin(a)===r.getUrlOrigin(s))throw n;return o.log("#startWorker: cross-origin worker construction failed, trying load with blob"),this.directlyFallbackToBlobBasedLoading=!0,e.startWorkerBlob(t,i)}throw n})}static startWorkerImmediately(e,t){try{const i=new Worker(e);return this.waitWorkerInitialized(i,t)}catch(e){return Promise.reject(e)}}static startWorkerBlob(e,t){return this.fetchScriptSourceToBlobUrl(e).then(e=>this.startWorkerImmediately(e,t))}static fetchScriptSourceToBlobUrl(e){let t=this.sourceLoaderCache.get(e);return void 0!==t||(t=fetch(e).then(e=>e.text()).catch(e=>{throw new Error(`WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: ${e}`)}).then(t=>{this.sourceLoaderCache.delete(e);const i=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(i)}),this.sourceLoaderCache.set(e,t)),t}static waitWorkerInitialized(e,t){return new Promise((i,r)=>{const o=t=>{const o=t.data;if(n.isWorkerBootstrapRequest(o)){const t=o.dependencies,i=[];for(const e of t){const t=this.dependencyUrlMapping[e];if(!t)return a(),void r(new Error(`#waitWorkerInitialized: Unable to resolve '${e}'`+" as needed by worker script."));i.push(t)}const n={type:"worker-bootstrap-response",resolvedDependencies:i};e.postMessage(n)}else a(),i(e),setTimeout(()=>{e.dispatchEvent(t)},0)},s=e=>{a();let t="Error during worker initialization";e.message&&(t+=`: ${e.message}`),"string"==typeof e.filename&&"number"==typeof e.lineno&&(t+=` in ${e.filename}:${e.lineno}`),r(new Error(t))},a=()=>{clearTimeout(l),e.removeEventListener("message",o),e.removeEventListener("error",s)};e.addEventListener("error",s),e.addEventListener("message",o);const l=setTimeout(()=>{a(),r(new Error("Timeout exceeded when waiting for first message from worker."))},t)})}}return e.directlyFallbackToBlobBasedLoading=!1,e.sourceLoaderCache=new Map,e.dependencyUrlMapping={},e})();t.WorkerLoader=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedDecoder=void 0;const r=i(2);let n=0;t.WorkerBasedDecoder=class{constructor(e,t){this.workerSet=e,this.decoderServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.decoderServiceType}-${n++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch(()=>{}),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.decoderServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}decodeTile(e,t,i,n){const o=t.mortonCode(),s={type:r.WorkerDecoderProtocol.Requests.DecodeTileRequest,tileKey:o,data:e,projection:r.getProjectionName(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,s,a,n)}getTileInfo(e,t,i,n){const o=t.mortonCode(),s={type:r.WorkerDecoderProtocol.Requests.TileInfoRequest,tileKey:o,data:e,projection:r.getProjectionName(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,s,a,n)}configure(e,t,i,n){const o={service:this.serviceId,type:r.WorkerDecoderProtocol.DecoderMessageName.Configuration,styleSet:e,definitions:t,options:n,languages:i};this.workerSet.broadcastMessage(o)}get workerCount(){return this.workerSet.workerCount}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentTilerFacade=void 0;const r=i(91),n=i(95);let o=(()=>{class e{static getTiler(e,t,i){const r=this.getWorkerSet(t,i);return new n.WorkerBasedTiler(r,e)}static getWorkerSet(e,t){void 0===e&&(e=this.defaultScriptUrl);let i=this.workerSets[e];return void 0===i&&(i=new r.ConcurrentWorkerSet({scriptUrl:e,workerCount:void 0===t?this.defaultWorkerCount:t}),this.workerSets[e]=i),i}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach(e=>{this.workerSets[e].destroy()}),this.workerSets={}}}return e.defaultScriptUrl="./decoder.bundle.js",e.defaultWorkerCount=1,e.workerSets={},e})();t.ConcurrentTilerFacade=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedTiler=void 0;const r=i(2);let n=0;t.WorkerBasedTiler=class{constructor(e,t){this.workerSet=e,this.tilerServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.tilerServiceType}-${n++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch(()=>{}),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.tilerServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}registerIndex(e,t){const i={type:r.WorkerTilerProtocol.Requests.RegisterIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}updateIndex(e,t){const i={type:r.WorkerTilerProtocol.Requests.UpdateIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}getTile(e,t){const i=t.mortonCode(),n={type:r.WorkerTilerProtocol.Requests.TileRequest,index:e,tileKey:i};return this.workerSet.invokeRequest(this.serviceId,n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundDataSource=void 0;const r=i(3),n=i(53),o=i(54),s=i(36);let a=(()=>{class e extends n.DataSource{constructor(){super({name:"background"}),this.m_tilingScheme=e.DEFAULT_TILING_SCHEME,this.cacheable=!0,this.addGroundPlane=!0}updateStorageLevelOffset(){let e;this.mapView.dataSources.forEach(t=>{if(t===this)return;t.getTilingScheme()===this.m_tilingScheme&&(e=void 0===e?t.storageLevelOffset:Math.max(e,t.storageLevelOffset))}),void 0===e&&(e=0),e!==this.storageLevelOffset&&(this.storageLevelOffset=e,this.mapView.clearTileCache(this.name))}setTheme(e,t){this.mapView.clearTileCache(this.name)}setTilingScheme(t){const i=t||e.DEFAULT_TILING_SCHEME;i!==this.m_tilingScheme&&(this.m_tilingScheme=i,this.updateStorageLevelOffset(),this.mapView.clearTileCache(this.name))}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new s.Tile(this,e);return t.forceHasGeometry(!0),t.removeDecodedTile(),o.TileGeometryCreator.instance.addGroundPlane(t,Number.MIN_SAFE_INTEGER),t}}return e.DEFAULT_TILING_SCHEME=r.webMercatorTilingScheme,e})();t.BackgroundDataSource=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprPool=void 0;const r=i(5);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_arrayLiterals=[],this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_matchExprs=[],this.m_caseExprs=[],this.m_interpolateExprs=[],this.m_stepExprs=[],this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return r.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){const i=this.m_booleanLiterals.get(e.value);return i||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){const i=this.m_numberLiterals.get(e.value);return i||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){const i=this.m_stringLiterals.get(e.value);return i||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const i=this.m_objectLiterals.get(e.value);if(i)return i;if(Array.isArray(e.value)){const t=e.value,i=this.m_arrayLiterals.find(e=>{const i=e.value;return i.length===t.length&&t.every((e,t)=>e===i[t])});if(void 0!==i)return i;this.m_arrayLiterals.push(e)}return this.m_objectLiterals.set(e.value,e),e}visitVarExpr(e,t){const i=this.m_varExprs.get(e.name);return i||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){const i=this.m_hasAttributeExprs.get(e.name);return i||(this.m_hasAttributeExprs.set(e.name,e),e)}visitMatchExpr(e,t){const i=e.value.accept(this,t),n=e.branches.map(([e,i])=>[e,i.accept(this,t)]),o=e.fallback.accept(this,t);for(const e of this.m_matchExprs){if(e.value!==i)continue;if(e.fallback!==o)continue;if(e.branches.length!==n.length)continue;let t=!0;for(let i=0;i<n.length;i++)if(n[i][0]!==e.branches[i][0]||n[i][1]!==e.branches[i][1]){t=!1;break}if(t)return e}const s=new r.MatchExpr(i,n,o);return this.m_matchExprs.push(s),s}visitCaseExpr(e,t){const i=e.branches.map(([e,i])=>[e.accept(this,t),i.accept(this,t)]),n=e.fallback.accept(this,t);for(const e of this.m_caseExprs){if(e.fallback!==n)continue;if(e.branches.length!==i.length)continue;let t=!0;for(let r=0;r<i.length;r++)if(i[r][0]!==e.branches[r][0]||i[r][1]!==e.branches[r][1]){t=!1;break}if(t)return e}const o=new r.CaseExpr(i,n);return this.m_caseExprs.push(o),o}visitCallExpr(e,t){const i=e.args.map(e=>e.accept(this,t));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const n=this.m_callExprs.get(e.op);for(const e of n){if(e.args.length!==i.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===i[t];++t);if(t===e.args.length)return e}const o=new r.CallExpr(e.op,i);return o.descriptor=e.descriptor,n.push(o),o}visitStepExpr(e,t){if(this.m_stepExprs.includes(e))return e;const i=e.input.accept(this,t),n=e.defaultValue.accept(this,t),o=e.stops.map(e=>{const i=e[0],r=e[1].accept(this,t);return r===e[1]?e:[i,r]});for(const e of this.m_stepExprs)if(e.input===i&&e.defaultValue===n&&o.length===e.stops.length&&o.every(([t,i],r)=>t===e.stops[r][0]&&i===e.stops[r][1]))return e;const s=new r.StepExpr(i,n,o);return this.m_stepExprs.push(s),s}visitInterpolateExpr(e,t){if(this.m_interpolateExprs.includes(e))return e;const i=e.input.accept(this,t),n=e.stops.map(e=>{const i=e[0],r=e[1].accept(this,t);return r===e[1]?e:[i,r]});for(const t of this.m_interpolateExprs)if(t.input===i&&t.mode[0]===e.mode[0]&&t.mode[1]===e.mode[1]&&n.length===t.stops.length&&n.every(([e,i],r)=>e===t.stops[r][0]&&i===t.stops[r][1]))return t;const o=new r.InterpolateExpr(e.mode,i,n);return this.m_interpolateExprs.push(o),o}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubdivisionModifier=void 0;const r=i(0),n=new r.Vector3,o=new r.Vector3,s=new r.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute("position"),i=Array.from(t.array),r=e.getAttribute("uv"),a=void 0!==r?Array.from(r.array):void 0,l=e.getAttribute("edge"),c=void 0!==l?Array.from(l.array):void 0,h=e.getAttribute("wall"),d=void 0!==h?Array.from(h.array):void 0,u=e.getIndex(),m=Array.from(u.array),p=new Map;function f(e,t){const r=`${Math.min(e,t)}_${Math.max(e,t)}`,l=p.get(r);if(void 0!==l)return l;n.set(i[3*e],i[3*e+1],i[3*e+2]),o.set(i[3*t],i[3*t+1],i[3*t+2]),s.lerpVectors(n,o,.5);const h=i.length/3;return i.push(...s.toArray()),p.set(r,h),void 0!==a&&(n.set(a[2*e],a[2*e+1],0),o.set(a[2*t],a[2*t+1],0),s.lerpVectors(n,o,.5),a.push(s.x,s.y)),void 0!==c&&(c[e]===t?(c.push(t),c[e]=h):c[t]===e?(c.push(e),c[t]=h):c.push(-1)),void 0!==d&&(d[e]===t?(d.push(t),d[e]=h):d[t]===e?(d.push(e),d[t]=h):d.push(-1)),h}const g=[];for(;m.length>=3;){const e=m.shift(),t=m.shift(),r=m.shift();switch(n.set(i[3*e],i[3*e+1],i[3*e+2]),o.set(i[3*t],i[3*t+1],i[3*t+2]),s.set(i[3*r],i[3*r+1],i[3*r+2]),this.shouldSplitTriangle(n,o,s)){case 0:{const i=f(e,t);m.push(e,i,r,i,t,r);break}case 1:{const i=f(t,r);m.push(e,t,i,e,i,r);break}case 2:{const i=f(r,e);m.push(e,t,i,i,t,r);break}case void 0:g.push(e,t,r);break;default:throw new Error("failed to subdivide the given geometry")}}return t.array=new Float32Array(i),t.count=i.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(r.array=new Float32Array(a),r.count=a.length/r.itemSize,r.needsUpdate=!0),void 0!==c&&(l.array=new Float32Array(c),l.count=c.length/l.itemSize,l.needsUpdate=!0),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferAttribute=void 0;const r=i(1),n=i(0),o=i(223);let s=(()=>{class e extends n.BufferAttribute{constructor(t,i,r,s){super(t.array,t.itemSize,t.normalized),this.originalAttribute=t,this.m_normals=i,this.m_uvs=r,this.m_textureWidth=0,this.m_textureHeight=0,this.m_cache=new o.VertexCache(e.MAX_CACHE_SIZE),this.m_lastPos=new n.Vector3,this.m_tmpNormal=new n.Vector3,this.resetTexture(s)}reset(e,t,i,r){this.array=e.array,this.itemSize=e.itemSize,this.count=this.array.length/this.itemSize,this.normalized=e.normalized,this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_cache.clear(),this.m_lastBufferIndex=void 0,this.resetTexture(r)}getX(e){return this.getDisplacedCoordinate(e).x}getY(e){return this.getDisplacedCoordinate(e).y}getZ(e){return this.getDisplacedCoordinate(e).z}resetTexture(e){this.m_texture=new Float32Array(e.image.data.buffer),this.m_textureWidth=e.image.width,this.m_textureHeight=e.image.height}getDisplacedCoordinate(e){return e===this.m_lastBufferIndex?this.m_lastPos:(this.m_lastBufferIndex=e,this.m_cache.get(e,this.m_lastPos)||(this.displacePosition(e),this.m_cache.set(e,this.m_lastPos)),this.m_lastPos)}displacePosition(e){this.m_lastPos.fromBufferAttribute(this.originalAttribute,e);const t=this.m_normals;this.m_tmpNormal.fromBufferAttribute(t,e);const i=this.m_uvs,o=n.MathUtils.clamp(i.getX(e),0,1),s=n.MathUtils.clamp(i.getY(e),0,1),a=r.sampleBilinear(this.m_texture,this.m_textureWidth,this.m_textureHeight,o,s);this.m_lastPos.add(this.m_tmpNormal.multiplyScalar(a))}}return e.MAX_CACHE_SIZE=6,e})();t.DisplacedBufferAttribute=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferGeometry=t.displaceBox=void 0;const r=i(0),n=i(99),o=new r.Vector3,s=new r.Vector3,a=new r.Box3;function l(e,t,i){a.copy(e);const r=o.copy(i),n=s.copy(r);return e.translate(r.multiplyScalar(t.min)).union(a.translate(n.multiplyScalar(t.max))),e}t.displaceBox=l;class c extends r.BufferGeometry{constructor(e,t,i,o){super(),this.originalGeometry=e,this.displacementRange=i,this.m_originalBoundingBox=new r.Box3,this.m_displacedPositions=o||new n.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),this.resetAttributes()}reset(e,t,i){this.originalGeometry=e;const r=e.attributes.position,n=e.attributes.normal,o=e.attributes.uv;this.m_displacedPositions.reset(r,n,o,t);const s=this.displacementRange.min!==i.min||this.displacementRange.max!==i.max;this.displacementRange=i,this.resetAttributes(),this.resetBoundingVolumes(s)}computeBoundingBox(){null===this.originalGeometry.boundingBox&&this.originalGeometry.computeBoundingBox();const e=this.m_originalBoundingBox.copy(this.originalGeometry.boundingBox);null===this.boundingBox?this.boundingBox=e.clone():this.boundingBox.copy(e),l(this.boundingBox,this.displacementRange,o.fromBufferAttribute(this.attributes.normal,0))}computeBoundingSphere(){null===this.boundingBox&&this.computeBoundingBox(),null===this.boundingSphere&&(this.boundingSphere=new r.Sphere),this.boundingBox.getBoundingSphere(this.boundingSphere)}needsBoundingBoxUpdate(e){return e||null!==this.boundingBox&&(!this.originalGeometry.boundingBox||!this.m_originalBoundingBox.equals(this.originalGeometry.boundingBox))}resetBoundingVolumes(e){this.needsBoundingBoxUpdate(e)&&(this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere())}resetAttributes(){this.index=this.originalGeometry.index,this.groups=this.originalGeometry.groups,this.drawRange=this.originalGeometry.drawRange,this.attributes=Object.assign({},this.originalGeometry.attributes),this.attributes.position=this.m_displacedPositions}}t.DisplacedBufferGeometry=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLight=t.toTextureFilter=t.toWrappingMode=t.toTextureDataType=t.toPixelFormat=void 0;const r=i(0);t.toPixelFormat=function(e){switch(e){case"Alpha":return r.AlphaFormat;case"RGB":return r.RGBFormat;case"RGBA":return r.RGBAFormat;case"Luminance":return r.LuminanceFormat;case"LuminanceAlpha":return r.LuminanceAlphaFormat;case"RGBE":return r.RGBEFormat;case"Depth":return r.DepthFormat;case"DepthStencil":return r.DepthStencilFormat;case"Red":return r.RedFormat;default:throw new Error(`invalid pixel format: ${e}`)}},t.toTextureDataType=function(e){switch(e){case"UnsignedByte":return r.UnsignedByteType;case"Byte":return r.ByteType;case"Short":return r.ShortType;case"UnsignedShort":return r.UnsignedShortType;case"Int":return r.IntType;case"UnsignedInt":return r.UnsignedIntType;case"Float":return r.FloatType;case"HalfFloat":return r.HalfFloatType;default:throw new Error(`invalid texture data type: ${e}`)}},t.toWrappingMode=function(e){switch(e){case"clamp":return r.ClampToEdgeWrapping;case"repeat":return r.RepeatWrapping;case"mirror":return r.MirroredRepeatWrapping;default:throw new Error(`invalid wrapping mode: ${e}`)}},t.toTextureFilter=function(e){switch(e){case"nearest":return r.NearestFilter;case"nearestMipMapNearest":return r.NearestMipMapNearestFilter;case"nearestMipMapLinear":return r.NearestMipMapLinearFilter;case"linear":return r.LinearFilter;case"linearMipMapNearest":return r.LinearMipMapNearestFilter;case"linearMipMapLinear":return r.LinearMipMapLinearFilter;default:throw new Error(`invalid texture filter: ${e}`)}},t.createLight=function(e){switch(e.type){case"ambient":{const t=new r.AmbientLight(e.color,e.intensity);return t.name=e.name,t}case"directional":{const t=new r.DirectionalLight(e.color,e.intensity);return t.name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.castShadow&&(t.shadow.bias=1e-5,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024),t.position.set(e.direction.x,e.direction.y,e.direction.z),t.position.normalize(),t}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setDepthPrePassStencil=t.createDepthPrePassMesh=t.createDepthPrePassMaterial=t.isRenderDepthPrePassEnabled=t.DEPTH_PRE_PASS_STENCIL_MASK=void 0;const r=i(0),n=i(23),o=i(4),s=i(19);t.DEPTH_PRE_PASS_STENCIL_MASK=1;function a(e){e.depthWrite=!1,e.depthFunc=r.EqualDepth,e.colorWrite=!0,o.enforceBlending(e);const t=e.clone();return t.isDepthPrepassMaterial=!0,t.depthWrite=!0,t.depthTest=!0,t.depthFunc=r.LessDepth,t.colorWrite=!1,t.opacity=1,t.blending=r.NoBlending,t}t.isRenderDepthPrePassEnabled=function(e,t){if(!1===e.enableDepthPrePass)return!1;let i=void 0!==e.opacity&&e.opacity>0&&e.opacity<1;if(!i){const r=s.evaluateBaseColorProperty(e,t);if(void 0!==r){const e=n.ColorUtils.getAlphaFromHex(r);i=e>0&&e<1}}return i},t.createDepthPrePassMaterial=a,t.createDepthPrePassMesh=function(e){const t=e.geometry;if(!(t instanceof r.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");const i=t.getAttribute("position");if(!i)throw new Error("#createDepthPassMesh position attribute not found");const n=new r.BufferGeometry;n.setAttribute("position",i);const o=t.getAttribute("uv");o&&n.setAttribute("uv",o);const s=t.getAttribute("normal");s&&n.setAttribute("normal",s);const l=t.getAttribute("extrusionAxis");l&&n.setAttribute("extrusionAxis",l),t.index&&n.setIndex(t.index);for(const e of t.groups){const{start:t,count:i,materialIndex:r}=e;n.addGroup(t,i,r)}const c=e.material instanceof Array?e.material.map(a):a(e.material),h=new r.Mesh(n,c);return h.renderOrder=e.renderOrder-1e-6,h},t.setDepthPrePassStencil=function(e,i){const n=e.material;n.stencilWrite=!0,n.stencilFail=r.KeepStencilOp,n.stencilZFail=r.KeepStencilOp,n.stencilZPass=r.ReplaceStencilOp,n.stencilFunc=r.AlwaysStencilFunc,n.stencilRef=255,n.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK;const o=i.material;o.stencilWrite=!0,o.stencilFail=r.KeepStencilOp,o.stencilZFail=r.KeepStencilOp,o.stencilZPass=r.ZeroStencilOp,o.stencilFunc=r.EqualStencilFunc,o.stencilRef=255,o.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overlayOnElevation=t.overlayTextElement=void 0;const r=i(2),n=i(4),o=i(1);function s(e,t){if(!("material"in e))return;const i=e.material;Array.isArray(i)?i.forEach(e=>{n.hasDisplacementFeature(e)&&(e.displacementMap=t)}):i&&n.hasDisplacementFeature(i)&&(i.displacementMap=t)}function a(e,t,i,r){const n=r.unprojectPoint(e);if(i.geoBox.contains(n))n.altitude=t.sampleHeight(n,i);else if(n.altitude=t.getHeight(n,i.tileKey.level),void 0===n.altitude)return!1;return r.projectPoint(n,e),!0}t.overlayTextElement=function(e,t,i,r){o.assert(!e.elevated),i&&(e.elevated=e.path?function(e,t,i,r){for(const n of e)if(!a(n,t,i,r))return!1;return!0}(e.path,t,i,r):a(e.position,t,i,r))},t.overlayOnElevation=function(e){const t=e.mapView.elevationProvider;if(void 0===t||0===e.objects.length)return;const i=e.objects[0];if(!i.userData||!i.userData.kind||!i.userData.kind.find(e=>e!==r.GeometryKind.All&&e!==r.GeometryKind.Terrain))return;const n=t.getDisplacementMap(e.tileKey);if(void 0!==n)for(const t of e.objects)s(t,n.texture)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorldPosition=t.isPathLabelTooSmall=t.placePathLabel=t.placePointLabel=t.placeIcon=t.PlacementResult=t.newPointLabelTextMarginPercent=t.persistentPointLabelTextMargin=t.checkReadyForPlacement=t.PrePlacementResult=t.getMaxViewDistance=t.pointToPlaneDistance=t.computeViewDistance=void 0;const r=i(2),n=i(3),o=i(6),s=i(1),a=i(0),l=i(105),c=i(107),h=i(17),d=i(25),u=new a.Vector3(0,0,0),m=new a.Vector3(0,0,0),p=new a.Vector3(0,0,0);function f(e,t,i){let r;const n=e.path;if(n&&n.length>1){const e=g(n[0],t,i),o=g(n[n.length-1],t,i);r=Math.min(e,o)}else r=g(e.position,t,i);return r}function g(e,t,i){return p.copy(e).sub(t).dot(i)}var v;t.computeViewDistance=f,t.pointToPlaneDistance=g,t.getMaxViewDistance=function(e,t){return e.maxVisibilityDist*t},function(e){e[e.Ok=0]="Ok",e[e.NotReady=1]="NotReady",e[e.Invisible=2]="Invisible",e[e.TooFar=3]="TooFar",e[e.Duplicate=4]="Duplicate",e[e.Count=5]="Count"}(v=t.PrePlacementResult||(t.PrePlacementResult={}));const y=new a.Vector3,_=new a.Box2;t.checkReadyForPlacement=function(e,t,i,r,o){let a;return e.visible?r.updatePoiFromPoiTable(e)?e.visible&&s.MathUtils.isClamped(t.zoomLevel,e.minZoomLevel,e.maxZoomLevel)?(a=void 0===o?f(e,t.worldCenter,t.lookAtVector):function(e,t,i,r,o){const s=f(e,t,i);return r!==n.ProjectionType.Spherical?s<=o?s:void 0:(u.copy(e.position).normalize(),m.copy(t).normalize(),u.dot(m)>.5877852522924731&&s<=o?s:void 0)}(e,t.worldCenter,t.lookAtVector,t.projection.type,o),void 0===a?{result:v.TooFar,viewDistance:a}:{result:v.Ok,viewDistance:a}):{result:v.Invisible,viewDistance:a}:{result:v.NotReady,viewDistance:a}:{result:v.Invisible,viewDistance:a}};const x=new a.Box2,S=[],b={},T=[],w=new c.CollisionBox,M=new a.Vector2,E=new a.Vector2,P=new s.Math2D.Box,C=new a.Vector2,A=new a.Vector2;var L;function R(e,i,n,l,c,u,m,p,f,g){const v=e.element;s.assert(void 0!==v.glyphs),s.assert(void 0!==v.layoutStyle);const y=void 0===v.bounds||f;void 0===v.bounds&&(v.bounds=new a.Box2),D(c,n),y&&(b.outputCharacterBounds=void 0,b.path=void 0,b.pathOverflow=!1,b.letterCaseArray=v.glyphCaseArray,c.measureText(v.glyphs,v.bounds,b),v.bounds.expandByVector(t.persistentPointLabelTextMargin));const _=function(e,t,i,n,l=new a.Vector2){switch(s.assert(e.type===d.TextElementType.PoiLabel),s.assert(void 0!==e.layoutStyle),s.assert(void 0!==e.bounds),l.x=e.xOffset,l.y=e.yOffset,t.h){case o.HorizontalPlacement.Left:l.x-=e.bounds.max.x;break;case o.HorizontalPlacement.Right:l.x-=e.bounds.min.x}switch(t.v){case o.VerticalPlacement.Top:l.y-=e.bounds.min.y;break;case o.VerticalPlacement.Center:l.y-=.5*(e.bounds.max.y+e.bounds.min.y);break;case o.VerticalPlacement.Bottom:l.y-=e.bounds.max.y}if(void 0!==e.poiInfo&&h.poiIsRenderable(e.poiInfo)){s.assert(void 0!==e.poiInfo.computedWidth),s.assert(void 0!==e.poiInfo.computedHeight),l.x+=e.poiInfo.computedWidth*(.5+t.h),l.y+=e.poiInfo.computedHeight*(.5+t.v);const i=o.hPlacementFromAlignment(e.layoutStyle.horizontalAlignment),a=o.vPlacementFromAlignment(e.layoutStyle.verticalAlignment);if(i!==t.h||a!==t.v){const s=e.poiInfo.technique;let c=r.getPropertyValue(s.iconXOffset,n),h=r.getPropertyValue(s.iconYOffset,n);c="number"==typeof c?c:0,h="number"==typeof h?h:0;const d=i-t.h,u=a-t.v,m=c-e.xOffset,p=h-e.yOffset;i===o.HorizontalPlacement.Center||a===o.VerticalPlacement.Center?(l.x+=2*Math.abs(d)*m,l.y-=2*u*Math.abs(m),l.y+=2*Math.abs(u)*p,l.x-=2*d*Math.abs(p)):(l.x+=2*Math.min(Math.abs(d),.5)*m,l.y-=2*Math.sign(u)*Math.min(Math.abs(u),.5)*Math.abs(m),l.y+=2*Math.min(Math.abs(u),.5)*p,l.x-=2*Math.sign(d)*Math.min(Math.abs(d),.5)*Math.abs(p))}}return l.multiplyScalar(i),l}(v,n,l,u,E);if(_.add(i),x.copy(v.bounds),x.translate(_),x.getCenter(C),x.getSize(A),A.multiplyScalar(l),P.set(C.x-A.x/2,C.y-A.y/2,A.x,A.y),g.set(_.x,_.y,e.renderDistance),!m.isVisible(P))return L.Invisible;const S=e.visible;return p?S?L.Rejected:L.Invisible:(y&&(x.getSize(A),A.multiplyScalar(l*(1+t.newPointLabelTextMarginPercent)),P.set(C.x-A.x/2,C.y-A.y/2,A.x,A.y)),!v.textMayOverlap&&m.isAllocated(P)?S?L.Rejected:L.Invisible:(v.textReservesSpace&&m.allocate(P),y&&(v.textBufferObject=void 0),e.textPlacement=n,L.Ok))}function D(e,t){e.textLayoutStyle.horizontalAlignment=o.hAlignFromPlacement(t.h),e.textLayoutStyle.verticalAlignment=o.vAlignFromPlacement(t.v)}t.persistentPointLabelTextMargin=new a.Vector2(2,2),t.newPointLabelTextMarginPercent=.1,function(e){e[e.Ok=0]="Ok",e[e.Rejected=1]="Rejected",e[e.Invisible=2]="Invisible"}(L=t.PlacementResult||(t.PlacementResult={})),t.placeIcon=function(e,t,i,r,n,o){return l.PoiRenderer.computeIconScreenBox(t,i,r,n,P),o.isVisible(P)?!0===t.mayOverlap||!o.isAllocated(P)?L.Ok:e.isVisible()?L.Rejected:L.Invisible:L.Invisible},t.placePointLabel=function(e,t,i,r,n,o,a,l,c=!1){s.assert(void 0!==e.element.layoutStyle);const h=e.element.layoutStyle,d=!e.visible;return a&&d?L.Invisible:!(c=c&&void 0!==h.placements&&h.placements.length>1)||a?function(e,t,i,r,n,o,a,l){s.assert(void 0!==e.element.layoutStyle);const c=e.textPlacement;return R(e,t,c,i,r,n,o,a,!e.visible,l)}(e,t,i,r,n,o,a,l):function(e,t,i,r,n,o,a){s.assert(void 0!==e.element.layoutStyle);const l=e.element,c=e.visible,h=e.textPlacement,d=l.layoutStyle.placements,u=d.length,m=d.findIndex(e=>e.h===h.h&&e.v===h.v);s.assert(m>=0);let p=!0;for(let h=m;h<u+m;++h){const f=d[h%u],g=h===m&&c,v=R(e,t,f,i,r,n,o,!1,!g,a);if(g&&(s.assert(void 0!==l.bounds),y.copy(a),_.copy(l.bounds)),v!==L.Invisible&&(p=!1,v!==L.Rejected))return L.Ok}return a.copy(y),l.bounds.copy(_),D(r,h),p?L.Invisible:c?L.Rejected:L.Invisible}(e,t,i,r,n,o,l)},t.placePathLabel=function(e,t,i,r,n){if(b.path=t,b.outputCharacterBounds=S,b.letterCaseArray=e.element.glyphCaseArray,!r.measureText(e.element.glyphs,x,b))return L.Rejected;if(w.copy(x.translate(i)),!n.isVisible(w))return L.Invisible;let o,s=!1;e.element.textMayOverlap||(o=n.search(w),s=o.length>0);const a=!n.isFullyVisible(w);T.length=S.length;for(let e=0;e<S.length;++e){const t=S[e].translate(i);let r=T[e];if(void 0===r?(r=new c.CollisionBox(t),T[e]=r):r.copy(t),a&&!n.isVisible(r))return L.Invisible;if(s&&n.intersectsDetails(r,o))return L.Rejected}if(e.element.textReservesSpace){const e=new c.DetailedCollisionBox(w,T.slice());T.length=0,n.allocate(e)}return L.Ok},t.isPathLabelTooSmall=function(e,t,i){s.assert(e.type===d.TextElementType.PathLabel),i.length=0;let r=!1;for(const n of e.points){void 0!==(r?t.project(n,M):t.projectOnScreen(n,M))&&(r=!0,i.push(M.clone()))}if(!r)return!0;const n=5*e.text.length;return x.setFromPoints(i),x.max.sub(x.min).lengthSq()<n*n&&(e.dbgPathTooSmall=!0,!0)};const O=new n.OrientedBox3;t.getWorldPosition=function(e,t,i,n){var o,s;const l=r.getPropertyValue(null===(s=null===(o=e.poiInfo)||void 0===o?void 0:o.technique)||void 0===s?void 0:s.worldOffset,i);if(null==n||n.copy(e.position),null!=l&&void 0!==e.offsetDirection){t.localTangentSpace(e.position,O);const i=O.yAxis,r=a.MathUtils.degToRad(e.offsetDirection);i.applyAxisAngle(O.zAxis.negate(),r),n.addScaledVector(O.yAxis,l)}return n}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiRenderer=void 0;const r=i(2),n=i(4),o=i(1),s=i(0),a=i(106),l=i(226),c=o.LoggerManager.instance.create("PoiRenderer"),h=new s.Vector3(0),d=new s.Color(1,1,1),u=new s.Color;let m=(()=>{class e{constructor(e,t,i,r){this.mapView=e,this.scene=t,this.imageItem=i,this.renderOrder=r}init(){void 0===this.boxBuffer&&this.setup()}reset(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.reset()}update(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.updateBufferGeometry()}updateMemoryUsage(e){void 0!==this.boxBuffer&&this.boxBuffer.updateMemoryUsage(e)}setup(){const t=new s.Texture(this.imageItem.imageData,s.UVMapping,void 0,void 0,(e.trilinear,s.LinearFilter),e.trilinear?s.LinearMipMapLinearFilter:s.LinearFilter,s.RGBAFormat);e.trilinear&&this.imageItem.mipMaps&&(t.mipmaps=this.imageItem.mipMaps,t.image=t.mipmaps[0]),t.flipY=!1,t.premultiplyAlpha=!0,t.needsUpdate=!0,this.m_material=new n.IconMaterial({map:t}),this.boxBuffer=new l.BoxBuffer(this.m_material,this.renderOrder);const i=this.boxBuffer.mesh;i.frustumCulled=!1,this.scene.add(i),this.mapView.update()}}return e.trilinear=!0,e})();class p{constructor(e,t){this.mapView=e,this.textCanvas=t,this.batches=[],this.m_batchMap=new Map}registerPoi(e){const{imageItem:t,imageTexture:i,imageTextureName:r}=e;if(void 0===t||void 0===r||void 0===i)return-1;const n=e.renderOrder,o=i.image;let s,a,l=this.m_batchMap.get(o);if(void 0===l&&(l=new Map,this.m_batchMap.set(o,l)),s=l.get(n),void 0!==s)return s;s=this.batches.length;let c=this.textCanvas.getLayer(n);return void 0===c&&(this.textCanvas.addText("",h,{layer:n}),c=this.textCanvas.getLayer(n)),a=new m(this.mapView,c.storage.scene,t,n),a.init(),l.set(n,s),this.batches.push(a),s}addPoi(e,t,i,r){const n=void 0!==e.poiRenderBatch&&-1!==e.poiRenderBatch?e.poiRenderBatch:this.registerPoi(e);if(-1===n)return-1;let s;return o.assert(n>=0),o.assert(n<this.batches.length),o.assert(void 0!==e.uvBox),void 0===this.batches[n].boxBuffer&&this.batches[n].init(),void 0!==e.iconBrightness?(s=u.setScalar(e.iconBrightness),void 0!==e.iconColor&&(s=u.multiply(e.iconColor))):s=void 0!==e.iconColor?e.iconColor:d,this.batches[n].boxBuffer.addBox(t,e.uvBox,s,r,i,e.textElement),n}getBatch(e){if(e>=0)return o.assert(e<this.batches.length),this.batches[e]}reset(){for(const e of this.batches)e.reset()}update(){for(const e of this.batches)e.update()}pickTextElements(e,t){for(const i of this.batches)void 0===i.boxBuffer&&i.init(),i.boxBuffer.pickBoxes(e,t,i.imageItem.imageData)}updateMemoryUsage(e){for(const t of this.batches){if(void 0!==t.imageItem.imageData){const i=t.imageItem.imageData.width*t.imageItem.imageData.height*4;e.heapSize+=i,e.gpuSize+=i}void 0!==t.boxBuffer&&t.boxBuffer.updateMemoryUsage(e)}}}let f=(()=>{class e{constructor(e,t){this.mapView=e,this.textCanvas=t,this.m_tempScreenBox=new o.Math2D.Box,this.m_renderBuffer=new p(e,t)}static computeIconScreenBox(e,t,i,n,s=new o.Math2D.Box){o.assert(void 0!==e.poiRenderBatch),o.assert(-1!==e.poiRenderBatch);const a=e.computedWidth*i,l=e.computedHeight*i,c=e.technique,h=r.getPropertyValue(c.iconXOffset,n),d=r.getPropertyValue(c.iconYOffset,n),u=t.x+("number"==typeof h?h:0)*i,m=t.y+("number"==typeof d?d:0)*i;return s.x=u-a/2,s.y=m-l/2,s.w=a,s.h=l,s}prepareRender(e,t){const i=e.poiInfo;return void 0!==i&&(void 0===i.poiRenderBatch&&this.preparePoi(e,t),void 0!==i.poiRenderBatch)}reset(){this.m_renderBuffer.reset()}renderPoi(t,i,r,n,s,a,l,c){o.assert(void 0!==t.poiRenderBatch),e.computeIconScreenBox(t,i,s,c,this.m_tempScreenBox),a&&r.allocate(this.m_tempScreenBox),this.m_renderBuffer.addPoi(t,this.m_tempScreenBox,n,l)}update(){this.m_renderBuffer.update()}pickTextElements(e,t){this.m_renderBuffer.pickTextElements(e,t)}getMemoryUsage(e){this.m_renderBuffer.updateMemoryUsage(e)}preparePoi(t,i){const r=t.poiInfo;if(void 0===r||!t.visible)return;if(void 0!==r.poiRenderBatch||!1===r.isValid)return;if(void 0!==r.poiTableName){if(!this.mapView.poiManager.updatePoiFromPoiTable(t))return;if(!t.visible)return}const n=r.imageTextureName,o=this.mapView.poiManager.getImageTexture(n);if(void 0===o)return void 0===e.m_missingTextureName.get(n)&&(e.m_missingTextureName.set(n,!0),c.error(`preparePoi: No imageTexture with name '${n}' found`)),void(r.isValid=!1);const s=o.image;let a=this.mapView.imageCache.findImageByName(s);if(void 0===a)return c.error(`init: No imageItem found with name '${s}'`),void(r.isValid=!1);if(!a.loaded){if(void 0!==a.loadingPromise)return;const e=a.url,t=this.mapView.imageCache.loadImage(a);if(t instanceof Promise)return void t.then(t=>{void 0!==t?this.setupPoiInfo(r,o,t,i):c.error(`preparePoi: Failed to load imageItem: '${e}`)}).catch(t=>{c.error(`preparePoi: Failed to load imageItem: '${e}`,t),r.isValid=!1});a=t}this.setupPoiInfo(r,o,a,i)}setupPoiInfo(e,t,i,n){if(o.assert(void 0===e.uvBox),void 0===i||void 0===i.imageData)return c.error("setupPoiInfo: No imageItem/imageData found"),e.poiRenderBatch=-1,void(e.isValid=!1);const s=e.technique,l=i.imageData.width,h=i.imageData.height,d=a.MipMapGenerator.getPaddedSize(l,h),u=m.trilinear&&i.mipMaps,p=u?d.width:l,f=u?d.height:h,g=void 0!==t.width?t.width:l,v=void 0!==t.height?t.height:h;let y=0,_=1,x=0,S=1,b=void 0!==s.iconScale?s.iconScale:1,T=void 0!==s.iconScale?s.iconScale:1;const w=void 0!==t.width?t.width:l,M=void 0!==t.height?t.height:h,E=void 0!==t.xOffset?t.xOffset:0,P=void 0!==t.yOffset?t.yOffset:0;y=E/p,_=(E+w)/p;x=P/f,S=(P+M)/f;const C=r.getPropertyValue(s.screenWidth,n);void 0!==C&&(T=b=C/g);const A=r.getPropertyValue(s.screenHeight,n);void 0!==A&&(T=A/v,void 0!==C&&(b=T)),e.computedWidth=g*b,e.computedHeight=v*T,e.uvBox={s0:y,t0:S,s1:_,t1:x},e.imageItem=i,e.imageTexture=t,e.poiRenderBatch=this.m_renderBuffer.registerPoi(e),e.isValid=!0,o.assert(void 0!==e.poiRenderBatch)}}return e.m_missingTextureName=new Map,e})();t.PoiRenderer=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MipMapGenerator=void 0;const r=i(0),n="undefined"==typeof window;class o{constructor(){n||(this.m_paddingCanvas=document.createElement("canvas"),this.m_paddingContext=this.m_paddingCanvas.getContext("2d"),this.m_resizeCanvas=document.createElement("canvas"),this.m_resizeContext=this.m_resizeCanvas.getContext("2d"))}static getPaddedSize(e,t){return{width:r.MathUtils.ceilPowerOfTwo(e),height:r.MathUtils.ceilPowerOfTwo(t)}}generateTextureAtlasMipMap(e){if(n)throw new Error("MipMapGenerator only works in browser.");if(void 0===e.imageData)throw new Error("Can not generate mip maps. Image data not loaded!");const t=e.imageData,i=[],{width:r,height:s}=o.getPaddedSize(t.width,t.height);this.copyImageWithPadding(t,r,s),i.push(this.m_paddingContext.getImageData(0,0,r,s));let a=.5*r,l=.5*s;for(;a>=1&&l>=1;){const e=i[i.length-1];i.push(this.resizeImage(e,a,l)),a*=.5,l*=.5}return i}copyImageWithPadding(e,t,i){return this.m_paddingCanvas.width=t,this.m_paddingCanvas.height=i,this.m_paddingContext.clearRect(0,0,t,i),e instanceof ImageBitmap?this.m_paddingContext.drawImage(e,0,0):this.m_paddingContext.putImageData(e,0,0),e.width!==t&&this.m_paddingContext.drawImage(this.m_paddingCanvas,e.width-1,0,1,e.height,e.width,0,t-e.width,e.height),e.height!==i&&this.m_paddingContext.drawImage(this.m_paddingCanvas,0,e.height-1,t,1,0,e.height,t,i-e.height),this.m_paddingCanvas}resizeImage(e,t,i){const r=this.copyImageWithPadding(e,e.width,e.height);return this.m_resizeCanvas.width=t,this.m_resizeCanvas.height=i,this.m_resizeContext.clearRect(0,0,t,i),this.m_resizeContext.drawImage(r,0,0,t,i),this.m_resizeContext.getImageData(0,0,t,i)}}t.MipMapGenerator=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenCollisionsDebug=t.ScreenCollisions=t.isLineWithBound=t.DetailedCollisionBox=t.CollisionBox=void 0;const r=i(1),n=i(0),o=i(57),s=i(108),a=r.LoggerManager.instance.create("ScreenCollissions");class l extends r.Math2D.Box{constructor(e){super(),void 0!==e&&this.copy(e)}copy(e){return e instanceof r.Math2D.Box?this.set(e.x,e.y,e.w,e.h):e instanceof n.Box2?this.set(e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y):this.set(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY),this}get minX(){return this.x}set minX(e){this.x=e}get maxX(){return this.x+this.w}set maxX(e){this.w=e-this.x}get minY(){return this.y}set minY(e){this.y=e}get maxY(){return this.y+this.h}set maxY(e){this.h=e-this.y}}t.CollisionBox=l;class c extends l{constructor(e,t){super(e),this.detailBoxes=t}}function h(e){return void 0!==e.line}t.DetailedCollisionBox=c,t.isLineWithBound=h;const d=new l;class u{constructor(){this.screenBounds=new r.Math2D.Box,this.rtree=new s}reset(){this.rtree.clear()}update(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()}allocate(e){const t=e instanceof l?e:new l(e);this.rtree.insert(t)}allocateIBoxes(e){this.rtree.load(e)}search(e){return this.rtree.search(e)}isAllocated(e){const t=e instanceof l?e:d.copy(e),i=this.search(t);return this.intersectsDetails(t,i)}isVisible(e){return this.screenBounds.intersects(e)}isFullyVisible(e){return this.screenBounds.containsBox(e)}intersectsDetails(e,t){for(const i of t)if(i instanceof c){for(const t of i.detailBoxes)if(t.intersects(e))return!0}else{if(!h(i))return!0;{const t=i;if(this.intersectsLine(e,t))return!0}}return!1}intersectsLine(e,t){const i=t.line,r=i.end.x-i.start.x;let n,o,s,a;if(0!==r){const t=i.end.y-i.start.y,l=t,c=-r,h=i.start.y-t/r*i.start.x;n=Math.sign(e.minX*l+(e.minY-h)*c),o=Math.sign(e.maxX*l+(e.minY-h)*c),s=Math.sign(e.minX*l+(e.maxY-h)*c),a=Math.sign(e.maxX*l+(e.maxY-h)*c)}else n=Math.sign(e.minX-i.start.x),o=Math.sign(e.maxX-i.start.x),s=Math.sign(e.minX-i.start.x),a=Math.sign(e.maxX-i.start.x);return n!==o||n!==s||n!==a}}t.ScreenCollisions=u;t.ScreenCollisionsDebug=class extends u{constructor(e){super(),this.m_renderContext=null,this.m_renderingEnabled=!1,this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0,null!=e&&(this.m_renderContext=e.getContext("2d"))}reset(){super.reset(),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0}update(e,t){this.m_renderingEnabled&&a.log(`Allocations: ${this.m_numAllocations} Successful Tests: ${this.m_numSuccessfulTests} Failed Tests: ${this.m_numFailedTests}  Successful Visibility Tests: ${this.m_numSuccessfulVisibilityTests}  Failed Visibility Tests: ${this.m_numFailedVisibilityTests} `),super.update(e,t),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=e,this.m_renderContext.canvas.height=t),this.m_renderingEnabled=o.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")}allocate(e){super.allocate(e),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(e.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-e.y,e.w,-e.h))}allocateIBoxes(e){for(const t of e)this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#aa2222",this.m_renderContext.strokeRect(t.minX-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.minY,t.maxX-t.minX,-(t.maxY-t.minY)));super.allocateIBoxes(e)}intersectsDetails(e,t){const i=super.intersectsDetails(e,t);if(this.m_renderingEnabled&&null!==this.m_renderContext){const t=i?2:1;this.m_renderContext.strokeStyle=i?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(e.x-this.screenBounds.x-t,this.screenBounds.y+this.screenBounds.h-e.y+t,e.w+2*t,-e.h-2*t)}return i?this.m_numFailedTests++:this.m_numSuccessfulTests++,i}isVisible(e){const t=super.isVisible(e);return t?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,t}}},function(e,t,i){e.exports=function(){"use strict";function e(e,r,n,o,s){!function e(i,r,n,o,s){for(;o>n;){if(o-n>600){var a=o-n+1,l=r-n+1,c=Math.log(a),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,r,Math.max(n,Math.floor(r-l*h/a+d)),Math.min(o,Math.floor(r+(a-l)*h/a+d)),s)}var u=i[r],m=n,p=o;for(t(i,n,r),s(i[o],u)>0&&t(i,n,o);m<p;){for(t(i,m,p),m++,p--;s(i[m],u)<0;)m++;for(;s(i[p],u)>0;)p--}0===s(i[n],u)?t(i,n,p):t(i,++p,o),p<=r&&(n=p+1),r<=p&&(o=p-1)}}(e,r,n||0,o||e.length-1,s||i)}function t(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function i(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function o(e,t){s(e,0,e.children.length,t,e)}function s(e,t,i,r,n){n||(n=p(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o=t;o<i;o++){var s=e.children[o];a(n,e.leaf?r(s):s)}return n}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function u(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,i,r,n,o){for(var s=[i,r];s.length;)if(!((r=s.pop())-(i=s.pop())<=n)){var a=i+Math.ceil((r-i)/n/2)*n;e(t,a,i,r,o),s.push(i,a,a,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,i=[];if(!m(e,t))return i;for(var r=this.toBBox,n=[];t;){for(var o=0;o<t.children.length;o++){var s=t.children[o],a=t.leaf?r(s):s;m(e,a)&&(t.leaf?i.push(s):u(e,a)?this._all(s,i):n.push(s))}t=n.pop()}return i},r.prototype.collides=function(e){var t=this.data;if(!m(e,t))return!1;for(var i=[];t;){for(var r=0;r<t.children.length;r++){var n=t.children[r],o=t.leaf?this.toBBox(n):n;if(m(e,o)){if(t.leaf||u(e,o))return!0;i.push(n)}}t=i.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var i,r,o,s=this.data,a=this.toBBox(e),l=[],c=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],i=c.pop(),o=!0),s.leaf){var h=n(e,s.children,t);if(-1!==h)return s.children.splice(h,1),l.push(s),this._condense(l),this}o||s.leaf||!u(s,a)?r?(i++,s=r.children[i],o=!1):s=null:(l.push(s),c.push(i),i=0,r=s,s=s.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},r.prototype._build=function(e,t,i,r){var n,s=i-t+1,a=this._maxEntries;if(s<=a)return o(n=p(e.slice(t,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,r-1))),(n=p([])).leaf=!1,n.height=r;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));f(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var d=Math.min(h+c-1,i);f(e,h,d,l,this.compareMinY);for(var u=h;u<=d;u+=l){var m=Math.min(u+l-1,d);n.children.push(this._build(e,u,m,r-1))}}return o(n,this.toBBox),n},r.prototype._chooseSubtree=function(e,t,i,r){for(;r.push(t),!t.leaf&&r.length-1!==i;){for(var n=1/0,o=1/0,s=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),d=(u=e,m=l,(Math.max(m.maxX,u.maxX)-Math.min(m.minX,u.minX))*(Math.max(m.maxY,u.maxY)-Math.min(m.minY,u.minY))-c);d<o?(o=d,n=c<n?c:n,s=l):d===o&&c<n&&(n=c,s=l)}t=s||t.children[0]}var u,m;return t},r.prototype._insert=function(e,t,i){var r=i?e:this.toBBox(e),n=[],o=this._chooseSubtree(r,this.data,t,n);for(o.children.push(e),a(o,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)},r.prototype._split=function(e,t){var i=e[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var s=this._chooseSplitIndex(i,n,r),a=p(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},r.prototype._splitRoot=function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,i){for(var r,n,o,a,l,c,d,u=1/0,m=1/0,p=t;p<=i-t;p++){var f=s(e,0,p,this.toBBox),g=s(e,p,i,this.toBBox),v=(n=f,o=g,a=Math.max(n.minX,o.minX),l=Math.max(n.minY,o.minY),c=Math.min(n.maxX,o.maxX),d=Math.min(n.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,d-l)),y=h(f)+h(g);v<u?(u=v,r=p,m=y<m?y:m):v===u&&y<m&&(m=y,r=p)}return r||i-t},r.prototype._chooseSplitAxis=function(e,t,i){var r=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,i,r){e.children.sort(r);for(var n=this.toBBox,o=s(e,0,t,n),l=s(e,i-t,i,n),c=d(o)+d(l),h=t;h<i-t;h++){var u=e.children[h];a(o,e.leaf?n(u):u),c+=d(o)}for(var m=i-t-1;m>=t;m--){var p=e.children[m];a(l,e.leaf?n(p):p),c+=d(l)}return c},r.prototype._adjustParentBBoxes=function(e,t,i){for(var r=i;r>=0;r--)a(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},r}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextStyleCache=void 0;const r=i(2),n=i(6),o=i(1),s=i(50),a=i(19),l=o.LoggerManager.instance.create("TextStyleCache"),c=new n.TextRenderStyle({fontSize:{unit:n.FontUnit.Pixel,size:32,backgroundSize:8},color:s.ColorCache.instance.getColor("#6d7477"),opacity:1,backgroundColor:s.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}),h=new n.TextLayoutStyle({verticalAlignment:n.VerticalAlignment.Center,horizontalAlignment:n.HorizontalAlignment.Center,placements:[]});function d(e,t,i){const o=i?function(e){const t=[];return(e?e.toUpperCase().replace(" ","").split(","):[]).forEach(e=>{const i=function(e){if(e.length<1||e.length>2)return;const t={h:n.HorizontalPlacement.Center,v:n.VerticalPlacement.Center};let i=e.charAt(0),o=!0;switch(i){case r.PlacementToken.Top:case r.PlacementToken.North:t.v=n.VerticalPlacement.Top;break;case r.PlacementToken.Bottom:case r.PlacementToken.South:t.v=n.VerticalPlacement.Bottom;break;default:if(o=!1,2===e.length)return}if(o&&1===e.length)return t;switch(i=1===e.length?e.charAt(0):e.charAt(1),i){case r.PlacementToken.Right:case r.PlacementToken.East:t.h=n.HorizontalPlacement.Right;break;case r.PlacementToken.Left:case r.PlacementToken.West:t.h=n.HorizontalPlacement.Left;break;default:return}return t}(e);void 0!==i&&t.push(i)}),t}(i):void 0;return n.resolvePlacementAndAlignment(function(e){return"Left"===e||"Center"===e||"Right"===e?n.HorizontalAlignment[e]:h.horizontalAlignment}(e),function(e){return"Above"===e||"Center"===e||"Below"===e?n.VerticalAlignment[e]:h.verticalAlignment}(t),o)}t.TextStyleCache=class{constructor(e){this.m_theme=e,this.m_textStyles=new Map,this.m_defaultStyle={name:"default",fontCatalog:"",renderParams:c.params,layoutParams:h.params}}initializeDefaultTextElementStyle(e){void 0===this.m_theme.textStyles&&(this.m_theme.textStyles=[]);const t=this.m_theme.textStyles,i=t.find(e=>"default"===e.name);void 0!==i?this.m_defaultStyle=this.createTextElementStyle(i,"default"):void 0!==this.m_theme.defaultTextStyle?this.m_defaultStyle=this.createTextElementStyle(this.m_theme.defaultTextStyle,"default"):t.length>0&&(this.m_defaultStyle=this.createTextElementStyle(t[0],"default")),this.m_defaultStyle.fontCatalog=e}initializeTextElementStyles(e,t,i){if(void 0!==this.m_defaultStyle.fontCatalog){const e=i.find(e=>e.fontCatalog===this.m_defaultStyle.fontCatalog);this.m_defaultStyle.textCanvas=void 0!==e?e.textCanvas:void 0,this.m_defaultStyle.poiRenderer=void 0!==e?e.poiRenderer:void 0}void 0===this.m_defaultStyle.textCanvas&&(void 0!==this.m_defaultStyle.fontCatalog&&l.warn(`FontCatalog '${this.m_defaultStyle.fontCatalog}' set in TextStyle '${this.m_defaultStyle.name}' not found, using default fontCatalog(${t.fontCatalog.name}).`),this.m_defaultStyle.textCanvas=t,this.m_defaultStyle.poiRenderer=e),this.m_theme.textStyles.forEach(e=>{this.m_textStyles.set(e.name,this.createTextElementStyle(e,e.name))});for(const[,r]of this.m_textStyles)if(void 0===r.textCanvas){if(void 0!==r.fontCatalog){const e=i.find(e=>e.fontCatalog===r.fontCatalog);r.textCanvas=void 0!==e?e.textCanvas:void 0,r.poiRenderer=void 0!==e?e.poiRenderer:void 0}void 0===r.textCanvas&&(void 0!==r.fontCatalog&&l.warn(`FontCatalog '${r.fontCatalog}' set in TextStyle '${r.name}' not found, using default fontCatalog(${t.fontCatalog.name}).`),r.textCanvas=t,r.poiRenderer=e)}}getTextElementStyle(e){let t;return void 0===e?t=this.m_defaultStyle:(t=this.m_textStyles.get(e),void 0===t&&(t=this.m_defaultStyle)),t}createRenderStyle(e,t){const i=e.mapView,l=i.zoomLevel,c=Math.floor(l),h=new r.MapEnv({$zoom:c},i.env),d=this.m_defaultStyle.renderParams,u=o.getOptionValue(d.opacity,1);let m,p=r.getPropertyValue(o.getOptionValue(t.opacity,u),h);if(void 0!==t.color){let e=a.evaluateColorProperty(t.color,h);if(void 0!==e){if(r.ColorUtils.hasAlphaInHex(e)){p*=r.ColorUtils.getAlphaFromHex(e),e=r.ColorUtils.removeAlphaFromHex(e)}m=s.ColorCache.instance.getColor(e)}}const f=o.getOptionValue(d.fontSize.backgroundSize,0),g=r.getPropertyValue(o.getOptionValue(t.backgroundSize,f),h),v=void 0!==t.backgroundColor&&void 0!==t.backgroundSize&&g>0,y=o.getOptionValue(d.backgroundOpacity,0);let _,x=r.getPropertyValue(o.getOptionValue(t.backgroundOpacity,v?1:y),h);if(void 0!==t.backgroundColor){let e=a.evaluateColorProperty(t.backgroundColor,h);if(void 0!==e){if(r.ColorUtils.hasAlphaInHex(e)){x*=r.ColorUtils.getAlphaFromHex(e),e=r.ColorUtils.removeAlphaFromHex(e)}_=s.ColorCache.instance.getColor(e)}}const S={fontName:o.getOptionValue(t.fontName,d.fontName),fontSize:{unit:n.FontUnit.Pixel,size:r.getPropertyValue(o.getOptionValue(t.size,d.fontSize.size),h),backgroundSize:g},fontStyle:"Regular"===t.fontStyle||"Bold"===t.fontStyle||"Italic"===t.fontStyle||"BoldItalic"===t.fontStyle?n.FontStyle[t.fontStyle]:d.fontStyle,fontVariant:"Regular"===t.fontVariant||"AllCaps"===t.fontVariant||"SmallCaps"===t.fontVariant?n.FontVariant[t.fontVariant]:d.fontVariant,rotation:o.getOptionValue(t.rotation,d.rotation),color:o.getOptionValue(m,o.getOptionValue(d.color,n.DefaultTextStyle.DEFAULT_COLOR)),backgroundColor:o.getOptionValue(_,o.getOptionValue(d.backgroundColor,n.DefaultTextStyle.DEFAULT_BACKGROUND_COLOR)),opacity:p,backgroundOpacity:x},b=this.getTextElementStyle(t.style).renderParams;return new n.TextRenderStyle(Object.assign(Object.assign({},b),S))}createLayoutStyle(e,t){var i,o,s,a,l,c;const h=e.mapView,u=Math.floor(e.mapView.zoomLevel),m=new r.MapEnv({$zoom:u},h.env),p=this.m_defaultStyle.layoutParams,f=r.getPropertyValue(t.hAlignment,m),g=r.getPropertyValue(t.vAlignment,m),v=r.isPoiTechnique(t)?r.getPropertyValue(t.placements,m):null,{horizontalAlignment:y,verticalAlignment:_,placements:x}=d(f,g,v),S=r.getPropertyValue(t.wrappingMode,m),b="None"===S||"Character"===S||"Word"===S?n.WrappingMode[S]:p.wrappingMode,T={tracking:null!==(i=r.getPropertyValue(t.tracking,m))&&void 0!==i?i:p.tracking,leading:null!==(o=r.getPropertyValue(t.leading,m))&&void 0!==o?o:p.leading,maxLines:null!==(s=r.getPropertyValue(t.maxLines,m))&&void 0!==s?s:p.maxLines,lineWidth:null!==(a=r.getPropertyValue(t.lineWidth,m))&&void 0!==a?a:p.lineWidth,canvasRotation:null!==(l=r.getPropertyValue(t.canvasRotation,m))&&void 0!==l?l:p.canvasRotation,lineRotation:null!==(c=r.getPropertyValue(t.lineRotation,m))&&void 0!==c?c:p.lineRotation,wrappingMode:b,horizontalAlignment:y,verticalAlignment:_,placements:x},w=this.getTextElementStyle(t.style);return new n.TextLayoutStyle(Object.assign(Object.assign({},w),T))}createTextElementStyle(e,t){const{horizontalAlignment:i,verticalAlignment:r,placements:a}=d(e.hAlignment,e.vAlignment,e.placements);return{name:t,fontCatalog:o.getOptionValue(e.fontCatalogName,this.m_defaultStyle.fontCatalog),renderParams:{fontName:e.fontName,fontSize:{unit:n.FontUnit.Pixel,size:32,backgroundSize:e.backgroundSize||8},fontStyle:"Regular"===e.fontStyle||"Bold"===e.fontStyle||"Italic"===e.fontStyle||"BoldItalic"===e.fontStyle?n.FontStyle[e.fontStyle]:void 0,fontVariant:"Regular"===e.fontVariant||"AllCaps"===e.fontVariant||"SmallCaps"===e.fontVariant?n.FontVariant[e.fontVariant]:void 0,rotation:e.rotation,color:void 0!==e.color?s.ColorCache.instance.getColor(e.color):void 0,backgroundColor:void 0!==e.backgroundColor?s.ColorCache.instance.getColor(e.backgroundColor):void 0,opacity:e.opacity,backgroundOpacity:e.backgroundOpacity},layoutParams:{tracking:e.tracking,leading:e.leading,maxLines:e.maxLines,lineWidth:e.lineWidth,canvasRotation:e.canvasRotation,lineRotation:e.lineRotation,wrappingMode:"None"===e.wrappingMode||"Character"===e.wrappingMode||"Word"===e.wrappingMode?n.WrappingMode[e.wrappingMode]:n.WrappingMode.Word,verticalAlignment:r,horizontalAlignment:i,placements:a}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CalculationStatus=void 0,function(e){e[e.PendingApproximate=0]="PendingApproximate",e[e.FinalPrecise=1]="FinalPrecise"}(t.CalculationStatus||(t.CalculationStatus={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewImageCache=void 0;const r=i(112);t.MapViewImageCache=class{constructor(e){this.mapView=e,this.m_name2Url=new Map,this.m_url2Name=new Map}registerImage(e,t,i){if(void 0!==e){if(this.hasName(e))throw new Error("duplicate name in cache");const i=this.m_url2Name.get(t);void 0!==i?i.indexOf(e)<0&&i.push(e):this.m_url2Name.set(t,[e]),this.m_name2Url.set(e,t)}const n=r.ImageCache.instance.findImage(t);return void 0===n?r.ImageCache.instance.registerImage(this.mapView,t,i):n}addImage(e,t,i=!0){const n=this.registerImage(e,t,void 0);return!0===i?r.ImageCache.instance.loadImage(n):n}findImageByName(e){const t=this.m_name2Url.get(e);if(void 0!==t)return r.ImageCache.instance.findImage(t)}findImageByUrl(e){return r.ImageCache.instance.findImage(e)}loadImage(e){return r.ImageCache.instance.loadImage(e)}clear(){r.ImageCache.instance.clear(this.mapView),this.m_name2Url=new Map,this.m_url2Name=new Map}get numberOfNames(){return this.m_name2Url.size}get numberOfUrls(){return this.m_url2Name.size}hasName(e){return void 0!==this.m_name2Url.get(e)}hasUrl(e){return void 0!==this.m_url2Name.get(e)}findNames(e){return this.m_url2Name.get(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCache=void 0;const r=i(1),n=i(0),o=i(106),s=r.LoggerManager.instance.create("ImageCache"),a=new o.MipMapGenerator;class l{constructor(){this.m_images=new Map}static get instance(){return void 0===l.m_instance&&(l.m_instance=new l),l.m_instance}static dispose(){l.m_instance=void 0}registerImage(e,t,i){let r=this.findImageCacheItem(t);if(void 0!==r)return void 0!==e&&r.mapViews.indexOf(e)<0&&r.mapViews.push(e),r.imageItem;const n=[];return void 0!==e&&n.push(e),r={imageItem:{url:t,imageData:i,loaded:!1},mapViews:n},this.m_images.set(t,r),r.imageItem}addImage(e,t,i=!0){const r=this.registerImage(e,t,void 0);return void 0!==r&&!0===i?this.loadImage(r):r}findImage(e){const t=this.m_images.get(e);if(void 0!==t)return t.imageItem}clear(e){const t=[];this.m_images.forEach(i=>{const r=i.mapViews.indexOf(e);r>=0&&i.mapViews.splice(r,1),0===i.mapViews.length&&t.push(i.imageItem.url)});for(const e of t)this.m_images.delete(e)}clearAll(){this.m_images=new Map}get size(){return this.m_images.size}loadImage(e){if(void 0!==e.imageData)return e;if(void 0!==e.loadingPromise)return e.loadingPromise;const t=new n.ImageLoader;return e.loadingPromise=new Promise(i=>{s.debug(`Loading image: ${e.url}`),t.load(e.url,t=>{s.debug(`... finished loading image: ${e.url}`),this.renderImage(e,t).then(()=>{e.mipMaps=a.generateTextureAtlasMipMap(e),e.loadingPromise=void 0,i(e)}).catch(t=>{s.error(`... loading image failed: ${e.url} : ${t}`),i(void 0)})},void 0,t=>{s.error(`... loading image failed: ${e.url} : ${t}`),e.loadingPromise=void 0,i(void 0)})}),e.loadingPromise}findImageCacheItem(e){return this.m_images.get(e)}renderImage(e,t){return new Promise((i,r)=>{if("function"==typeof createImageBitmap){const r={premultiplyAlpha:"default"};s.debug(`Creating bitmap image: ${e.url}`),createImageBitmap(t,0,0,t.width,t.height,r).then(t=>{s.debug(`... finished creating bitmap image: ${e.url}`),e.loadingPromise=void 0,e.imageData=t,e.loaded=!0,i(t)}).catch(t=>{s.error(`... loading image failed: ${e.url} : ${t}`),i(void 0)})}else try{"undefined"==typeof document&&(s.error("Error: document is not available, cannot generate image"),r(new Error("ImageCache#renderImage: document is not available, cannot render image to create texture")));const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const o=n.getContext("2d");if(null!==o){s.debug(`... finished creating bitmap image in canvas: ${e.url} ${t}`),o.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height);const r=o.getImageData(0,0,t.width,t.height);e.imageData=r,e.loaded=!0,i(r)}else s.error("renderImage: no context found"),r(new Error("ImageCache#renderImage: no context found"))}catch(t){s.error(`renderImage failed: ${t}`),e.imageData=void 0,e.loaded=!0,r(new Error(`ImageCache#renderImage failed: ${t}`))}})}}t.ImageCache=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapAnchors=void 0;const r=i(3),n=i(0);t.MapAnchors=class{constructor(){this.m_anchors=[]}get children(){return this.m_anchors}add(e){this.m_anchors.push(e)}remove(e){const t=this.m_anchors.findIndex(t=>t===e);t>-1&&this.m_anchors.splice(t,1)}clear(){this.m_anchors.length=0}update(e,t,i,o,s){const a=new n.Vector3;this.m_anchors.forEach(n=>{if(void 0!==n.styleSet){const e=null==s?void 0:s.findIndex(e=>e.group===n.styleSet&&e.category===n.category);void 0!==e&&-1!==e&&(n.renderOrder=10*(e+1))}const l=void 0!==n.geoPosition?n.geoPosition:n.anchor;void 0!==l&&(r.isVector3Like(l)?a.set(l.x,l.y,l.z):r.isGeoCoordinatesLike(l)&&e.projectPoint(l,a),n.position.copy(a).sub(t)),!0===n.overlay?o.add(n):i.add(n)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewFog=void 0;const r=i(4),n=i(1),o=i(0);t.MapViewFog=class{constructor(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new o.Fog(0),this.m_fogIsDefined=!1,this.m_cachedTheme={styles:{}}}set enabled(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()}get enabled(){return this.m_enabled}reset(e){this.m_cachedTheme=e,void 0!==e&&void 0!==e.fog&&void 0!==e.fog.color&&void 0!==e.fog.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.fog.color),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())}update(e,t){if(null!==this.m_scene.fog&&void 0!==this.m_cachedTheme&&this.m_cachedTheme.fog&&void 0!==this.m_cachedTheme.fog.startRatio&&(void 0!==e.camera.far||void 0!==t)){const i=void 0!==t?t:e.camera.far,r=1,o=0,s=this.m_cachedTheme.fog.startRatio,a=1;n.assert(s<=a);const l=Math.abs(Math.cos(e.tilt)),c=n.MathUtils.smoothStep(r,o,l);this.m_fog.near=n.MathUtils.lerp(i*s,i,1-c),this.m_fog.far=n.MathUtils.lerp(i*a,i,c),this.m_fog.near=Math.min(this.m_fog.near,e.camera.far),this.m_fog.far=Math.min(this.m_fog.far,e.camera.far)}}add(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)}remove(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)}setFogInRawShaderMaterials(e){this.m_scene.traverse(t=>{t instanceof o.Mesh&&t.material instanceof o.Material&&(t.material instanceof r.HighPrecisionLineMaterial||t.material.fog!==e&&(t.material.fog=e,t.material.needsUpdate=!0))})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiManager=void 0;const r=i(2),n=i(6),o=i(1),s=i(0),a=i(50),l=i(17),c=i(39),h=o.LoggerManager.instance.create("PoiManager");let d=(()=>{class e{constructor(e){this.mapView=e,this.m_imageTextures=new Map,this.m_poiShieldGroups=new Map}static notifyMissingPoiTable(t,i){void 0===t&&(t="undefined"),void 0===e.m_missingPoiTableName.get(t)&&(e.m_missingPoiTableName.set(t,!0),void 0===i||i.loadedOk?h.error(`updatePoiFromPoiTable: No POI table with name '${t}' found!`):h.error(`updatePoiFromPoiTable: Could not load POI table '${t}'!`))}static notifyMissingPoi(t,i){void 0===t&&(t="undefined");const r=`${i}[${t}]`;void 0===e.m_missingPoiName.get(r)&&(e.m_missingPoiName.set(r,!0),h.warn("updatePoiFromPoiTable: "+`Cannot find POI info for '${t}' in table '${i}'.`))}addPois(e,t){const i=o.assertExists(t.poiGeometries),n=e.computeWorldOffsetX();for(const a of i){o.assert(void 0!==a.technique);const i=o.assertExists(a.technique),l=t.techniques[i];if(!1===l._kindState||!r.isLineMarkerTechnique(l)&&!r.isPoiTechnique(l))continue;if(!1===l.showOnMap)continue;const c=new s.BufferAttribute(new Float32Array(a.positions.buffer),a.positions.itemCount);r.isLineMarkerTechnique(l)&&c.count>0?this.addLineMarker(e,a,l,c,n):r.isPoiTechnique(l)&&this.addPoi(e,a,l,c,n)}}addTextureAtlas(e,t){fetch(t).then(e=>{if(!e.ok)throw new Error(`addTextureAtlas: Cannot load textureAtlas: ${e.statusText}`);return e.json()}).then(i=>{if(void 0!==i){try{h.debug(`addTextureAtlas: Loading textureAtlas '${t}' for image '${e}'`);for(const t of Object.getOwnPropertyNames(i)){const r=i[t],n={name:t,image:e,xOffset:r.x,yOffset:r.y,width:r.width,height:r.height};this.addImageTexture(n)}}catch(e){h.error("addTextureAtlas: Failed to load textureAtlas "+`'${t}' : ${e}`)}this.mapView.update()}else h.info(`addTextureAtlas: TextureAtlas empty: ${t}`)}).catch(e=>{h.error(`addTextureAtlas: Failed to load textureAtlas '${t}' : ${e}`)})}addImageTexture(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&h.warn(`addImageTexture: Name already used: ${e.name}`+" (overriding it)"),this.m_imageTextures.set(e.name,e)):h.error("addImageTexture: Name required",e)}getImageTexture(e){return this.m_imageTextures.get(e)}updatePoiFromPoiTable(t){const i=t.poiInfo;if(void 0===i||void 0===i.poiTableName||void 0===i.poiName)return!0;const n=i.poiTableName,o=this.mapView.poiTableManager.getPoiTable(n);if(void 0!==o&&o.isLoading)return!1;if(i.poiTableName=void 0,void 0===o||!o.loadedOk)return e.notifyMissingPoiTable(n,o),!0;const s=i.poiName,a=o.getEntry(s);return void 0===a?(e.notifyMissingPoi(s,n),!0):(void 0!==a.iconName&&a.iconName.length>0&&(i.imageTextureName=r.composeTechniqueTextureName(a.iconName,i.technique)),t.visible=void 0!==a.visible?a.visible:t.visible,t.priority=void 0!==a.priority?a.priority:t.priority,i.iconMinZoomLevel=void 0!==a.iconMinLevel?a.iconMinLevel:i.iconMinZoomLevel,i.iconMaxZoomLevel=void 0!==a.iconMaxLevel?a.iconMaxLevel:i.iconMaxZoomLevel,i.textMinZoomLevel=void 0!==a.textMinLevel?a.textMinLevel:i.textMinZoomLevel,i.textMaxZoomLevel=void 0!==a.textMaxLevel?a.textMaxLevel:i.textMaxZoomLevel,t.updateMinMaxZoomLevelsFromPoiInfo(),!0)}clear(){this.m_imageTextures.clear(),this.m_poiShieldGroups.clear()}addLineMarker(e,t,i,n,a){const l=this.mapView.env;let c,h,d=void 0!==i.imageTexture?r.composeTechniqueTextureName(r.getPropertyValue(i.imageTexture,l),i):void 0,u="";void 0!==t.stringCatalog&&(o.assert(t.texts.length>0),u=t.stringCatalog[t.texts[0]]||"",void 0!==t.objInfos&&(c=t.objInfos[0],h=r.getFeatureId(c)),void 0!==t.imageTextures&&(o.assert(t.imageTextures.length>0),d=t.stringCatalog[t.imageTextures[0]]));const m=String(d)+"-"+u;let p=this.m_poiShieldGroups.get(m);void 0===p&&(p=this.m_poiShieldGroups.size,this.m_poiShieldGroups.set(m,p));const f=[];for(let e=0;e<n.count;e+=3){const t=n.getX(e)+a,i=n.getY(e),r=n.getZ(e);f.push(new s.Vector3(t,i,r))}const g=this.checkCreateTextElement(e,u,i,d,void 0,void 0,p,h,f,void 0,void 0,void 0,c);g.ignoreDistance=!1,e.addTextElement(g)}addPoi(e,t,i,n,s){if(void 0===t.stringCatalog)return;const a=e.mapView.env,l=void 0!==i.imageTexture?r.composeTechniqueTextureName(r.getPropertyValue(i.imageTexture,a),i):void 0,c=i,h=c.poiTable;let d=c.poiName;for(let a=0;a<n.count;++a){const u=n.getX(a)+s,m=n.getY(a),p=n.getZ(a);o.assert(t.texts.length>a);let f=l;const g=t.stringCatalog[t.texts[a]]||"",v=void 0!==t.objInfos?t.objInfos[a]:void 0,y=r.getFeatureId(v),_=void 0===t.offsetDirections?0:t.offsetDirections[a];void 0!==t.imageTextures&&t.imageTextures[a]>=0&&(o.assert(t.imageTextures.length>a),f=t.stringCatalog[t.imageTextures[a]]),void 0!==h&&(d=void 0===c.poiName?f:c.poiName,f=void 0);const x=this.checkCreateTextElement(e,g,i,f,h,d,0,y,u,m,p,_,v);e.addTextElement(x)}}checkCreateTextElement(e,t,i,o,d,u,m,p,f,g,v,y,_){const x=void 0!==i.priority?i.priority:0,S=Array.isArray(f)?f:new s.Vector3(f,g,v),b=this.mapView.env,T=void 0!==i.fadeNear?r.getPropertyValue(i.fadeNear,b):i.fadeNear,w=void 0!==i.fadeFar?r.getPropertyValue(i.fadeFar,b):i.fadeFar,M=r.getPropertyValue(i.xOffset,b),E=r.getPropertyValue(i.yOffset,b),P=new l.TextElement(n.ContextualArabicConverter.instance.convert(t),S,e.textStyleCache.getRenderStyle(i),e.textStyleCache.getLayoutStyle(i),r.getPropertyValue(x,b),void 0!==M?M:0,void 0!==E?E:0,p,i.style,T,w,e.offset,y);if(P.mayOverlap=!0===i.textMayOverlap,P.reserveSpace=!1!==i.textReserveSpace,P.alwaysOnTop=!0===i.alwaysOnTop,P.userData=_,void 0===o&&void 0!==d?o="":void 0!==o&&void 0!==d&&h.warn("Possible duplicate POI icon definition via imageTextureName and poiTable!"),void 0!==o){const e=!0===i.textIsOptional,t=!1!==i.iconIsOptional,n=!(!1===i.renderTextDuringMovements),s=void 0===i.iconMayOverlap?P.textMayOverlap:!0===i.iconMayOverlap,l=void 0===i.iconReserveSpace?P.textReservesSpace:!1!==i.iconReserveSpace,c=i.iconColor?r.getPropertyValue(i.iconColor,b):null,h=null!==c?a.ColorCache.instance.getColor(c):void 0;P.poiInfo={technique:i,imageTextureName:o,poiTableName:d,poiName:u,shieldGroupIndex:m,textElement:P,textIsOptional:e,iconIsOptional:t,renderTextDuringMovements:n,mayOverlap:s,reserveSpace:l,featureId:p,iconBrightness:i.iconBrightness,iconColor:h,iconMinZoomLevel:i.iconMinZoomLevel,iconMaxZoomLevel:i.iconMaxZoomLevel,textMinZoomLevel:i.textMinZoomLevel,textMaxZoomLevel:i.textMaxZoomLevel},P.updateMinMaxZoomLevelsFromPoiInfo()}else void 0===P.minZoomLevel&&(P.minZoomLevel=i.textMinZoomLevel),void 0===P.maxZoomLevel&&(P.maxZoomLevel=i.textMaxZoomLevel);return P.distanceScale=void 0!==i.distanceScale?i.distanceScale:c.DEFAULT_TEXT_DISTANCE_SCALE,P.kind=i.kind,P}}return e.m_missingPoiTableName=new Map,e.m_missingPoiName=new Map,e})();t.PoiManager=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiTableManager=t.PoiTable=void 0;const r=i(2),n=i(1).LoggerManager.instance.create("PoiTable");class o{static verifyJSON(e){let t="string"==typeof e.name&&e.name.length>0&&(void 0===e.altNames||Array.isArray(e.altNames))&&(void 0===e.stackMode||"yes"===e.stackMode||"no"===e.stackMode||"parent"===e.stackMode)&&(void 0===e.visible||"boolean"==typeof e.visible)&&(void 0===e.priority||"number"==typeof e.priority)&&(void 0===e.iconMinLevel||"number"==typeof e.iconMinLevel)&&(void 0===e.iconMaxLevel||"number"==typeof e.iconMaxLevel)&&(void 0===e.textMinLevel||"number"==typeof e.textMinLevel)&&(void 0===e.textMaxLevel||"number"==typeof e.textMaxLevel);if(t&&void 0!==e.altNames){const i=e.altNames;for(const e in i)if("string"!=typeof e){t=!1;break}}return t}setup(e){switch(this.name=e.name,this.altNames=e.altNames,this.iconName=e.iconName,this.visible=e.visible,this.priority=e.priority,this.iconMinLevel=e.iconMinLevel,this.iconMaxLevel=e.iconMaxLevel,this.textMinLevel=e.textMinLevel,this.textMaxLevel=e.textMaxLevel,e.stackMode){case"yes":this.stackMode=r.PoiStackMode.Show;break;case"no":this.stackMode=r.PoiStackMode.Hide;break;case"parent":this.stackMode=r.PoiStackMode.ShowParent}}}class s{constructor(e,t){this.name=e,this.useAltNamesForKey=t,this.poiList=new Array,this.poiDict=new Map,this.m_isLoading=!1,this.m_loadedOk=void 0}get isLoading(){return this.m_isLoading}get loadedOk(){return!0===this.m_loadedOk}getEntry(e){const t=this.poiDict.get(e);if(void 0!==t){if(t<this.poiList.length)return this.poiList[t];throw new Error("Poi table entry index out of stored list!")}}async load(e){if(void 0!==this.m_loadedOk)return!0;this.m_loadedOk=!1;const t=await fetch(e);if(!t.ok)throw new Error(`load: Cannot load POI table at ${e}:`+` ${t.statusText}`);const i=await t.json();if(void 0===i)return n.info(`load: TextureAtlas empty: ${e}`),!0;this.startLoading();try{if(n.debug(`load: Loading POI table '${e}' for table '${this.name}'`),void 0!==i.poiList&&Array.isArray(i.poiList))for(const t of i.poiList)if(o.verifyJSON(t)){const i=new o;i.setup(t);const r=this.poiList.push(i)-1;if(this.useAltNamesForKey)if(void 0!==i.altNames&&i.altNames.length>0)for(const e of i.altNames)this.poiDict.set(e,r);else n.debug(`load: Invalid entry in POI table '${e}' : `+`No alternative names set in entry: ${JSON.stringify(t)}.`);else void 0===i.name?n.warn(`load: Invalid entry in POI table '${e}' : `+`. No name set in entry: ${t}.`):this.poiDict.set(i.name,r)}else n.warn(`load: Invalid entry in POI table '${e}' : ${JSON.stringify(t)}`);this.m_loadedOk=!0,this.finishedLoading()}catch(t){return n.error("load: Failed to load POI table "+`'${e}' : ${t}`),this.m_loadedOk=!1,this.finishedLoading(),!1}return!0}startLoading(){this.m_isLoading=!0}finishedLoading(){this.m_isLoading=!1}}t.PoiTable=s;t.PoiTableManager=class{constructor(e){this.mapView=e,this.m_isLoading=!1,this.m_poiTables=new Map}async loadPoiTables(e){return new Promise(t=>{if(this.clear(),void 0!==e.poiTables){this.startLoading();const i=new Array;e.poiTables.forEach(e=>{if(void 0!==e&&void 0!==e.name&&"string"==typeof e.name){const t=new s(e.name,!1!==e.useAltNamesForKey);void 0!==e.url&&"string"==typeof e.url?(this.addTable(t),i.push(t.load(e.url))):n.error(`POI table definition has no valid url: ${e}`)}else n.error(`POI table definition has no valid name: ${e}`)}),i.length>0?Promise.all(i).finally(()=>{this.finishLoading(),t()}):(this.finishLoading(),t())}else this.finishLoading(),t()})}clear(){this.m_poiTables=new Map}get poiTables(){return this.m_poiTables}addTable(e){this.m_poiTables.set(e.name,e)}getPoiTable(e){return void 0===e?void 0:this.m_poiTables.get(e)}get finishedLoading(){return!this.m_isLoading}startLoading(){this.m_isLoading=!0}finishLoading(){this.m_isLoading=!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolarTileDataSource=void 0;const r=i(0),n=i(2),o=i(243),s=i(3),a=i(53),l=i(19),c=i(38),h=i(36);class d extends a.DataSource{constructor({name:e="polar",styleSetName:t,minDataLevel:i,maxDataLevel:n,minDisplayLevel:o,maxDisplayLevel:a,storageLevelOffset:l=-2,geometryLevelOffset:c=1,debugTiles:h=!1}){super({name:e,styleSetName:t,minDataLevel:i,maxDataLevel:n,minDisplayLevel:o,maxDisplayLevel:a,storageLevelOffset:l}),this.m_tilingScheme=s.polarTilingScheme,this.m_maxLatitude=r.MathUtils.radToDeg(s.MercatorConstants.MAXIMUM_LATITUDE),this.m_geometryLevelOffset=c,this.m_debugTiles=h,this.cacheable=!1}dispose(){this.m_northPoleEntry&&(this.m_northPoleEntry.material.dispose(),delete this.m_northPoleEntry),this.m_southPoleEntry&&(this.m_southPoleEntry.material.dispose(),delete this.m_southPoleEntry),this.m_styleSetEvaluator&&delete this.m_styleSetEvaluator}createTechiqueEntry(e){if(!this.m_styleSetEvaluator)return;const t=new o.MapEnv({$geometryType:"polygon",$layer:"earth",kind:e}),i=this.m_styleSetEvaluator.getMatchingTechniques(t);if(0===i.length)return;const r=i[0],n=l.createMaterial({technique:r,env:this.mapView.env});return n?{material:n,technique:r}:void 0}setStyleSet(e,t,i){this.dispose(),void 0!==e&&(this.m_styleSetEvaluator=new o.StyleSetEvaluator(e,t),this.m_northPoleEntry=this.createTechiqueEntry("north_pole"),this.m_southPoleEntry=this.createTechiqueEntry("south_pole")),this.mapView.markTilesDirty(this)}setTheme(e,t){const i=void 0!==this.styleSetName&&e.styles&&e.styles[this.styleSetName]||[];this.setStyleSet(i,e.definitions,t)}canGetTile(e,t){if(e!==t.level||t.level<1)return!1;const{north:i,south:r}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||r<-this.m_maxLatitude}shouldSubdivide(e,t){if(e<=t.level)return!1;const{north:i,south:r}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||r<-this.m_maxLatitude}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new h.Tile(this,e);return this.createTileGeometry(t),t}get geometryLevelOffset(){return this.m_geometryLevelOffset}set geometryLevelOffset(e){this.m_geometryLevelOffset=e}intersectEdge(e,t,i){const r=t.latitude,n=i.latitude;let o=t.longitude,a=i.longitude;90===Math.abs(r)&&(o=a),90===Math.abs(n)&&(a=o);const l=a-o,c=(e-r)/(n-r);return new s.GeoCoordinates(e,o+l*c,0)}createTileGeometry(e){const{north:t,south:i}=e.geoBox,o=t>0&&i>=0,a=o?this.m_northPoleEntry:this.m_southPoleEntry;if(void 0===a)return void e.forceHasGeometry(!0);const l=this.m_tilingScheme.projection,h=this.projection,d=this.m_maxLatitude,u=o?d:-d,m=this.m_tilingScheme.boundingBoxGenerator.getWorldBox(e.tileKey),p=l.unprojectPoint(new r.Vector3(m.min.x,m.min.y,0)),f=l.unprojectPoint(new r.Vector3(m.max.x,m.min.y,0)),g=l.unprojectPoint(new r.Vector3(m.max.x,m.max.y,0)),v=l.unprojectPoint(new r.Vector3(m.min.x,m.max.y,0));let y,_=!1;if(1===e.tileKey.level){const e=0===m.min.x,t=e?m.max.x:m.min.x,i=(m.max.y+m.min.y)/2,n=l.unprojectPoint(new r.Vector3(t,i,0)),s=e?p:f;y=o?e?[n,g,s,f]:[n,p,s,v]:e?[n,f,s,g]:[n,v,s,p],_=!0}else{y=o?[p,f,g,v]:[p,v,g,f];const e=y.map(e=>e.latitude),t=Math.max(...e),i=Math.min(...e);if(o?t<u:i>u)return;if(_=o?i<u:t>u,_){const r=e.indexOf(o?t:i);if(0!==r)for(let e=0;e<r;e++)y.push(y.shift())}}if(_){const t=(m.min.x+m.max.x)/2,i=(m.min.y+m.max.y)/2,n=l.unprojectPoint(new r.Vector3(t,i,0));s.TransverseMercatorUtils.alignLongitude(y,n);const o=y[0],a=y[1],c=y[2],h=y[3],p=Math.abs(a.latitude)>=d,f=Math.abs(h.latitude)>=d,g=p?this.intersectEdge(u,a,c):this.intersectEdge(u,o,a),v=f?this.intersectEdge(u,h,c):this.intersectEdge(u,o,h);y.splice(p?2:1,4,g);const _=e.tileKey.level-this.storageLevelOffset+this.m_geometryLevelOffset,x=360/(1<<Math.max(0,_)),S=Math.floor((g.longitude+180)/x),b=Math.ceil((v.longitude+180)/x);for(let e=S+1;e<b;e++)y.push(new s.GeoCoordinates(u,e*x-180,0));y.push(v),f&&y.push(h)}const x=new r.Geometry;for(const t of y){const i=h.projectPoint(t,new r.Vector3);x.vertices.push(i.sub(e.center))}for(let e=1;e<y.length-1;e++)x.faces.push(o?new r.Face3(0,e,e+1):new r.Face3(0,e+1,e));const S=new r.BufferGeometry;S.fromGeometry(x),x.dispose();const b=new r.Mesh(S,a.material);if(b.userData={dataSource:this.name,tileKey:e.tileKey},this.m_debugTiles){const t=Math.round(16777215*Math.abs(Math.sin(11*e.tileKey.mortonCode())));b.material=new r.MeshBasicMaterial({color:t,transparent:!0,opacity:.5}),e.objects.push(new r.Mesh(S,new r.MeshBasicMaterial({color:t,wireframe:!0})))}c.MapObjectAdapter.create(b,{technique:a.technique,kind:[o?n.StandardGeometryKind.Water:n.StandardGeometryKind.Background]}),e.objects.push(b)}}t.PolarTileDataSource=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyCubemapTexture=t.SkyCubemapFaceId=t.SKY_CUBEMAP_FACE_COUNT=void 0;const r=i(1),n=i(0),o=r.LoggerManager.instance.create("SkyCubemapTexture");var s;t.SKY_CUBEMAP_FACE_COUNT=6,function(e){e[e.positiveX=0]="positiveX",e[e.negativeX=1]="negativeX",e[e.positiveY=2]="positiveY",e[e.negativeY=3]="negativeY",e[e.positiveZ=4]="positiveZ",e[e.negativeZ=5]="negativeZ"}(s=t.SkyCubemapFaceId||(t.SkyCubemapFaceId={}));t.SkyCubemapTexture=class{constructor(e){const t=this.createCubemapFaceArray(e);this.m_skybox=void 0!==t?(new n.CubeTextureLoader).load(t):new n.CubeTexture}dispose(){this.m_skybox.dispose()}get texture(){return this.m_skybox}updateTexture(e){const t=this.createCubemapFaceArray(e);void 0!==t&&(this.m_skybox=(new n.CubeTextureLoader).load(t))}createCubemapFaceArray(e){const i=[void 0,void 0,void 0,void 0,void 0,void 0];for(let r=0;r<t.SKY_CUBEMAP_FACE_COUNT;++r){const t=e[s[r]];if(void 0===t)return void o.error(`Face "${s[r]}" was not defined.`);i[r]=t}return i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeLoader=t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH=void 0;const r=i(2),n=i(34),o=i(1),s=i(118);i(11),t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH=4;class a{static async load(e,t){if(t=t||{},"string"==typeof e){const i=t.uriResolver,r=void 0!==i?i.resolveUri(e):e,n=await fetch(r,{signal:t.signal});if(!n.ok)throw new Error(`ThemeLoader#load: cannot load theme: ${n.statusText}`);(e=await n.json()).url=o.resolveReferenceUri(o.getAppBaseUrl(),r),e=this.resolveUrls(e,t)}else void 0===e.url?(e.url=o.getAppBaseUrl(),e=this.resolveUrls(e,t)):e=this.convertFlatTheme(e);if(null==e)throw new Error("ThemeLoader#load: loaded resource is not valid JSON");a.checkTechniqueSupport(e);const i=o.getOptionValue(t.resolveDefinitions,!1);if(e=await a.resolveBaseThemes(e,t),i){const i=new o.ContextLogger(t.logger||console,`when processing Theme ${e.url}:`);a.resolveThemeReferences(e,i)}return e}static isThemeLoaded(e){return void 0===e.extends}static async loadAsync(e){return a.load(e)}static resolveUrls(e,t){if(void 0===(e=a.convertFlatTheme(e)).url)return e;const i=o.composeUriResolvers(null==t?void 0:t.uriResolver,new o.RelativeUriResolver(e.url)),r=void 0===t||!(!1===t.resolveIncludeUris);return e.extends&&r&&(e.extends=(Array.isArray(e.extends)?e.extends:[e.extends]).map(r=>"string"==typeof r?i.resolveUri(r):void 0!==r.url?r:(r.url=e.url,this.resolveUrls(r,t)))),a.convertFlatTheme(e)?((void 0===t||!(!1===t.resolveResourceUris))&&a.resolveResources(e,i),e):e}static checkTechniqueSupport(e){if(void 0!==e.styles)for(const t in e.styles)if(e.styles.hasOwnProperty(t))for(const i of e.styles[t])i.technique}static resolveThemeReferences(e,t){if(void 0!==e.definitions){t.pushAttr("definitions");for(const i in e.definitions){if(!e.definitions.hasOwnProperty(i))continue;const r=e.definitions[i];if(n.isActualSelectorDefinition(r)){t.pushAttr(i);const n=a.resolveStyle(r,e.definitions,t);t.pop(),void 0===n?(t.pushAttr(i),t.warn("skipping invalid style in definition"),t.pop(),delete e.definitions[i]):e.definitions[i]=n}}t.pop()}if(void 0!==e.styles)for(const i in e.styles)e.styles.hasOwnProperty(i)&&(t.pushAttr("styles"),t.pushAttr(i),e.styles[i]=a.resolveStyleSet(e.styles[i],e.definitions,t),t.pop(),t.pop());return e}static resolveStyleSet(e,t,i){const r=[];for(let n=0;n<e.length;++n){const o=e[n];i.pushIndex(n);const s=a.resolveStyle(o,t,i);void 0!==s?r.push(s):i.warn("invalid style, ignored"),i.pop()}return r}static resolveStyle(e,t,i){if(n.isJsonExprReference(e)){const r=t&&t[e[1]];if(!r)return void i.warn(`invalid reference '${e[1]}' - not found`);if(!n.isActualSelectorDefinition(r))return void i.warn(`invalid reference '${e[1]}' - expected style definition`);e=o.cloneDeep(r)}if(e=e,Array.isArray(e.when)){i.pushAttr("when");const r=this.resolveExpressionReferences(e.when,t,i);if(i.pop(),void 0===r)return;e.when=r}if(void 0!==e.attr){const r=e.attr;i.pushAttr("attr");for(const e in r){if(!r.hasOwnProperty(e))continue;const n=r[e];if(!Array.isArray(n))continue;i.pushAttr(e);const o=this.resolveExpressionReferences(n,t,i);i.pop(),void 0!==o?r[e]=o:delete r[e]}i.pop()}return e}static resolveExpressionReferences(e,t,i){let o=!1;const s=function e(s){if(n.isJsonExprReference(s)){const e=s[1],a=t&&t[e];return void 0===a?(i.warn(`invalid reference '${e}' - not found`),void(o=!0)):n.isLiteralDefinition(a)||r.isJsonExpr(a)?a:n.isBoxedDefinition(a)?a.value:(i.warn(`invalid reference '${e}' - expected value definition`),void(o=!0))}if(Array.isArray(s)){const t=[...s];for(let i=1;i<t.length;++i)t[i]=e(t[i]);return t}return s}(e);if(!o)return s}static async resolveBaseThemes(e,i){if(i=i||{},void 0===e.extends)return e;const r=o.getOptionValue(i.maxInheritanceDepth,t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH);if(r<=0)throw new Error("maxInheritanceDepth reached when attempting to load base theme");const n=Array.isArray(e.extends)?e.extends:[e.extends];delete e.extends;let s={};for(const e of n){const t=await a.load(e,Object.assign(Object.assign({},i),{resolveDefinitions:!1,maxInheritanceDepth:r-1}));s=a.mergeThemes(t,s)}return a.mergeThemes(e,s)}static mergeThemes(e,t){const i=Object.assign(Object.assign({},t.definitions),e.definitions);let r;if(t.styles&&e.styles){const i=Object.keys(t.styles),n=Object.keys(e.styles);r={},i.forEach(i=>{const o=n.indexOf(i);-1!==o?(r[i]=[...t.styles[i],...e.styles[i]],n.splice(o,1)):r[i]=t.styles[i]}),n.forEach(t=>{r[t]=e.styles[t]})}else t.styles?r=Object.assign({},t.styles):e.styles&&(r=Object.assign({},e.styles));return Object.assign(Object.assign(Object.assign({},t),e),{definitions:i,styles:r})}static convertFlatTheme(e){if(Array.isArray(e.styles)){const t={};e.styles.forEach(e=>{if(r.isJsonExpr(e))throw new Error("invalid usage of theme reference");const i=e.styleSet;if(void 0===i)throw new Error("missing reference to style set");t[i]||(t[i]=[]),t[i].push(e)}),e.styles=t}return e}static resolveResources(e,t){if(e.sky&&"cubemap"===e.sky.type)for(let i=0;i<s.SKY_CUBEMAP_FACE_COUNT;++i){const r=e.sky[s.SkyCubemapFaceId[i]];void 0!==r&&(e.sky[s.SkyCubemapFaceId[i]]=t.resolveUri(r))}if(e.images)for(const i of Object.keys(e.images)){const r=e.images[i];r.url=t.resolveUri(r.url),void 0!==r.atlas&&(r.atlas=t.resolveUri(r.atlas))}if(e.fontCatalogs)for(const i of e.fontCatalogs)i.url=t.resolveUri(i.url);if(e.poiTables)for(const i of e.poiTables)i.url=t.resolveUri(i.url);if(void 0!==e.styles)for(const i in e.styles){if(!e.styles.hasOwnProperty(i))continue;const r=e.styles[i];for(const e of r)e.attr&&["map","normalMap","displacementMap","roughnessMap"].forEach(i=>{const r=e.attr[i];r&&"string"==typeof r&&(e.attr[i]=t.resolveUri(r))})}}}t.ThemeLoader=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibleTileSet=t.ResourceComputationType=void 0;const r=i(3),n=i(85),o=i(1),s=i(0),a=i(96),l=i(10);var c,h;!function(e){e[e.EstimationInMb=0]="EstimationInMb",e[e.NumberOfTiles=1]="NumberOfTiles"}(c=t.ResourceComputationType||(t.ResourceComputationType={})),function(e){e[e.NONE=0]="NONE",e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.BOTH=3]="BOTH"}(h||(h={}));class d{constructor(e,t=c.EstimationInMb){this.m_disposedTiles=[],this.m_resourceComputationType=t,this.m_tileCache=new n.LRUCache(e,e=>this.m_resourceComputationType===c.EstimationInMb?e.memoryUsage*(1/1048576):1),this.m_tileCache.evictionCallback=(e,t)=>{void 0!==t.tileLoader&&t.tileLoader.cancel(),this.m_disposedTiles.push(t)},this.m_tileCache.canEvict=(e,t)=>!t.isVisible}static getKey(e,t,i){return`${i.name}_${e}_${t}`}static getKeyForTile(e){return d.getKey(e.tileKey.mortonCode(),e.offset,e.dataSource)}get resourceComputationType(){return this.m_resourceComputationType}get capacity(){return this.m_tileCache.capacity}get size(){return this.m_tileCache.size}setCapacity(e,t){this.m_resourceComputationType=t,this.m_tileCache.setCapacityAndMeasure(e,e=>this.m_resourceComputationType===c.EstimationInMb?e.memoryUsage*(1/1048576):1)}get(e,t,i){return this.m_tileCache.get(d.getKey(e,t,i))}set(e,t,i,r){this.m_tileCache.set(d.getKey(e,t,i),r)}delete(e){const t=d.getKeyForTile(e);this.deleteByKey(t)}deleteByKey(e){this.m_tileCache.delete(e)}disposeTiles(){this.m_disposedTiles.forEach(e=>{e.dispose()}),this.m_disposedTiles.length=0}shrinkToCapacity(){this.m_tileCache.shrinkToCapacity()}evictAll(){this.m_tileCache.evictAll()}evictSelected(e){this.m_tileCache.evictSelected(e)}forEach(e,t){this.m_tileCache.forEach((i,r)=>{void 0!==t&&i.dataSource!==t||e(i,r)})}}t.VisibleTileSet=class{constructor(e,t,i){this.m_frustumIntersection=e,this.m_tileGeometryManager=t,this.options=i,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_cameraOverride=new s.PerspectiveCamera,this.m_viewRange={near:.1,far:1/0,minimum:.1,maximum:1/0},this.m_coveringMap=new Map,this.m_resourceComputationType=c.EstimationInMb,this.m_resourceComputationType=void 0===i.resourceComputationType?c.EstimationInMb:i.resourceComputationType,this.m_dataSourceCache=new d(this.options.tileCacheSize,this.m_resourceComputationType)}getDataSourceCacheSize(){return this.options.tileCacheSize}setDataSourceCacheSize(e,t=c.EstimationInMb){this.options.tileCacheSize=e,this.resourceComputationType=t}getNumberOfVisibleTiles(){return this.options.maxVisibleDataSourceTiles}setNumberOfVisibleTiles(e){this.options.maxVisibleDataSourceTiles=e}get resourceComputationType(){return this.m_resourceComputationType}set resourceComputationType(e){this.m_resourceComputationType=e,this.m_dataSourceCache.setCapacity(this.options.tileCacheSize,e)}updateClipPlanes(e,t){void 0!==e&&(this.options.clipPlanesEvaluator.maxElevation=e),void 0!==t&&(this.options.clipPlanesEvaluator.minElevation=t);const{camera:i,projection:r,elevationProvider:n}=this.m_frustumIntersection.mapView;return this.m_viewRange=this.options.clipPlanesEvaluator.evaluateClipPlanes(i,r,n),this.m_viewRange}updateRenderList(e,t,i,r){let n=!0;const s=this.getVisibleTileKeysForDataSources(t,i,r);this.dataSourceTileList=[],this.m_coveringMap.clear();for(const{dataSource:i,visibleTileKeys:r}of s.tileKeys){r.sort((e,t)=>{const i=e.distance-t.distance,r=1e-6*(e.distance+t.distance);return Math.abs(i)<r?e.tileKey.mortonCode()-t.tileKey.mortonCode():i});const o=[];let s=!0,a=0;const l=i.getDataZoomLevel(t);for(let e=0;e<r.length&&o.length<this.options.maxVisibleDataSourceTiles;e++){const t=r[e],n=this.getTile(i,t.tileKey,t.offset);void 0!==n&&(s=s&&n.allGeometryLoaded,n.allGeometryLoaded?(n.numFramesVisible++,this.skipOverlappedTiles(i,n),n.frameNumVisible<0&&(n.frameNumVisible=i.mapView.frameNumber)):a++,n.visibleArea=t.area,n.elevationRange=t,o.push(n))}this.m_tileGeometryManager.updateTiles(o),this.dataSourceTileList.push({dataSource:i,storageLevel:e,zoomLevel:l,allVisibleTileLoaded:s,numTilesLoading:a,visibleTiles:o,renderedTiles:new Map}),n=n&&s}let a,l;this.allVisibleTilesLoaded=n&&s.allBoundingBoxesFinal,this.populateRenderedTiles(),this.forEachCachedTile(e=>{e.isVisible||void 0===e.tileLoader||e.tileLoader.isFinished||this.disposeTile(e)}),this.m_dataSourceCache.shrinkToCapacity(),this.dataSourceTileList.forEach(e=>{e.renderedTiles.forEach(t=>{t.update(e.zoomLevel),a=o.MathUtils.min2(a,t.geoBox.minAltitude),l=o.MathUtils.max2(l,t.geoBox.maxAltitude)})}),void 0===a&&(a=0),void 0===l&&(l=0);let c=!1;const h=this.m_viewRange,d=this.updateClipPlanes(l,a);var u,m;return c=!1==(m=h,(u=d).far===m.far&&u.maximum===m.maximum&&u.minimum===m.minimum&&u.near===m.near),{viewRanges:d,viewRangesChanged:c}}getTile(e,t,i=0){return this.getTileImpl(e,t,i,!1)}getCachedTile(e,t,i=0){o.assert(e.cacheable);return this.getTileImpl(e,t,i,!0)}getRenderedTile(e,t,i=0){const r=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0!==r)return r.renderedTiles.get(l.TileOffsetUtils.getKeyForTileKeyAndOffset(t,i))}getRenderedTileAtLocation(e,t,i=0){const n=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0===n)return;const o=e.getTilingScheme(),s=n.zoomLevel,a=o.getTileKey(t,s);if(!a)return;let c=n.renderedTiles.get(l.TileOffsetUtils.getKeyForTileKeyAndOffset(a,i));if(void 0!==c)return c;const{searchLevelsUp:h,searchLevelsDown:d}=this.getSearchDirection(e,s);let u=a;for(let e=1;e<=h;++e)if(u=u.parent(),c=n.renderedTiles.get(l.TileOffsetUtils.getKeyForTileKeyAndOffset(u,i)),void 0!==c)return c;const m=o.projection.projectPoint(t);for(let e=1;e<=d;++e){const t=s+e,a=r.TileKeyUtils.worldCoordinatesToTileKey(o,m,t);if(a&&(c=n.renderedTiles.get(l.TileOffsetUtils.getKeyForTileKeyAndOffset(a,i)),void 0!==c))return c}}removeDataSource(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter(t=>t.dataSource!==e)}clearTileCache(e){void 0!==e?this.m_dataSourceCache.evictSelected((t,i)=>t.dataSource===e):this.m_dataSourceCache.evictAll()}markTilesDirty(e){if(void 0===e)this.dataSourceTileList.forEach(e=>{this.markDataSourceTilesDirty(e)});else{const t=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0===t)return;this.markDataSourceTilesDirty(t)}}disposePendingTiles(){this.m_dataSourceCache.disposeTiles()}forEachVisibleTile(e){for(const t of this.dataSourceTileList)t.renderedTiles.forEach(e)}forEachCachedTile(e,t){this.m_dataSourceCache.forEach((t,i)=>e(t),t)}disposeTile(e){this.m_dataSourceCache.delete(e),e.dispose()}skipOverlappedTiles(e,t){if(this.options.projection.type!==r.ProjectionType.Spherical&&e.isFullyCovering()){const i=t.uniqueKey,r=this.m_coveringMap.get(i);void 0===r?(t.skipRendering=!1,this.m_coveringMap.set(i,t)):r.dataSource instanceof a.BackgroundDataSource?r.skipRendering=!0:e instanceof a.BackgroundDataSource&&(t.skipRendering=!0)}}getSearchDirection(e,t){const i=Math.min(this.options.quadTreeSearchDistanceUp,Math.max(0,t-e.minDataLevel)),r=Math.min(this.options.quadTreeSearchDistanceDown,Math.max(0,e.maxDataLevel-t));return{searchDirection:r>0&&i>0?h.BOTH:r>0?h.DOWN:i>0?h.UP:h.NONE,searchLevelsUp:i,searchLevelsDown:r}}populateRenderedTiles(){this.dataSourceTileList.forEach(e=>{const t=e.renderedTiles,i=[];e.visibleTiles.forEach(e=>{e.levelOffset=0,e.hasGeometry?t.set(e.uniqueKey,e):i.push(e.uniqueKey)});const r=e.dataSource;if(0===i.length||!1===r.allowOverlappingTiles)return;const n=e.zoomLevel,{searchDirection:o}=this.getSearchDirection(r,n),s=new Map;for(const e of i)(o!==h.BOTH&&o!==h.UP||!this.findUp(e,n,t,s,r))&&(o!==h.BOTH&&o!==h.DOWN||this.findDown(e,n,t,r))})}findDown(e,t,i,n){const{offset:o,mortonCode:s}=l.TileOffsetUtils.extractOffsetAndMortonKeyFromKey(e),a=r.TileKey.fromMortonCode(s),c=n.getTilingScheme();for(const e of c.getSubTileKeys(a)){const r=l.TileOffsetUtils.getKeyForTileKeyAndOffset(e,o),s=this.m_dataSourceCache.get(e.mortonCode(),o,n),a=Math.abs(e.level-t);void 0!==s&&s.hasGeometry?(i.set(r,s),s.levelOffset=a):a<this.options.quadTreeSearchDistanceDown&&this.findDown(r,t,i,n)}}findUp(e,t,i,n,o){const s=l.TileOffsetUtils.getParentKeyFromKey(e);if(void 0!==i.get(s))return!0;const a=n.get(s);if(void 0!==a)return a;const{offset:c,mortonCode:h}=l.TileOffsetUtils.extractOffsetAndMortonKeyFromKey(s),d=this.m_dataSourceCache.get(h,c,o),u=d?d.tileKey:r.TileKey.fromMortonCode(h),m=Math.abs(t-u.level);if(void 0!==d&&d.hasGeometry)return n.set(s,!0),i.set(s,d),d.levelOffset=-m,!0;if(n.set(s,!1),m<this.options.quadTreeSearchDistanceUp&&0!==u.level){const e=this.findUp(s,t,i,n,o);if(n.set(s,e),e)return!0}return!1}getTileImpl(e,t,i,r){function n(t){void 0!==t&&(t.frameNumLastRequested=e.mapView.frameNumber)}if(!e.cacheable&&!r){const i=e.getTile(t);return n(i),i}const o=this.m_dataSourceCache;let s=o.get(t.mortonCode(),i,e);return void 0!==s&&s.offset===i?(n(s),s):r?void 0:(s=e.getTile(t),void 0!==s&&(s.offset=i,n(s),o.set(t.mortonCode(),i,e,s),this.m_tileGeometryManager.initTile(s)),s)}markDataSourceTilesDirty(e){const t=this.m_dataSourceCache,i=new Set;function r(e,t){const r=d.getKeyForTile(e);i.has(r)||(i.add(r),void 0!==e.tileGeometryLoader&&e.tileGeometryLoader.reset(),e.clearTextElements(),e.load())}e.visibleTiles.forEach(e=>{r(e,this.m_tileGeometryManager)}),e.renderedTiles.forEach(e=>{r(e,this.m_tileGeometryManager)}),t.forEach((e,r)=>{i.has(r)||(t.deleteByKey(r),e.dispose())},e.dataSource)}getVisibleTileKeysForDataSources(e,t,i){const r=Array();let n=!0;if(0===t.length)return{tileKeys:r,allBoundingBoxesFinal:n};const o=new Map;t.forEach(e=>{const t=e.getTilingScheme(),i=o.get(t);void 0===i?o.set(t,[e]):i.push(e)}),void 0!==i?(this.m_cameraOverride.copy(this.m_frustumIntersection.camera),this.m_cameraOverride.near=Math.min(this.m_cameraOverride.near,this.m_viewRange.minimum),this.m_cameraOverride.far=Math.max(this.m_cameraOverride.far,this.m_viewRange.maximum),this.m_cameraOverride.updateProjectionMatrix(),this.m_frustumIntersection.updateFrustum(this.m_cameraOverride.projectionMatrix)):this.m_frustumIntersection.updateFrustum();for(const[t,s]of o){const o=s.map(t=>t.getDataZoomLevel(e)),a=this.m_frustumIntersection.compute(t,i,o,s);n=n&&a.calculationFinal;for(const t of s){const i=[],n=t.getDataZoomLevel(e);for(const e of a.tileKeyEntries.get(n).values())t.canGetTile(n,e.tileKey)&&i.push(e);r.push({dataSource:t,visibleTileKeys:i})}}return{tileKeys:r,allBoundingBoxesFinal:n}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightCoverageProvider=void 0;const r=i(1),n=i(108);t.CopyrightCoverageProvider=class{constructor(){this.logger=r.LoggerManager.instance.create("CopyrightCoverageProvider")}getTree(){return void 0!==this.m_cachedTreePromise||(this.m_cachedTreePromise=this.getCopyrightCoverageData().then(e=>this.initRBush(e)).catch(e=>(this.logger.error(e),new n))),this.m_cachedTreePromise}async getCopyrights(e,t){const i=[],n=(await this.getTree()).search({minX:e.west,minY:e.south,maxX:e.east,maxY:e.north});for(const e of n){const n=r.getOptionValue(e.minLevel,0),o=r.getOptionValue(e.maxLevel,1/0);t>=n&&t<=o&&void 0===i.find(t=>t.id===e.label)&&i.push({id:e.label})}return i}initRBush(e){const t=new n;if(!e)return this.logger.warn("No copyright coverage data provided"),t;for(const i of e){const{minLevel:e,maxLevel:r,label:n,alt:o}=i;if(i.boxes)for(const s of i.boxes){const[i,a,l,c]=s;t.insert({minX:a,minY:i,maxX:c,maxY:l,minLevel:e,maxLevel:r,label:n,alt:o})}else t.insert({minX:-180,minY:-90,maxX:180,maxY:180,minLevel:e,maxLevel:r,label:n,alt:o})}return t}}},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(256),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedBufferedGeometryLineAccessor=t.IndexedBufferedGeometryAccessor=t.BufferedGeometryObject3dAccessor=t.BufferedGeometryLineAccessor=t.BufferedGeometryAccessor=t.BufferedGeometryAccessorBase=t.isObject3dAccessor=t.isLineAccessor=void 0;const r=i(2),n=i(265),o=i(1),s=o.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};class a{constructor(e,t,i){this.object=e,this.geometryType=t,this.bufferGeometry=i,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,o.assert(!!e),"BufferGeometry"!==i.type&&s.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),o.assert("BufferGeometry"===i.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||s.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&s.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}getCount(){return this.position.count}get renderOrder(){return this.object.renderOrder}setRange(e,t,i=0,r=0){o.assert(e>=0),o.assert(t>=0),o.assert(e<=t),this.start=e,this.end=t,this.startCapSize=i,this.endCapSize=r}get color(){const e=e=>{const t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){const t=e;if("SolidLineMaterial"===t.name)return t.uniforms.diffuse.value;s.warn("BufferedGeometryAccessor#color: unknown shader material name",t.name)}else s.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){const t=new Array,i=this.object.material;for(const r of i)t.push(e(r));return t}return e(this.object.material)}}t.BufferedGeometryAccessorBase=a;class l extends a{constructor(e,t,i,r){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.stride=r}clear(){o.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.position.array,t=this.start*this.itemSize,i=this.end*this.itemSize;for(let r=t;r<i;r++)e[r]=0;this.position.needsUpdate=!0}getVertices(){o.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)}checkSetUp(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end}}t.BufferedGeometryAccessor=l;t.BufferedGeometryLineAccessor=class extends l{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){o.assert(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")}};t.BufferedGeometryObject3dAccessor=class extends l{constructor(e,t,i){super(e,t,i,1),this.object=e,this.geometryType=t,this.bufferGeometry=i}isObject3dAccessor(){return!0}getVertices(){return super.getVertices()}};class c extends a{constructor(e,t,i,r,n){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.indices=null!==this.bufferGeometry.index?this.bufferGeometry.index.array:void 0,this.indices?this.indices instanceof Uint32Array||(s.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),o.assert(this.indices instanceof Uint32Array)):(s.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),o.assert(!!this.indices))}getCount(){return this.indices.length}checkSetUp(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end}}t.IndexedBufferedGeometryAccessor=c;t.IndexedBufferedGeometryLineAccessor=class extends c{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){if(o.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===r.GeometryType.ExtrudedLine){const e=this.start+this.startCapSize,t=this.position.array;return n.reconstructLineWidth(t,e)}}clear(){o.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.start,t=this.end;for(let i=e;i<t;i++)this.indices[i]=0;null!==this.bufferGeometry.index&&(this.bufferGeometry.index.needsUpdate=!0)}getVertices(){o.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.itemSize,t=this.start,i=this.end,r=new Float32Array((i-t)*e),n=this.position.array;if(2===e)for(let o=t,s=0;o<i;o++,s+=e){const t=this.indices[o];r[s+0]=n[t*e+0],r[s+1]=n[t*e+1]}if(3===e)for(let o=t,s=0;o<i;o++,s+=e){const t=this.indices[o];r[s+0]=n[t*e+0],r[s+1]=n[t*e+1],r[s+2]=n[t*e+2]}else for(let o=t,s=0;o<i;o++,s++){const t=this.indices[o];for(let i=0;i<e;i++)r[s*e+i]=n[t*e+i]}return r}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructLineWidth=t.reconstructLine=t.triangulateLine=t.numCirclePoints=void 0;const r=i(0),n=new r.Vector3(0,0,1),o=[0,1,2,1,3,2],s=[0,1,3,3,1,2,0,3,4,5,4,3],a=Math.PI/8;function l(e,t,i,r,n,o){const s=n.length/3;n.push(e,t,0);for(let l=0;l<9;++l){const c=a*l+Math.PI/2+i;n.push(e+r*Math.cos(c),t+r*Math.sin(c),0),o.push(s,s+l+1,s+(l+1)%9+1)}}t.numCirclePoints=function(e){return 9},t.triangulateLine=function(e,t,i,a,c=!0,h=c){if(e.length<3)return;const d=new r.Vector2;if(c){const r=3!==e.length?d.set(e[3]-e[0],e[4]-e[1]).angle():0;l(e[0],e[1],r,t,i,a)}const u=i.length/3,m=new r.Vector3,p=new r.Vector3,f=new r.Vector3,g=new r.Vector3,v=new r.Vector3,y=new r.Vector3,_=new r.Vector3,x=new r.Vector3,S=new r.Vector3,b=e.length/3;let T=0;for(let r=0;r<b;++r){let l=!1;if(p.set(e[3*r],e[3*r+1],e[3*r+2]),r+1<b){if(f.set(e[3*(r+1)],e[3*(r+1)+1],e[3*(r+1)+2]),g.copy(f).sub(p).normalize().cross(n),v.copy(g),r>0&&(v.add(m).multiplyScalar(1-.5*g.dot(m)),l=m.angleTo(g)>Math.PI/2,l)){const e=t/Math.cos(g.angleTo(m)/2);y.copy(g).add(m).normalize().multiplyScalar(-e).add(p),_.copy(m).multiplyScalar(t).add(p),x.copy(g).add(m).normalize().multiplyScalar(e).add(p),S.copy(g).multiplyScalar(t).add(p)}l?i.push(y.x,y.y,y.z,_.x,_.y,_.z,x.x,x.y,x.z,S.x,S.y,S.z):(y.copy(v).multiplyScalar(-t).add(p),_.copy(v).multiplyScalar(t).add(p),i.push(y.x,y.y,y.z,_.x,_.y,_.z)),m.copy(g)}else y.copy(m).multiplyScalar(-t).add(p),_.copy(m).multiplyScalar(t).add(p),i.push(y.x,y.y,y.z,_.x,_.y,_.z);r!==b-1&&((l?s:o).forEach(e=>a.push(u+T+e)),T+=l?4:2)}if(h){const r=2!==e.length?d.set(e[3*(b-3)]-e[3*(b-2)],e[3*(b-3)+1]-e[3*(b-2)+1]).angle():Math.PI;l(e[3*(b-2)],e[3*(b-2)+1],r,t,i,a)}},t.reconstructLine=function(e,t){const i=new Float32Array(e.length/2);for(let r=3*t,n=2*r;r<i.length;r+=3,n+=6)i[r]=e[n]+.5*(e[n+3]-e[n]),i[r+1]=e[n+1]+.5*(e[n+3+1]-e[n+1]),i[r+2]=e[n+2]+.5*(e[n+3+2]-e[n+2]);return i},t.reconstructLineWidth=function(e,t){const i=e[2*t+3]-e[2*t],r=e[2*t+3+1]-e[2*t+1],n=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(i*i+r*r+n*n)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionLine=t.HighPrecisionWireFrameLine=void 0;const r=i(4),n=i(0),o=i(60);class s extends n.Line{constructor(e,t,i,o,s){super(void 0===e?new n.BufferGeometry:e,t),void 0===t&&(t=new r.HighPrecisionLineMaterial({color:o||r.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:r.HighPrecisionLineMaterial.DEFAULT_OPACITY})),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){o.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,r,n,s)=>{o.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.getInverse(this.matrixWorld)}}t.HighPrecisionWireFrameLine=s;class a extends n.Mesh{constructor(e,t,i,o,s){super(void 0===e?new n.BufferGeometry:e,t),void 0===t&&(t=new r.HighPrecisionLineMaterial({color:o||r.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:r.HighPrecisionLineMaterial.DEFAULT_OPACITY})),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){o.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,r,n,s)=>{o.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.getInverse(this.matrixWorld)}}t.HighPrecisionLine=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileInfoLoader=t.TileLoader=void 0,i(11);const r=i(2),n=i(16),o=i(1).LoggerManager.instance.create("TileLoader");class s{constructor(e,t,i,r,o){this.dataSource=e,this.tileKey=t,this.dataProvider=i,this.tileDecoder=r,this.priority=o,this.state=n.TileLoaderState.Initialized,this.loadAbortController=new AbortController}loadAndDecode(){switch(this.state){case n.TileLoaderState.Loading:case n.TileLoaderState.Loaded:case n.TileLoaderState.Decoding:return this.donePromise;case n.TileLoaderState.Ready:case n.TileLoaderState.Failed:case n.TileLoaderState.Initialized:case n.TileLoaderState.Canceled:return this.startLoading(),this.donePromise}}waitSettled(){return this.donePromise?this.donePromise:Promise.resolve(this.state)}cancel(){switch(this.state){case n.TileLoaderState.Loading:this.loadAbortController.abort(),this.loadAbortController=new AbortController;break;case n.TileLoaderState.Decoding:this.requestController&&(this.requestController.abort(),this.requestController=void 0)}this.onDone(n.TileLoaderState.Canceled)}get isFinished(){return this.state===n.TileLoaderState.Ready||this.state===n.TileLoaderState.Canceled||this.state===n.TileLoaderState.Failed}updatePriority(e){this.priority=e,void 0!==this.requestController&&(this.requestController.priority=e)}startLoading(){const e=this.loadAbortController.signal;this.dataProvider.getTile(this.tileKey,e).then(t=>{if(e.aborted){const e=new Error("Aborted");throw e.name="AbortError",e}this.onLoaded(t)}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&this.onError(e)}),void 0===this.donePromise&&(this.donePromise=new Promise((e,t)=>{this.resolveDonePromise=e,this.rejectedDonePromise=t})),this.state=n.TileLoaderState.Loading}onLoaded(e){this.state=n.TileLoaderState.Loaded,this.payload=e,0===e.byteLength||e.constructor===Object&&0===Object.keys(e).length?this.onDone(n.TileLoaderState.Ready):this.startDecodeTile()}startDecodeTile(){const e=this.payload;if(void 0===e)return void o.error("TileLoader#startDecodeTile: Cannot decode without payload");this.state=n.TileLoaderState.Decoding,this.payload=void 0;const t=new r.RequestController(this.priority);this.requestController=t;const i=this.dataSource;this.tileDecoder.decodeTile(e,this.tileKey,i.projection,t).then(e=>{t.signal.aborted||this.onDecoded(e)}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&this.onError(e)})}onDecoded(e){this.decodedTile=e,this.onDone(n.TileLoaderState.Ready)}cancelDecoding(){void 0!==this.requestController&&(this.requestController.abort(),this.requestController=void 0)}onDone(e){this.resolveDonePromise&&e===n.TileLoaderState.Ready?this.resolveDonePromise(e):this.rejectedDonePromise&&this.rejectedDonePromise(e),this.resolveDonePromise=void 0,this.rejectedDonePromise=void 0,this.donePromise=void 0,this.state=e}onError(e){if(this.state===n.TileLoaderState.Canceled)return;const t=this.dataSource;o.error(`[${t.name}]: failed to load tile ${this.tileKey.mortonCode()}`,e),this.error=e,this.onDone(n.TileLoaderState.Failed)}}t.TileLoader=s;t.TileInfoLoader=class extends s{startDecodeTile(){const e=this.payload;if(void 0===e)return void o.error("TileInfoLoader#startDecodeTile: Cannot decode without payload");this.state=n.TileLoaderState.Decoding,this.payload=void 0;const t=new r.RequestController(this.priority);this.requestController=t;const i=this.dataSource;this.tileDecoder.getTileInfo(e,this.tileKey,i.projection,t).then(e=>{t.signal.aborted||(this.tileInfo=e,this.onDone(n.TileLoaderState.Ready))}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&this.onError(e)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvRestClient=t.AuthenticationTypeAccessToken=t.AuthenticationTypeTomTomV1=t.AuthenticationTypeBearer=t.AuthenticationMethod=t.APIFormat=void 0,i(11);const r=i(122),n=i(1).LoggerManager.instance.create("OmvRestClient");var o,s;!function(e){e[e.HereV1=0]="HereV1",e[e.MapboxV4=1]="MapboxV4",e[e.XYZMVT=2]="XYZMVT",e[e.XYZJson=3]="XYZJson",e[e.XYZOMV=4]="XYZOMV",e[e.TomtomV1=5]="TomtomV1",e[e.XYZSpace=6]="XYZSpace"}(o=t.APIFormat||(t.APIFormat={})),function(e){e[e.QueryString=0]="QueryString",e[e.AuthorizationHeader=1]="AuthorizationHeader"}(s=t.AuthenticationMethod||(t.AuthenticationMethod={})),t.AuthenticationTypeBearer={method:s.AuthorizationHeader,name:"Bearer"},t.AuthenticationTypeTomTomV1={method:s.QueryString,name:"key"},t.AuthenticationTypeAccessToken={method:s.QueryString,name:"access_token"};t.OmvRestClient=class{constructor(e){this.params=e,this.downloadManager=void 0===e.downloadManager?r.TransferManager.instance():e.downloadManager,this.urlParams=void 0===e.urlParams?{}:e.urlParams}async connect(){}ready(){return!0}async getTile(e,t){const i={signal:t};let r=this.dataUrl(e);const n=await this.getActualAuthenticationCode();return r=this.applyAuthCode(r,i,n),r=this.addQueryParams(r,this.urlParams),this.params.apiFormat===o.XYZJson?this.downloadManager.downloadJson(r,i):this.downloadManager.downloadArrayBuffer(r,i)}async getActualAuthenticationCode(){return"string"==typeof this.params.authenticationCode?this.params.authenticationCode:void 0!==this.params.authenticationCode?this.params.authenticationCode():void 0!==this.params.getBearerToken?this.params.getBearerToken():void 0}getDefaultAuthMethod(){if(void 0!==this.params.getBearerToken)return t.AuthenticationTypeBearer;switch(this.params.apiFormat){case o.HereV1:return t.AuthenticationTypeBearer;case o.MapboxV4:case o.XYZOMV:case o.XYZMVT:case o.XYZSpace:case o.XYZJson:return t.AuthenticationTypeAccessToken;case o.TomtomV1:return t.AuthenticationTypeTomTomV1;default:return void n.warn(`#getDefaultAuthMethod: Not supported API format: ${this.params.apiFormat}`)}}applyAuthCode(e,t,i){if(void 0===i)return e;const r=this.params.authenticationMethod||this.getDefaultAuthMethod();if(void 0===r)return e;if(r.method===s.AuthorizationHeader){void 0===t.headers&&(t.headers=new Headers);const e=r.name||"Bearer";t.headers.append("Authorization",`${e} ${i}`)}else if(r.method===s.QueryString){const t={};t[r.name||"access_token"]=i,e=this.addQueryParams(e,t)}return e}dataUrl(e){if(void 0!==this.params.url)return this.params.url.replace("{x}",String(e.column)).replace("{y}",String(e.row)).replace("{z}",String(e.level));let t=[`/${e.level}`,e.column,e.row].join(this.params.apiFormat===o.XYZSpace||this.params.apiFormat===o.XYZJson?"_":"/");switch(this.params.apiFormat){case o.HereV1:case o.XYZOMV:t+="/omv";break;case o.MapboxV4:case o.XYZMVT:t+=".mvt";break;case o.XYZJson:break;case o.XYZSpace:t+=".mvt";break;case o.TomtomV1:t+=".pbf";break;default:n.warn(`Not supported API format: ${this.params.apiFormat}`)}return this.params.baseUrl+t}addQueryParams(e,t){let i="",r=-1!==e.indexOf("?")?"&":"?";return Object.getOwnPropertyNames(t).forEach(e=>{i+=r+e+"="+t[e],"?"===r&&(r="&")}),e+i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(16),o=i(268),s=i(276),a=i(277);i(278);const l="https://www.harp.gl/docs/";document.querySelector(".examples-link").href=l+"master/examples/",document.querySelector(".docs-link").href=l+"master/doc/",document.querySelector("#docs-nav").href=l+"master/doc/",document.querySelector("#examples-nav").href=l+"master/examples/",document.querySelector("#docs-nav-mobile").href=l+"master/doc/",document.getElementById("year").innerText=`${(new Date).getFullYear()}`;const c=[{date:"latest",hash:"master",version:"latest-dev"}],h=document.querySelector("select[name=versions]");fetch("./releases.json").then(e=>e.json()).then(e=>{c.push(...e),c.forEach(e=>{const t=document.createElement("option");t.innerText=e.version,h.appendChild(t)}),h.onchange=()=>{const e=h.querySelector("option:checked"),t=c.find(t=>t.version===e.innerText);if(!t)return;const i=t.hash,r=t.version;document.querySelector(".examples-link").href=l+i+"/examples/",document.querySelector(".examples-link").innerText="Examples"+("master"!==i?` (${r})`:""),document.querySelector(".docs-link").href=l+i+"/doc/",document.querySelector(".docs-link").innerText="Documentation"+("master"!==i?` (${r})`:"")}}).catch(()=>{const e=document.createElement("option");e.innerText="master",h.appendChild(e)}),function(){const e=document.getElementById("map"),t=new n.MapView({canvas:e,decoderUrl:"decoder.bundle.js",theme:a,maxVisibleDataSourceTiles:40,enableMixedLod:!1,tileCacheSize:100});t.animatedExtrusionHandler.enabled=!1;const i=new o.OmvDataSource({baseUrl:"https://vector.hereapi.com/v2/vectortiles/base/mc",apiFormat:o.APIFormat.XYZOMV,styleSetName:"tilezen",authenticationCode:s.apikey,authenticationMethod:{method:o.AuthenticationMethod.QueryString,name:"apikey"},copyrightInfo:s.copyrightInfo});t.addDataSource(i),t.resize(window.innerWidth,500),window.addEventListener("resize",()=>t.resize(window.innerWidth,500));const l=n.MapViewUtils.calculateZoomLevelFromDistance(t,1400),c={target:new r.GeoCoordinates(42.361145,-71.057083),zoomLevel:l,tilt:34.3,heading:135};t.lookAt(c),t.addEventListener(n.MapViewEventNames.FrameComplete,()=>{e.style.opacity="1",t.addEventListener(n.MapViewEventNames.Render,()=>t.lookAt({heading:t.heading+.1})),setTimeout(()=>{t.beginAnimation()},.5)})}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoBoxExtentLike=void 0,t.isGeoBoxExtentLike=function(e){return e&&"object"==typeof e&&"number"==typeof e.latitudeSpan&&"number"==typeof e.longitudeSpan}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.identityProjection=void 0;const r=i(20),n=i(7),o=i(13),s=i(8),a=i(14),l=i(15),c=i(0);class h extends l.Projection{constructor(){super(...arguments),this.type=l.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new c.Box3),i.min.x=-Math.PI,i.min.y=.5*-Math.PI,i.min.z=e,i.max.x=Math.PI,i.max.y=.5*Math.PI,i.max.z=t,i}projectPoint(e,t){return t||(t={x:0,y:0,z:0}),t.x=c.MathUtils.degToRad(e.longitude),t.y=c.MathUtils.degToRad(e.latitude),t.z=e.altitude||0,t}unprojectPoint(e){return n.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=new c.Box3);const i=this.projectPoint(new n.GeoCoordinates(e.south,e.west,e.minAltitude)),r=this.projectPoint(new n.GeoCoordinates(e.north,e.east,e.maxAltitude));return o.isBox3Like(t)?(t.min.x=i.x,t.min.y=i.y,t.min.z=i.z,t.max.x=r.x,t.max.y=r.y,t.max.z=r.z):a.isOrientedBox3Like(t)&&(s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.x+r.x),t.position.y=.5*(i.y+r.y),t.position.z=.5*(i.z+r.z),t.extents.x=.5*(r.x-i.x),t.extents.y=.5*(r.y-i.y),t.extents.z=Math.max(Number.EPSILON,.5*(r.z-i.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new h(1)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sphereProjection=void 0;const r=i(7),n=i(21),o=i(13),s=i(8),a=i(14),l=i(12),c=i(27),h=i(15),d=i(0);function u(e){const t=1/Math.PI,i=Math.floor(2*(e*t+1));return d.MathUtils.clamp(i,0,4)}function m(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function p(e,t,i){const r=.5*(i+(e.maxAltitude||0)),n=d.MathUtils.degToRad(e.west),o=d.MathUtils.degToRad(e.east),s=u(n),a=u(o);let l=Math.cos(n),c=l,h=Math.sin(n),m=h;for(let e=s+1;e<=a;e++){const t=(e+1&1)*((2&e)-1);l=Math.min(t,l),c=Math.max(t,c);const i=(1&e)*((2&e)-1);h=Math.min(i,h),m=Math.max(i,m)}const p=Math.cos(o);l=Math.min(p,l),c=Math.max(p,c);const f=Math.sin(o);h=Math.min(f,h),m=Math.max(f,m);const g=(c+l)*r,v=(c-l)*r,y=(m+h)*r,_=(m-h)*r,x=d.MathUtils.degToRad(e.south),S=d.MathUtils.degToRad(e.north),b=Math.sin(S),T=Math.sin(x),w=(b+T)*r,M=(b-T)*r;return t.min.x=g-v,t.min.y=y-_,t.min.z=w-M,t.max.x=g+v,t.max.y=y+_,t.max.z=w+M,t}class f extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Spherical}worldExtent(e,t,i=new d.Box3){const r=this.unitScale+t;return i.min.x=-r,i.min.y=-r,i.min.z=-r,i.max.x=r,i.max.y=r,i.max.z=r,i}projectPoint(e,t=s.MathUtils.newVector3(0,0,0)){return function(e,t,i){const r=i+(e.altitude||0),n=d.MathUtils.degToRad(e.latitude),o=d.MathUtils.degToRad(e.longitude),s=Math.cos(n);return t.x=r*s*Math.cos(o),t.y=r*s*Math.sin(o),t.z=r*Math.sin(n),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,i=Math.sqrt(t),n=e.z/i;if(isNaN(n))return r.GeoCoordinates.fromRadians(0,0,-this.unitScale);const o=Math.sqrt(t+e.z*e.z);return r.GeoCoordinates.fromRadians(Math.atan(n),Math.atan2(e.y,e.x),o-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-l.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=new d.Box3){if(o.isBox3Like(t))return p(e,t,this.unitScale);if(a.isOrientedBox3Like(t)){if(e.longitudeSpan>=90){const i=p(e,new d.Box3,this.unitScale);return s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.max.x+i.min.x),t.position.y=.5*(i.max.y+i.min.y),t.position.z=.5*(i.max.z+i.min.z),t.extents.x=.5*(i.max.x-i.min.x),t.extents.y=.5*(i.max.y-i.min.y),t.extents.z=.5*(i.max.z-i.min.z),t}const{south:i,west:r,north:n,east:o,center:a}=e,l=a.longitude,c=a.latitude,h=Math.cos(d.MathUtils.degToRad(i)),u=Math.sin(d.MathUtils.degToRad(i)),m=Math.cos(d.MathUtils.degToRad(r)),f=Math.sin(d.MathUtils.degToRad(r)),g=Math.cos(d.MathUtils.degToRad(n)),v=Math.sin(d.MathUtils.degToRad(n)),y=Math.cos(d.MathUtils.degToRad(o)),_=Math.sin(d.MathUtils.degToRad(o)),x=Math.cos(d.MathUtils.degToRad(l)),S=Math.sin(d.MathUtils.degToRad(l)),b=Math.cos(d.MathUtils.degToRad(c)),T=Math.sin(d.MathUtils.degToRad(c));let w,M,E;s.MathUtils.newVector3(x*b,S*b,T,t.zAxis),s.MathUtils.newVector3(-S,x,0,t.xAxis),s.MathUtils.newVector3(-x*T,-S*T,b,t.yAxis),i>=0?(w=Math.abs(h*(x*(f-_)+S*(y-m))),M=b*u-T*h,E=b*v-T*g*(x*y+S*_)):(n<=0?(w=Math.abs(g*(x*(f-_)+S*(y-m))),E=b*v-T*g):(w=Math.abs(x*(f-_)+S*(y-m)),E=b*v-T*g*(S*_+x*y)),M=b*u-T*h*(x*y+S*_));const P=.5*(this.unitScale+(e.maxAltitude||0)),C=.5*(this.unitScale+(e.minAltitude||0)),A=b*(x*y+S*_),L=Math.min(g*A+v*T,h*A+u*T);return s.MathUtils.newVector3(w*P,(E-M)*P,P-L*C,t.extents),s.MathUtils.newVector3(0,(M+E)*P,P+P,t.position),function(e,t,i,r){const n=e.x*r.x+t.x*r.y+i.x*r.z,o=e.y*r.x+t.y*r.y+i.y*r.z,s=e.z*r.x+t.z*r.y+i.z*r.z;r.x=n,r.y=o,r.z=s}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return m(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(m(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const i=1/(m(e)||1);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t}reprojectPoint(e,t,i){if(e===c.mercatorProjection||e===c.webMercatorProjection){const{x:r,y:n,z:o}=t,s=this.unitScale,a=r/s-Math.PI,l=n/s-Math.PI,h=Math.exp(l),d=h*h,u=2*h/(d+1),m=(d-1)/(d+1),p=s+o;return void 0===i&&(i={}),i.x=Math.cos(a)*u*p,i.y=Math.sin(a)*u*p,i.z=m*p,e===c.webMercatorProjection&&(i.z=-i.z),i}return super.reprojectPoint(e,t,i)}localTangentSpace(e,t){let i;n.isGeoCoordinatesLike(e)?(this.projectPoint(e,t.position),i=e):(s.MathUtils.copyVector3(e,t.position),i=this.unprojectPoint(e));const r=d.MathUtils.degToRad(i.latitude),o=d.MathUtils.degToRad(i.longitude),a=Math.cos(o),l=Math.sin(o),c=Math.cos(r),h=Math.sin(r);return s.MathUtils.newVector3(a*c,l*c,h,t.zAxis),s.MathUtils.newVector3(-l,a,0,t.xAxis),s.MathUtils.newVector3(-a*h,-l*h,c,t.yAxis),t}}t.sphereProjection=new f(l.EarthConstants.EQUATORIAL_RADIUS)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuadTree=void 0;const r=i(29);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(r.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const i of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(i,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hereTilingScheme=void 0;const r=i(65),n=i(68),o=i(22);t.hereTilingScheme=new o.TilingScheme(n.halfQuadTreeSubdivisionScheme,r.normalizedEquirectangularProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorTilingScheme=void 0;const r=i(27),n=i(28),o=i(22);t.webMercatorTilingScheme=new o.TilingScheme(n.quadTreeSubdivisionScheme,r.webMercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mercatorTilingScheme=void 0;const r=i(27),n=i(28),o=i(22);t.mercatorTilingScheme=new o.TilingScheme(n.quadTreeSubdivisionScheme,r.mercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.polarTilingScheme=void 0;const r=i(66),n=i(28),o=i(22);t.polarTilingScheme=new o.TilingScheme(n.quadTreeSubdivisionScheme,r.transverseMercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=void 0,t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTransformLike=void 0,t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrientedBox3=void 0;const r=i(0);function n(e,t,i,r,n){const o=i.dot(t),s=i.dot(e);if(Math.abs(s)<1e-20)return Math.abs(o)<=r;const a=1/s,l=(o+r)*a,c=(o-r)*a;return l>c?(c>n.min&&(n.min=c),l<n.max&&(n.max=l)):(l>n.min&&(n.min=l),c<n.max&&(n.max=c)),n.min<=n.max&&n.max>=0}const o=new r.Vector3,s={min:-1/0,max:1/0};class a{constructor(e,t,i){this.position=new r.Vector3,this.xAxis=new r.Vector3(1,0,0),this.yAxis=new r.Vector3(0,1,0),this.zAxis=new r.Vector3(0,0,1),this.extents=new r.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==i&&this.extents.copy(i)}clone(){const e=new a;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new r.Vector3){return e.copy(this.position)}getSize(e=new r.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new r.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}intersectsRay(e){if(s.min=-1/0,s.max=1/0,o.copy(this.position).sub(e.origin),n(e.direction,o,this.xAxis,this.extents.x,s)&&n(e.direction,o,this.yAxis,this.extents.y,s)&&n(e.direction,o,this.zAxis,this.extents.z,s))return s.min>0?s.min:s.max}contains(e){const t=e.x-this.position.x,i=e.y-this.position.y,r=e.z-this.position.z,n=Math.abs(t*this.xAxis.x+i*this.xAxis.y+r*this.xAxis.z),o=Math.abs(t*this.yAxis.x+i*this.yAxis.y+r*this.yAxis.z),s=Math.abs(t*this.zAxis.x+i*this.zAxis.y+r*this.zAxis.z);return!(n>this.extents.x||o>this.extents.y||s>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new r.Vector3;t.subVectors(e,this.position);const i=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let n=0;for(let e=0;e<3;++e){const t=i[e],r=this.extents.getComponent(e);if(t<-r){const e=r+t;n+=e*e}else if(t>r){const e=t-r;n+=e*e}}return n}}t.OrientedBox3=a},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(142),t),n(i(143),t),n(i(148),t),n(i(149),t),n(i(150),t),n(i(151),t),n(i(152),t),n(i(153),t),n(i(154),t),n(i(155),t),n(i(156),t),n(i(157),t),n(i(41),t),n(i(158),t),n(i(159),t),n(i(160),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupedPriorityList=t.PriorityListGroup=void 0;class r{constructor(e,t=new Array){this.priority=e,this.elements=t}clone(){return new r(this.priority,this.elements.slice())}remove(e){const t=this.elements.indexOf(e);return-1!==t&&(this.elements.splice(t,1),!0)}}t.PriorityListGroup=r;class n{constructor(){this.groups=new Map}add(e){this.getGroup(e.priority).elements.push(e)}remove(e){const t=this.findGroup(e.priority);return!(void 0===t||!t.remove(e))&&(0===t.elements.length&&this.groups.delete(t.priority),!0)}clear(){this.groups.clear()}merge(e){for(const t of e.groups){const e=this.findGroup(t[1].priority);void 0!==e?e.elements=e.elements.concat(t[1].elements):this.groups.set(Math.floor(t[1].priority),t[1].clone())}return this}clone(){const e=new n;for(const[t,i]of this.groups)e.groups.set(t,i.clone());return e}forEach(e){for(const t of this.groups)t[1].elements.forEach(e)}count(){let e=0;for(const t of this.groups)e+=t[1].elements.length;return e}findGroup(e){const t=Math.floor(e);return this.groups.get(t)}getGroup(e){let t=this.findGroup(e);if(void 0===t){const i=Math.floor(e);t=new r(i),this.groups.set(t.priority,t)}return t}}t.GroupedPriorityList=n},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(73),t),n(i(144),t),n(i(40),t),n(i(74),t),n(i(145),t),n(i(147),t),n(i(75),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManager=void 0;const r=i(146);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new r.LoggerManagerImpl)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManagerImpl=void 0;const r=i(73),n=i(74),o=i(75);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new r.ConsoleChannel:new o.WorkerChannel}getLoggerNames(){return this.m_loggers.map(e=>e.name)}getLogger(e){return this.m_loggers.find(t=>t.name===e)}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const i=new n.Logger(e,this.channel,t);return this.m_loggers.push(i),i}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const i of this.m_loggers)i.name===e&&i.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiChannel=void 0;t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const i of this.channels)i.error(e,...t)}debug(e,...t){for(const i of this.channels)i.debug(e,...t)}info(e,...t){for(const i of this.channels)i.info(e,...t)}log(e,...t){for(const i of this.channels)i.log(e,...t)}trace(e,...t){for(const i of this.channels)i.trace(e,...t)}warn(e,...t){for(const i of this.channels)i.warn(e,...t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Math2D=void 0,function(e){function t(e,t,i,r){return(e-i)*(e-i)+(t-r)*(t-r)}e.Box=class{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.w=i,this.h=r}set(e,t,i,r){this.x=e,this.y=t,this.w=i,this.h=r}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}containsBox(e){const t=e.x+e.w,i=e.y+e.h;return this.contains(e.x,e.y)&&this.contains(t,e.y)&&this.contains(e.x,i)&&this.contains(t,i)}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const i=e.length-4;for(let r=0;r<i;r+=3){const i=e[r+3]-e[r],n=e[r+4]-e[r+1];t+=i*i+n*n}return t},e.distToSegmentSquared=function(e,i,r,n,o,s){const a=t(r,n,o,s);if(0===a)return t(e,i,r,n);let l=((e-r)*(o-r)+(i-n)*(s-n))/a;return l=Math.max(0,Math.min(1,l)),t(e,i,r+l*(o-r),n+l*(s-n))}}(t.Math2D||(t.Math2D={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0,function(e){function t(e,t,i){return e<t?t:e>i?i:e}e.clamp=t,e.lerp=function(e,t,i){return e*(1-i)+t*i},e.smoothStep=function(e,i,r){return(r=t((r-e)/(i-e),0,1))*r*(3-2*r)},e.smootherStep=function(e,i,r){return(r=t((r-e)/(i-e),0,1))*r*r*(r*(6*r-15)+10)},e.map=function(e,t,i,r,n){return(e-t)*(n-r)/(i-t)+r},e.min2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.min(i,t)),i},e.max2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.max(i,t)),i},e.isClamped=function(e,t,i){return!(void 0!==t&&e<t)&&!(void 0!==i&&e>i)},e.easeInOutCubic=function(e,t,i){return e+(t-e)*(i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixinsWithoutProperties=t.applyMixins=void 0,t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{e.prototype[i]=t.prototype[i]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{const r=Object.getOwnPropertyDescriptor(t.prototype,i);void 0!==r&&void 0===r.get&&"constructor"!==i&&(e.prototype[i]=t.prototype[i])})})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertExists=t.assert=void 0;t.assert=function(e,t){0},t.assertExists=function(e,t){return e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContextLogger=void 0;t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod("warn"),this.info=this.createLogMethod("info"),this.error=this.createLogMethod("error")}pushAttr(e){this.context.push(`${this.context.length>0?".":""}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...i)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join("")}: ${t}`,...i)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceTimer=void 0;let r=(()=>{class e{static now(){return e.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}return e.instance=new e,e.nowFunc=e.getNowFunc(),e})();t.PerformanceTimer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pick=t.cloneDeep=void 0,t.cloneDeep=function(e){const t=new Map,i=function e(i){if(null===i)return null;if("object"==typeof i){const r=t.get(i);if(void 0!==r)return r;if(Array.isArray(i)){const r=[];t.set(i,r),r.length=i.length;for(let t=0;t<r.length;++t)r[t]=e(i[t]);return r}if(i instanceof Date){const e=new Date(i.getTime());return t.set(i,e),e}if(i instanceof RegExp){const e=new RegExp(i.source,i.flags);return t.set(i,e),e}if(i.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const r={};t.set(i,r);for(const t in i)i.hasOwnProperty(t)&&(r[t]=e(i[t]));return r}}return i}(e);return t.clear(),i},t.pick=function(e,t){const i={};for(const r of t)e.hasOwnProperty(r)&&(i[r]=e[r]);return i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeWithOptions=t.getOptionValue=void 0,t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t},t.mergeWithOptions=function(e,t){const i=Object.assign({},e);if(null==t)return i;for(const r in e)if(e.hasOwnProperty(r)){const e=t[r];null!=e&&(i[r]=e)}return i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.composeUriResolvers=t.RelativeUriResolver=t.PrefixMapUriResolver=void 0;const r=i(41);t.PrefixMapUriResolver=class{constructor(e){this.definitions=e}resolveUri(e){return Object.keys(this.definitions).reduce((e,t)=>{if(t.endsWith("/")&&e.startsWith(t)){return this.definitions[t]+e.substr(t.length)}return e===t?this.definitions[t]:e},e)}};t.RelativeUriResolver=class{constructor(e){this.parentUri=e}resolveUri(e){return r.resolveReferenceUri(this.parentUri,e)}},t.composeUriResolvers=function(...e){return{resolveUri:t=>e.reduce((e,t)=>void 0!==t?t.resolveUri(e):e,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=void 0,t.chainCallbacks=function(e,t){return function(...i){return e&&e.apply(this,i),t.apply(this,i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sampleBilinear=void 0,t.sampleBilinear=function(e,t,i,r,n){const o=t-1,s=i-1,a=r*o,l=Math.floor(a),c=n*s,h=Math.floor(c),d=h*t+l,u=l<o?d+1:d,m=h<s?d+t:d,p=l<o?m+1:m,f=e[d],g=e[u],v=e[m],y=e[p],_=Number.isInteger(a)?0:a-l,x=1-_,S=Number.isInteger(c)?0:c-h,b=1-S;return f*x*b+g*_*b+v*x*S+y*_*S}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAppBaseUrl=void 0;const r=i(41);t.getAppBaseUrl=function(){return r.baseUrl(window.location.href)}},function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return e<0?0:e>1?1:e}function o(e){return"%"===e[e.length-1]?r(parseFloat(e)/100*255):r(parseInt(e))}function s(e){return"%"===e[e.length-1]?n(parseFloat(e)/100):n(parseFloat(e))}function a(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in i)return i[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=n.indexOf("("),c=n.indexOf(")");if(-1!==l&&c+1===n.length){var h=n.substr(0,l),d=n.substr(l+1,c-(l+1)).split(","),u=1;switch(h){case"rgba":if(4!==d.length)return null;u=s(d.pop());case"rgb":return 3!==d.length?null:[o(d[0]),o(d[1]),o(d[2]),u];case"hsla":if(4!==d.length)return null;u=s(d.pop());case"hsl":if(3!==d.length)return null;var m=(parseFloat(d[0])%360+360)%360/360,p=s(d[1]),f=s(d[2]),g=f<=.5?f*(p+1):f+p-f*p,v=2*f-g;return[r(255*a(v,g,m+1/3)),r(255*a(v,g,m)),r(255*a(v,g,m-1/3)),u];default:return null}}return null}}catch(e){}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprEvaluator=t.ExprEvaluatorContext=void 0;const r=i(5),n=i(164),o=i(165),s=i(166),a=i(167),l=i(168),c=i(169),h=i(170),d=i(171),u=i(172),m=i(173),p=i(174),f=i(175),g=i(176),v=i(30),y=i(0),_=i(42),x=new Map;function S(e,t){var i,n,o;if(t instanceof r.StringLiteralExpr)return null!==(i=t.promotedValue)&&void 0!==i?i:t.value;const s=e.evaluate(t);return"string"==typeof s&&null!==(o=null!==(n=v.RGBA.parse(s))&&void 0!==n?n:_.Pixels.parse(s))&&void 0!==o?o:s}t.ExprEvaluatorContext=class{constructor(e,t,i,r){this.evaluator=e,this.env=t,this.scope=i,this.cache=r}evaluate(e){var t,i;if(void 0===e)throw new Error("Failed to evaluate expression");const r=null===(t=this.cache)||void 0===t?void 0:t.get(e);if(void 0!==r)return r;const n=e.accept(this.evaluator,this);return null===(i=this.cache)||void 0===i||i.set(e,n),n}wrapValue(e){return r.Expr.isExpr(e)?e:r.LiteralExpr.fromValue(e)}};class b{static defineOperator(e,t){x.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach(t=>{this.defineOperator(t,e[t])})}static getOperator(e){return x.get(e)}visitVarExpr(e,t){const i=t.env.lookup(e.name);return void 0!==i?i:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitMatchExpr(e,t){const i=t.evaluate(e.value);for(const[r,n]of e.branches){if(Array.isArray(r)&&r.includes(i))return t.evaluate(n);if(r===i)return t.evaluate(n)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){if(t.scope===r.ExprScope.Value){const i=e.branches.findIndex(([e,t])=>e.isDynamic());if(-1!==i){let n;for(let o=0;o<e.branches.length;++o){const[s,a]=e.branches[o],l=t.evaluate(s),c=t.evaluate(a);if(o<i&&Boolean(l))return c;if((r.Expr.isExpr(l)||Boolean(l))&&(void 0===n&&(n=[]),null==n||n.push([t.wrapValue(l),t.wrapValue(c)]),!r.Expr.isExpr(l)&&Boolean(l)))return new r.CaseExpr(n,r.LiteralExpr.fromValue(null))}const o=t.evaluate(e.fallback);return void 0===n?o:new r.CaseExpr(n,t.wrapValue(o))}}for(const[i,r]of e.branches)if(t.evaluate(i))return t.evaluate(r);return t.evaluate(e.fallback)}visitCallExpr(e,t){var i;const n=null!==(i=e.descriptor)&&void 0!==i?i:x.get(e.op);if(n){let i;if(e.descriptor=n,t.scope===r.ExprScope.Value&&e.isDynamic()){if(e.descriptor.partialEvaluate)return e.descriptor.partialEvaluate(t,e);const n=e.args.map(e=>t.wrapValue(t.evaluate(e)));if(n.every((t,i)=>t===e.args[i]))return e;i=new r.CallExpr(e.op,n)}else i=n.call(t,e);return i}throw new Error(`undefined operator '${e.op}'`)}visitStepExpr(e,t){if(t.scope===r.ExprScope.Value){const i=t.evaluate(e.input),n=t.evaluate(e.defaultValue);return new r.StepExpr(t.wrapValue(i),t.wrapValue(n),e.stops.map(([e,i])=>{const r=t.evaluate(i);return[e,t.wrapValue(r)]}))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error(`input '${i}' must be a number`);if(i<e.stops[0][0])return t.evaluate(e.defaultValue);let r=e.stops.findIndex(e=>e[0]>i);return-1===r&&(r=e.stops.length),t.evaluate(e.stops[r-1][1])}}visitInterpolateExpr(e,t){if(t.scope===r.ExprScope.Value){const i=t.evaluate(e.input);return new r.InterpolateExpr(e.mode,t.wrapValue(i),e.stops.map(([e,i])=>{const r=t.evaluate(i);return[e,t.wrapValue(r)]}))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error("input must be a number");if("cubic"===e.mode[0])return function(e,t,i){if(i<t.stops[0][0])return S(e,t.stops[0][1]);if(i>=t.stops[t.stops.length-1][0])return S(e,t.stops[t.stops.length-1][1]);const r=t.stops.findIndex(e=>e[0]>i),n=Math.max(0,r-1),o=0===n?r:n-1,s=r<t.stops.length-1?r+1:r-1,a=t.stops[o][0],l=t.stops[n][0],c=t.stops[r][0],h=.5*(c-l),d=h/(l-a),u=h/(t.stops[s][0]-c),m=(i-l)/(c-l),p=m*m,f=p*m,g=-d*f+2*d*p-d*m,x=(1+d)*f+(-1.5-2*d)*p+(-.5+d)*m+1,b=(-1-u)*f+(1.5+u)*p+.5*m,T=u*f-u*p,w=S(e,t.stops[o][1]),M=S(e,t.stops[n][1]),E=S(e,t.stops[r][1]),P=S(e,t.stops[s][1]);if("number"==typeof w&&"number"==typeof M&&"number"==typeof E&&"number"==typeof P)return g*w+x*M+b*E+T*P;if(w instanceof v.RGBA&&M instanceof v.RGBA&&E instanceof v.RGBA&&P instanceof v.RGBA)return new v.RGBA(y.MathUtils.clamp(g*w.r+x*M.r+b*E.r+T*P.r,0,1),y.MathUtils.clamp(g*w.g+x*M.g+b*E.g+T*P.g,0,1),y.MathUtils.clamp(g*w.b+x*M.b+b*E.b+T*P.b,0,1),y.MathUtils.clamp(g*w.a+x*M.a+b*E.a+T*P.a,0,1));if(w instanceof _.Pixels&&M instanceof _.Pixels&&E instanceof _.Pixels&&P instanceof _.Pixels)return new _.Pixels(g*w.value+x*M.value+b*E.value+T*P.value);if(w instanceof y.Color&&M instanceof y.Color&&E instanceof y.Color&&P instanceof y.Color)return new y.Color(g*w.r+x*M.r+b*E.r+T*P.r,g*w.g+x*M.g+b*E.g+T*P.g,g*w.b+x*M.b+b*E.b+T*P.b);if(w instanceof y.Vector2&&M instanceof y.Vector2&&E instanceof y.Vector2&&P instanceof y.Vector2)return new y.Vector2(g*w.x+x*M.x+b*E.x+T*P.x,g*w.y+x*M.y+b*E.y+T*P.y);if(w instanceof y.Vector3&&M instanceof y.Vector3&&E instanceof y.Vector3&&P instanceof y.Vector3)return new y.Vector3(g*w.x+x*M.x+b*E.x+T*P.x,g*w.y+x*M.y+b*E.y+T*P.y,g*w.z+x*M.z+b*E.z+T*P.z);if(w instanceof y.Vector4&&M instanceof y.Vector4&&E instanceof y.Vector4&&P instanceof y.Vector4)return new y.Vector4(g*w.x+x*M.x+b*E.x+T*P.x,g*w.y+x*M.y+b*E.y+T*P.y,g*w.z+x*M.z+b*E.z+T*P.z,g*w.w+x*M.w+b*E.w+T*P.w);if(Array.isArray(w)&&Array.isArray(M)&&Array.isArray(E)&&Array.isArray(P)){const e=w.length,t=[];for(let i=0;i<e;++i)t[i]=g*w[i]+x*M[i]+b*E[i]+T*P[i];return t}throw new Error("failed to interpolate values")}(t,e,i);const r=e.stops.findIndex(e=>e[0]>i);if(-1===r)return t.evaluate(e.stops[e.stops.length-1][1]);if(0===r)return t.evaluate(e.stops[0][1]);const[n,o]=e.stops[r],[s,a]=e.stops[r-1],l=S(t,a);let c=0;switch(e.mode[0]){case"discrete":return l;case"linear":c=(i-s)/(n-s);break;case"exponential":{const t=e.mode[1];c=(Math.pow(t,i-s)-1)/(Math.pow(t,n-s)-1);break}default:throw new Error(`interpolation mode ${JSON.stringify(e.mode)} is not supported`)}const h=S(t,o);if("number"==typeof l&&"number"==typeof h)return y.MathUtils.lerp(l,h,c);if(l instanceof v.RGBA&&h instanceof v.RGBA)return l.clone().lerp(h,c);if(l instanceof _.Pixels&&h instanceof _.Pixels)return new _.Pixels(y.MathUtils.lerp(l.value,h.value,c));if(l instanceof y.Color&&h instanceof y.Color)return l.clone().lerp(h,c);if(l instanceof y.Vector2&&h instanceof y.Vector2)return l.clone().lerp(h,c);if(l instanceof y.Vector3&&h instanceof y.Vector3)return l.clone().lerp(h,c);if(l instanceof y.Vector4&&h instanceof y.Vector4)return l.clone().lerp(h,c);if(Array.isArray(l)&&Array.isArray(h)&&l.length===h.length)return l.map((e,t)=>y.MathUtils.lerp(e,h[t],c));throw new Error(`todo: mix(${JSON.stringify(l)}, ${JSON.stringify(h)}, ${c})`)}}}t.ExprEvaluator=b,b.defineOperators(o.CastOperators),b.defineOperators(a.ComparisonOperators),b.defineOperators(d.MathOperators),b.defineOperators(p.StringOperators),b.defineOperators(s.ColorOperators),b.defineOperators(f.TypeOperators),b.defineOperators(u.MiscOperators),b.defineOperators(c.FlowOperators),b.defineOperators(n.ArrayOperators),b.defineOperators(m.ObjectOperators),b.defineOperators(l.FeatureOperators),b.defineOperators(h.MapOperators),b.defineOperators(g.VectorOperators)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayOperators=void 0;const r=i(5),n=["boolean","number","string"];function o(e,t){if(!(e instanceof r.StringLiteralExpr&&n.includes(e.value)))throw new Error(`expected "boolean", "number" or "string" instead of '${JSON.stringify(e)}'`);const i=e.value;t.forEach((e,t)=>{if(typeof e!==i)throw new Error(`expected array element at index ${t} to have type '${i}'`)})}function s(e,t){const i=e.evaluate(t);if(!Array.isArray(i))throw new Error(`'${i}' is not an array`);return i}const a={array:{call:(e,t)=>{switch(t.args.length){case 0:throw new Error("not enough arguments");case 1:return s(e,t.args[0]);case 2:{const i=s(e,t.args[1]);return o(t.args[0],i),i}case 3:{const i=s(e,t.args[2]);return function(e,t){if(!(e instanceof r.NumberLiteralExpr))throw new Error("missing expected number of elements");const i=e.value;if(t.length!==i)throw new Error(`the array must have ${i} element(s)`)}(t.args[1],i),o(t.args[0],i),i}default:throw new Error("too many arguments")}}},"make-array":{call:(e,t)=>{if(0===t.args.length)throw new Error("not enough arguments");return[...t.args.map(t=>e.evaluate(t))]}},at:{call:(e,t)=>{const i=t.args,r=e.evaluate(i[0]);if("number"!=typeof r)throw new Error("expected the index of the element to retrieve");const n=e.evaluate(i[1]);if(!Array.isArray(n))throw new Error("expected an array");return r>=0&&r<n.length?n[r]:null}}};t.ArrayOperators=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CastOperators=void 0;const r={"to-boolean":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},"to-string":{call:(e,t)=>String(e.evaluate(t.args[0]))},"to-number":{call:(e,t)=>{for(const i of t.args){const t=Number(e.evaluate(i));if(!isNaN(t))return t}throw new Error("cannot convert the value to a number")}}};t.CastOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorOperators=void 0;const r=i(0),n=i(23),o=i(31),s={alpha:{call:(e,t)=>{let i=e.evaluate(t.args[0]);return"string"==typeof i&&(i=o.parseStringEncodedColor(i)),"number"==typeof i?n.ColorUtils.getAlphaFromHex(i):1}},rgba:{call:(e,t)=>{const i=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if("number"==typeof i&&"number"==typeof o&&"number"==typeof s&&"number"==typeof a&&i>=0&&o>=0&&s>=0&&a>=0&&a<=1)return function(e,t,i,o){return n.ColorUtils.getHexFromRgba(r.MathUtils.clamp(e,0,255)/255,r.MathUtils.clamp(t,0,255)/255,r.MathUtils.clamp(i,0,255)/255,r.MathUtils.clamp(o,0,1))}(i,o,s,a);throw new Error(`unknown color 'rgba(${i},${o},${s},${a})'`)}},rgb:{call:(e,t)=>{const i=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof o&&"number"==typeof s&&i>=0&&o>=0&&s>=0)return function(e,t,i){return n.ColorUtils.getHexFromRgb(r.MathUtils.clamp(e,0,255)/255,r.MathUtils.clamp(t,0,255)/255,r.MathUtils.clamp(i,0,255)/255)}(i,o,s);throw new Error(`unknown color 'rgb(${i},${o},${s})'`)}},hsl:{call:(e,t)=>{const i=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof o&&"number"==typeof s&&i>=0&&o>=0&&s>=0)return function(e,t,i){return n.ColorUtils.getHexFromHsl(r.MathUtils.euclideanModulo(e,360)/360,r.MathUtils.clamp(t,0,100)/100,r.MathUtils.clamp(i,0,100)/100)}(i,o,s);throw new Error(`unknown color 'hsl(${i},${o}%,${s}%)'`)}}};t.ColorOperators=s},function(e,t,i){"use strict";function r(e,t,i=!1){const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if(!("number"==typeof r&&"number"==typeof n||"string"==typeof r&&"string"==typeof n)&&i)throw new Error(`invalid operands '${r}' and '${n}' for operator '${t.op}'`);switch(t.op){case"<":return r<n;case">":return r>n;case"<=":return r<=n;case">=":return r>=n;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ComparisonOperators=void 0;const n={"!":{call:(e,t)=>!e.evaluate(t.args[0])},"==":{call:(e,t)=>e.evaluate(t.args[0])===e.evaluate(t.args[1])},"!=":{call:(e,t)=>e.evaluate(t.args[0])!==e.evaluate(t.args[1])},"<":{call:(e,t)=>r(e,t)},">":{call:(e,t)=>r(e,t)},"<=":{call:(e,t)=>r(e,t)},">=":{call:(e,t)=>r(e,t)}};t.ComparisonOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureOperators=void 0;const r=i(32),n=i(5),o={"geometry-type":{call:(e,t)=>{switch(e.env.lookup("$geometryType")){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon";default:return null}}},"feature-state":{isDynamicOperator:()=>!0,call:(e,t)=>{var i,o;if(e.scope!==n.ExprScope.Dynamic)throw new Error("feature-state cannot be used in this context");const s=e.evaluate(t.args[0]);if("string"!=typeof s)throw new Error("expected the name of the property of the feature state");const a=e.env.lookup("$state");return r.Env.isEnv(a)?null!==(i=a.lookup(s))&&void 0!==i?i:null:a instanceof Map&&null!==(o=a.get(s))&&void 0!==o?o:null}},id:{call:(e,t)=>{var i;return null!==(i=e.env.lookup("$id"))&&void 0!==i?i:null}}};t.FeatureOperators=o},function(e,t,i){"use strict";function r(e,t,i){switch(t){case"boolean":case"number":case"string":for(const r of i){const i=e.evaluate(r);if(typeof i===t)return i}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.FlowOperators=void 0;const n={all:{call:(e,t)=>{for(const i of t.args)if(!e.evaluate(i))return!1;return!0}},any:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!0;return!1}},none:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!1;return!0}},boolean:{call:(e,t)=>r(e,"boolean",t.args)},number:{call:(e,t)=>r(e,"number",t.args)},string:{call:(e,t)=>r(e,"string",t.args)}};t.FlowOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapOperators=void 0;const r=i(5),n={"ppi-scale":{call:(e,t)=>e.evaluate(t.args[0])*(t.args[1]?e.evaluate(t.args[1]):1)},"world-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),r=t.args[1]?e.evaluate(t.args[1]):1,n=e.env.lookup("$zoom");return i*(Math.pow(2,17)/Math.pow(2,n))*r}},"world-discrete-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),r=t.args[1]?e.evaluate(t.args[1]):1,n=e.env.lookup("$zoom");return i*(Math.pow(2,17.8)/Math.pow(2,Math.floor(n)))*r}},ppi:{call:e=>{const t=e.env.lookup("$ppi");return"number"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:(e,t)=>{var i;return e.scope===r.ExprScope.Value?t:null!==(i=e.env.lookup("$zoom"))&&void 0!==i?i:null}}};t.MapOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathOperators=void 0;const r=i(0),n={"^":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '^'`);return Math.pow(i,r)}},"-":{call:(e,t)=>{if(1===t.args.length){const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`ìnvalid operand '${typeof i} for operator '-'`);return-i}const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '-'`);return i-r}},"/":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '/'`);return i/r}},"%":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '%'`);return i%r}},"+":{call:(e,t)=>t.args.reduce((t,i)=>Number(t)+Number(e.evaluate(i)),0)},"*":{call:(e,t)=>t.args.reduce((t,i)=>Number(t)*Number(e.evaluate(i)),1)},abs:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'abs'`);return Math.abs(i)}},acos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'acos'`);return Math.acos(i)}},asin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'asin'`);return Math.asin(i)}},atan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'atan'`);return Math.atan(i)}},ceil:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ceil'`);return Math.ceil(i)}},cos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'cos'`);return Math.cos(i)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'floor'`);return Math.floor(i)}},ln:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln'`);return Math.log(i)}},ln2:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln2'`);return Math.log2(i)}},log10:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'log10'`);return Math.log10(i)}},max:{call:(e,t)=>Math.max(...t.args.map(t=>Number(e.evaluate(t))))},min:{call:(e,t)=>Math.min(...t.args.map(t=>Number(e.evaluate(t))))},clamp:{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"!=typeof i||"number"!=typeof n||"number"!=typeof o)throw new Error(`invalid operands '${i}', ${n}, ${o} for operator 'clamp'`);return r.MathUtils.clamp(i,n,o)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'round'`);return Math.round(i)}},sin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sin'`);return Math.sin(i)}},sqrt:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sqrt'`);return Math.sqrt(i)}},tan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'tan'`);return Math.tan(i)}}};t.MathOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MiscOperators=void 0;const r={length:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if(Array.isArray(i)||"string"==typeof i)return i.length;throw new Error(`invalid operand '${i}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const i of t.args){const t=e.evaluate(i);if(null!==t)return t}return null}}};t.MiscOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectOperators=void 0;const r=i(5),n=i(32),o=Object.prototype.hasOwnProperty;var s;function a(e,t,i){var r;const a=e.evaluate(t[0]);if("string"!=typeof a)throw new Error("expected the name of an attribute");const l=e.evaluate(t[1]);if(l&&"object"==typeof l){if(n.Env.isEnv(l)){const e=null!==(r=l.lookup(a))&&void 0!==r?r:null;return i===s.get?e:null!==e}if(o.call(l,a))return i!==s.get||l[a]}return i===s.get&&null}!function(e){e[e.get=0]="get",e[e.has=1]="has"}(s||(s={}));const l={in:{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return("string"==typeof i&&"string"==typeof r||!!Array.isArray(r))&&r.includes(i)}},get:{call:(e,t)=>a(e,t.args,s.get)},has:{call:(e,t)=>a(e,t.args,s.has)},"dynamic-properties":{isDynamicOperator:()=>!0,call:(e,t)=>e.scope===r.ExprScope.Dynamic?e.env:t}};t.ObjectOperators=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringOperators=void 0;const r={concat:{call:(e,t)=>"".concat(...t.args.map(t=>String(e.evaluate(t))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},"~=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&-1!==i.indexOf(r)}},"^=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&i.startsWith(r)}},"$=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&i.endsWith(r)}}};t.StringOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeOperators=void 0;t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorOperators=void 0;const r=i(5),n=i(0);function o(e,t,i){let r;switch(i){case"vector2":r=n.Vector2;break;case"vector3":r=n.Vector3;break;case"vector4":r=n.Vector4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof r)return t}throw new Error(`expected a "${i}"`)}function s(e,t,i){let r,o;switch(i){case"vector2":r=n.Vector2,o=2;break;case"vector3":r=n.Vector3,o=3;break;case"vector4":r=n.Vector4,o=4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof r)return t;if(Array.isArray(t)&&t.length===o&&t.every(e=>"number"==typeof e))return(new r).fromArray(t)}throw new Error(`expected a "${i}"`)}const a={"make-vector":{call:(e,t)=>{if(void 0!==t._value)return t._value;if(t.args.length<2)throw new Error("not enough arguments");if(t.args.length>4)throw new Error("too many arguments");const i=t.args.map(t=>e.evaluate(t));let o;switch(i.forEach((e,t)=>{if("number"!=typeof e)throw new Error(`expected vector component at index ${t} to have type "number"`)}),i.length){case 2:o=(new n.Vector2).fromArray(i);break;case 3:o=(new n.Vector3).fromArray(i);break;case 4:o=(new n.Vector4).fromArray(i);break;default:throw new Error("too many arguments")}return t.args.every(e=>e instanceof r.NumberLiteralExpr)&&(t._value=o),o}},vector2:{call:(e,t)=>o(e,t,"vector2")},vector3:{call:(e,t)=>o(e,t,"vector3")},vector4:{call:(e,t)=>o(e,t,"vector4")},"to-vector2":{call:(e,t)=>s(e,t,"vector2")},"to-vector3":{call:(e,t)=>s(e,t,"vector3")},"to-vector4":{call:(e,t)=>s(e,t,"vector4")}};t.VectorOperators=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprInstantiator=void 0;const r=i(5),n=new(i(32).Env);t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=t.env.lookup(e.name);return r.LiteralExpr.fromValue(void 0!==i?i:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=void 0!==t.env.lookup(e.name);return r.LiteralExpr.fromValue(i)}visitCallExpr(e,t){const i=e.args.map(e=>e.accept(this,t));return i.some((t,i)=>t!==e.args[i])?new r.CallExpr(e.op,i):e}visitMatchExpr(e,t){const i=e.value.accept(this,t);if(i instanceof r.LiteralExpr){const r=i.value;for(const[i,n]of e.branches){if(Array.isArray(i)&&i.includes(r))return n.accept(this,t);if(i===r)return n.accept(this,t)}return e.fallback.accept(this,t)}let n=e.value!==i;const o=e.branches.map(([e,i])=>{const r=i.accept(this,t);return r!==i&&(n=!0),[e,r]}),s=e.fallback.accept(this,t);return s!==e.fallback&&(n=!0),n?new r.MatchExpr(i,o,s):e}visitCaseExpr(e,t){const i=[];let o=!1;for(const[s,a]of e.branches){const e=s.accept(this,t),l=e.dependencies();if(s.isDynamic()||0!==l.properties.size)e!==s&&(o=!0),i.push([e,a]);else if(Boolean(e.evaluate(n,r.ExprScope.Condition)))return a.accept(this,t)}if(0===i.length)return e.fallback.accept(this,t);i.length!==e.branches.length&&(o=!0),i.forEach(e=>{const i=e[1].accept(this,t);i!==e[1]&&(o=!0),e[1]=i});const s=e.fallback.accept(this,t);return s!==e.fallback&&(o=!0),o?new r.CaseExpr(i,s):e}visitStepExpr(e,t){const i=e.input.accept(this,t),n=e.defaultValue.accept(this,t),o=e.stops.map(([e,i])=>[e,i.accept(this,t)]);return new r.StepExpr(i,n,o)}visitInterpolateExpr(e,t){const i=e.input.accept(this,t),n=e.stops.map(([e,i])=>[e,i.accept(this,t)]);return new r.InterpolateExpr(e.mode,i,n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprParser=void 0;const r=i(5);var n,o;function s(e){switch(e){case n.Tab:case n.Lf:case n.Cr:case n.Space:return!0;default:return!1}}function a(e){return e>=n._0&&e<=n._9}function l(e){return e>=n.a&&e<=n.z||e>=n.A&&e<=n.Z}function c(e){return function(e){return l(e)||a(e)}(e)||e===n._||e===n.Dollar||e===n.Dot||e===n.LBracket||e===n.RBracket}function h(e){switch(e){case o.Eof:return"eof";case o.Error:return"error";case o.Identifier:return"identifier";case o.Number:return"number";case o.String:return"string";case o.Comma:return",";case o.LParen:return"(";case o.RParen:return")";case o.LBracket:return"[";case o.RBracket:return"]";case o.Exclaim:return"!";case o.TildeEqual:return"~=";case o.CaretEqual:return"^=";case o.DollarEqual:return"$=";case o.EqualEqual:return"==";case o.ExclaimEqual:return"!=";case o.Less:return"<";case o.Greater:return">";case o.LessEqual:return"<=";case o.GreaterEqual:return">=";case o.BarBar:return"||";case o.AmpAmp:return"&&";default:throw new Error(`invalid token ${e}`)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(n||(n={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(o||(o={}));class d{constructor(e){this.code=e,this.m_token=o.Error,this.m_index=0,this.m_char=n.Lf}token(){return this.m_token}text(){return this.m_text||""}next(){if(this.m_token=this.yylex(),this.m_token===o.Error)throw new Error(`unexpected character ${this.m_char}`);return this.m_token}yyinp(){this.m_char=this.code.codePointAt(this.m_index++)||0}yylex(){for(this.m_text=void 0;s(this.m_char);)this.yyinp();if(0===this.m_char)return o.Eof;const e=this.m_char;switch(this.yyinp(),e){case n.LParen:return o.LParen;case n.RParen:return o.RParen;case n.LBracket:return o.LBracket;case n.RBracket:return o.RBracket;case n.Comma:return o.Comma;case n.SingleQuote:case n.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),o.String}case n.Exclaim:return this.m_char===n.Equal?(this.yyinp(),o.ExclaimEqual):o.Exclaim;case n.Caret:return this.m_char===n.Equal?(this.yyinp(),o.CaretEqual):o.Error;case n.Tilde:return this.m_char===n.Equal?(this.yyinp(),o.TildeEqual):o.Error;case n.Equal:return this.m_char===n.Equal?(this.yyinp(),o.EqualEqual):o.Error;case n.Less:return this.m_char===n.Equal?(this.yyinp(),o.LessEqual):o.Less;case n.Greater:return this.m_char===n.Equal?(this.yyinp(),o.GreaterEqual):o.Greater;case n.Bar:return this.m_char===n.Bar?(this.yyinp(),o.BarBar):o.Error;case n.Amp:return this.m_char===n.Amp?(this.yyinp(),o.AmpAmp):o.Error;default:{const t=this.m_index-2;if(l(e)||e===n._||e===n.Dollar&&c(this.m_char)){for(;c(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===n.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Number}if(e===n.Dollar)return this.m_char===n.Equal?(this.yyinp(),o.DollarEqual):o.Error}}return o.Error}}function u(e){switch(e){case o.TildeEqual:return"~=";case o.CaretEqual:return"^=";case o.DollarEqual:return"$=";case o.EqualEqual:return"==";case o.ExclaimEqual:return"!=";default:return}}function m(e){switch(e){case o.Less:return"<";case o.Greater:return">";case o.LessEqual:return"<=";case o.GreaterEqual:return">=";default:return}}t.ExprParser=class{constructor(e){this.lex=new d(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${h(e)}' but `+`found '${h(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case o.Identifier:{const e=this.lex.text();switch(e){case"has":this.lex.next(),this.yyexpect(o.LParen);const t=this.lex.text();return this.yyexpect(o.Identifier),this.yyexpect(o.RParen),new r.HasAttributeExpr(t);case"length":this.lex.next(),this.yyexpect(o.LParen);const i=this.parseLogicalOr();return this.yyexpect(o.RParen),new r.CallExpr("length",[i]);default:const n=new r.VarExpr(e);return this.lex.next(),n}}case o.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(o.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case o.Number:{const e=new r.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case o.String:{const e=new r.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error("Syntax error")}}parseUnary(){return this.lex.token()===o.Exclaim?(this.lex.next(),new r.CallExpr("!",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===o.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(o.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===o.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(o.RBracket),e=new r.CallExpr("in",[e,r.LiteralExpr.fromValue(t.map(({value:e})=>e))])}else{const t=m(this.lex.token());if(void 0===t)break;this.lex.next();const i=this.parseUnary();e=new r.CallExpr(t,[e,i])}return e}parseEquality(){let e=this.parseRelational();for(;;){let t=u(this.lex.token());if(void 0===t)break;"~="===t&&(t="in"),this.lex.next();const i=this.parseRelational();e=new r.CallExpr(t,[e,i])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==o.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===o.AmpAmp);return new r.CallExpr("all",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==o.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===o.BarBar);return new r.CallExpr("any",t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerServiceProtocol=void 0,function(e){let t,i;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(i=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return/unknown targetServiceType requested: /.test(e.message)},e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerTilerProtocol=void 0,function(e){let t;!function(e){e.RegisterIndex="register-index",e.UpdateIndex="update-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerDecoderProtocol=t.RequestController=void 0;t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,i;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(i=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateTechniqueAttr=void 0;const r=i(5),n=i(78);t.evaluateTechniqueAttr=function(e,t,i){if(void 0===t)return i;const o=r.Env.isEnv(e)?n.getPropertyValue(t,e):n.getPropertyValue(t,e.env,e.cachedExprResults);return null!=o?o:i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeVisitor=void 0;const r=i(5);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!r.isJsonExpr(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e in this.theme.styles)if(void 0!==this.theme.styles[e])for(const i of this.theme.styles[e])if(t(i))return!0;return!1}}},function(e,t,i){"use strict";var r=this&&this.__rest||function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.CirclePointsMaterial=void 0;const n=i(0),o=i(9);let s=(()=>{class e extends n.ShaderMaterial{constructor(t={}){const{size:i,color:s,opacity:a}=t,l=r(t,["size","color","opacity"]);l.name="CirclePointsMaterial",l.vertexShader="\nuniform float size;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n",l.fragmentShader="\nuniform vec3 diffuse;\nuniform float opacity;\n\nvoid main() {\n    float alpha = opacity;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuse, alpha);\n}",l.uniforms={size:new n.Uniform(e.DEFAULT_CIRCLE_SIZE),diffuse:new n.Uniform(new n.Color),opacity:new n.Uniform(1)},l.depthTest=!1,l.extensions=Object.assign(Object.assign({},l.extensions),{derivatives:!0}),super(l),o.enforceBlending(this),this.type="CirclePointsMaterial",this.m_color=this.uniforms.diffuse.value,this.m_opacity=this.uniforms.opacity.value,void 0!==i&&(this.size=i),void 0!==s&&(this.color=s),void 0!==a&&(this.opacity=a)}get size(){return this.uniforms.size.value}set size(e){this.uniforms.size.value=e}get opacity(){return this.m_opacity}set opacity(e){this.m_opacity=e,this.uniforms&&this.uniforms.opacity&&(this.uniforms.opacity.value=e)}get color(){return this.m_color}set color(e){this.m_color.set(e)}}return e.DEFAULT_CIRCLE_SIZE=1,e})();t.CirclePointsMaterial=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasDisplacementFeature=void 0,t.hasDisplacementFeature=function(e){return"displacementMap"in e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeMaterial=void 0;const r=i(0),n=i(44),o=i(35),s=i(9);let a=(()=>{class e extends r.RawShaderMaterial{constructor(t){const i={},a=void 0!==t&&void 0!==t.displacementMap,l=void 0!==t&&void 0!==t.extrusionRatio&&t.extrusionRatio>=o.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN&&t.extrusionRatio<o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX;a&&s.setShaderDefine(i,"USE_DISPLACEMENTMAP",!0),l&&s.setShaderDefine(i,"USE_EXTRUSION",!0),super({name:"EdgeMaterial",vertexShader:"\n#define EDGE_DEPTH_OFFSET 0.0001\n\nattribute vec4 color;\n\n// SHADER_NAME may be defined by THREE.JS own shaders in which case these attributes & uniforms are\n// already defined\n#ifndef SHADER_NAME\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n#endif\n\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\n#ifdef USE_DISPLACEMENTMAP\nattribute vec3 normal;\nattribute vec2 uv;\nuniform sampler2D displacementMap;\n#endif\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_vertex>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n\n    #ifdef USE_COLOR\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n    #else\n    vColor = edgeColor.rgb;\n    #endif\n\n    vec3 transformed = vec3( position );\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_vertex>\n    #endif\n\n    #ifdef USE_DISPLACEMENTMAP\n    transformed += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n    gl_Position = projectionMatrix * mvPosition;\n    // After projection gl_Position contains clip space coordinates of each vertex\n    // before perspective division (1 / w), thus only vertexes with -w < z < w should\n    // be displayed and offset. We offset only those edges which z coordinate in NDC\n    // space is between: -inf < z < 1\n    float depthOffset = step(-1.0, -gl_Position.z / gl_Position.w) * EDGE_DEPTH_OFFSET;\n    gl_Position.z -= depthOffset;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",uniforms:{edgeColor:new r.Uniform(new r.Color(e.DEFAULT_COLOR)),edgeColorMix:new r.Uniform(e.DEFAULT_COLOR_MIX),fadeNear:new r.Uniform(n.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new r.Uniform(n.FadingFeature.DEFAULT_FADE_FAR),extrusionRatio:new r.Uniform(o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),displacementMap:new r.Uniform(a?t.displacementMap:new r.Texture)},depthWrite:!1,defines:i}),s.enforceBlending(this),n.FadingFeature.patchGlobalShaderChunks(),n.ExtrusionFeature.patchGlobalShaderChunks(),void 0!==t&&(void 0!==t.color&&this.color.set(t.color),void 0!==t.colorMix&&(this.colorMix=t.colorMix),void 0!==t.fadeNear&&(this.fadeNear=t.fadeNear),void 0!==t.fadeFar&&(this.fadeFar=t.fadeFar),void 0!==t.displacementMap&&(this.displacementMap=t.displacementMap),void 0!==t.extrusionRatio&&(this.extrusionRatio=t.extrusionRatio))}get color(){return this.uniforms.edgeColor.value}set color(e){this.uniforms.edgeColor.value.copy(e)}get colorMix(){return this.uniforms.edgeColorMix.value}set colorMix(e){this.uniforms.edgeColorMix.value!==e&&(this.uniforms.edgeColorMix.value=e,s.setShaderMaterialDefine(this,"USE_COLOR",e>0))}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value!==e&&(this.uniforms.fadeFar.value=e,s.setShaderMaterialDefine(this,"USE_FADING",e>0))}get extrusionRatio(){return this.uniforms.extrusionRatio.value}set extrusionRatio(e){if(this.uniforms.extrusionRatio.value===e)return;this.uniforms.extrusionRatio.value=e;const t=e>=o.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN;s.setShaderMaterialDefine(this,"USE_EXTRUSION",t)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),s.setShaderMaterialDefine(this,"USE_DISPLACEMENTMAP",t)}}return e.DEFAULT_COLOR=0,e.DEFAULT_COLOR_MIX=0,e})();t.EdgeMaterial=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(35),n=r.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT*r.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT;t.default={extrusion_pars_vertex:"\n// Add define so we can check for it in the outline effect (see Outline.ts).\n#define HAS_EXTRUSION_PARS_VERTEX\n// Extrusion axis (xyz: vector, w: factor).\nattribute vec4 extrusionAxis;\nuniform float extrusionRatio;\n#ifdef FLAT_SHADED\nvarying vec4 vExtrusionAxis;\n#endif\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#endif\n",extrusion_vertex:`\n#define HAS_EXTRUSION_VERTEX\n#ifdef ZFIGHTING_WORKAROUND\n// Cancel extrusionRatio (meaning, force to 1) if extrusionAxisLen < MIN_BUILDING_HEIGHT.\nconst float MIN_BUILDING_HEIGHT_SQUARED = ${n};\nfloat extrusionAxisLenSquared = dot(extrusionAxis.xyz, extrusionAxis.xyz);\nvExtrusionRatio = (extrusionAxisLenSquared < MIN_BUILDING_HEIGHT_SQUARED) ? 1.0 : extrusionRatio;\n#else\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ntransformed = transformed + extrusionAxis.xyz * (vExtrusionRatio - 1.0);\n#ifdef FLAT_SHADED\nvExtrusionAxis = vec4(normalMatrix * extrusionAxis.xyz, extrusionAxis.w);\n#endif\n`,extrusion_normal_fragment_begin:"\n#ifdef FLAT_SHADED\n    // Flattened this divergent path to prevent undefined behaviour in the following derivatives\n    // functions. For more info:\n    // http://www.aclockworkberry.com/shader-derivative-functions/#Derivatives_and_branches\n\n    // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n    vec3 fdx = vec3(dFdx(vViewPosition.x), dFdx(vViewPosition.y), dFdx(vViewPosition.z));\n    vec3 fdy = vec3(dFdy(vViewPosition.x), dFdy(vViewPosition.y), dFdy(vViewPosition.z));\n    vec3 normal = cross( fdx, fdy );\n    if (vExtrusionAxis.w > 0.999999) {\n        normal = vExtrusionAxis.xyz;\n    }\n    normal = normalize(normal);\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t#endif\n\t#endif\n#endif\n// non perturbed normal for clearcoat among others\nvec3 geometryNormal = normal;\n",extrusion_pars_fragment:"\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#else\nuniform float extrusionRatio;\n#endif\nvarying vec4 vExtrusionAxis;\n",extrusion_fragment:"\n#ifndef ZFIGHTING_WORKAROUND\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ngl_FragColor.a *= smoothstep( 0.0, 0.25, vExtrusionRatio );\n"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fading_pars_vertex:"\nvarying float fadingDepth;\n",fading_vertex:"\nfadingDepth = -mvPosition.z;\n",fading_pars_fragment:"\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n",fading_fragment:'\n\n// lerp with "hard" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n'}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simpleLightingShadowChunk=void 0,t.simpleLightingShadowChunk="\n    struct PhysicalMaterial {\n        vec3\tdiffuseColor;\n        float\tspecularRoughness;\n        vec3\tspecularColor;\n    };\n\n    #define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n    void RE_Direct_Physical( const in IncidentLight directLight,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n        // directLight.color is the light color * shadow, internally three.js uses a step function, so\n        // this value is either the light color or black. in order to lighten up the shadows, we\n        // take add 50% of the color to grey (to give us either pure white or grey) and multiply this to\n        // the material's diffuse color.\n        #if defined(USE_SHADOWMAP)\n            reflectedLight.directDiffuse = (0.5 * directLight.color +\n                vec3(0.5,0.5,0.5)) * material.diffuseColor;\n        #else\n            reflectedLight.directDiffuse = material.diffuseColor;\n        #endif\n    }\n\n    void RE_IndirectDiffuse_Physical( const in vec3 irradiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n            // Disable influence of indirect light (it is handled in the RE_Direct_Physical function)\n    }\n\n    void RE_IndirectSpecular_Physical( const in vec3 radiance,\n        const in vec3 irradiance,\n        const in vec3 clearcoatRadiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight) {\n            // Disable specular reflection of light.\n    }\n\n    #define RE_Direct               RE_Direct_Physical\n    #define RE_IndirectDiffuse      RE_IndirectDiffuse_Physical\n    #define RE_IndirectSpecular     RE_IndirectSpecular_Physical\n"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroundAtmosphereMaterial=t.GroundAtmosphereShader=void 0;const r=i(0),n=i(82),o=i(9);t.GroundAtmosphereShader={uniforms:{u_eyePositionWorld:new r.Uniform(new r.Vector3),u_lightDirectionWorld:new r.Uniform(new r.Vector3(0,1,0)),u_modelViewProjection:new r.Uniform(new r.Matrix4),u_atmosphereEnv:new r.Uniform(new r.Vector4(6378137*1.001,6537590.425,0,1)),u_hsvCorrection:new r.Uniform(new r.Vector3(0,0,0)),topColor:new r.Uniform(new r.Color(30719)),bottomColor:new r.Uniform(new r.Color(16777215)),offset:new r.Uniform(33),exponent:new r.Uniform(.6),fogColor:new r.Uniform(new r.Color(30719)),fogNear:new r.Uniform(new r.Color(30719)),fogFar:new r.Uniform(new r.Color(16777215))},vertexShader:`\n\n    #define IMPROVE_INTERSECT_PRECISION 1\n    #define IMPROVE_DOT_PRECISION 1\n\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    // Base mandatory uniforms\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec4 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height, light mode\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Km = 0.0015;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 25.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        1.0 / pow(0.650, 4.0), // Red\n        1.0 / pow(0.570, 4.0), // Green\n        1.0 / pow(0.475, 4.0)); // Blue\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${n.default.atmosphere_common_utils}\n    ${n.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for ground.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE.\n    //\n    AtmosphereColor computeGroundAtmosphere(vec3 v3Pos, vec3 vLightDir, bool dynamicLighting)\n    {\n        // Retrieve environment variables\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be moved to const or define(s) at further optimizations:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = fScale / RayleighScaleDepth;\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n#if !defined(IMPROVE_DOT_PRECISION)\n        vec3 v3Dir = normalize(v3Pos);\n#endif\n\n#ifdef CAMERA_IN_SPACE\n\n        // Calculate first point of camera ray and sphere intersection.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection, setting it to\n        // the length of ray passed through atmosphere\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n        float fDepth = exp((fInnerRadius - fOuterRadius) / RayleighScaleDepth);\n\n#else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        // Virtually fNear is just at eye position, so ray passing through atmosphere does not shorten\n        // fFar -= 0.0;\n        float fDepth = exp((fInnerRadius - fCameraHeight) / RayleighScaleDepth);\n#endif\n\n#if defined(IMPROVE_DOT_PRECISION)\n        float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n#else\n        float fCameraAngle = dot(-v3Ray, v3Dir);\n#endif\n        float fCameraScale = scale(fCameraAngle);\n\n        // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n#if defined(IMPROVE_DOT_PRECISION)\n        // The light angle for given light source may be calculated as:\n        // angle = dot(vLightDir, v3Dir) / length(v3Dir);\n        // where v3Dir holds normalized vertex position, but for precision issues we v3Pos (un-normalized)\n        float fLightAngle = conditionalBranchFree(dynamicLighting, dot(vLightDir, v3Pos) / length(v3Pos), 1.0);\n#else\n        float fLightAngle = conditionalBranchFree(dynamicLighting, dot(vLightDir, v3Dir), 1.0);\n#endif\n        float fLightScale = scale(fLightAngle);\n\n        float fCameraOffset = fDepth * fCameraScale;\n        float fTemp = (fLightScale + fCameraScale);\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i = 0; i < nSamples; i++)\n        {\n            float fHeight = length(v3SamplePoint);\n            float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n            float fScatter = fDepth * fTemp - fCameraOffset;\n            // Compute color factors\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (fDepth * fScaledLength);\n            // Move to the next point\n            v3SamplePoint += v3SampleRay;\n        }\n\n        AtmosphereColor color;\n        color.mie = v3BaseColor * (InvWavelength * KrESun + KmESun);\n        // Calculate the attenuation factor for the ground\n        color.rayleigh = v3Attenuate;\n\n        return color;\n    }\n\n    void main(void)\n    {\n        float fLightMode = u_atmosphereEnv.w;\n        bool bDynamicLight = fLightMode != 0.0;\n\n        vec3 vLightDir = conditionalBranchFree(bDynamicLight,\n            u_lightDirectionWorld,\n            u_eyePositionWorld);\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeGroundAtmosphere(position.xyz, vLightDir, bDynamicLight);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n        v_vertToOrigin = normalize(position.xyz);\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n\n    // Exposure correction gives more subtle gradients on the ground.\n    #define CORRECT_EXPOSURE 1\n    #define FADE_DEPTH 1\n    #define NIGHT_LOCAL 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec4 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height, light mode\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${n.default.atmosphere_common_utils}\n    ${n.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n        float fLightMode = u_atmosphereEnv.w;\n        bool bDynamicLight = fLightMode != 0.0;\n\n        vec3 vLightDir = conditionalBranchFree(bDynamicLight,\n            u_lightDirectionWorld,\n            u_eyePositionWorld);\n        vLightDir = normalize(vLightDir);\n\n        // GPU gems mix of ground solution, with custom alpha settings\n        vec3 cRgb = v_mieColor + 0.25 * v_rayleighColor;\n\n        // Not needed for HDR frame buffer\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Interesting results with exposure factor: 2.0, 3.5, 4.0\n        cRgb = correctExposure(cRgb, 3.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Base atmosphere opacity\n        float fAtmosphereAlpha = 1.0;\n\n        // Factor based on the distance of camera atmosphere and ground, results are:\n        // 0.0 = camera on the ground surface,\n        // 1.0 = at the outer edge of the atmosphere.\n        float fDepthFactor = clamp((fCameraHeight - fInnerRadius) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n    #ifdef FADE_DEPTH\n        // Fade alpha based on the distance of camera between atmosphere layers\n        #ifdef FADE_DEPTH_LINEAR\n            fAtmosphereAlpha *= fDepthFactor;\n        #else\n            fAtmosphereAlpha *= pow(fDepthFactor, 1.5);\n        #endif\n    #endif\n\n#if defined(FADE_NIGHT) || defined(DARKEN_NIGHT)\n        // Adjust factor based on time of day, results are:\n        // 0.0 = night,\n        // 1.0 = day.\n    #ifdef NIGHT_GLOBAL\n        // Global night fade based on camera and light orientation\n        float fNightFactor = conditionalBranchFree(bDynamicLight,\n            clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0),\n             1.0);\n        fNightFactor = pow(fNightFactor, 0.5);\n    #else // NIGHT_LOCAL\n        float fNightFactor = conditionalBranchFree(bDynamicLight,\n            clamp(dot(v_vertToOrigin, vLightDir) / length(v_vertToOrigin), 0.0, 1.0),\n            1.0);\n        fNightFactor = pow(fNightFactor, 0.8);\n    #endif\n#endif\n\n    #ifdef FADE_NIGHT\n        // Adjust alpha for night side of the globe\n        fAtmosphereAlpha *= fNightFactor;\n    #endif\n\n    #ifdef DARKEN_NIGHT\n        // Change the brightness depending on night / day side.\n        // NOTE: Darkening should be rather applied in HSV space, without loss on saturation,\n        // but it is much more GPU consuming.\n        const float minBrightness = 0.5;\n        float fDarkenFactor = clamp(fNightFactor, minBrightness, 1.0);\n        cRgb *= fDarkenFactor;\n    #endif\n\n    #ifdef EXPOSURE_DEPTH\n        // Control exposure depending from ground distance\n        float exposureBoost = 3.0 - fDepthFactor;\n        cRgb = correctExposure(cRgb, exposureBoost);\n    #endif\n\n        // Experimental fading out of focus point - similar to fresnel effect in top view.\n        // This fade is handy to better expose cartographic/map features in screen center.\n        float fFocusFactor = 1.0 - clamp(dot(normalize(v_vertToCamera), v_vertToOrigin), 0.0, 1.0) + 0.1;\n        fFocusFactor = pow(fFocusFactor, 2.5);\n        fAtmosphereAlpha *= fFocusFactor;\n\n        // Integrate all features\n        gl_FragColor = vec4(cRgb, fAtmosphereAlpha);\n    }\n    `};class s extends r.RawShaderMaterial{constructor(e){super({name:"GroundAtmosphereMaterial",vertexShader:t.GroundAtmosphereShader.vertexShader,fragmentShader:t.GroundAtmosphereShader.fragmentShader,uniforms:t.GroundAtmosphereShader.uniforms,transparent:!0,depthTest:!1,depthWrite:!1,side:r.FrontSide,blending:r.NormalBlending,fog:!1})}setDynamicLighting(e){this.uniforms.u_atmosphereEnv.value.w=e?1:0}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,r){const n=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=n.eyePos,i=n.modelViewProjection,s=n.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=r.clone();const a=s>this.outerRadius,l=o.setShaderDefine(e.defines,"CAMERA_IN_SPACE",a),c=o.setShaderDefine(e.defines,"CAMERA_IN_ATMOSPHERE",!a);e.needsUpdate=l||c}}getCameraInfo(e,t,i=!1){if(i){const i=(new r.Matrix4).identity(),n=(new r.Matrix4).getInverse(e.matrixWorld).transpose(),o=t.projectionMatrix,s=new r.Matrix4;s.multiplyMatrices(n,i),s.multiplyMatrices(o,s);const a=new r.Vector3;e.getWorldPosition(a);const l=new r.Vector3;return t.getWorldPosition(l),{modelViewProjection:s,eyePos:a,eyeHeight:l.distanceTo(a)}}{const i=e.matrixWorld,n=t.matrixWorldInverse,o=t.projectionMatrix,s=new r.Matrix4;s.multiplyMatrices(n,i),s.multiplyMatrices(o,s);const a=new r.Vector3;t.getWorldPosition(a);const l=new r.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:s,eyePos:a,eyeHeight:c}}}}t.GroundAtmosphereMaterial=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionLineMaterial=t.HighPrecisionLineMaterial=void 0;const r=i(0),n=i(45);let o=(()=>{class e extends r.RawShaderMaterial{constructor(t){Object.assign(r.ShaderChunk,n.default);const i={name:"HighPrecisionLineMaterial",vertexShader:"\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuse, opacity );\n    #endif\n}",uniforms:{diffuse:new r.Uniform(new r.Color(e.DEFAULT_COLOR)),opacity:new r.Uniform(e.DEFAULT_OPACITY),u_mvp:new r.Uniform(new r.Matrix4),u_eyepos:new r.Uniform(new r.Vector3),u_eyepos_lowpart:new r.Uniform(new r.Vector3)}};Object.assign(i,t),super(i),this.type="HighPrecisionLineMaterial",this.isHighPrecisionLineMaterial=!0,void 0!==t&&(void 0!==t.color&&this.color.set(t.color),void 0!==t.opacity&&(this.opacity=t.opacity)),this.updateTransparencyFeature()}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}updateTransparencyFeature(){this.transparent=this.opacity<1}}return e.DEFAULT_COLOR=80,e.DEFAULT_OPACITY=1,e})();t.HighPrecisionLineMaterial=o,t.isHighPrecisionLineMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionLineMaterial}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionPointMaterial=t.HighPrecisionPointMaterial=void 0;const r=i(0),n=i(45);let o=(()=>{class e extends r.PointsMaterial{constructor(t){Object.assign(r.ShaderChunk,n.default),super(t),this.type="HighPrecisionPointMaterial",this.vertexShader="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}",this.fragmentShader=r.ShaderChunk.points_frag,this.fog=!1,this.uniforms={diffuse:new r.Uniform(new r.Color(e.DEFAULT_COLOR)),opacity:new r.Uniform(e.DEFAULT_OPACITY),size:new r.Uniform(e.DEFAULT_SIZE),scale:new r.Uniform(e.DEFAULT_SCALE),map:new r.Uniform(new r.Texture),uvTransform:new r.Uniform(new r.Matrix3),u_mvp:new r.Uniform(new r.Matrix4),u_eyepos:new r.Uniform(new r.Vector3),u_eyepos_lowpart:new r.Uniform(new r.Vector3)},this.isHighPrecisionPointMaterial=!0,void 0!==t&&(void 0!==t.color&&this.color.set(t.color),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.size&&(this.size=t.size),void 0!==t.scale&&(this.scale=t.scale),void 0!==t.uvTransform&&(this.uvTransform=t.uvTransform),void 0!==t.map&&(this.map=t.map))}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}get uvTransform(){return this.uniforms.uvTransform.value}set uvTransform(e){this.uniforms.uvTransform.value=e}}return e.DEFAULT_COLOR=80,e.DEFAULT_OPACITY=1,e.DEFAULT_SIZE=1,e.DEFAULT_SCALE=1,e})();t.HighPrecisionPointMaterial=o,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconMaterial=void 0;const r=i(0);class n extends r.RawShaderMaterial{constructor(e){super({name:"IconMaterial",vertexShader:"\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}",uniforms:{map:new r.Uniform(e.map)},depthTest:!0,depthWrite:!1,transparent:!0,vertexColors:!0,premultipliedAlpha:!0,blending:r.NormalBlending})}get map(){return this.uniforms.map.value}}t.IconMaterial=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LuminosityHighPassShader=void 0;const r=i(0);t.LuminosityHighPassShader={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new r.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform vec3 defaultColor;\n    uniform float defaultOpacity;\n    uniform float luminosityThreshold;\n    uniform float smoothWidth;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        vec3 luma = vec3( 0.299, 0.587, 0.114 );\n        float v = dot( texel.xyz, luma );\n        vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n        float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n        gl_FragColor = mix( outputColor, texel, alpha );\n    }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAAMaterial=void 0;const r=i(0),n=i(81);class o extends r.ShaderMaterial{constructor(e){super({uniforms:e,vertexShader:n.CopyShader.vertexShader,fragmentShader:n.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:r.AdditiveBlending,depthTest:!1,depthWrite:!1})}}t.MSAAMaterial=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SepiaShader=void 0,t.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float amount;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 color = texture2D( tDiffuse, vUv );\n            vec3 c = color.rgb;\n            color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n            color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n            color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n            gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n        }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyAtmosphereMaterial=t.SkyAtmosphereShader=void 0;const r=i(0),n=i(82),o=i(9);t.SkyAtmosphereShader={uniforms:{u_eyePositionWorld:new r.Uniform(new r.Vector3),u_lightDirectionWorld:new r.Uniform(new r.Vector3(0,1,0)),u_modelViewProjection:new r.Uniform(new r.Matrix4),u_atmosphereEnv:new r.Uniform(new r.Vector4(6378137,6537590.425,0,1)),u_hsvCorrection:new r.Uniform(new r.Vector3(0,0,0)),topColor:new r.Uniform(new r.Color(30719)),bottomColor:new r.Uniform(new r.Color(16777215)),offset:new r.Uniform(33),exponent:new r.Uniform(.6),fogColor:new r.Uniform(new r.Color(30719)),fogNear:new r.Uniform(new r.Color(30719)),fogFar:new r.Uniform(new r.Color(16777215))},vertexShader:`\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec4 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height, light mode\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km = 0.0015;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 15.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n        9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n        19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${n.default.atmosphere_common_utils}\n    ${n.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for sky.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE\n    //\n    AtmosphereColor computeSkyAtmosphere(vec3 v3Pos, vec3 vLightDir, bool dynamicLighting)\n    {\n        // Unpack attributes\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be const or define(s) at further optimization:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = (fScale / RayleighScaleDepth);\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n    #ifdef CAMERA_IN_SPACE\n\n        // Calculate the closest intersection of the ray with the outer\n        // atmosphere, this is the first point of the ray passing through the atmosphere dome.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n\n        float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n        float fStartDepth = exp(-1.0 / RayleighScaleDepth );\n        float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    #else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        float height = length(v3Start);\n        float depth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n        float fStartAngle = dot(v3Ray, v3Start) / height;\n        float fStartOffset = depth * scale(fStartAngle);\n\n    #endif\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i=0; i < nSamples; i++)\n        {\n            float height = length(v3SamplePoint);\n            float depth = exp(fScaleOverScaleDepth * (fInnerRadius - height));\n            float fLightAngle = dot(vLightDir, v3SamplePoint) / height;\n            float fCameraAngle = dot(v3Ray, v3SamplePoint) / height;\n            float fScatter = (fStartOffset + depth * (scale(fLightAngle) - scale(fCameraAngle)));\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (depth * fScaledLength);\n            v3SamplePoint += v3SampleRay;\n        }\n\n        // Scale the Mie and Rayleigh colors and set up output of the function\n        AtmosphereColor color;\n        color.mie = v3BaseColor * KmESun;\n        color.rayleigh = v3BaseColor * (InvWavelength * KrESun);\n        return color;\n    }\n\n    void main(void)\n    {\n        float fLightMode = u_atmosphereEnv.w;\n        bool bDynamicLight = fLightMode != 0.0;\n\n        vec3 vLightDir = conditionalBranchFree(bDynamicLight,\n            u_lightDirectionWorld,\n            u_eyePositionWorld);\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeSkyAtmosphere(position.xyz, vLightDir, bDynamicLight);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n    // Because of harsh light distribution the exposure correction is always enabled for the sky.\n    #define CORRECT_EXPOSURE 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec4 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height, light mode\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${n.default.atmosphere_common_utils}\n    ${n.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n        float fLightMode = u_atmosphereEnv.w;\n        bool bDynamicLight = fLightMode != 0.0;\n\n        vec3 vLightDir = conditionalBranchFree(bDynamicLight,\n            u_lightDirectionWorld,\n            u_eyePositionWorld);\n        vLightDir = normalize(vLightDir);\n\n        // NOTE:\n        // For better precision normalization may be added on fragment (for mobile devices)\n        // while in vertex shader may be left un-normalized\n        // dot(vLightDir, normalize(v_vertToCamera)) / length(v_vertToCamera);\n        float fCosAngle = dot(vLightDir, v_vertToCamera) / length(v_vertToCamera);\n        float fRayleighPhase = 0.75 * (1.0 + fCosAngle * fCosAngle);\n        float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCosAngle * fCosAngle) / pow(1.0 + g2 - 2.0 * g * fCosAngle, 1.5);\n\n        vec3 cRgb = fRayleighPhase * v_rayleighColor + fMiePhase * v_mieColor;\n\n        // Sky produces very harsh lighting effect so exposure correction is always enabled.\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Exposure factor may be exposed to uniform variable.\n        cRgb = correctExposure(cRgb, 2.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n        float fAtmosphereAlpha = clamp((fOuterRadius - fCameraHeight) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n\n        // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n        float fNightAlpha = conditionalBranchFree(bDynamicLight,\n            clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0),\n            1.0);\n        fAtmosphereAlpha *= pow(fNightAlpha, 0.5);\n\n        gl_FragColor = vec4(cRgb, mix(cRgb.b, 1.0, fAtmosphereAlpha));\n    }\n    `};class s extends r.RawShaderMaterial{constructor(e){super({name:"SkyAtmosphereMaterial",vertexShader:t.SkyAtmosphereShader.vertexShader,fragmentShader:t.SkyAtmosphereShader.fragmentShader,uniforms:t.SkyAtmosphereShader.uniforms,transparent:!0,depthTest:!0,depthWrite:!1,side:r.BackSide,blending:r.NormalBlending,fog:!1})}setDynamicLighting(e){this.uniforms.u_atmosphereEnv.value.w=e?1:0}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,r){const n=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=n.eyePos,i=n.modelViewProjection,s=n.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=r.clone();const a=s>this.outerRadius,l=o.setShaderDefine(e.defines,"CAMERA_IN_SPACE",a),c=o.setShaderDefine(e.defines,"CAMERA_IN_ATMOSPHERE",!a);e.needsUpdate=l||c}}getCameraInfo(e,t,i=!1){if(i){const i=(new r.Matrix4).identity(),n=(new r.Matrix4).getInverse(e.matrixWorld).transpose(),o=t.projectionMatrix,s=new r.Matrix4;s.multiplyMatrices(n,i),s.multiplyMatrices(o,s);const a=new r.Vector3;e.getWorldPosition(a);const l=new r.Vector3;return t.getWorldPosition(l),{modelViewProjection:s,eyePos:a,eyeHeight:l.distanceTo(a)}}{const i=e.matrixWorld,n=t.matrixWorldInverse,o=t.projectionMatrix,s=new r.Matrix4;s.multiplyMatrices(n,i),s.multiplyMatrices(o,s);const a=new r.Vector3;t.getWorldPosition(a);const l=new r.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:s,eyePos:a,eyeHeight:c}}}}t.SkyAtmosphereMaterial=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMaterial=t.LineDashesModes=void 0;const r=i(0),n=i(44),o=i(45),s=i(9),a={None:o.LineCapsModes.CAPS_NONE,Square:o.LineCapsModes.CAPS_SQUARE,Round:o.LineCapsModes.CAPS_ROUND,TriangleIn:o.LineCapsModes.CAPS_TRIANGLE_IN,TriangleOut:o.LineCapsModes.CAPS_TRIANGLE_OUT},l=Object.keys(a).reduce((e,t)=>{const i=t;return e[a[i]]=i,e},{});var c;!function(e){e[e.DASHES_SQUARE=0]="DASHES_SQUARE",e[e.DASHES_ROUND=1]="DASHES_ROUND",e[e.DASHES_DIAMOND=2]="DASHES_DIAMOND"}(c=t.LineDashesModes||(t.LineDashesModes={}));const h={Square:c.DASHES_SQUARE,Round:c.DASHES_ROUND,Diamond:c.DASHES_DIAMOND},d=Object.keys(h).reduce((e,t)=>{const i=t;return e[h[i]]=i,e},{}),u=new r.Color,m=`\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform vec3 outlineColor;\nuniform float opacity;\nuniform float extrusionWidth;\nuniform float outlineWidth;\nuniform vec2 tileSize;\nuniform vec2 drawRange;\n\n#ifdef USE_DASHED_LINE\nuniform float dashSize;\nuniform float gapSize;\nuniform vec3 dashColor;\n\n#define DASHES_SQUARE ${c.DASHES_SQUARE}\n#define DASHES_ROUND ${c.DASHES_ROUND}\n#define DASHES_DIAMOND ${c.DASHES_DIAMOND}\n#endif\n\n#ifdef USE_TILE_CLIP\nvarying vec3 vPosition;\n#endif\n\nvarying vec3 vRange;\nvarying vec4 vCoords;\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\n#include <round_edges_and_add_caps>\n#include <tile_clip_func>\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\nvoid main() {\n    float alpha = opacity;\n    vec3 outputDiffuse = diffuse;\n\n    #ifdef USE_TILE_CLIP\n    tileClip(vPosition.xy, tileSize);\n    #endif\n\n    // Calculate distance to center (0.0: lineCenter, 1.0: lineEdge).\n    float distToCenter = roundEdgesAndAddCaps(vCoords, vRange);\n    // Calculate distance to edge (-1.0: lineCenter, 0.0: lineEdge).\n    float distToEdge = distToCenter - (extrusionWidth + outlineWidth) / extrusionWidth;\n\n    // Decrease the line opacity by the distToEdge, making the transition steeper when the slope\n    // of distToChange increases (i.e. the line is further away).\n    float width = fwidth(distToEdge);\n    alpha *= (1.0 - smoothstep(-width, width, distToEdge));\n\n    #ifdef USE_DASHED_LINE\n    // Compute the distance to the dash origin (0.0: dashOrigin, 1.0: dashEnd, (d+g)/d: gapEnd).\n    float d = dashSize / vRange.x;\n    float g = gapSize / vRange.x;\n    float distToDashOrigin = mod(vCoords.x, d + g) / d;\n\n    // Compute distance to dash edge (0.5: dashCenter, 0.0: dashEdge) and compute the\n    // dashBlendFactor similarly on how we did it for the line opacity.\n    float distToDashEdge = 0.5 - distance(distToDashOrigin, (d + g) / d * 0.5);\n    #if DASHES_MODE == DASHES_ROUND\n    distToDashEdge = 0.5 - distance(vec2(distToCenter * 0.5, distToDashEdge), vec2(0.0, 0.5));\n    #elif DASHES_MODE == DASHES_DIAMOND\n    distToDashEdge -= distToCenter * 0.5;\n    #endif\n    float dashWidth = fwidth(distToDashEdge);\n    float dashBlendFactor = 1.0 - smoothstep(-dashWidth, dashWidth, distToDashEdge);\n\n    #ifdef USE_DASH_COLOR\n    outputDiffuse = mix(diffuse, dashColor, dashBlendFactor);\n    #endif\n    #endif\n\n    #ifdef USE_OUTLINE\n    // Calculate distance to outline (0.0: lineEdge, outlineWidth/lineWidth: outlineEdge) and\n    // compute the outlineBlendFactor (used to mix line and outline colors).\n    float distToOutline = distToCenter - 1.0;\n    float outlineWidth = fwidth(distToOutline);\n    float outlineBlendFactor = smoothstep(-outlineWidth, outlineWidth, distToOutline);\n\n    // Mix the colors using the different computed factors.\n    #if defined(USE_DASHED_LINE) && !defined(USE_DASH_COLOR)\n    float colorBlendFactor = smoothstep(-1.0, 1.0, dashBlendFactor - outlineBlendFactor);\n    outputDiffuse = mix(\n      mix(\n        mix(outlineColor, diffuse, colorBlendFactor),\n        outputDiffuse,\n        dashBlendFactor\n      ),\n      outlineColor,\n      outlineBlendFactor\n    );\n    #else\n    outputDiffuse = mix(outputDiffuse, outlineColor, outlineBlendFactor);\n    #endif\n    #endif\n\n    #if defined(USE_DASHED_LINE) && !defined(USE_DASH_COLOR)\n    // Multiply the alpha by the dashBlendFactor.\n    #if defined(USE_OUTLINE)\n    alpha *= clamp(dashBlendFactor + outlineBlendFactor, 0.0, 1.0);\n    #else\n    alpha *= 1.0 - dashBlendFactor;\n    #endif\n    #endif\n\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( outputDiffuse * vColor, alpha );\n    #else\n    gl_FragColor = vec4( outputDiffuse, alpha );\n    #endif\n\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}`;let p=(()=>{class e extends r.RawShaderMaterial{constructor(t){var i;Object.assign(r.ShaderChunk,o.default),n.FadingFeature.patchGlobalShaderChunks();const a={CAPS_MODE:o.LineCapsModes.CAPS_ROUND,DASHES_MODE:c.DASHES_SQUARE};let l,h=!0,d=1;if(void 0!==t){h=!0===t.fog,h&&s.setShaderDefine(a,"USE_FOG",!0),d=void 0!==t.opacity?t.opacity:d,l=t.displacementMap,void 0!==l&&s.setShaderDefine(a,"USE_DISPLACEMENTMAP",!0),void 0!==t.outlineWidth&&t.outlineWidth>0&&s.setShaderDefine(a,"USE_OUTLINE",!0)}super({name:"SolidLineMaterial",vertexShader:"\n#define SEGMENT_OFFSET 0.1\n\nattribute vec3 extrusionCoord;\nattribute vec3 position;\nattribute vec4 bitangent;\nattribute vec3 tangent;\nattribute vec2 uv;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float extrusionWidth;\nuniform float outlineWidth;\nuniform float offset;\nuniform vec2 drawRange;\n\n#ifdef USE_DISPLACEMENTMAP\nuniform sampler2D displacementMap;\n#endif\n\n#ifdef USE_TILE_CLIP\nvarying vec3 vPosition;\n#endif\nvarying vec3 vRange;\nvarying vec4 vCoords;\n#ifdef USE_COLOR\nattribute vec3 color;\nvarying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n\n#include <extrude_line_vert_func>\n\nvoid main() {\n    // Calculate the segment.\n    vec2 segment = abs(extrusionCoord.xy) - SEGMENT_OFFSET;\n    float segmentPos = sign(extrusionCoord.x) / 2.0 + 0.5;\n\n    // Calculate the vertex position inside the line (segment) and extrusion direction and factor.\n    float linePos = mix(segment.x, segment.y, segmentPos);\n    vec2 extrusionDir = sign(extrusionCoord.xy);\n    // Precompute to avoid computing multiple times\n    float tanHalfAngle = tan(bitangent.w / 2.0);\n    float extrusionFactor = extrusionDir.y * tanHalfAngle;\n\n    // Calculate the extruded vertex position (and scale the extrusion direction).\n    vec3 pos = extrudeLine(\n        position, linePos, extrusionWidth + outlineWidth, bitangent, tangent, tanHalfAngle,\n        extrusionDir);\n\n    // Store the normalized extrusion coordinates in vCoords (with their ranges in vRange).\n    vRange = vec3(extrusionCoord.z, extrusionWidth, extrusionFactor);\n    vCoords = vec4(extrusionDir / vRange.xy, segment / vRange.x);\n\n    // Adjust the segment to fit the drawRange.\n    float capDist = (extrusionWidth + outlineWidth) / extrusionCoord.z;\n    if ((vCoords.w + capDist) < drawRange.x || (vCoords.z - capDist) > drawRange.y) {\n        vCoords.zw += 1.0;\n    }\n    if (vCoords.z < drawRange.x) {\n        vCoords.zw += vec2(drawRange.x - vCoords.z, 0.0);\n    }\n    if (vCoords.w > drawRange.y) {\n        vCoords.zw -= vec2(0.0, vCoords.w - drawRange.y);\n    }\n\n    // Transform position.\n    #ifdef USE_DISPLACEMENTMAP\n    pos += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    // Shift the line based on the offset, where the bitangent is the cross product of the average\n    // of the two direction vectors (the previous and next segment directions) and the normal of\n    // the line (facing into the sky). The w component is the angle between the two segments.\n    // Note, we need to take the angle into consideration, so we use trigonometry to calculate how\n    // much we need to extend the offset. Note, orthough this looks complicated we are doing this\n    // in the vertex shader, so it should not cause a performance issue.\n    pos += bitangent.xyz * offset * sqrt(1.0 + pow(abs(tanHalfAngle), 2.0));\n\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Pass extruded position to fragment shader.\n    #ifdef USE_TILE_CLIP\n    vPosition = pos;\n    #endif\n\n    #ifdef USE_COLOR\n    // Pass vertex color to fragment shader.\n    vColor = color;\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}",fragmentShader:m,uniforms:r.UniformsUtils.merge([{diffuse:new r.Uniform(new r.Color(e.DEFAULT_COLOR)),dashColor:new r.Uniform(new r.Color(e.DEFAULT_COLOR)),outlineColor:new r.Uniform(new r.Color(e.DEFAULT_COLOR)),extrusionWidth:new r.Uniform(e.DEFAULT_WIDTH),outlineWidth:new r.Uniform(e.DEFAULT_OUTLINE_WIDTH),offset:new r.Uniform(e.DEFAULT_OFFSET),opacity:new r.Uniform(e.DEFAULT_OPACITY),tileSize:new r.Uniform(new r.Vector2),fadeNear:new r.Uniform(n.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new r.Uniform(n.FadingFeature.DEFAULT_FADE_FAR),displacementMap:new r.Uniform(void 0!==l?l:new r.Texture),drawRange:new r.Uniform(new r.Vector2(e.DEFAULT_DRAW_RANGE_START,e.DEFAULT_DRAW_RANGE_END)),dashSize:new r.Uniform(e.DEFAULT_DASH_SIZE),gapSize:new r.Uniform(e.DEFAULT_GAP_SIZE)},r.UniformsLib.fog]),defines:a,fog:h,opacity:d}),this.m_fog=h,this.m_opacity=d,s.enforceBlending(this),this.extensions.derivatives=!0,void 0!==t&&(void 0!==t.color&&(u.set(t.color),this.color=u),void 0!==t.outlineColor&&(u.set(t.outlineColor),this.outlineColor=u),void 0!==t.lineWidth&&(this.lineWidth=t.lineWidth),void 0!==t.outlineWidth&&(this.outlineWidth=t.outlineWidth),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.depthTest&&(this.depthTest=t.depthTest),void 0!==t.depthWrite&&(this.depthWrite=t.depthWrite),void 0!==t.fadeNear&&(this.fadeNear=t.fadeNear),void 0!==t.fadeFar&&(this.fadeFar=t.fadeFar),void 0!==t.displacementMap&&(this.displacementMap=t.displacementMap),void 0!==t.caps&&(this.caps=t.caps),void 0!==t.drawRangeStart&&(this.drawRangeStart=t.drawRangeStart),void 0!==t.drawRangeEnd&&(this.drawRangeEnd=t.drawRangeEnd),void 0!==t.dashes&&(this.dashes=t.dashes),void 0!==t.dashColor&&(u.set(t.dashColor),this.dashColor=u),void 0!==t.dashSize&&(this.dashSize=t.dashSize),void 0!==t.gapSize&&(this.gapSize=t.gapSize),void 0!==t.fog&&(this.fog=t.fog),this.offset=null!==(i=t.offset)&&void 0!==i?i:0),this.invalidateFog(),this.invalidateOpacity()}set fog(e){this.m_fog=e,void 0!==this.defines&&s.setShaderMaterialDefine(this,"USE_FOG",e)}get fog(){return this.m_fog&&!0===s.getShaderMaterialDefine(this,"USE_FOG")}set offset(e){this.uniforms.offset.value=e}get offset(){return this.uniforms.offset.value}set outline(e){s.setShaderMaterialDefine(this,"USE_OUTLINE",e)}get outline(){return!0===s.getShaderMaterialDefine(this,"USE_OUTLINE")}get opacity(){return this.m_opacity}set opacity(e){this.m_opacity=e,void 0!==this.uniforms&&(this.uniforms.opacity.value=e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}get outlineColor(){return this.uniforms.outlineColor.value}set outlineColor(e){this.uniforms.outlineColor.value.copy(e)}get dashColor(){return this.uniforms.dashColor.value}set dashColor(e){this.uniforms.dashColor.value.copy(e),s.setShaderMaterialDefine(this,"USE_DASH_COLOR",!0)}get lineWidth(){return 2*this.uniforms.extrusionWidth.value}set lineWidth(e){this.uniforms.extrusionWidth.value=e/2}get outlineWidth(){return this.uniforms.outlineWidth.value}set outlineWidth(e){this.uniforms.outlineWidth.value=e,this.outline=e>0}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e,s.setShaderMaterialDefine(this,"USE_DASHED_LINE",e>0)}get caps(){let e="Round";const t=s.getShaderMaterialDefine(this,"CAPS_MODE");return"number"==typeof t&&l.hasOwnProperty(t)&&(e=l[t]),e}set caps(e){a.hasOwnProperty(e)&&s.setShaderMaterialDefine(this,"CAPS_MODE",a[e])}get dashes(){let e="Square";const t=s.getShaderMaterialDefine(this,"DASHES_MODE");return"number"==typeof t&&d.hasOwnProperty(t)&&(e=d[t]),e}set dashes(e){h.hasOwnProperty(e)&&s.setShaderMaterialDefine(this,"DASHES_MODE",h[e])}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value=e,s.setShaderMaterialDefine(this,"USE_FADING",e>0)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),s.setShaderMaterialDefine(this,"USE_DISPLACEMENTMAP",t)}get drawRangeStart(){return this.uniforms.drawRange.value.x}set drawRangeStart(e){this.uniforms.drawRange.value.x=e}get drawRangeEnd(){return this.uniforms.drawRange.value.y}set drawRangeEnd(e){this.uniforms.drawRange.value.y=e}set clipTileSize(e){this.uniforms.tileSize.value.copy(e);const t=e.x>0&&e.y>0;s.setShaderMaterialDefine(this,"USE_TILE_CLIP",t)}get clipTileSize(){return this.uniforms.tileSize.value}invalidateFog(){this.m_fog!==s.getShaderMaterialDefine(this,"USE_FOG")&&s.setShaderMaterialDefine(this,"USE_FOG",this.m_fog)}invalidateOpacity(){this.m_opacity!==this.uniforms.opacity.value&&(this.uniforms.opacity.value=this.m_opacity)}}return e.DEFAULT_COLOR=16711680,e.DEFAULT_WIDTH=1,e.DEFAULT_OUTLINE_WIDTH=0,e.DEFAULT_OPACITY=1,e.DEFAULT_DRAW_RANGE_START=0,e.DEFAULT_DRAW_RANGE_END=1,e.DEFAULT_DASH_SIZE=1,e.DEFAULT_GAP_SIZE=1,e.DEFAULT_OFFSET=0,e})();t.SolidLineMaterial=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VignetteShader=void 0,t.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float offset;\n        uniform float darkness;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 texel = texture2D( tDiffuse, vUv );\n            vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n            gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n        }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FontCatalog=void 0;const r=i(0),n=i(46),o=i(205),s=i(18);class a{constructor(e,t,i,r,n,s,a,l,c,h,d){this.url=e,this.name=t,this.type=i,this.size=r,this.maxWidth=n,this.maxHeight=s,this.distanceRange=a,this.fonts=l,this.unicodeBlocks=c,this.maxCodePointCount=h,this.m_replacementGlyph=d,this.m_glyphTextureCache=new o.GlyphTextureCache(h,this.maxWidth+1,this.maxHeight+1),this.m_loadingJson=new Map,this.m_loadingPages=new Map,this.m_loadingGlyphs=new Map,this.m_loadedJson=new Map,this.m_loadedPages=new Map,this.m_loadedGlyphs=new Map}static async load(e,t){const i=new URL(e,window.location.href),o=await a.loadJSON(i.href),s=new URL(`${o.name}_Assets/Extra/`,i),l=await a.loadJSON(s.href+"Specials.json"),c=await a.loadTexture(s.href+"Specials.png");c.wrapS=r.ClampToEdgeWrapping,c.wrapT=r.ClampToEdgeWrapping,c.minFilter=r.NearestFilter,c.needsUpdate=!0;const h=o.fonts.find(e=>"Extra"===e.name),d=new n.GlyphData(65533,"Specials",l.chars[0].width,l.chars[0].height,l.chars[0].xadvance,l.chars[0].xoffset,l.chars[0].yoffset,0,0,1,1,c,h);return new a(i.href.substr(0,i.href.lastIndexOf("/")),o.name,o.type,o.size,o.maxWidth,o.maxHeight,o.distanceRange,o.fonts,o.supportedBlocks,t,d)}static async loadTexture(e){return new Promise(t=>{(new r.TextureLoader).load(e,t)})}static async loadJSON(e){const t=await fetch(e);if(!t.ok)throw new Error(`${e} Status Text:  ${t.statusText}`);const i=await t.text();return JSON.parse(i)}dispose(){this.fonts.length=0,this.unicodeBlocks.length=0,this.m_glyphTextureCache.dispose(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}clear(){this.m_glyphTextureCache.clear(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}update(e){this.m_glyphTextureCache.update(e)}get texture(){return this.m_glyphTextureCache.texture}get textureSize(){return this.m_glyphTextureCache.textureSize}get isLoading(){return this.m_loadingJson.size>0||this.m_loadingPages.size>0||this.m_loadingGlyphs.size>0}async loadBlock(e,t,i,r){const n=this.getAssetsPath(i,t),o=`${n}/${e.name.replace(/ /g,"_")}.json`;let s=this.m_loadedJson.get(o);if(void 0===s){let e=this.m_loadingJson.get(o);if(void 0===e)try{e=a.loadJSON(o),this.m_loadingJson.set(o,e),s=await e,this.m_loadingJson.delete(o),this.m_loadedJson.set(o,s)}catch(e){console.error(e),this.m_loadingJson.delete(o)}else s=await e}const l=[];if(!0===r)for(const e of s.pages)l.push(this.loadPage(`${n}/${e}`));return await Promise.all(l),s}removeBlock(e,t,i){const r=this.getAssetsPath(i,t),n=`${r}/${e.name.replace(/ /g,"_")}.json`,o=this.m_loadedJson.get(n);if(void 0!==o){for(const e of o.pages){const t=`${r}/${e}`;this.m_loadingPages.delete(t),this.m_loadedPages.delete(t)}this.m_loadingJson.delete(n),this.m_loadedJson.delete(n)}}async loadCharset(e,t){const i=t.fontName,r=t.fontStyle,n=(t.fontVariant===s.FontVariant.AllCaps||t.fontVariant===s.FontVariant.SmallCaps?e.toUpperCase():e).replace(/[\s\S](?=([\s\S]+))/g,(e,t)=>t.indexOf(e)+1?"":e),o=[];for(const e of n){const t=e.codePointAt(0),n=this.getFont(t,i),s=`${n.name}_${r}`,a=`${s}_${t}`;let l=this.m_loadedGlyphs.get(s);void 0===l&&(l=new Map,this.m_loadedGlyphs.set(s,l));const c=l.get(t);if(void 0===c){let i=this.m_loadingGlyphs.get(a);if(void 0===i){if(-1===n.charset.indexOf(String.fromCodePoint(t))){const i=this.createReplacementGlyph(t,e,n);l.set(t,i),this.m_glyphTextureCache.add(a,i);continue}let o;for(const e of this.unicodeBlocks)if(t>=e.min&&t<=e.max){o=e;break}i=this.loadAssets(t,r,o,n),this.m_loadingGlyphs.set(a,i),i.then(e=>{this.m_loadingGlyphs.delete(a),l.set(t,e),this.m_glyphTextureCache.add(a,e)})}o.push(i)}else this.m_glyphTextureCache.has(a)||(o.push(Promise.resolve(c)),this.m_glyphTextureCache.add(a,c))}return Promise.all(o)}getGlyph(e,t,i){const r=this.m_loadedGlyphs.get(`${t.name}_${i}`);if(void 0!==r)return r.get(e)}getGlyphs(e,t,i){const r=[],n=t.fontName,o=t.fontStyle,a=t.fontVariant,l=a===s.FontVariant.AllCaps||a===s.FontVariant.SmallCaps;for(const t of e){const e=l?t.toUpperCase():t;for(const s of e){const e=s.codePointAt(0),a=this.getFont(e,n),l=this.getGlyph(e,a,o);if(void 0===l)return;r.push(l),void 0!==i&&i.push(s!==t)}}return r}getFont(e,t){let i=this.fonts[0].name;for(const r of this.unicodeBlocks)if(e>=r.min&&e<=r.max){i=void 0!==t&&void 0!==r.fonts.find(e=>e===t)?t:r.fonts[0];break}return this.fonts.find(e=>e.name===i)}updateMemoryUsage(e){let t=0;for(const e of this.unicodeBlocks)t+=2*(e.max-e.min);let i=this.m_glyphTextureCache.textureSize.x*this.m_glyphTextureCache.textureSize.y*4;for(const e in this.m_loadedPages.entries)if(void 0!==this.m_loadedPages.get(e)){const t=this.m_loadedPages.get(e);void 0!==t&&(i+=t.image.width*t.image.height*4)}e.heapSize+=t+i,e.gpuSize+=i}createReplacementGlyph(e,t,i){const r=this.m_replacementGlyph.clone();return r.codePoint=e,r.character=t,r.font=i,r}async loadAssets(e,t,i,r){const o=await this.loadBlock(i,r,t);if(void 0===o)return this.m_replacementGlyph;const s=o.chars.find(t=>t.id===e),a=`${this.getAssetsPath(t,r)}/${o.pages[s.page]}`,l=await this.loadPage(a);return new n.GlyphData(s.id,i.name,s.width,s.height,s.xadvance,s.xoffset,s.yoffset,s.x/l.image.width,1-(s.y+s.height)/l.image.height,(s.x+s.width)/l.image.width,1-s.y/l.image.height,l,r)}async loadPage(e){let t=this.m_loadedPages.get(e);if(void 0===t){let i=this.m_loadingPages.get(e);void 0===i?(i=a.loadTexture(e),this.m_loadingPages.set(e,i),t=await i,t.wrapS=r.ClampToEdgeWrapping,t.wrapT=r.ClampToEdgeWrapping,t.minFilter=r.NearestFilter,t.needsUpdate=!0,this.m_loadingPages.delete(e)&&this.m_loadedPages.set(e,t),this.m_loadingPages.delete(e)):t=await i}return t}getAssetsPath(e,t){let i="_Assets/";switch(e){case s.FontStyle.Bold:void 0!==t.bold&&(i="_BoldAssets/");break;case s.FontStyle.Italic:void 0!==t.italic&&(i="_ItalicAssets/");break;case s.FontStyle.BoldItalic:void 0!==t.boldItalic?i="_BoldItalicAssets/":void 0!==t.italic?i="_ItalicAssets/":void 0!==t.bold&&(i="_BoldAssets/")}return`${this.url}/${this.name}${i}${t.name}`}}t.FontCatalog=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphTextureCache=void 0;const r=i(85),n=i(0),o=i(46),s=i(86);t.GlyphTextureCache=class{constructor(e,t,i){this.capacity=e,this.entryWidth=t,this.entryHeight=i;const o=Math.floor(Math.sqrt(e));this.m_cacheHeight=o*o<e?o+1:o,this.m_cacheWidth=o*this.m_cacheHeight<e?o+1:o,this.m_textureSize=new n.Vector2(this.m_cacheWidth*t,this.m_cacheHeight*i),(this.m_textureSize.y>4096||this.m_textureSize.x>4096)&&console.warn("GlyphTextureCache texture size ("+this.m_textureSize.x+", "+this.m_textureSize.y+") exceeds WebGL's widely supported MAX_TEXTURE_SIZE (4096).\nThis could result in rendering errors on some devices.\nPlease consider reducing its capacity or input assets size."),this.m_entryCache=new r.LRUCache(e),this.initCacheEntries(),this.m_scene=new n.Scene,this.m_camera=new n.OrthographicCamera(0,this.m_textureSize.x,this.m_textureSize.y,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new n.WebGLRenderTarget(this.m_textureSize.x,this.m_textureSize.y,{wrapS:n.ClampToEdgeWrapping,wrapT:n.ClampToEdgeWrapping,depthBuffer:!1,stencilBuffer:!1}),this.m_copyTextureSet=new Set,this.m_copyTransform=new n.Matrix3,this.m_copyPositions=[],this.m_copyPositions.push(new n.Vector2,new n.Vector2,new n.Vector2,new n.Vector2),this.m_copyMaterial=new s.GlyphCopyMaterial,this.m_copyVertexBuffer=new n.InterleavedBuffer(new Float32Array(20*e),5),this.m_copyVertexBuffer.setUsage(n.DynamicDrawUsage),this.m_copyPositionAttribute=new n.InterleavedBufferAttribute(this.m_copyVertexBuffer,3,0),this.m_copyUVAttribute=new n.InterleavedBufferAttribute(this.m_copyVertexBuffer,2,3),this.m_copyGeometry=new n.BufferGeometry,this.m_copyGeometry.setAttribute("position",this.m_copyPositionAttribute),this.m_copyGeometry.setAttribute("uv",this.m_copyUVAttribute);const a=new n.BufferAttribute(new Uint32Array(6*e),1);a.setUsage(n.DynamicDrawUsage),this.m_copyGeometry.setIndex(a),this.m_copyMesh=new n.Mesh(this.m_copyGeometry,this.m_copyMaterial),this.m_copyMesh.frustumCulled=!1,this.m_copyGeometryDrawCount=0,this.m_clearMaterial=new s.GlyphClearMaterial,this.m_clearPositionAttribute=new n.BufferAttribute(new Float32Array(8*e),2),this.m_clearPositionAttribute.setUsage(n.DynamicDrawUsage),this.m_clearGeometry=new n.BufferGeometry,this.m_clearGeometry.setAttribute("position",this.m_clearPositionAttribute);const l=new n.BufferAttribute(new Uint32Array(6*e),1);l.setUsage(n.DynamicDrawUsage),this.m_clearGeometry.setIndex(l),this.m_clearMesh=new n.Mesh(this.m_clearGeometry,this.m_clearMaterial),this.m_clearMesh.frustumCulled=!1,this.m_clearGeometryDrawCount=0,this.m_scene.add(this.m_clearMesh,this.m_copyMesh)}dispose(){this.m_entryCache.clear(),this.m_scene.remove(this.m_clearMesh,this.m_copyMesh),this.m_rt.dispose(),this.m_clearMaterial.dispose(),this.m_copyMaterial.dispose(),this.m_copyTextureSet.clear(),this.m_clearGeometry.dispose(),this.m_copyGeometry.dispose()}get texture(){return this.m_rt.texture}get textureSize(){return this.m_textureSize}add(e,t){if(void 0!==this.m_entryCache.get(e))return;const i=this.m_entryCache.oldest;if(null===i)throw new Error("GlyphTextureCache is uninitialized!");this.clearCacheEntry(i.value),this.copyGlyphToCache(e,t,i.value.location)}has(e){return this.m_entryCache.has(e)}get(e){return this.m_entryCache.get(e)}clear(){this.m_copyGeometryDrawCount=0,this.m_clearGeometryDrawCount=0,this.m_entryCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()}update(e){let t=null;const i=this.m_clearGeometryDrawCount>0,r=this.m_copyGeometryDrawCount>0;if((i||r)&&(t=e.getRenderTarget(),e.setRenderTarget(this.m_rt)),i){if(null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearPositionAttribute.needsUpdate=!0,this.m_clearPositionAttribute.updateRange.offset=0,this.m_clearPositionAttribute.updateRange.count=8*this.m_clearGeometryDrawCount,this.m_clearGeometry.index.needsUpdate=!0,this.m_clearGeometry.index.updateRange.offset=0,this.m_clearGeometry.index.updateRange.count=6*this.m_clearGeometryDrawCount,this.m_clearGeometry.setDrawRange(0,6*this.m_clearGeometryDrawCount),this.m_clearMesh.visible=!0,this.m_copyMesh.visible=!1,e.render(this.m_scene,this.m_camera),this.m_clearGeometryDrawCount=0,this.m_clearMesh.visible=!1}if(r){if(null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyVertexBuffer.needsUpdate=!0,this.m_copyVertexBuffer.updateRange.offset=0,this.m_copyVertexBuffer.updateRange.count=20*this.m_copyGeometryDrawCount,this.m_copyGeometry.index.needsUpdate=!0,this.m_copyGeometry.index.updateRange.offset=0,this.m_copyGeometry.index.updateRange.count=6*this.m_copyGeometryDrawCount,this.m_copyGeometry.setDrawRange(0,6*this.m_copyGeometryDrawCount),this.m_copyMesh.visible=!0;const t=Array.from(this.m_copyTextureSet),i=Math.ceil(this.m_copyTextureSet.size/8);for(let r=0;r<i;r++){const i=8*r;this.m_copyMaterial.uniforms.pageOffset.value=i;for(let e=0;e<8;e++){const r=i+e;r<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+e].value=t[r])}e.render(this.m_scene,this.m_camera)}this.m_copyTextureSet.clear(),this.m_copyGeometryDrawCount=0}(i||r)&&e.setRenderTarget(t)}initCacheEntries(){const e={name:"",metrics:{size:0,distanceRange:0,base:0,lineHeight:0,lineGap:0,capHeight:0,xHeight:0},charset:""},t=new o.GlyphData(0,"",0,0,0,0,0,0,0,0,0,n.Texture.DEFAULT_IMAGE,e);for(let e=0;e<this.m_cacheHeight;e++)for(let i=0;i<this.m_cacheWidth;i++){const r={glyphData:t,location:new n.Vector2(i,e)};this.m_entryCache.set(`Dummy_${e*this.m_cacheHeight+i}`,r)}}copyGlyphToCache(e,t,i){this.m_copyTextureSet.add(t.texture);let r=0;for(const e of this.m_copyTextureSet.values()){if(e===t.texture)break;r++}t.copyIndex=r,this.m_copyTransform.set(1,0,i.x*this.entryWidth-t.offsetX,0,1,i.y*this.entryHeight-t.positions[0].y,0,0,0);for(let e=0;e<4;++e)this.m_copyPositions[e].set(t.positions[e].x,t.positions[e].y),this.m_copyPositions[e].applyMatrix3(this.m_copyTransform);if(this.m_copyGeometryDrawCount>=this.capacity)return;const n=4*this.m_copyGeometryDrawCount,o=6*this.m_copyGeometryDrawCount;for(let e=0;e<4;++e)this.m_copyPositionAttribute.setXYZ(n+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y,t.copyIndex),this.m_copyUVAttribute.setXY(n+e,t.sourceTextureCoordinates[e].x,t.sourceTextureCoordinates[e].y);if(null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyGeometry.index.setX(o,n),this.m_copyGeometry.index.setX(o+1,n+1),this.m_copyGeometry.index.setX(o+2,n+2),this.m_copyGeometry.index.setX(o+3,n+2),this.m_copyGeometry.index.setX(o+4,n+1),this.m_copyGeometry.index.setX(o+5,n+3),++this.m_copyGeometryDrawCount;const s=this.m_copyPositions[0].x/this.m_textureSize.x,a=this.m_copyPositions[0].y/this.m_textureSize.y,l=this.m_copyPositions[3].x/this.m_textureSize.x,c=this.m_copyPositions[3].y/this.m_textureSize.y;t.dynamicTextureCoordinates[0].set(s,a),t.dynamicTextureCoordinates[1].set(l,a),t.dynamicTextureCoordinates[2].set(s,c),t.dynamicTextureCoordinates[3].set(l,c),t.isInCache=!0,this.m_entryCache.set(e,{glyphData:t,location:i})}clearCacheEntry(e){if(e.glyphData.isInCache=!1,this.m_copyPositions[0].set(e.location.x*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[1].set((e.location.x+1)*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[2].set(e.location.x*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_copyPositions[3].set((e.location.x+1)*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_clearGeometryDrawCount>=this.capacity)return;const t=4*this.m_clearGeometryDrawCount,i=6*this.m_clearGeometryDrawCount;for(let e=0;e<4;++e)this.m_clearPositionAttribute.setXY(t+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y);if(null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearGeometry.index.setX(i,t),this.m_clearGeometry.index.setX(i+1,t+1),this.m_clearGeometry.index.setX(i+2,t+2),this.m_clearGeometry.index.setX(i+3,t+2),this.m_clearGeometry.index.setX(i+4,t+1),this.m_clearGeometry.index.setX(i+5,t+3),++this.m_clearGeometryDrawCount}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=t.Entry=void 0;const r=i(1);class n{constructor(e,t,i,r,n){this.key=e,this.value=t,this.size=i,this.newer=r,this.older=n}}t.Entry=n;t.LRUCache=class{constructor(e,t=(()=>1)){this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}forEach(e,t){let i=this.m_newest;for(;null!==i;){const r=i.older;e.call(t,i.value,i.key,this),i=r}}get size(){return this.m_size}get capacity(){return this.m_capacity}get map(){return this.m_map}get newest(){return this.m_newest}get oldest(){return this.m_oldest}setCapacity(e){this.m_capacity=e,this.evict()}setCapacityAndMeasure(e,t=(()=>1)){this.m_capacity=e,this.m_sizeFunction=t,this.shrinkToCapacity()}shrinkToCapacity(){let e=0;const t=this.m_sizeFunction;let i=this.m_newest;for(;null!==i;){const r=t(i.value);i.size=r,e+=r,i=i.older}this.m_size=e,this.evict()}set(e,t){const i=this.m_sizeFunction(t);let o=this.m_map.get(e);if(void 0!==o)this.m_size=this.m_size-o.size+i,o.value=t,o.size=i,this.promoteEntry(o),this.evict();else{if(i>this.m_capacity)return;if(o=new n(e,t,i,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=o;else{r.assert(null!==this.m_newest);const e=this.m_newest;o.older=this.m_newest,e.newer=o,this.m_newest=o}this.m_map.set(e,o),this.m_size+=i,this.evict()}}get(e){const t=this.m_map.get(e);if(void 0!==t)return this.promoteEntry(t),t.value}has(e){return this.m_map.has(e)}clear(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()}evictAll(){const e=this.evictionCallback;void 0!==e&&this.forEach((t,i)=>e(i,t)),this.clear()}evictSelected(e,t){const i=this.evictionCallback;let r=this.m_newest;for(;null!==r;){const n=r.older;e.call(t,r.value,r.key)&&(void 0!==i&&i(r.key,r.value),this.deleteEntry(r),this.m_map.delete(r.key)),r=n}}delete(e){const t=this.m_map.get(e);return void 0!==t&&(this.deleteEntry(t),this.m_map.delete(e))}evict(){for(;null!==this.m_oldest&&this.m_size>this.m_capacity;){if(void 0===this.evictOldest())return}}evictOldest(){r.assert(null!==this.m_oldest);const e=this.m_oldest;r.assert(null===e.older);let t=e;if(void 0!==this.canEvict)for(;!this.canEvict(t.key,t.value);){if(null===t.newer)return;t=t.newer}if(t===e)this.m_oldest=t.newer,null!==t.newer&&(r.assert(t.newer.older===t),t.newer.older=null);else{if(null===t.newer)return;r.assert(t.newer.older===t),t.newer.older=t.older,null!==t.older&&(t.older.newer=t.newer)}const i=this.m_map.delete(t.key);return r.assert(!0===i),i&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t}deleteEntry(e){e===this.m_newest?this.m_newest=e.older:e.newer?e.newer.older=e.older:r.assert(!1),e===this.m_oldest?this.m_oldest=e.newer:e.older?e.older.newer=e.newer:r.assert(!1),this.m_size-=e.size}promoteEntry(e){if(e===this.m_newest)return;e.newer&&(r.assert(e.newer.older===e),e.newer.older=e.older),e.older&&(r.assert(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,r.assert(null!==this.m_newest);const t=this.m_newest;r.assert(null===t.newer),t.newer=e,this.m_newest=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvas=t.DEFAULT_TEXT_CANVAS_LAYER=void 0;const r=i(0),n=i(87),o=i(47),s=i(18),a=i(208),l=i(209),c=i(88),h=new r.Vector3,d={array:[new r.Box2],offset:0};let u=new Float32Array;t.DEFAULT_TEXT_CANVAS_LAYER=0;let m=(()=>{class e{constructor(i){this.m_renderer=i.renderer,this.m_fontCatalog=i.fontCatalog,this.minGlyphCount=i.minGlyphCount,this.maxGlyphCount=i.maxGlyphCount,void 0===i.material?(this.m_ownsMaterial=!0,this.m_material=c.createSdfTextMaterial({fontCatalog:i.fontCatalog})):(this.m_ownsMaterial=!1,this.m_material=i.material),void 0===i.backgroundMaterial?(this.m_ownsBgMaterial=!0,this.m_bgMaterial=c.createSdfTextMaterial({fontCatalog:i.fontCatalog,isBackground:!0})):(this.m_ownsBgMaterial=!1,this.m_bgMaterial=i.backgroundMaterial),this.m_defaultLayer={id:t.DEFAULT_TEXT_CANVAS_LAYER,storage:new o.TextGeometry(new r.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers=[this.m_defaultLayer],this.m_currentTextRenderStyle=(new s.TextRenderStyle).copy(e.defaultTextRenderStyle),this.m_currentTextLayoutStyle=(new s.TextLayoutStyle).copy(e.defaultTextLayoutStyle),this.m_lineTypesetter=new a.LineTypesetter,this.m_pathTypesetter=new l.PathTypesetter}get fontCatalog(){return this.m_fontCatalog}set fontCatalog(e){this.m_fontCatalog=e;const t=this.m_material;t.uniforms.sdfTexture.value=this.m_fontCatalog.texture,t.uniforms.sdfParams.value=new r.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),t.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0;const i=this.m_bgMaterial;i.uniforms.sdfTexture.value=this.m_fontCatalog.texture,i.uniforms.sdfParams.value=new r.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),i.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0}get material(){return this.m_material}set material(e){this.m_ownsMaterial&&(this.m_material.dispose(),this.m_ownsMaterial=!1),this.m_material=e;for(const e of this.m_layers)e.storage.mesh.material=this.m_material}get backgroundMaterial(){return this.m_bgMaterial}set backgroundMaterial(e){this.m_ownsBgMaterial&&(this.m_bgMaterial.dispose(),this.m_ownsBgMaterial=!1),this.m_bgMaterial=e;for(const e of this.m_layers)e.storage.backgroundMesh.material=this.m_bgMaterial}get textRenderStyle(){return this.m_currentTextRenderStyle}set textRenderStyle(e){this.m_currentTextRenderStyle.copy(e)}get textLayoutStyle(){return this.m_currentTextLayoutStyle}set textLayoutStyle(e){this.m_currentTextLayoutStyle.copy(e)}clear(){for(const e of this.m_layers)e.storage.clear();this.m_currentTextRenderStyle.copy(e.defaultTextRenderStyle),this.m_currentTextLayoutStyle.copy(e.defaultTextLayoutStyle)}render(e,t,i){this.m_fontCatalog.update(this.m_renderer);let r=null;void 0!==t&&(r=this.m_renderer.getRenderTarget(),this.m_renderer.setRenderTarget(t)),!0===i&&this.m_renderer.clear(!0);for(const t of this.m_layers)t.storage.update(),this.m_renderer.render(t.storage.scene,e);void 0!==t&&this.m_renderer.setRenderTarget(r)}addLayer(e){let t=this.getLayer(e);return void 0===t&&(t={id:e,storage:new o.TextGeometry(new r.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers.push(t),this.m_layers.sort((e,t)=>e.id-t.id)),t}getLayer(e){return this.m_layers.find(t=>t.id===e)}getAllLayers(){return this.m_layers}measureText(e,t,i){let r,n,o,s;if(h.set(0,0,0),void 0!==i){if(r=i.path,n=i.pathOverflow,s=i.outputCharacterBounds,void 0!==i.path){const e=i.path.getPoint(0);if(null===e)return!1;h.set(e.x,e.y,0)}i.letterCaseArray&&(o=i.letterCaseArray)}return this.placeText({input:e,layer:this.m_defaultLayer,textPath:r,textPathOverflow:n,bounds:t,individualBounds:s,letterCaseArray:o})}addText(e,t,i){let r,n,o;h.copy(t);let s=this.m_defaultLayer;if(void 0!==i){if(r=i.path,n=i.pathOverflow,void 0!==i.layer){let e=this.getLayer(i.layer);void 0===e&&(e=this.addLayer(i.layer)),s=e}void 0!==i.path&&h.set(0,0,h.z),i.letterCaseArray&&(o=i.letterCaseArray)}const a=s.storage.drawCount,l=this.placeText({input:e,textPath:r,textPathOverflow:n,layer:s,letterCaseArray:o});return l&&void 0!==i?(!0===i.updatePosition&&t.copy(h),void 0!==i.pickingData&&s.storage.addPickingData(a,s.storage.drawCount,i.pickingData)):l||(s.storage.m_drawCount=a),l}createTextBufferObject(e,t){let i,o;h.set(0,0,0);const a=this.m_currentTextRenderStyle.fontVariant===s.FontVariant.SmallCaps;if("string"!=typeof e)i=e,void 0!==t&&t.letterCaseArray&&(o=t.letterCaseArray);else if(o=[],i=this.m_fontCatalog.getGlyphs(e,this.m_currentTextRenderStyle,a?o:void 0),void 0===i)return;let l,c,d,m,p,f;return void 0!==t&&(l=t.path,c=t.pathOverflow,!0===t.outputBounds&&(d=new r.Box2),!0===t.outputCharacterBounds&&(m=[]),!0===t.storeStyles&&(p=this.m_currentTextRenderStyle.clone(),f=this.m_currentTextLayoutStyle.clone())),this.placeText({input:e,layer:this.m_defaultLayer,computeTextBuffer:!0,textPath:l,textPathOverflow:c,bounds:d,individualBounds:m,letterCaseArray:o}),new n.TextBufferObject(i,new Float32Array(u),d,m,p,f)}addTextBufferObject(e,t){var i;let r,n,o,s,a,l,c,h=this.m_defaultLayer;if(void 0!==t){if(void 0!==t.layer){let e=this.getLayer(t.layer);void 0===e&&(e=this.addLayer(t.layer)),h=e}r=null===(i=t.position)||void 0===i?void 0:i.clone(),n=t.scale,o=t.rotation,s=t.color,a=t.opacity,l=t.backgroundColor,c=t.backgroundOpacity}const d=h.storage.drawCount,u=h.storage.addTextBufferObject(e,r,n,o,s,a,l,c);return u&&void 0!==t?void 0!==t.pickingData&&h.storage.addPickingData(d,h.storage.drawCount,t.pickingData):u||(h.storage.m_drawCount=d),u}pickText(e,t){for(const i of this.m_layers)i.storage.pick(e,t)}getMemoryUsage(e){this.m_fontCatalog.updateMemoryUsage(e);for(const t of this.m_layers)t.storage.updateMemoryUsage(e)}placeText(e){if(0===e.input.length||0===this.m_currentTextLayoutStyle.maxLines)return void 0!==e.bounds&&(e.bounds.min.set(0,0),e.bounds.max.set(0,0)),void 0!==e.individualBounds&&(e.individualBounds.length=0),!0;let t,i;const r=this.m_currentTextRenderStyle.fontVariant===s.FontVariant.SmallCaps;if("string"!=typeof e.input)t=e.input,e.letterCaseArray&&(i=e.letterCaseArray);else if(i=[],t=this.m_fontCatalog.getGlyphs(e.input,this.m_currentTextRenderStyle,r?i:void 0),void 0===t)return!1;let n;void 0!==e.individualBounds&&(d.array=e.individualBounds,d.offset=0,n=d),void 0!==e.bounds&&(e.bounds.min.set(1/0,1/0),e.bounds.max.set(-1/0,-1/0)),!0===e.computeTextBuffer&&(u=new Float32Array(t.length*o.QUAD_VERTEX_MEMORY_FOOTPRINT));const a=void 0!==e.textPath,l={glyphs:t,fontCatalog:this.m_fontCatalog,textRenderStyle:this.m_currentTextRenderStyle,textLayoutStyle:this.m_currentTextLayoutStyle,position:h,geometry:e.layer.storage,smallCapsArray:r?i:void 0,globalBounds:e.bounds,individualBounds:n,vertexBuffer:!0===e.computeTextBuffer?u:void 0};let c=!0;return a?(Object.assign(l,{path:e.textPath,pathOverflow:!0===e.textPathOverflow}),c=this.m_pathTypesetter.arrangeGlyphs(l)):c=this.m_lineTypesetter.arrangeGlyphs(l),void 0!==n&&(n.array.length=n.offset),c}}return e.defaultTextRenderStyle=new s.TextRenderStyle,e.defaultTextLayoutStyle=new s.TextLayoutStyle,e})();t.TextCanvas=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineTypesetter=void 0;const r=i(0),n=i(47),o=i(18),s=i(48),a=i(24);t.LineTypesetter=class{constructor(){this.m_tempTransform=new r.Matrix3,this.m_tempCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=s.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=s.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(s.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_currentParams.position.y+=this.m_currentParams.textLayoutStyle.verticalAlignment*this.m_currentParams.glyphs[0].font.metrics.capHeight*this.m_tempScale;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer,i=this.m_currentParams.position.x,r=this.m_currentParams.glyphs[0].font.metrics.lineHeight+this.m_currentParams.textLayoutStyle.leading;let n=0,l=0,c=0,h=0,d=0,u=0,m=0,p=0,f=!1;for(let e=0;e<this.m_currentParams.glyphs.length&&!(p>this.m_currentParams.textLayoutStyle.maxLines-1);++e){const g=this.m_currentParams.glyphs[e];if(!g.isInCache&&!t)return!1;const v=a.UnicodeUtils.isNewLine(g.codePoint),y=a.UnicodeUtils.isWhiteSpace(g.codePoint);if(f||g.direction!==-this.m_tempLineDirection||(f=!0),a.UnicodeUtils.isPrintable(g.codePoint)&&(d+=(g.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?s.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1)),e===n&&(h=d,u=d,m=d),v||this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Character&&d>this.m_currentParams.textLayoutStyle.lineWidth||this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Word&&d>this.m_currentParams.textLayoutStyle.lineWidth&&m!==h){if(this.m_currentParams.textLayoutStyle.wrappingMode!==o.WrappingMode.None){let t=l,i=u;this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Word&&m!==h&&(t=c,i=m),d=i,e=Math.min(v?n===e?t:e:t,this.m_currentParams.glyphs.length-1)}const t=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.x=this.m_currentParams.position.x+d*t,!this.placeLine(n,e,this.m_tempLineDirection,f))return!1;for(this.m_currentParams.position.y-=r*this.m_tempScale,this.m_currentParams.position.x=i;e!==n&&e+1<this.m_currentParams.glyphs.length&&a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint);)++e;if(n=e+1,n===this.m_currentParams.glyphs.length)break;v&&(this.m_tempLineDirection=s.TypesettingUtils.getDirection(this.m_currentParams.glyphs,n),this.m_tempRunDirection=this.m_tempLineDirection),h=0,d=0,l=n,u=0,c=n,m=0,f=!1,p++}else this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.None||y||(l=e,u=d,this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Word&&e+1<this.m_currentParams.glyphs.length&&(a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint)||a.UnicodeUtils.isNewLine(this.m_currentParams.glyphs[e+1].codePoint))&&(c=e,m=d))}if(p<=this.m_currentParams.textLayoutStyle.maxLines-1&&n<=this.m_currentParams.glyphs.length-1){const e=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.setX(this.m_currentParams.position.x+d*e),!this.placeLine(n,this.m_currentParams.glyphs.length-1,this.m_tempLineDirection,f))return!1}return!0}placeLine(e,t,i,r){if(!r)return this.placeRun(e,t,i);const n=this.m_currentParams.glyphs,o=this.m_currentParams.smallCapsArray,l=this.m_currentParams.textRenderStyle,c=this.m_currentParams.textLayoutStyle,h=this.m_currentParams.position,d=i===a.UnicodeUtils.Direction.RTL,u=h.x;let m=0,p=e;for(let r=e;r<=t;++r){const e=n[r];if(e.direction===-this.m_tempRunDirection){if(d&&(h.x=u+m),!this.placeRun(p,r-1,this.m_tempRunDirection))return!1;d||(h.x=u+m),p=r,this.m_tempRunDirection*=-1}else if(e.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-i){let e=r;for(;e+1<n.length&&1!==Math.abs(n[e].direction);)++e;if(n[e].direction!==this.m_tempRunDirection){if(d&&(h.x=u+m),!this.placeRun(p,r-1,this.m_tempRunDirection))return!1;d||(h.x=u+m),p=r,this.m_tempRunDirection*=-1}}m+=(e.advanceX+c.tracking)*this.m_tempScale*(this.m_tempSmallCaps?s.TypesettingUtils.getSmallCapsScale(n,o,r,l.fontVariant):1)*i}if(p<=t){if(d&&(h.x=u+m),!this.placeRun(p,t,this.m_tempRunDirection))return!1;d||(h.x=u+m)}return!0}placeRun(e,t,i){const r=this.m_currentParams.glyphs,l=this.m_currentParams.smallCapsArray,c=this.m_currentParams.fontCatalog,h=this.m_currentParams.textRenderStyle,d=this.m_currentParams.textLayoutStyle,u=this.m_currentParams.position,m=this.m_currentParams.geometry,p=this.m_currentParams.globalBounds,f=this.m_currentParams.individualBounds,g=this.m_currentParams.vertexBuffer,v=i===a.UnicodeUtils.Direction.LTR?e:t,y=i===a.UnicodeUtils.Direction.LTR?t:e;for(let _=v;i===a.UnicodeUtils.Direction.RTL?_>=y:_<=y;_+=i){const v=r[_];if(!a.UnicodeUtils.isPrintable(v.codePoint))continue;if(e!==t&&0!==_&&i===a.UnicodeUtils.Direction.RTL&&v.direction===a.UnicodeUtils.Direction.Weak){let t=_,i=r[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=r[t-1];this.placeRun(Math.max(t,e),_,a.UnicodeUtils.Direction.LTR),_=t;continue}const y=v.font,x=y.metrics,S=h.fontStyle,b=S===o.FontStyle.Bold&&void 0===y.bold||S===o.FontStyle.BoldItalic&&void 0===y.bold&&void 0===y.boldItalic,T=S===o.FontStyle.Italic&&void 0===y.italic||S===o.FontStyle.BoldItalic&&void 0===y.italic&&void 0===y.boldItalic,w=!!this.m_tempSmallCaps&&(l[_]&&h.fontVariant===o.FontVariant.SmallCaps),M=w?x.xHeight/x.capHeight:1,E=this.m_tempScale*M,P=((b?.02:0)+(w?.01:0))*(c.size/c.distanceRange),C=.5*this.m_tempPixelBgSize/(c.distanceRange*Math.max(E,1)),A=a.UnicodeUtils.isRtlMirrored(v.codePoint)&&i===a.UnicodeUtils.Direction.RTL,L=x.lineHeight-x.base-.5*x.distanceRange;s.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,u,E,d.canvasRotation,h.rotation);for(let e=0;e<4;++e){const t=v.positions[e],i=T&&e>1?s.TypesettingUtils.OBLIQUE_OFFSET*x.size:0;this.m_tempCorners[e].set(t.x+i,t.y-L,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform)}if(void 0===p&&void 0===g){if(!m.add(v,this.m_tempCorners,P,P+C,A,h))return!1}else void 0!==p&&s.TypesettingUtils.updateBounds(this.m_tempCorners,p,f),void 0!==g&&m.addToBuffer(g,_*n.QUAD_VERTEX_MEMORY_FOOTPRINT,v,this.m_tempCorners,P,P+C,A,h);u.set(u.x+(v.advanceX+d.tracking)*E*Math.cos(d.lineRotation),u.y+(v.advanceX+d.tracking)*E*Math.sin(d.lineRotation),u.z)}return!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathTypesetter=void 0;const r=i(0),n=i(47),o=i(18),s=i(48),a=i(24);t.PathTypesetter=class{constructor(){this.m_tempTransform=new r.Matrix3,this.m_tempCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1,this.m_tempPathPosition=new r.Vector3,this.m_tempPathLength=0,this.m_tempPathOffset=0}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=s.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=s.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(s.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_tempPathLength=this.m_currentParams.path.getLength(),this.m_tempPathOffset=0;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer;let i=!1,r=0;for(let e=0;e<this.m_currentParams.glyphs.length;++e){const n=this.m_currentParams.glyphs[e];if(!n.isInCache&&!t)return!1;a.UnicodeUtils.isPrintable(n.codePoint)&&(i||n.direction!==-this.m_tempLineDirection||(i=!0),r+=(n.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?s.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1))}return this.m_tempPathOffset=Math.min(Math.max(-this.m_currentParams.textLayoutStyle.horizontalAlignment+this.m_currentParams.textLayoutStyle.horizontalAlignment*r/this.m_tempPathLength,0),1),this.placeLine(this.m_tempLineDirection,i)}placeLine(e,t){if(!t)return this.placeRun(0,this.m_currentParams.glyphs.length-1,e);const i=this.m_currentParams.glyphs;let r=0;for(let t=r;t<i.length;++t){const n=i[t];if(n.direction===-this.m_tempRunDirection){if(!this.placeRun(r,t-1,this.m_tempRunDirection))return!1;r=t,this.m_tempRunDirection*=-1}else if(n.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-e){let e=t;for(;e+1<i.length&&1!==Math.abs(i[e].direction);)++e;if(i[e].direction!==this.m_tempRunDirection){if(!this.placeRun(r,t-1,this.m_tempRunDirection))return!1;r=t,this.m_tempRunDirection*=-1}}}return!(r<i.length&&!this.placeRun(r,i.length-1,this.m_tempRunDirection))}placeRun(e,t,i){const l=this.m_currentParams.glyphs,c=this.m_currentParams.smallCapsArray,h=this.m_currentParams.fontCatalog,d=this.m_currentParams.textRenderStyle,u=this.m_currentParams.textLayoutStyle,m=this.m_currentParams.position,p=this.m_currentParams.geometry,f=this.m_currentParams.globalBounds,g=this.m_currentParams.individualBounds,v=this.m_currentParams.vertexBuffer,y=this.m_currentParams.path,_=d.rotation,x=u.verticalAlignment*l[0].font.metrics.capHeight*this.m_tempScale,S=i===a.UnicodeUtils.Direction.LTR?e:t,b=i===a.UnicodeUtils.Direction.LTR?t:e;for(let T=S;i===a.UnicodeUtils.Direction.RTL?T>=b:T<=b;T+=i){const S=l[T];if(!a.UnicodeUtils.isPrintable(S.codePoint))continue;if(e!==t&&0!==T&&i===a.UnicodeUtils.Direction.RTL&&S.direction===a.UnicodeUtils.Direction.Weak){let t=T,i=l[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=l[t-1];this.placeRun(Math.max(t,e),T,a.UnicodeUtils.Direction.LTR),T=t;continue}const b=S.font,w=b.metrics,M=d.fontStyle,E=M===o.FontStyle.Bold&&void 0===b.bold||M===o.FontStyle.BoldItalic&&void 0===b.bold&&void 0===b.boldItalic,P=M===o.FontStyle.Italic&&void 0===b.italic||M===o.FontStyle.BoldItalic&&void 0===b.italic&&void 0===b.boldItalic,C=!!this.m_tempSmallCaps&&(c[T]&&d.fontVariant===o.FontVariant.SmallCaps),A=C?w.xHeight/w.capHeight:1,L=this.m_tempScale*A,R=((E?.02:0)+(C?.01:0))*(h.size/h.distanceRange),D=.5*this.m_tempPixelBgSize/(h.distanceRange*Math.max(L,1)),O=a.UnicodeUtils.isRtlMirrored(S.codePoint)&&i===a.UnicodeUtils.Direction.RTL,F=w.lineHeight-w.base-.5*w.distanceRange,I=y.getPoint(this.m_tempPathOffset);if(null===I)return this.m_currentParams.pathOverflow;const U=y.getTangent(this.m_tempPathOffset),k=new r.Vector2(-U.y,U.x).multiplyScalar(x),V=Math.atan2(U.y,U.x);this.m_tempPathPosition.set(k.x+I.x,k.y+I.y,m.z),d.rotation=_+V,s.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,this.m_tempPathPosition,L,0,d.rotation);for(let e=0;e<4;++e){const t=S.positions[e],i=P&&e>1?s.TypesettingUtils.OBLIQUE_OFFSET*w.size:0;this.m_tempCorners[e].set(t.x+i,t.y-F,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform),this.m_tempCorners[e].x-=m.x,this.m_tempCorners[e].y-=m.y}if(void 0===f&&void 0===v){if(!p.add(S,this.m_tempCorners,R,R+D,O,d))return!1}else void 0!==f&&s.TypesettingUtils.updateBounds(this.m_tempCorners,f,g),void 0!==v&&p.addToBuffer(v,T*n.QUAD_VERTEX_MEMORY_FOOTPRINT,S,this.m_tempCorners,R,R+D,O,d);d.rotation=_,this.m_tempPathOffset+=(S.advanceX+u.tracking)*L/this.m_tempPathLength}return!0}}},function(e,t,i){"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ContextualArabicConverter=void 0,function(e){e[e.Initial=0]="Initial",e[e.Medial=1]="Medial",e[e.Final=2]="Final"}(r||(r={})),function(e){e[e.Isolated=0]="Isolated",e[e.Connected=1]="Connected"}(n||(n={}));class o{constructor(){this.m_singleCharactersMap=new Map,this.m_combinedCharactersMap=new Map,this.m_singleCharactersMap.set(1569,[void 0,void 0,void 0]),this.m_singleCharactersMap.set(1570,[void 0,void 0,65154]),this.m_singleCharactersMap.set(1571,[void 0,void 0,65156]),this.m_singleCharactersMap.set(1572,[void 0,void 0,65158]),this.m_singleCharactersMap.set(1573,[void 0,void 0,65160]),this.m_singleCharactersMap.set(1574,[65163,65164,65162]),this.m_singleCharactersMap.set(1575,[void 0,void 0,65166]),this.m_singleCharactersMap.set(1576,[65169,65170,65168]),this.m_singleCharactersMap.set(1577,[void 0,void 0,65172]),this.m_singleCharactersMap.set(1578,[65175,65176,65174]),this.m_singleCharactersMap.set(1579,[65179,65180,65178]),this.m_singleCharactersMap.set(1580,[65183,65184,65182]),this.m_singleCharactersMap.set(1581,[65187,65188,65186]),this.m_singleCharactersMap.set(1582,[65191,65192,65190]),this.m_singleCharactersMap.set(1583,[void 0,void 0,65194]),this.m_singleCharactersMap.set(1584,[void 0,void 0,65196]),this.m_singleCharactersMap.set(1585,[void 0,void 0,65198]),this.m_singleCharactersMap.set(1586,[void 0,void 0,65200]),this.m_singleCharactersMap.set(1587,[65203,65204,65202]),this.m_singleCharactersMap.set(1588,[65207,65208,65206]),this.m_singleCharactersMap.set(1589,[65211,65212,65210]),this.m_singleCharactersMap.set(1590,[65215,65216,65214]),this.m_singleCharactersMap.set(1591,[65219,65220,65218]),this.m_singleCharactersMap.set(1592,[65223,65224,65222]),this.m_singleCharactersMap.set(1593,[65227,65228,65226]),this.m_singleCharactersMap.set(1594,[65231,65232,65230]),this.m_singleCharactersMap.set(1600,[1600,1600,1600]),this.m_singleCharactersMap.set(1601,[65235,65236,65234]),this.m_singleCharactersMap.set(1602,[65239,65240,65238]),this.m_singleCharactersMap.set(1603,[65243,65244,65242]),this.m_singleCharactersMap.set(1604,[65247,65248,65246]),this.m_singleCharactersMap.set(1605,[65251,65252,65250]),this.m_singleCharactersMap.set(1606,[65255,65256,65254]),this.m_singleCharactersMap.set(1607,[65259,65260,65258]),this.m_singleCharactersMap.set(1608,[void 0,void 0,65262]),this.m_singleCharactersMap.set(1609,[void 0,void 0,65264]),this.m_singleCharactersMap.set(1610,[65267,65268,65266]),this.m_singleCharactersMap.set(1662,[64344,64345,64343]),this.m_singleCharactersMap.set(1740,[64510,64511,64509]),this.m_singleCharactersMap.set(1670,[64380,64381,64379]),this.m_singleCharactersMap.set(1705,[64400,64401,64399]),this.m_singleCharactersMap.set(1711,[64404,64405,64403]),this.m_singleCharactersMap.set(1688,[void 0,void 0,64395]),this.m_combinedCharactersMap.set(1604,new Map),this.m_combinedCharactersMap.get(1604).set(1570,[65269,65270]),this.m_combinedCharactersMap.get(1604).set(1571,[65271,65272]),this.m_combinedCharactersMap.get(1604).set(1573,[65273,65274]),this.m_combinedCharactersMap.get(1604).set(1575,[65275,65276]),this.m_neutralCharacters=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}static get instance(){return void 0===this.m_instance&&(this.m_instance=new o),this.m_instance}convert(e){let t="";for(let i=0;i<e.length;++i){const o=e.charCodeAt(i);if(this.isArabicCharacter(o)){let s=i-1;for(;s>=0&&this.isNeutral(e.charCodeAt(s));--s);let a=s>=0?e.charCodeAt(s):void 0;if(void 0!==a){const e=this.getCharacterMap(a);(void 0===e||void 0===e[r.Initial]&&void 0===e[r.Medial])&&(a=void 0)}let l=i+1;for(;l<e.length&&this.isNeutral(e.charCodeAt(l));++l);let c=l<e.length?e.charCodeAt(l):void 0;if(void 0!==c){const e=this.getCharacterMap(c);(void 0===e||void 0===e[r.Medial]&&void 0===e[r.Final])&&(c=void 0)}if(1604===o&&void 0!==c&&(1570===c||1571===c||1573===c||1575===c)){const e=this.getCombinedCharacterMap(o,c);t+=void 0!==a?String.fromCharCode(e[n.Connected]):String.fromCharCode(e[n.Isolated]),++i;continue}const h=this.getCharacterMap(o);void 0!==a&&void 0!==c&&void 0!==h[r.Medial]?t+=String.fromCharCode(h[r.Medial]):void 0!==a&&void 0!==h[r.Final]?t+=String.fromCharCode(h[r.Final]):void 0!==c&&void 0!==h[r.Initial]?t+=String.fromCharCode(h[r.Initial]):t+=String.fromCharCode(o)}else t+=String.fromCharCode(o)}return t}isArabicCharacter(e){return this.m_singleCharactersMap.has(e)}getCharacterMap(e){return this.m_singleCharactersMap.get(e)}getCombinedCharacterMap(e,t){const i=this.m_combinedCharactersMap.get(e);if(void 0!==i)return i.get(t)}isNeutral(e){for(const t of this.m_neutralCharacters)if(t===e)return!0;return!1}}t.ContextualArabicConverter=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroup=void 0;const r=i(1);class n extends r.PriorityListGroup{}t.TextElementGroup=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroupPriorityList=void 0;const r=i(1);class n extends r.GroupedPriorityList{}t.TextElementGroupPriorityList=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTextStyleCache=void 0;t.TileTextStyleCache=class{constructor(e){this.textRenderStyles=[],this.textLayoutStyles=[],this.tile=e}clear(){this.textRenderStyles.length=0,this.textLayoutStyles.length=0}getRenderStyle(e){let t=this.textRenderStyles[e._index];return void 0===t&&(t=this.textRenderStyles[e._index]=this.tile.mapView.textElementsRenderer.styleCache.createRenderStyle(this.tile,e)),t}getLayoutStyle(e){let t=this.textLayoutStyles[e._index];return void 0===t&&(t=this.textLayoutStyles[e._index]=this.tile.mapView.textElementsRenderer.styleCache.createLayoutStyle(this.tile,e)),t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapRenderingManager=void 0;const r=i(0),n=i(4),o=i(215),s=i(90),a=i(216),l=i(26),c=i(217),h=s.MSAASampling.Level_1,d=s.MSAASampling.Level_4;t.MapRenderingManager=class{constructor(e,t,i,a={msaaEnabled:!1}){this.bloom={enabled:!1,strength:1.5,radius:.4,threshold:.85},this.outline={enabled:!1,thickness:.005,color:"#000000",ghostExtrudedPolygons:!1,needsUpdate:!1},this.vignette={enabled:!1,offset:1,darkness:1},this.sepia={enabled:!1,amount:.5},this.m_width=1,this.m_height=1,this.m_renderPass=new l.RenderPass,this.m_target1=new r.WebGLRenderTarget(1,1),this.m_target2=new r.WebGLRenderTarget(1,1),this.m_sepiaPass=new l.ShaderPass(n.SepiaShader),this.m_vignettePass=new l.ShaderPass(n.VignetteShader),this.m_readBuffer=new r.WebGLRenderTarget(e,t),this.m_msaaPass=new s.MSAARenderPass,this.m_msaaPass.enabled=void 0!==a&&!0===a.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===a.dynamicMsaaSamplingLevel?h:a.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===a.staticMsaaSamplingLevel?d:a.staticMsaaSamplingLevel,this.m_lowResPass=new o.LowResRenderPass(i),this.m_lowResPass.enabled=void 0!==i}updateOutline(e){this.outline.color=e.color,this.outline.thickness=e.thickness,this.outline.ghostExtrudedPolygons=e.ghostExtrudedPolygons,this.outline.needsUpdate=!0}render(e,t,i,n){if(!n&&void 0!==this.m_lowResPass.pixelRatio)return this.m_lowResPass.renderToScreen=!0,void this.m_lowResPass.render(e,t,i,null,this.m_readBuffer);const o=this.bloom.enabled||this.outline.enabled||this.vignette.enabled||this.sepia.enabled;let s=null;if((this.bloom.enabled||this.vignette.enabled||this.sepia.enabled)&&(e.setRenderTarget(this.m_target1),e.clearDepth()),this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=n?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!o,this.m_msaaPass.render(e,t,i,null,this.m_readBuffer)):this.bloom.enabled||this.vignette.enabled||this.sepia.enabled?(s=this.m_target1,this.m_renderPass.render(e,t,i,this.m_target1,null)):(!this.outline.enabled||this.outline.enabled&&!this.bloom.enabled)&&e.render(t,i),this.outline.enabled){void 0===this.m_outlineEffect&&(this.m_outlineEffect=new a.OutlineEffect(e)),this.outline.needsUpdate&&(this.m_outlineEffect.color=this.outline.color,this.m_outlineEffect.thickness=this.outline.thickness,this.m_outlineEffect.ghostExtrudedPolygons=this.outline.ghostExtrudedPolygons,this.outline.needsUpdate=!1);const r=this.bloom.enabled||this.vignette.enabled||this.sepia.enabled;r&&(s=this.m_target1),e.setRenderTarget(r?s:null),this.m_outlineEffect.render(t,i)}if(this.bloom.enabled){void 0===this.m_bloomPass&&(this.m_bloomPass=new c.BloomPass(new r.Vector2(this.m_width,this.m_height),this.bloom.strength,this.bloom.radius,this.bloom.threshold));const n=this.vignette.enabled||this.sepia.enabled;this.m_bloomPass.renderToScreen=!n,this.m_bloomPass.radius=this.bloom.radius,this.m_bloomPass.strength=this.bloom.strength,this.m_bloomPass.threshold=this.bloom.threshold,this.m_bloomPass.render(e,t,i,null,s)}else void 0!==this.m_bloomPass&&(this.m_bloomPass.dispose(),this.m_bloomPass=void 0);if(this.vignette.enabled){const r=s,n=this.sepia.enabled;this.m_vignettePass.uniforms.offset.value=this.vignette.offset,this.m_vignettePass.uniforms.darkness.value=this.vignette.darkness,this.m_vignettePass.renderToScreen=!n,n&&(s=s===this.m_target1?this.m_target2:this.m_target1),this.m_vignettePass.render(e,t,i,s,r)}this.sepia.enabled&&(this.m_sepiaPass.renderToScreen=!0,this.m_sepiaPass.uniforms.amount.value=this.sepia.amount,this.m_sepiaPass.render(e,t,i,null,s))}setSize(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t),void 0!==this.m_bloomPass&&this.m_bloomPass.setSize(e,t),this.m_lowResPass.setSize(e,t),this.m_target1.setSize(e,t),this.m_target2.setSize(e,t),this.m_width=e,this.m_height=t}get lowResPixelRatio(){return this.m_lowResPass.pixelRatio}set lowResPixelRatio(e){this.m_lowResPass.pixelRatio=e,this.m_lowResPass.enabled=void 0!==e}set dynamicMsaaSamplingLevel(e){this.m_dynamicMsaaSamplingLevel=e}get dynamicMsaaSamplingLevel(){return this.m_dynamicMsaaSamplingLevel}set msaaEnabled(e){this.m_msaaPass.enabled=e}get msaaEnabled(){return this.m_msaaPass.enabled}set staticMsaaSamplingLevel(e){this.m_staticMsaaSamplingLevel=e}get staticMsaaSamplingLevel(){return this.m_staticMsaaSamplingLevel}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LowResRenderPass=void 0;const r=i(4),n=i(0),o=i(26);class s extends o.Pass{constructor(e){super(),this.lowResPixelRatio=e,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new n.Scene,this.m_quadUniforms=r.CopyShader.uniforms,this.m_quadMaterial=new r.CopyMaterial(this.m_quadUniforms),this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_savedWidth=0,this.m_savedHeight=0,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad),this.m_pixelRatio=e}dispose(){this.m_quadMaterial.dispose(),this.m_quad.geometry.dispose(),null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}set pixelRatio(e){this.m_pixelRatio=e,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio))}get pixelRatio(){return this.m_pixelRatio}render(e,t,i,r,o){if(!this.enabled||void 0===this.pixelRatio)return;null===this.m_renderTarget&&(this.m_savedWidth=o.width,this.m_savedHeight=o.height,this.m_renderTarget=new n.WebGLRenderTarget(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio),{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat,depthBuffer:!0,stencilBuffer:!0}),this.m_renderTarget.texture.name="LowResRenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture,this.m_quadUniforms.opacity.value=1;const s=e.getRenderTarget();e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:r),e.clear(),e.render(this.m_quadScene,this.m_localCamera),e.setRenderTarget(s)}setSize(e,t){this.m_savedWidth=e,this.m_savedHeight=t,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(e*this.pixelRatio),Math.floor(t*this.pixelRatio))}}t.LowResRenderPass=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlineEffect=void 0;const r=i(4),n=i(1),o=i(0);t.OutlineEffect=class{constructor(e){this.m_renderer=e,this.enabled=!0,this.m_defaultThickness=.02,this.m_defaultColor=new o.Color(0,0,0),this.m_defaultAlpha=1,this.m_defaultKeepAlive=!1,this.m_ghostExtrudedPolygons=!1,this.m_cache={},this.m_removeThresholdCount=60,this.m_originalMaterials={},this.m_originalOnBeforeRenders={},this.m_shaderIDs={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},this.m_uniformsChunk={outlineThickness:{value:this.m_defaultThickness},outlineColor:{value:this.m_defaultColor},outlineAlpha:{value:this.m_defaultAlpha}},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap}set thickness(e){this.m_defaultThickness=e,this.m_uniformsChunk.outlineThickness.value=e,this.m_cache={}}set color(e){this.m_defaultColor.set(e),this.m_cache={}}set ghostExtrudedPolygons(e){this.m_ghostExtrudedPolygons=e}clear(e,t,i){this.m_renderer.clear(e,t,i)}getPixelRatio(){return this.m_renderer.getPixelRatio()}setPixelRatio(e){this.m_renderer.setPixelRatio(e)}getSize(e){return this.m_renderer.getSize(e)}setSize(e,t,i){this.m_renderer.setSize(e,t,i)}setViewport(e,t,i,r){this.m_renderer.setViewport(e,t,i,r)}setScissor(e,t,i,r){this.m_renderer.setScissor(e,t,i,r)}setScissorTest(e){this.m_renderer.setScissorTest(e)}setRenderTarget(e){this.m_renderer.setRenderTarget(e)}render(e,t){if(this.m_ghostExtrudedPolygons){if(!this.enabled)return void this.m_renderer.render(e,t);const i=this.m_renderer.autoClear;this.m_renderer.autoClear=this.autoClear,this.m_renderer.render(e,t),this.m_renderer.autoClear=i}this.renderOutline(e,t)}renderOutline(e,t){const i=this.m_renderer.autoClear,r=e.autoUpdate,n=e.background,o=this.m_renderer.shadowMap.enabled;e.autoUpdate=!1,e.background=null,this.m_renderer.autoClear=!1,this.m_renderer.shadowMap.enabled=!1,e.traverse(this.setOutlineMaterial.bind(this)),this.m_renderer.render(e,t),e.traverse(this.restoreOriginalMaterial.bind(this)),this.cleanupCache(),e.autoUpdate=r,e.background=n,this.m_renderer.autoClear=i,this.m_renderer.shadowMap.enabled=o}createInvisibleMaterial(){return new o.ShaderMaterial({name:"invisible",visible:!1})}createMaterial(e){if(e instanceof r.EdgeMaterial||!0===e.isDepthPrepassMaterial)return this.createInvisibleMaterial();const t=this.m_shaderIDs[e.type];let i,n=void 0!==e.shaderUniforms?e.shaderUniforms:e.uniforms;if(void 0!==t){const e=o.ShaderLib[t];n=e.uniforms,i=e.vertexShader}else if(!0===e.isRawShaderMaterial){if(i=e.vertexShader,!/attribute\s+vec3\s+position\s*;/.test(i)||!/attribute\s+vec3\s+normal\s*;/.test(i))return this.createInvisibleMaterial()}else{if(!0!==e.isShaderMaterial)return this.createInvisibleMaterial();i=e.vertexShader}const s=void 0!==e.shaderUniforms&&void 0!==e.shaderUniforms.extrusionRatio,a=r.FadingFeature.isDefined(e),l=Object.assign(Object.assign({},n),this.m_uniformsChunk),c=i.replace(/void\s+main\s*\(\s*\)/,"\n#ifdef USE_EXTRUSION\n  #ifndef HAS_EXTRUSION_PARS_VERTEX\n    #include <extrusion_pars_vertex>\n  #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_vertex>\n#endif\n\nuniform float outlineThickness;\n\nvec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {\n    float thickness = outlineThickness;\n    const float ratio = 1.0;\n    vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );\n    vec4 norm = normalize( pos - pos2 );\n    return pos + norm * thickness * pos.w * ratio;\n}\nvoid main()").replace(/\}\s*$/,"\n#if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( STANDARD )\n    #ifndef USE_ENVMAP\n        vec3 objectNormal = normalize( normal );\n    #endif\n#endif\n\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n\n#ifdef DECLARE_TRANSFORMED\n    vec3 transformed = vec3( position );\n#endif\n\n#ifdef USE_EXTRUSION\n #ifndef HAS_EXTRUSION_VERTEX\n  #include <extrusion_vertex>\n #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_vertex>\n#endif\n\n#ifdef USE_EXTRUSION\n  gl_Position = calculateOutline( projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 ),\n      objectNormal, vec4( transformed, 1.0 ) );\n#else\n  gl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );\n#endif\n\n#include <fog_vertex>\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),h={};return/vec3\s+transformed\s*=/.test(i)||/#include\s+<begin_vertex>/.test(i)||(h.DECLARE_TRANSFORMED=!0),s&&(l.extrusionRatio={value:r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN},h.USE_EXTRUSION=1),a&&(l.fadeNear={value:void 0!==n.fadeNear?n.fadeNear.value:r.FadingFeature.DEFAULT_FADE_NEAR},l.fadeFar={value:void 0!==n.fadeFar?n.fadeFar.value:r.FadingFeature.DEFAULT_FADE_FAR},h.USE_FADING=1),new o.ShaderMaterial({defines:h,uniforms:l,vertexShader:c,fragmentShader:"\n#include <common>\n#include <fog_pars_fragment>\n\n#ifdef USE_EXTRUSION\n  #include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_fragment>\n#endif\n\nuniform vec3 outlineColor;\nuniform float outlineAlpha;\n\nvoid main() {\n\n    gl_FragColor = vec4( outlineColor, outlineAlpha );\n\n    #include <fog_fragment>\n\n    #ifdef USE_EXTRUSION\n      #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n      #include <fading_fragment>\n    #endif\n}",side:o.BackSide,skinning:!1,morphTargets:!1,morphNormals:!1,fog:!1,blending:o.CustomBlending,blendSrc:o.SrcAlphaFactor,blendDst:o.OneMinusSrcAlphaFactor,blendSrcAlpha:o.OneFactor,blendDstAlpha:o.OneMinusSrcAlphaFactor,transparent:!0,polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:30})}getOutlineMaterialFromCache(e){let t=this.m_cache[e.uuid];return void 0===t&&(t={material:this.createMaterial(e),used:!0,keepAlive:this.m_defaultKeepAlive,count:0},this.m_cache[e.uuid]=t),t.used=!0,t.material}getOutlineMaterial(e){const t=this.getOutlineMaterialFromCache(e);return this.m_originalMaterials[t.uuid]=e,this.updateOutlineMaterial(t,e),t}setOutlineMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.getOutlineMaterial(e.material[t]);else e.material=this.getOutlineMaterial(e.material);this.m_originalOnBeforeRenders[e.uuid]=e.onBeforeRender,e.onBeforeRender=n.chainCallbacks(e.onBeforeRender,this.onBeforeRender.bind(this))}}restoreOriginalMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.m_originalMaterials[e.material[t].uuid];else e.material=this.m_originalMaterials[e.material.uuid];e.onBeforeRender=this.m_originalOnBeforeRenders[e.uuid]}}onBeforeRender(e,t,i,r,n,o){const s=this.m_originalMaterials[n.uuid];void 0!==s&&this.updateUniforms(n,s)}updateUniforms(e,t){const i=t.userData.outlineParameters,n=e.uniforms;n.outlineAlpha.value=t.opacity;const o=void 0!==t.shaderUniforms?t.shaderUniforms:t.uniforms;if(void 0!==i&&(void 0!==i.thickness&&(n.outlineThickness.value=i.thickness),void 0!==i.color&&n.outlineColor.value.fromArray(i.color),void 0!==i.alpha&&(n.outlineAlpha.value=i.alpha)),void 0!==o&&void 0!==o.extrusionRatio){const i=t.shaderUniforms.extrusionRatio.value;e.extrusionRatio=i,e.uniforms.extrusionRatio.value=void 0!==i?i:r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}void 0!==e.defines.USE_FADING&&void 0!==o.fadeNear&&void 0!==o.fadeFar&&o.fadeFar.value>=0&&(n.fadeNear.value=o.fadeNear.value,n.fadeFar.value=o.fadeFar.value)}updateOutlineMaterial(e,t){if("invisible"===e.name)return;const i=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,void 0!==i?(e.visible=!1!==t.visible&&(void 0===i.visible||i.visible),void 0!==i.keepAlive&&(this.m_cache[t.uuid].keepAlive=i.keepAlive)):e.visible=t.visible,!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1)}cleanupCache(){let e;e=Object.keys(this.m_originalMaterials);for(let t=0,i=e.length;t<i;t++)this.m_originalMaterials[e[t]]=void 0;e=Object.keys(this.m_originalOnBeforeRenders);for(let t=0,i=e.length;t<i;t++)this.m_originalOnBeforeRenders[e[t]]=void 0;e=Object.keys(this.m_cache);for(const t of e)!1===this.m_cache[t].used?(this.m_cache[t].count++,!1===this.m_cache[t].keepAlive&&this.m_cache[t].count>this.m_removeThresholdCount&&delete this.m_cache[t]):(this.m_cache[t].used=!1,this.m_cache[t].count=0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomPass=void 0;const r=i(4),n=i(0),o=i(26),s=new n.Vector2(1,0),a=new n.Vector2(0,1);class l extends o.Pass{constructor(e,t,i,o){super(),this.resolution=new n.Vector2(256,256),this.m_renderTargetsHorizontal=[],this.m_renderTargetsVertical=[],this.m_nMips=5,this.m_separableBlurMaterials=[],this.m_camera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_scene=new n.Scene,this.m_basic=new n.MeshBasicMaterial,this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2)),this.m_bloomTintColors=[new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1)],this.strength=t,this.radius=i,this.threshold=o,this.resolution=e,this.m_quad.frustumCulled=!1,this.m_scene.add(this.m_quad);const s={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat};let a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.m_renderTargetBright=new n.WebGLRenderTarget(a,l,s),this.m_renderTargetBright.texture.name="UnrealBloomPass.bright",this.m_renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.m_nMips;e++){const t=new n.WebGLRenderTarget(a,l,s);t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.m_renderTargetsHorizontal.push(t);const i=new n.WebGLRenderTarget(a,l,s);i.texture.name="UnrealBloomPass.v"+e,i.texture.generateMipmaps=!1,this.m_renderTargetsVertical.push(i),a=Math.round(a/2),l=Math.round(l/2)}this.m_highPassUniforms=n.UniformsUtils.clone(r.LuminosityHighPassShader.uniforms),this.m_highPassUniforms.luminosityThreshold.value=o,this.m_highPassUniforms.smoothWidth.value=.01,this.m_materialHighPassFilter=new n.ShaderMaterial({uniforms:this.m_highPassUniforms,vertexShader:r.LuminosityHighPassShader.vertexShader,fragmentShader:r.LuminosityHighPassShader.fragmentShader,defines:{}});const c=[3,5,7,9,11];a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let e=0;e<this.m_nMips;e++)this.m_separableBlurMaterials.push(this.getSeperableBlurMaterial(c[e])),this.m_separableBlurMaterials[e].uniforms.texSize.value=new n.Vector2(a,l),a=Math.round(a/2),l=Math.round(l/2);this.m_compositeMaterial=this.getCompositeMaterial(this.m_nMips),this.m_compositeMaterial.uniforms.blurTexture1.value=this.m_renderTargetsVertical[0].texture,this.m_compositeMaterial.uniforms.blurTexture2.value=this.m_renderTargetsVertical[1].texture,this.m_compositeMaterial.uniforms.blurTexture3.value=this.m_renderTargetsVertical[2].texture,this.m_compositeMaterial.uniforms.blurTexture4.value=this.m_renderTargetsVertical[3].texture,this.m_compositeMaterial.uniforms.blurTexture5.value=this.m_renderTargetsVertical[4].texture,this.m_compositeMaterial.uniforms.bloomStrength.value=t,this.m_compositeMaterial.uniforms.bloomRadius.value=.1,this.m_compositeMaterial.needsUpdate=!0;this.m_compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,this.m_copyUniforms=n.UniformsUtils.clone(r.CopyShader.uniforms),this.m_copyUniforms.opacity.value=1,this.m_materialCopy=new n.ShaderMaterial({uniforms:this.m_copyUniforms,vertexShader:r.CopyShader.vertexShader,fragmentShader:r.CopyShader.fragmentShader,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}dispose(){for(const e of this.m_renderTargetsHorizontal)e.dispose();for(const e of this.m_renderTargetsVertical)e.dispose();this.m_renderTargetBright.dispose()}setSize(e,t){let i=Math.round(e/2),r=Math.round(t/2);this.m_renderTargetBright.setSize(i,r);for(let e=0;e<this.m_nMips;e++)this.m_renderTargetsHorizontal[e].setSize(i,r),this.m_renderTargetsVertical[e].setSize(i,r),this.m_separableBlurMaterials[e].uniforms.texSize.value=new n.Vector2(i,r),i=Math.round(i/2),r=Math.round(r/2)}render(e,t,i,r,n){this.renderToScreen&&(this.m_quad.material=this.m_basic,this.m_basic.map=n.texture,e.setRenderTarget(null),e.clear(),e.render(this.m_scene,this.m_camera)),this.m_highPassUniforms.tDiffuse.value=n.texture,this.m_highPassUniforms.luminosityThreshold.value=this.threshold,this.m_quad.material=this.m_materialHighPassFilter,e.setRenderTarget(this.m_renderTargetBright),e.clear(),e.render(this.m_scene,this.m_camera);let o=this.m_renderTargetBright;for(let t=0;t<this.m_nMips;t++)this.m_quad.material=this.m_separableBlurMaterials[t],this.m_separableBlurMaterials[t].uniforms.colorTexture.value=o.texture,this.m_separableBlurMaterials[t].uniforms.direction.value=s,e.setRenderTarget(this.m_renderTargetsHorizontal[t]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_separableBlurMaterials[t].uniforms.colorTexture.value=this.m_renderTargetsHorizontal[t].texture,this.m_separableBlurMaterials[t].uniforms.direction.value=a,e.setRenderTarget(this.m_renderTargetsVertical[t]),e.clear(),e.render(this.m_scene,this.m_camera),o=this.m_renderTargetsVertical[t];this.m_quad.material=this.m_compositeMaterial,this.m_compositeMaterial.uniforms.bloomStrength.value=this.strength,this.m_compositeMaterial.uniforms.bloomRadius.value=this.radius,this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,e.setRenderTarget(this.m_renderTargetsHorizontal[0]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_quad.material=this.m_materialCopy,this.m_copyUniforms.tDiffuse.value=this.m_renderTargetsHorizontal[0].texture,this.renderToScreen?(e.setRenderTarget(null),e.render(this.m_scene,this.m_camera)):(e.setRenderTarget(n),e.render(this.m_scene,this.m_camera))}getSeperableBlurMaterial(e){return new n.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new n.Vector2(.5,.5)},direction:{value:new n.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }",fragmentShader:"#include <common>\n            varying vec2 vUv;\n            uniform sampler2D colorTexture;\n            uniform vec2 texSize;\n            uniform vec2 direction;\n\n            float gaussianPdf(in float x, in float sigma) {\n                return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n            }\n            void main() {\n                vec2 invSize = 1.0 / texSize;\n                float fSigma = float(SIGMA);\n                float weightSum = gaussianPdf(0.0, fSigma);\n                vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n                for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n                    float x = float(i);\n                    float w = gaussianPdf(x, fSigma);\n                    vec2 uvOffset = direction * invSize * x;\n                    vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n                    vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n                    diffuseSum += (sample1 + sample2) * w;\n                    weightSum += 2.0 * w;\n                }\n                gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n            }"})}getCompositeMaterial(e){return new n.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }",fragmentShader:"varying vec2 vUv;\n                uniform sampler2D blurTexture1;\n                uniform sampler2D blurTexture2;\n                uniform sampler2D blurTexture3;\n                uniform sampler2D blurTexture4;\n                uniform sampler2D blurTexture5;\n                uniform sampler2D dirtTexture;\n                uniform float bloomStrength;\n                uniform float bloomRadius;\n                uniform float bloomFactors[NUM_MIPS];\n                uniform vec3 bloomTintColors[NUM_MIPS];\n\n                float lerpBloomFactor(const in float factor) {\n                    float mirrorFactor = 1.2 - factor;\n                    return mix(factor, mirrorFactor, bloomRadius);\n                }\n\n                void main() {\n                    gl_FragColor = bloomStrength * (\nlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\nlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\nlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\nlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\nlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n                }"})}}t.BloomPass=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerBootstrapResponse=t.isWorkerBootstrapRequest=void 0,t.isWorkerBootstrapRequest=function(e){return e&&"worker-bootstrap-request"===e.type&&Array.isArray(e.dependencies)},t.isWorkerBootstrapResponse=function(e){return e&&"worker-bootstrap-response"===e.type&&Array.isArray(e.resolvedDependencies)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightElementHandler=void 0;const r=i(1),n=i(52),o=i(59);class s{constructor(e,t){if(this.m_defaults=new Map,this.m_mapViews=[],this.update=()=>{const e=this.m_mapViews.map(e=>e.copyrightInfo).reduce(o.CopyrightInfo.mergeArrays,this.staticInfo||[]);if(0===e.length)return void(this.m_element.style.display="none");if(this.m_element.style.display="block",0!==this.m_defaults.size)for(const t of e){const e=this.m_defaults.get(t.id);void 0!==e&&(t.year=r.getOptionValue(t.year,e.year),t.label=r.getOptionValue(t.label,e.label),t.link=r.getOptionValue(t.link,e.link))}const t=o.CopyrightInfo.mergeArrays(e);this.m_element.innerHTML=o.CopyrightInfo.formatAsHtml(t)},"string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`CopyrightElementHandler: unable to find DOM element #${e}`);this.m_element=t}else this.m_element=e;void 0!==t&&this.attach(t)}static install(e,t){return new s(e,t)}destroy(){for(const e of this.m_mapViews)e.removeEventListener(n.MapViewEventNames.CopyrightChanged,this.update)}attach(e){return this.m_mapViews.push(e),e.addEventListener(n.MapViewEventNames.CopyrightChanged,this.update),this.update(),this}detach(e){return e.removeEventListener(n.MapViewEventNames.CopyrightChanged,this.update),this.m_mapViews=this.m_mapViews.filter(t=>t!==e),this.update(),this}setDefaults(e){if(this.m_defaults.clear(),void 0!==e)for(const t of e)this.m_defaults.set(t.id,t);return this}setStaticCopyightInfo(e){return this.staticInfo=e,this}}t.CopyrightElementHandler=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeLengthGeometrySubdivisionModifier=t.SubdivisionMode=void 0;const r=i(3),n=i(1),o=i(0),s=i(98),a=[new o.Vector3,new o.Vector3];var l;!function(e){e[e.All=0]="All",e[e.NoDiagonals=1]="NoDiagonals"}(l=t.SubdivisionMode||(t.SubdivisionMode={}));class c extends s.SubdivisionModifier{constructor(e,t,i=l.All,o){super(),this.subdivision=e,this.geoBox=t,this.subdivisionMode=i,this.projection=o,n.assert(o.type===r.ProjectionType.Planar,"EdgeLengthGeometrySubdivisionModifier only supports planar projections");const s=o.projectPoint(t.northEast,a[0]),c=o.projectPoint(t.southWest,a[1]);this.m_projectedBox={min:{x:Math.min(s.x,c.x),y:Math.min(s.y,c.y),z:Math.min(s.z,c.z)},max:{x:Math.max(s.x,c.x),y:Math.max(s.y,c.y),z:Math.max(s.z,c.z)}},this.m_maxLengthX=(this.m_projectedBox.max.x-this.m_projectedBox.min.x)/e,this.m_maxLengthY=(this.m_projectedBox.max.y-this.m_projectedBox.min.y)/e,this.subdivisionMode===l.All&&(this.m_maxLengthX*=1.1,this.m_maxLengthY*=1.1),this.m_maxLength=Math.sqrt(this.m_maxLengthX*this.m_maxLengthX+this.m_maxLengthY*this.m_maxLengthY)}get maxLength(){return this.m_maxLength}get maxLengthX(){return this.m_maxLengthX}get maxLengthY(){return this.m_maxLengthY}shouldSplitTriangle(e,t,i){const r=this.shouldSplitEdge(e,t),n=this.shouldSplitEdge(t,i),o=this.shouldSplitEdge(i,e);if(!(r||n||o))return;const s=e.distanceTo(t),a=t.distanceTo(i),l=i.distanceTo(e),c=Math.max(r?s:0,n?a:0,o?l:0);if(s===c)return 0;if(a===c)return 1;if(l===c)return 2;throw new Error("Could not split triangle.")}shouldSplitEdge(e,t){switch(this.subdivisionMode){case l.All:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY||e.distanceTo(t)>this.m_maxLength;case l.NoDiagonals:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY}}}t.EdgeLengthGeometrySubdivisionModifier=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphericalGeometrySubdivisionModifier=void 0;const r=i(3),n=i(0),o=i(98),s=[new n.Vector3,new n.Vector3,new n.Vector3];class a extends o.SubdivisionModifier{constructor(e,t=r.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,i){const n=r.sphereProjection.reprojectPoint(this.projection,e,s[0]),o=r.sphereProjection.reprojectPoint(this.projection,t,s[1]),a=r.sphereProjection.reprojectPoint(this.projection,i,s[2]),l=n.angleTo(o),c=o.angleTo(a),h=a.angleTo(n),d=Math.max(l,Math.max(c,h));if(!(d<this.angle)){if(d===l)return 0;if(d===c)return 1;if(d===h)return 2;throw new Error("failed to split triangle")}}}t.SphericalGeometrySubdivisionModifier=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedMesh=void 0;const r=i(4),n=i(1),o=i(0),s=i(99),a=i(100);class l extends o.Mesh{constructor(e,t,i,r){super(e,t),this.m_getDisplacementRange=i,this.m_raycastStrategy=r}static getDisplacedPositionAttribute(e,t){return l.displacedPositions?l.displacedPositions.reset(e.attributes.position,e.attributes.normal,e.attributes.uv,t):l.displacedPositions=new s.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),l.displacedPositions}raycast(e,t){const i=this.firstMaterial;if(!function(e){const t=r.hasDisplacementFeature(e);return n.assert(t,"Material does not support displacement maps."),t}(i)||!function(e){if(!e)return!1;const t=e instanceof o.DataTexture;return n.assert(t,"Material does not support displacement maps."),t}(i.displacementMap))return void super.raycast(e,t);const s=i.displacementMap,c=Object.assign({},this.m_getDisplacementRange());n.assert(this.geometry instanceof o.BufferGeometry,"Unsupported geometry type.");const h=this.geometry;this.displacedGeometry?this.displacedGeometry.reset(h,s,c):this.displacedGeometry=new a.DisplacedBufferGeometry(h,s,c,l.getDisplacedPositionAttribute(h,s)),this.geometry=this.displacedGeometry,this.m_raycastStrategy?this.m_raycastStrategy(this,e,t):super.raycast(e,t),super.geometry=this.displacedGeometry.originalGeometry}get firstMaterial(){return Array.isArray(this.material)?this.material[0]:this.material}}t.DisplacedMesh=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexCache=void 0;const r=i(1);var n;!function(e){e[e.VertexId=0]="VertexId",e[e.OlderIdx=1]="OlderIdx",e[e.NewerIdx=2]="NewerIdx",e[e.X=3]="X",e[e.Y=4]="Y",e[e.Z=5]="Z",e[e.Count=6]="Count"}(n||(n={}));t.VertexCache=class{constructor(e){this.maxVertexCount=e,this.m_cache=[],this.m_vertexCount=0,this.m_oldestIdx=0,this.m_newestIdx=0,this.m_cache.length=this.maxVertexCount*n.Count,this.clear()}clear(){this.m_cache.fill(-1),this.m_vertexCount=0}get(e,t){const i=this.find(e);return void 0!==i&&(this.promoteEntry(i),this.getVertex(i,t),!0)}set(e,t){let i=-1;this.m_vertexCount<this.maxVertexCount?(i=this.m_vertexCount*n.Count,this.m_vertexCount++):i=this.m_oldestIdx,1===this.m_vertexCount?this.m_oldestIdx=this.m_newestIdx=i:this.promoteEntry(i),this.setVertex(i,e,t)}find(e){const t=this.m_cache.length;for(let i=0;i<t;i+=n.Count)if(this.m_cache[i]===e)return i}promoteEntry(e){if(e===this.m_newestIdx)return;const t=this.getNewerIdx(e),i=this.getOlderIdx(e);-1!==t&&(r.assert(this.getOlderIdx(t)===e),this.setOlderIdx(t,i)),-1!==i&&(r.assert(this.getNewerIdx(i)===e),this.setNewerIdx(i,t)),e===this.m_oldestIdx&&(this.m_oldestIdx=t),this.setNewerIdx(e,-1),this.setOlderIdx(e,this.m_newestIdx),r.assert(-1!==this.m_newestIdx),r.assert(-1===this.getNewerIdx(this.m_newestIdx)),this.setNewerIdx(this.m_newestIdx,e),this.m_newestIdx=e}getOlderIdx(e){return this.m_cache[e+n.OlderIdx]}setOlderIdx(e,t){this.m_cache[e+n.OlderIdx]=t}getNewerIdx(e){return this.m_cache[e+n.NewerIdx]}setNewerIdx(e,t){this.m_cache[e+n.NewerIdx]=t}getVertex(e,t){t.x=this.m_cache[e+n.X],t.y=this.m_cache[e+n.Y],t.z=this.m_cache[e+n.Z]}setVertex(e,t,i){this.m_cache[e]=t,this.m_cache[e+n.X]=i.x,this.m_cache[e+n.Y]=i.y,this.m_cache[e+n.Z]=i.z}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMesh=void 0;const r=i(3),n=i(4),o=i(1),s=i(0),a=i(100),l=new s.Sphere,c=new s.Matrix4,h=new s.Ray,d=new s.Line3,u=new s.Box3,m=new r.OrientedBox3,p=new s.Plane,f=new s.Vector3,g=new s.Vector3,v=new s.Vector3,y=new s.Vector3;function _(e,t,i){let r;e instanceof a.DisplacedBufferGeometry&&(r=e.displacementRange,e=e.originalGeometry);const n=e.attributes.position,o=e.index.array,l=new s.Sphere,c=u.makeEmpty(),h=f;for(let e=t;e<i;e+=6)c.expandByPoint(h.fromBufferAttribute(n,o[e])),c.expandByPoint(h.fromBufferAttribute(n,o[e+2]));if(r){const t=g;return t.fromBufferAttribute(e.attributes.normal,0),a.displaceBox(c,r,t).getBoundingSphere(l)}return c.getBoundingSphere(l)}function x(e,t,i,r,n,o,a,l){if(a.equals(e.origin)&&0===e.direction.dot(o.normal)){const n=function(e,t,i,r,n){var o;const s=m;return t.getCenter(s.position),t.delta(s.xAxis).normalize(),s.yAxis.copy(i),s.zAxis.copy(r),s.extents.set(t.distance()/2,n,n),s.contains(e.origin)?0:null!==(o=s.intersectsRay(e))&&void 0!==o?o:1/0}(e,t,i,o.normal,r),a=function(e,t,i){const r=new s.Sphere(t.start,i),n=r.containsPoint(e.origin)?0:e.intersectSphere(r,y)?y.sub(e.origin).length():1/0;r.center.copy(t.end);const o=r.containsPoint(e.origin)?0:e.intersectSphere(r,y)?y.sub(e.origin).length():1/0;return Math.min(n,o)}(e,t,r),c=Math.min(n,a);return c!==1/0&&(e.at(c,l),!0)}return!(a.distanceToSquared(t.closestPointToPoint(a,!0,y))>n)&&(l.copy(a),!0)}function S(e,t,i,r,n,o,s,a,c,h){const u=f,m=p,y=g,_=d,S=e.geometry,b=S.attributes,T=b.position,w=b.bitangent,M=S.index.array;if(l.copy(c),l.applyMatrix4(e.matrixWorld),l.radius+=r,t.ray.intersectsSphere(l))for(let r=s;r<a;r+=6){const s=M[r],a=M[r+2];if(_.start.fromBufferAttribute(T,s),_.end.fromBufferAttribute(T,a),u.set(w.getX(s),w.getY(s),w.getZ(s)).normalize(),m.setFromCoplanarPoints(_.start,v.copy(_.start).add(u),_.end),0===m.normal.manhattanLength())continue;if(!i.intersectPlane(m,y))continue;const l=v;if(!x(i,_,u,n,o,m,y,l))continue;const c=l.applyMatrix4(e.matrixWorld),d=t.ray.origin.distanceTo(c);d<t.near||d>t.far||h.push({distance:d,point:c.clone(),index:r,object:e})}}const b=[0];function T(e,t,i,r,a,l,c){var h;const d=e.userData.feature.boundingVolumes;o.assert(e.geometry instanceof s.BufferGeometry,"Unsupported geometry type.");const u=e.geometry;o.assert(function(e){return Array.isArray(e)?e.every(e=>e instanceof n.SolidLineMaterial):e instanceof n.SolidLineMaterial}(t),"Unsupported material type");const m=t,p=(m.lineWidth+m.outlineWidth)/2;o.assert(Math.abs(1-e.scale.x/e.scale.y)<.01),o.assert(Math.abs(1-e.scale.x/e.scale.z)<.01),o.assert(Math.abs(1-e.scale.y/e.scale.z)<.01);const f=p/((e.scale.x+e.scale.y+e.scale.z)/3),g=f*f,v=null!==(h=e.userData.feature.starts)&&void 0!==h?h:b;let y=a,x=v[y];const T=v.length-1;for(;x<l;){const t=y,n=y<T?v[++y]:l;t>=d.length&&d.push(_(u,x,n)),S(e,i,r,p,f,g,x,n,d[t],c),x=n}return y}class w extends s.Mesh{static raycast(e,t,i){o.assert(e.geometry instanceof s.BufferGeometry,"Unsupported geometry type");const r=e.geometry;o.assert(null!==r.index,"Geometry does not have indices");const n=e.matrixWorld;c.getInverse(n);const a=h.copy(t.ray).applyMatrix4(c);e.userData.feature||(e.userData.feature={}),e.userData.feature.boundingVolumes||(e.userData.feature.boundingVolumes=[]);const l=r.index.array;if(Array.isArray(e.material)){let n=0;for(const o of r.groups){n=T(e,e.material[o.materialIndex],t,a,n,o.start+o.count,i)}}else T(e,e.material,t,a,0,l.length,i)}constructor(e,t){super(e,t)}raycast(e,t){w.raycast(this,e,t)}}t.SolidLineMesh=w},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathBlockingElement=void 0;const r=i(0);t.PathBlockingElement=class{constructor(e){this.points=e,this.screenSpaceLines=new Array(e.length>=2?e.length-1:0);for(let e=0;e<this.screenSpaceLines.length;e++)this.screenSpaceLines[e]=new r.Line3(new r.Vector3,new r.Vector3)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoxBuffer=t.BoxBufferMesh=void 0;const r=i(1),n=i(0),o=i(227);class s extends n.Mesh{constructor(e,t){super(e,t),this.type="BoxBufferMesh"}get isEmpty(){if(void 0===this.geometry)return!0;{const e=this.geometry;return null===e.index||0===e.index.count}}}t.BoxBufferMesh=s;class a{constructor(e,t=0,i=0,r=32768){this.material=e,this.renderOrder=t,this.startElementCount=i,this.maxElementCount=r,this.m_size=0,this.resizeBuffer(i),this.pickInfos=new Array}clone(){return new a(this.material,this.renderOrder)}dispose(){void 0!==this.geometry&&(this.geometry.dispose(),this.geometry=void 0),this.internalMesh=void 0}get size(){return this.m_size}reset(){void 0!==this.positionAttribute&&(this.positionAttribute.count=0,this.colorAttribute.count=0,this.uvAttribute.count=0,this.indexAttribute.count=0,this.pickInfos.length=0)}canAddElements(e=1){const t=this.indexAttribute;if(t.count+6*e>=t.array.length){if(t.array.length>=6*this.maxElementCount)return!1;const e=Math.min(this.maxElementCount,0===this.size?256:2*this.size);this.resize(e)}return!0}saveState(){return{positionAttributeCount:this.positionAttribute.count,colorAttributeCount:this.colorAttribute.count,uvAttributeCount:this.uvAttribute.count,indexAttributeCount:this.indexAttribute.count,pickInfoCount:this.pickInfos.length}}restoreState(e){this.positionAttribute.count=e.positionAttributeCount,this.colorAttribute.count=e.colorAttributeCount,this.uvAttribute.count=e.uvAttributeCount,this.indexAttribute.count=e.indexAttributeCount,this.pickInfos.length=e.pickInfoCount}addBox(e,t,i,r,n,o){if(!this.canAddElements())return!1;const{s0:s,t0:a,s1:l,t1:c}=t,{x:h,y:d,w:u,h:m}=e,p=Math.round(255*i.r),f=Math.round(255*i.g),g=Math.round(255*i.b),v=Math.round(255*r),y=this.positionAttribute,_=this.colorAttribute,x=this.uvAttribute,S=this.indexAttribute,b=y.count,T=S.count;return y.setXYZ(b,h,d,n),y.setXYZ(b+1,h+u,d,n),y.setXYZ(b+2,h,d+m,n),y.setXYZ(b+3,h+u,d+m,n),_.setXYZW(b,p,f,g,v),_.setXYZW(b+1,p,f,g,v),_.setXYZW(b+2,p,f,g,v),_.setXYZW(b+3,p,f,g,v),x.setXY(b,s,a),x.setXY(b+1,l,a),x.setXY(b+2,s,c),x.setXY(b+3,l,c),S.setX(T,b),S.setX(T+1,b+1),S.setX(T+2,b+2),S.setX(T+3,b+2),S.setX(T+4,b+1),S.setX(T+5,b+3),y.count+=4,_.count+=4,x.count+=4,S.count+=6,this.pickInfos.push(o),!0}updateBufferGeometry(){const e=this.positionAttribute,t=this.colorAttribute,i=this.uvAttribute,r=this.indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=4*e.count),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),i.count>0&&(i.needsUpdate=!0,i.updateRange.offset=0,i.updateRange.count=4*i.count),r.count>0&&(r.needsUpdate=!0,r.updateRange.offset=0,r.updateRange.count=r.count),void 0!==this.geometry&&(this.geometry.clearGroups(),this.geometry.addGroup(0,this.indexAttribute.count))}cleanUp(){0===this.indexAttribute.count&&this.size>0&&this.clearAttributes()}get isEmpty(){return this.internalMesh.isEmpty}get mesh(){return void 0===this.internalMesh&&this.resize(),this.internalMesh}pickBoxes(e,t,i){const n=this.pickInfos.length,o=this.pickInfos,s=this.positionAttribute,a=e.x,l=e.y,c=document.createElement("canvas");for(let e=0;e<n;e++){const n=4*e,h=s.getX(n);if(a<h)continue;const d=s.getX(n+1);if(a>d)continue;const u=s.getY(n);if(l<u)continue;const m=s.getY(n+2);if(l>m)continue;const p=new r.Math2D.Box(h,u,d-h,m-u);void 0!==i&&void 0!==o[e].poiInfo&&void 0!==o[e].poiInfo.uvBox&&this.isPixelTransparent(i,a,l,p,o[e].poiInfo.uvBox,c)||void 0!==o[e]&&t(o[e])}}resize(e,t){return void 0!==this.geometry&&this.geometry.dispose(),this.geometry=new n.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.geometry.setAttribute("position",this.positionAttribute),this.geometry.setAttribute("color",this.colorAttribute),this.geometry.setAttribute("uv",this.uvAttribute),this.geometry.setIndex(this.indexAttribute),this.geometry.addGroup(0,this.indexAttribute.count),void 0===this.internalMesh?(this.internalMesh=new s(this.geometry,this.material),this.internalMesh.renderOrder=this.renderOrder):this.internalMesh.geometry=this.geometry,this.internalMesh}updateMemoryUsage(e){const t=3*this.positionAttribute.count*4+4*this.colorAttribute.count+4*this.uvAttribute.count*4+4*this.indexAttribute.count;e.heapSize+=t,e.gpuSize+=t}isPixelTransparent(e,t,i,r,n,s){let a=!1;const{u:l,v:c}=o.screenToUvCoordinates(t,i,r,n),h=e.width*l,d=e.height*c,u=o.getPixelFromImage(h,d,e,s);return void 0!==u&&0===u[3]&&(a=!0),a}clearAttributes(){this.positionAttribute=void 0,this.colorAttribute=void 0,this.uvAttribute=void 0,this.indexAttribute=void 0,this.resize(0,!0)}resizeBuffer(e){const t=new Float32Array(4*e*3);if(void 0!==this.positionAttribute&&this.positionAttribute.array.length>0){const e=this.positionAttribute.count;t.set(this.positionAttribute.array),this.positionAttribute.array=t,this.positionAttribute.count=e}else this.positionAttribute=new n.BufferAttribute(t,3),this.positionAttribute.count=0,this.positionAttribute.setUsage(n.DynamicDrawUsage);const i=new Uint8Array(4*e*4);if(void 0!==this.colorAttribute){const e=this.colorAttribute.count;i.set(this.colorAttribute.array),this.colorAttribute.array=i,this.colorAttribute.count=e}else this.colorAttribute=new n.BufferAttribute(i,4,!0),this.colorAttribute.count=0,this.colorAttribute.setUsage(n.DynamicDrawUsage);const r=new Float32Array(4*e*4);if(void 0!==this.uvAttribute){const e=this.uvAttribute.count;r.set(this.uvAttribute.array),this.uvAttribute.array=r,this.uvAttribute.count=e}else this.uvAttribute=new n.BufferAttribute(r,4),this.uvAttribute.count=0,this.uvAttribute.setUsage(n.DynamicDrawUsage);const o=6*e*1,s=o>65535?new Uint32Array(o):new Uint16Array(o);if(void 0!==this.indexAttribute){const e=this.indexAttribute.count;s.set(this.indexAttribute.array),this.indexAttribute.array=s,this.indexAttribute.count=e}else this.indexAttribute=new n.BufferAttribute(s,1),this.indexAttribute.count=0,this.indexAttribute.setUsage(n.DynamicDrawUsage);this.m_size=e}}t.BoxBuffer=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPixelFromImageData=t.getPixelFromImageBitmap=t.screenToUvCoordinates=t.getPixelFromImage=void 0;const r=i(1);function n(e,t,i,r){if(t>e.width||t<0||i>e.height||i<0)return;let n;r.width=e.width,r.height=e.height;const o=r.getContext("2d");return null!==o&&(o.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),n=o.getImageData(t,i,1,1).data),n}function o(e,t,i,r){if(!(t>e.width||t<0||i>e.height||i<0))return((e,t,i)=>{const r=t*i,n=e.data,o=new Uint8ClampedArray(i);for(let e=0;e<i;e++)o[0]=n[r+e];return o})(e,i*e.width+t,r)}t.getPixelFromImage=function(e,t,i,r){let s;if(void 0!==i.close)void 0===r&&(r=document.createElement("canvas")),s=n(i,e,t,r);else{const r=i;s=o(r,e,t,r.data.length/(r.height*r.width))}return s},t.screenToUvCoordinates=function(e,t,i,n){const o=i.x,s=i.x+i.w,a=i.y,l=i.y+i.h;return{u:r.MathUtils.map(e,o,s,n.s0,n.s1),v:r.MathUtils.map(t,a,l,n.t0,n.t1)}},t.getPixelFromImageBitmap=n,t.getPixelFromImageData=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlacementStats=void 0;t.PlacementStats=class{constructor(e){this.m_logger=e,this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedPoiIcons=0,this.numRenderedPoiTexts=0,this.numPoiTextsInvisible=0,this.numRenderedTextElements=0}clear(){this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedPoiIcons=0,this.numRenderedPoiTexts=0,this.numPoiTextsInvisible=0,this.numRenderedTextElements=0}log(){const e=this.uninitialized+this.numPoiTextsInvisible+this.tooFar+this.numNotVisible+this.numCannotAdd;this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("Resorted groups",this.resortedGroups),this.m_logger.debug("Total labels",this.total),this.m_logger.debug("Rendered labels",this.numRenderedTextElements),this.m_logger.debug("Rejected labels",e),this.m_logger.debug("Unitialized labels",this.uninitialized),this.m_logger.debug("Rendered poi icons",this.numRenderedPoiIcons),this.m_logger.debug("Rendered poi texts",this.numRenderedPoiTexts),this.m_logger.debug("Poi text invisible",this.numPoiTextsInvisible),this.m_logger.debug("Too far",this.tooFar),this.m_logger.debug("Not visible",this.numNotVisible),this.m_logger.debug("Path too small",this.numPathTooSmall),this.m_logger.debug("Rejected, max glyphs reached",this.numCannotAdd)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimplePath=t.PathParam=t.SimpleLineCurve=void 0;const r=i(0);class n extends r.LineCurve{constructor(e,t){super(e,t)}getLengths(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths}}t.SimpleLineCurve=n;class o{constructor(e,t,i){this.path=e,this.index=t,this.t=i}get curve(){return this.path.curves[this.index]}get point(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point}}t.PathParam=o;class s extends r.Path{constructor(){super()}getLengths(){if(this.m_cache)return this.m_cache;let e=0;const t=new Array;return t.push(0),this.curves.forEach(i=>{const r=i;e+=r.v1.distanceTo(r.v2),t.push(e)}),this.m_cache=t,t}getParamAt(e){const t=e*this.getLength(),i=this.getCurveLengths();for(let e=0;e<i.length;++e){if(i[e]<t)continue;const r=i[e]-t,n=this.curves[e].getLength();return new o(this,e,0===n?0:1-r/n)}return null}}t.SimplePath=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeDefaultOptions=void 0;t.initializeDefaultOptions=function(e){void 0===e.fontCatalog&&(e.fontCatalog="./resources/fonts/Default_FontCatalog.json"),void 0===e.minNumGlyphs&&(e.minNumGlyphs=1024),void 0===e.maxNumGlyphs&&(e.maxNumGlyphs=32768),void 0===e.maxNumVisibleLabels&&(e.maxNumVisibleLabels=500),void 0===e.numSecondChanceLabels&&(e.numSecondChanceLabels=300),void 0===e.labelDistanceScaleMin&&(e.labelDistanceScaleMin=.7),void 0===e.labelDistanceScaleMax&&(e.labelDistanceScaleMax=1.5),void 0===e.maxDistanceRatioForTextLabels&&(e.maxDistanceRatioForTextLabels=.99),void 0===e.maxDistanceRatioForPoiLabels&&(e.maxDistanceRatioForPoiLabels=.99),void 0===e.disableFading&&(e.disableFading=!1),void 0===e.delayLabelsUntilMovementFinished&&(e.delayLabelsUntilMovementFinished=!0)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementStateCache=void 0;const r=i(1),n=i(232),o=i(25),s=r.LoggerManager.instance.create("TextElementsStateCache",{level:r.LogLevel.Log});const a={entries:[],index:-1};function l(e){return e.hasFeatureId()?e.featureId:e.text}function c(e,t,i,r){return void 0!==e.pathLengthSqr&&(void 0!==i.pathLengthSqr&&e.pathLengthSqr>i.pathLengthSqr)}function h(e,t,i,r){return t<r}function d(e,t,i){const r=e.element,n=function(e){return 100<<(Math.min(4,13-Math.min(13,Math.floor(e)))<<2)}(i),s=t.length,a=r.position,l=e.visible;let d,u=-1,m=1/0;const p=r.type===o.TextElementType.PoiLabel?h:c;for(let e=0;e<s;++e){const i=t[e],o=i.element,s=r.type!==o.type,c=l&&i.visible;if(s||c)continue;const h=a.distanceToSquared(o.position);h>n||(void 0===d||p(o,h,d,m))&&(u=e,d=o,m=h)}return u}t.TextElementStateCache=class{constructor(){this.m_referenceMap=new Map,this.m_textMap=new Map}getOrSet(e,t,i){let o=this.get(e);return void 0!==o?(r.assert(o.size===e.elements.length),o.updateElements(i),[o,!0]):(o=new n.TextElementGroupState(e,t,i),this.set(e,o),[o,!1])}get size(){return this.m_referenceMap.size}get sortedGroupStates(){return void 0===this.m_sortedGroupStates&&(this.m_sortedGroupStates=Array.from(this.m_referenceMap.values()),this.m_sortedGroupStates.sort((e,t)=>t.group.priority-e.group.priority)),r.assert(this.m_referenceMap.size===this.m_sortedGroupStates.length),this.m_sortedGroupStates}update(e,t,i,r){const n=i?this.replaceElement.bind(this,r):void 0;let o=!1;for(const[r,s]of this.m_referenceMap.entries())s.visited?s.updateFading(e,t):(i&&s.traverseVisibleElements(n),this.m_referenceMap.delete(r),this.m_sortedGroupStates=void 0,o=!0);return o}clearVisited(){for(const e of this.m_referenceMap.values())e.visited=!1}clearTextCache(){this.m_textMap.clear()}clear(){this.m_referenceMap.clear(),this.m_sortedGroupStates=void 0,this.m_textMap.clear()}deduplicateElement(e,t){const i=this.findDuplicate(t,e);if(void 0===i)return this.m_textMap.set(l(t.element),[t]),!0;if(-1===i.index)return i.entries.push(t),!0;const r=i.entries[i.index];return!(r.visible||!t.visible)&&(i.entries[i.index]=t,r.reset(),!0)}replaceElement(e,t){r.assert(t.visible);const i=this.findDuplicate(t,e);if(void 0===i||-1===i.index)return;const n=i.entries[i.index];r.assert(!n.visible),n.replace(t)}get(e){const t=this.m_referenceMap.get(e);return void 0!==t&&(t.visited=!0),t}set(e,t){r.assert(e.elements.length>0),this.m_referenceMap.set(e,t),this.m_sortedGroupStates=void 0}findDuplicate(e,t){const i=e.element,n=this.m_textMap.get(l(i));if(void 0===n)return;a.entries=n;const o=i.hasFeatureId()?function(e,t){const i=e.element,n=t.findIndex(e=>e.element.tileOffset===i.tileOffset);if(-1===n)return-1;const o=t[n].element;if(r.assert(i.featureId===o.featureId),o.text===i.text)return n;s.debug(`Text feature id ${i.featureId} collision between "${i.text} and              ${o.text}`)}(e,n):d(e,n,t);return void 0===o?(i.featureId=void 0,this.findDuplicate(e,t)):(a.index=o,a)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroupState=void 0;const r=i(1),n=i(233);t.TextElementGroupState=class{constructor(e,t,i){this.group=e,this.tileKey=t,this.m_visited=!1,r.assert(e.elements.length>0);const o=e.elements.length;this.m_textElementStates=new Array(o),this.m_visited=!0;for(let t=0;t<o;++t){const r=e.elements[t],o=new n.TextElementState(r),s=i(o);o.update(s),this.m_textElementStates[t]=o}}get visited(){return this.m_visited}set visited(e){this.m_visited=e}get priority(){return this.group.priority}updateFading(e,t){for(const i of this.m_textElementStates)void 0!==i&&i.updateFading(e,t)}traverseVisibleElements(e){for(const t of this.m_textElementStates)void 0!==t&&t.visible&&e(t)}updateElements(e){for(const t of this.m_textElementStates){const i=e(t);t.update(i)}}get size(){return this.m_textElementStates.length}get textElementStates(){return this.m_textElementStates}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementState=void 0;const r=i(6),n=i(1),o=i(234),s=i(235),a=i(25);t.TextElementState=class{constructor(e){this.element=e}get initialized(){return void 0!==this.m_textRenderState||void 0!==this.m_iconRenderStates}get visible(){if(void 0!==this.m_textRenderState&&this.m_textRenderState.isVisible())return!0;const e=this.iconRenderState;if(void 0!==e&&e.isVisible())return!0;const t=this.iconRenderStates;if(void 0===t)return!1;for(const e of t)if(e.isVisible())return!0;return!1}get textPlacement(){const e=this.element.layoutStyle,t=this.m_textLayoutState;return void 0!==t?t.textPlacement:{h:r.hPlacementFromAlignment(e.horizontalAlignment),v:r.vPlacementFromAlignment(e.verticalAlignment)}}set textPlacement(e){void 0===this.m_textLayoutState&&!0===this.isBaseTextPlacement(e)||(void 0===this.m_textLayoutState?this.m_textLayoutState=new o.LayoutState(e):this.m_textLayoutState.textPlacement=e)}isBaseTextPlacement(e){const t=this.element.layoutStyle;if(void 0!==t)return r.hAlignFromPlacement(e.h)===t.horizontalAlignment&&r.vAlignFromPlacement(e.v)===t.verticalAlignment}reset(){if(void 0!==this.m_textRenderState&&this.m_textRenderState.reset(),void 0!==this.m_textLayoutState&&(void 0!==this.element.layoutStyle?this.m_textLayoutState.reset(this.element.layoutStyle):this.m_textLayoutState=void 0),this.iconRenderState)this.m_iconRenderStates.reset();else if(void 0!==this.m_iconRenderStates)for(const e of this.m_iconRenderStates)e.reset();this.m_viewDistance=void 0,this.element.textBufferObject=void 0}replace(e){this.m_textRenderState=e.m_textRenderState,this.m_textLayoutState=e.m_textLayoutState,this.m_iconRenderStates=e.m_iconRenderStates,e.m_textRenderState=void 0,e.m_textLayoutState=void 0,e.m_iconRenderStates=void 0,void 0===this.element.glyphs&&(this.element.glyphs=e.element.glyphs,this.element.glyphCaseArray=e.element.glyphCaseArray),this.element.bounds=void 0,this.element.textBufferObject=void 0}get viewDistance(){return this.m_viewDistance}update(e){this.initialized||void 0===e||this.initializeRenderStates(),this.setViewDistance(e)}setViewDistance(e){this.m_viewDistance=e}get renderDistance(){return!0===this.element.alwaysOnTop?0:void 0!==this.m_viewDistance?-this.m_viewDistance:0}get textRenderState(){return this.m_textRenderState}get iconRenderState(){if(void 0!==this.m_iconRenderStates)return this.m_iconRenderStates instanceof s.RenderState?this.m_iconRenderStates:void 0}get iconRenderStates(){if(void 0!==this.m_iconRenderStates)return this.m_iconRenderStates instanceof s.RenderState?void 0:this.m_iconRenderStates}updateFading(e,t){if(void 0!==this.m_textRenderState&&this.m_textRenderState.updateFading(e,t),void 0!==this.iconRenderState){this.m_iconRenderStates.updateFading(e,t)}else if(void 0!==this.iconRenderStates)for(const i of this.m_iconRenderStates)i.updateFading(e,t)}initializeRenderStates(){var e;n.assert(void 0===this.m_textRenderState),n.assert(void 0===this.m_textLayoutState),n.assert(void 0===this.m_iconRenderStates);const{textFadeTime:t}=this.element,i=null===(e=this.element.poiInfo)||void 0===e?void 0:e.technique.iconFadeTime;if(this.element.type!==a.TextElementType.LineMarker)this.m_textRenderState=new s.RenderState(t),this.element.type===a.TextElementType.PoiLabel&&(this.m_iconRenderStates=new s.RenderState(i));else{this.m_iconRenderStates=new Array;for(const e of this.element.points){const e=this.m_iconRenderStates,t=new s.RenderState(i);e.push(t)}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutState=void 0;const r=i(6);t.LayoutState=class{constructor(e){this.m_hAlign=r.DefaultTextStyle.DEFAULT_HORIZONTAL_ALIGNMENT,this.m_vAlign=r.DefaultTextStyle.DEFAULT_VERTICAL_ALIGNMENT,this.textPlacement=e}set textPlacement(e){this.m_hAlign=r.hAlignFromPlacement(e.h),this.m_vAlign=r.vAlignFromPlacement(e.v)}get textPlacement(){return{h:r.hPlacementFromAlignment(this.m_hAlign),v:r.vPlacementFromAlignment(this.m_vAlign)}}reset(e){this.m_hAlign=e.horizontalAlignment,this.m_vAlign=e.verticalAlignment}get horizontalAlignment(){return this.m_hAlign}get verticalAlignment(){return this.m_vAlign}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderState=t.DEFAULT_FADE_TIME=t.FadingState=void 0;const r=i(1),n=i(0);var o;!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(o=t.FadingState||(t.FadingState={})),t.DEFAULT_FADE_TIME=800;t.RenderState=class{constructor(e=t.DEFAULT_FADE_TIME){this.fadeTime=e,this.value=0,this.startTime=0,this.opacity=1,this.m_state=o.Undefined}reset(){this.m_state=o.Undefined,this.value=0,this.startTime=0,this.opacity=1}isUndefined(){return this.m_state===o.Undefined}isFading(){return this.m_state===o.FadingIn||this.m_state===o.FadingOut}isFadingIn(){return this.m_state===o.FadingIn}isFadingOut(){return this.m_state===o.FadingOut}isFadedIn(){return this.m_state===o.FadedIn}isFadedOut(){return this.m_state===o.FadedOut}isVisible(){return this.m_state!==o.FadedOut&&this.m_state!==o.Undefined}startFadeIn(e){this.m_state!==o.FadingIn&&this.m_state!==o.FadedIn&&(this.m_state===o.FadingOut?(this.value=1-this.value,this.startTime=e-this.value*this.fadeTime):(this.startTime=e,this.value=0,this.opacity=0),this.m_state=o.FadingIn)}startFadeOut(e){this.m_state!==o.FadingOut&&this.m_state!==o.FadedOut&&(this.m_state===o.FadingIn?(this.startTime=e-this.value*this.fadeTime,this.value=1-this.value):(this.startTime=e,this.value=0,this.opacity=1),this.m_state=o.FadingOut)}updateFading(e,t){if(this.m_state!==o.FadingIn&&this.m_state!==o.FadingOut)return;0===this.startTime&&(this.startTime=e);const i=e-this.startTime,s=this.m_state===o.FadingIn?0:1,a=this.m_state===o.FadingIn?1:0;t||i>=this.fadeTime?(this.value=1,this.opacity=a,this.m_state=this.m_state===o.FadingIn?o.FadedIn:o.FadedOut):(this.value=i/this.fadeTime,this.opacity=n.MathUtils.clamp(r.MathUtils.smootherStep(s,a,this.value),0,1),r.assert(this.isFading()))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStats=void 0;const r=i(104);t.UpdateStats=class{constructor(e){this.m_logger=e,this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results=new Array(r.PrePlacementResult.Count),this.results.fill(0)}clear(){this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results.fill(0)}log(){this.m_logger.debug("Tiles",this.tiles),this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("New groups",this.newGroups),this.m_logger.debug("Total labels",this.totalLabels),this.m_logger.debug("Placed labels",this.results[r.PrePlacementResult.Ok]),this.m_logger.debug("Invisible",this.results[r.PrePlacementResult.Invisible]),this.m_logger.debug("Poi not ready",this.results[r.PrePlacementResult.NotReady]),this.m_logger.debug("Too far",this.results[r.PrePlacementResult.TooFar]),this.m_logger.debug("Duplicate",this.results[r.PrePlacementResult.Duplicate])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrustumIntersection=t.TileKeyEntry=void 0;const r=i(3),n=i(1),o=i(0),s=i(110),a=i(238),l=i(10),c=[new o.Vector3,new o.Vector3],h=new o.Vector4;class d{constructor(e,t,i=0,r=0,n=0,o=0){this.tileKey=e,this.area=t,this.offset=i,this.minElevation=r,this.maxElevation=n,this.distance=o}}t.TileKeyEntry=d;t.FrustumIntersection=class{constructor(e,t,i,r,n){this.m_camera=e,this.mapView=t,this.m_extendedFrustumCulling=i,this.m_tileWrappingEnabled=r,this.m_enableMixedLod=n,this.m_frustum=new o.Frustum,this.m_viewProjectionMatrix=new o.Matrix4,this.m_rootTileKeys=[],this.m_tileKeyEntries=new Map,this.m_mapTileCuller=new a.MapTileCuller(e)}get camera(){return this.m_camera}get projection(){return this.mapView.projection}updateFrustum(e){this.m_viewProjectionMatrix.multiplyMatrices(void 0!==e?e:this.m_camera.projectionMatrix,this.m_camera.matrixWorldInverse),this.m_frustum.setFromProjectionMatrix(this.m_viewProjectionMatrix),this.m_extendedFrustumCulling&&this.m_mapTileCuller.setup(),this.computeRequiredInitialRootTileKeys(this.m_camera.position)}compute(e,t,i,s){this.m_tileKeyEntries.clear(),n.assert(0!==this.mapView.viewportHeight);const a=Math.pow(256/this.mapView.viewportHeight,2),c=void 0!==t&&t.getTilingScheme()===e,h=this.mapView.projection.type===r.ProjectionType.Spherical||c,d=new Set(i),u={calculationFinal:!0,tileBounds:h?new r.OrientedBox3:new o.Box3};for(const e of d)this.m_tileKeyEntries.set(e,new Map);for(const i of this.m_rootTileKeys){const r=i.tileKey,n=i.offset,o=this.getTileKeyEntry(r,n,e,u,c?t:void 0);if(void 0!==o)for(const e of d){this.m_tileKeyEntries.get(e).set(l.TileOffsetUtils.getKeyForTileKeyAndOffset(r,n),o)}}const m=[...this.m_rootTileKeys.values()];for(;m.length>0;){const r=m.pop();if(void 0===r)break;const n=r.tileKey,o=r.offset;if(!s.some((e,t)=>e.shouldSubdivide(i[t],n)))continue;if(this.m_enableMixedLod&&r.area<a)continue;const h=l.TileOffsetUtils.getKeyForTileKeyAndOffset(n,o);for(const e of d){if(n.level>=e)continue;this.m_tileKeyEntries.get(e).delete(h)}for(const i of e.getSubTileKeys(n)){const r=this.getTileKeyEntry(i,o,e,u,c?t:void 0);if(void 0!==r){for(const e of d){if(r.tileKey.level>e)continue;const t=l.TileOffsetUtils.getKeyForTileKeyAndOffset(i,o);this.m_tileKeyEntries.get(e).set(t,r)}m.push(r)}}}return{tileKeyEntries:this.m_tileKeyEntries,calculationFinal:u.calculationFinal}}getTileKeyEntry(e,t,i,r,n){const o=function(e,t,i){const r=e.getGeoBox(t),n=360*i;return r.northEast.longitude+=n,r.southWest.longitude+=n,r}(i,e,t);if(void 0!==n){const t=n.getElevationRange(e);o.southWest.altitude=t.minElevation,o.northEast.altitude=t.maxElevation,r.calculationFinal=r.calculationFinal&&t.calculationStatus===s.CalculationStatus.FinalPrecise}this.mapView.projection.projectBox(o,r.tileBounds);const{area:a,distance:l}=this.computeTileAreaAndDistance(r.tileBounds);if(a>0)return new d(e,a,t,o.southWest.altitude,o.northEast.altitude,l)}computeTileAreaAndDistance(e){if(e instanceof o.Box3){if(this.m_extendedFrustumCulling&&!this.m_mapTileCuller.frustumIntersectsTileBox(e)||!this.m_frustum.intersectsBox(e))return{area:0,distance:1/0}}else if(!e.intersects(this.m_frustum))return{area:0,distance:1/0};const t=e.getCenter(c[0]),i=h.set(t.x,t.y,t.z,1).applyMatrix4(this.m_viewProjectionMatrix),r=.5*e.getSize(c[1]).length()/i.w;return{area:r*r,distance:i.z/i.w}}computeRequiredInitialRootTileKeys(e){this.m_rootTileKeys=[];const t=r.TileKey.fromRowColumnLevel(0,0,0);if(!(this.mapView.projection.type===r.ProjectionType.Planar)||!this.m_tileWrappingEnabled)return void this.m_rootTileKeys.push(new d(t,1/0,0,0));const i=this.mapView.projection.unprojectPoint(e),n=Math.round(i.longitude/360),s=this.m_camera,a=l.MapViewUtils.extractAttitude(this.mapView,s).pitch,c=s.aspect>1?s.aspect:1/s.aspect,h=o.MathUtils.degToRad(s.fov*c/2)+a,u=Math.tan(h)*s.position.z-Math.tan(a)*s.position.z,m=new o.Vector3(e.x-u,e.y,e.z),p=this.mapView.projection.unprojectPoint(m),f=o.MathUtils.clamp(Math.ceil(Math.abs((i.longitude-p.longitude)/360)*Math.SQRT2),0,7);for(let e=-f+n;e<=f+n;e++)this.m_rootTileKeys.push(new d(t,1/0,e,0,0))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapTileCuller=void 0;const r=i(0);t.MapTileCuller=class{constructor(e){this.m_camera=e,this.m_globalFrustumMin=new r.Vector3,this.m_globalFrustumMax=new r.Vector3,this.m_frustumCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3]}setup(){const e=this.getFrustumCorners(),t=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const i of e)i.applyMatrix4(t),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,i.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,i.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,i.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,i.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,i.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,i.z)}frustumIntersectsTileBox(e){const t=this.m_globalFrustumMin,i=this.m_globalFrustumMax;return!(i.x<e.min.x||i.y<e.min.y||i.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)}getFrustumCorners(){const e=this.m_frustumCorners,t=this.m_camera.projectionMatrixInverse;let i=0;function r(r,n,o){e[i++].set(r,n,o).applyMatrix4(t)}return r(-1,-1,-1),r(1,-1,-1),r(-1,1,-1),r(1,1,-1),r(-1,-1,1),r(1,-1,1),r(-1,1,1),r(1,1,1),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryManager=void 0;const r=i(2),n=i(38),o=i(240);t.TileGeometryManager=class{constructor(e){this.mapView=e,this.enableFilterByKind=!0,this.enabledKinds=new r.GeometryKindSet,this.disabledKinds=new r.GeometryKindSet,this.hiddenKinds=new r.GeometryKindSet,this.m_visibilityCounter=1}get enabledGeometryKinds(){return this.enabledKinds}set enabledGeometryKinds(e){this.enabledKinds=e}get disabledGeometryKinds(){return this.disabledKinds}set disabledGeometryKinds(e){this.disabledKinds=e}get hiddenGeometryKinds(){return this.hiddenKinds}set hiddenGeometryKinds(e){this.hiddenKinds=e,this.incrementVisibilityCounter()}get visibilityCounter(){return this.m_visibilityCounter}initTile(e){e.dataSource.useGeometryLoader&&(e.tileGeometryLoader=new o.TileGeometryLoader(e))}updateTiles(e){for(const t of e){const e=t.tileGeometryLoader;void 0!==e&&(e.update(this.enableFilterByKind?this.enabledGeometryKinds:void 0,this.enableFilterByKind?this.disabledGeometryKinds:void 0),this.m_tileUpdateCallback&&this.m_tileUpdateCallback(t))}this.updateTileObjectVisibility(e)&&this.mapView.update()}clear(){this.enabledKinds.clear(),this.disabledKinds.clear(),this.hiddenKinds.clear()}enableKind(e,t=!0){this.enableDisableKinds(this.enabledKinds,e,t)}disableKind(e,t=!0){this.enableDisableKinds(this.disabledKinds,e,t)}hideKind(e,t=!0){let i=!1;if(Array.isArray(e)||e instanceof Set)for(const r of e){const e=this.addRemove(this.hiddenKinds,r,t);i=i||e}else i=this.addRemove(this.hiddenKinds,e,t);i&&this.incrementVisibilityCounter()}getAvailableKinds(e){const t=new r.GeometryKindSet;for(const i of e){const e=i.tileGeometryLoader;if(void 0!==e){const i=e.availableGeometryKinds;if(void 0!==i)for(const e of i)t.add(e)}}return t}updateTileObjectVisibility(e){let t=!1;for(const i of e)if(0!==i.objects.length&&i.visibilityCounter!==this.visibilityCounter){i.visibilityCounter=this.visibilityCounter;for(const e of i.objects){const i=n.MapObjectAdapter.get(e),r=null==i?void 0:i.kind;if(void 0!==r){const i=!r.some(e=>this.hiddenKinds.has(e));t=t||e.visible!==i,e.visible=i}}}return t}setTileUpdateCallback(e){this.m_tileUpdateCallback=e}incrementVisibilityCounter(){return++this.m_visibilityCounter}enableDisableKinds(e,t,i){if(Array.isArray(t))for(const r of t)this.addRemove(e,r,i);else if(t instanceof Set){const r=t;for(const t of r)this.addRemove(e,t,i)}else void 0!==t&&this.addRemove(e,t,i)}addRemove(e,t,i){if(i){if(!e.has(t))return e.add(t),!0}else if(e.has(t))return e.delete(t),!0;return!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryLoader=void 0;const r=i(2),n=i(1),o=i(37),s=i(54);class a{constructor(e){this.m_tile=e,this.m_isFinished=!1}static prepareAvailableGeometryKinds(e){const t=new r.GeometryKindSet;for(const i of e.techniques){const e=a.compileGeometryKind(i);if(e instanceof Set)for(const i of e)t.add(i);else t.add(e)}return t}static compileGeometryKind(e){let t=e.kind;return void 0===t?(t=r.isFillTechnique(e)?r.GeometryKind.Area:r.isLineTechnique(e)||r.isSolidLineTechnique(e)||r.isSegmentsTechnique(e)||r.isExtrudedLineTechnique(e)?r.GeometryKind.Line:r.isExtrudedPolygonTechnique(e)?r.GeometryKind.Building:r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)||r.isTextTechnique(e)?r.GeometryKind.Label:r.GeometryKind.All,e.kind=t):Array.isArray(t)&&(t=e.kind=new r.GeometryKindSet(t)),t}get tile(){return this.m_tile}get isFinished(){return this.m_isFinished}get geometryCreationPending(){return!this.isFinished&&void 0!==this.m_decodedTile}get basicGeometryLoaded(){return this.m_tile.hasGeometry}get allGeometryLoaded(){return this.m_isFinished}setDecodedTile(e){return this.m_decodedTile=e,void 0!==this.m_decodedTile&&(this.m_availableGeometryKinds=a.prepareAvailableGeometryKinds(this.m_decodedTile)),this.m_decodedTile}get availableGeometryKinds(){return this.m_availableGeometryKinds}update(e,t){var i;const r=this.tile;this.isFinished||this.discardNeedlessTile(r)||((null===(i=r.tileLoader)||void 0===i?void 0:i.isFinished)&&void 0===r.decodedTile?this.finish():(this.geometryCreationPending&&!this.compareGeometryKinds(e,t)&&this.reset(),this.geometryCreationPending||void 0===r.decodedTile||(s.TileGeometryCreator.instance.processTechniques(r,e,t),this.setGeometryKinds(e,t),this.setDecodedTile(r.decodedTile),this.prepareForRender(e,t))))}dispose(){this.m_decodedTile=void 0}reset(){var e,t,i;null===(e=this.m_availableGeometryKinds)||void 0===e||e.clear(),null===(t=this.m_enabledKinds)||void 0===t||t.clear(),null===(i=this.m_disabledKinds)||void 0===i||i.clear(),this.m_decodedTile=void 0,this.m_isFinished=!1,void 0!==this.m_timeout&&(clearTimeout(this.m_timeout),this.m_timeout=void 0)}finish(){this.m_tile.loadingFinished(),this.m_tile.removeDecodedTile(),this.m_decodedTile=void 0,this.m_isFinished=!0,void 0!==this.m_timeout&&(clearTimeout(this.m_timeout),this.m_timeout=void 0)}prepareForRender(e,t){const i=this.tile,r=this.m_decodedTile;void 0!==r?this.m_timeout=setTimeout(()=>{if(this.m_timeout=void 0,this.discardNeedlessTile(i))return;const a=o.PerformanceStatistics.instance;let l=0;a.enabled&&(l=n.PerformanceTimer.now());const c=s.TileGeometryCreator.instance;if(i.clear(),c.initDecodedTile(r,e,t),c.createAllGeometries(i,r),a.enabled){const e=n.PerformanceTimer.now()-l,t=a.currentFrame;t.addValue("render.fullFrameTime",e),t.addValue("render.geometryCreationTime",e),t.addValue("geometry.geometryCreationTime",e),t.addValue("geometryCount.numGeometries",r.geometries.length),t.addValue("geometryCount.numTechniques",r.techniques.length),t.addValue("geometryCount.numPoiGeometries",void 0!==r.poiGeometries?r.poiGeometries.length:0),t.addValue("geometryCount.numTextGeometries",void 0!==r.textGeometries?r.textGeometries.length:0),t.addValue("geometryCount.numTextPathGeometries",void 0!==r.textPathGeometries?r.textPathGeometries.length:0),t.addValue("geometryCount.numPathGeometries",void 0!==r.pathGeometries?r.pathGeometries.length:0),t.addMessage(`Decoded tile: ${i.dataSource.name} # lvl=${i.tileKey.level} col=${i.tileKey.column} row=${i.tileKey.row}`)}this.finish(),i.dataSource.requestUpdate()},0):this.finish()}discardNeedlessTile(e){if(!e.isVisible){e.mapView.visibleTileSet.disposeTile(e);const t=o.PerformanceStatistics.instance;return t.enabled&&t.currentFrame.addMessage(`Decoded tile: ${e.dataSource.name} # lvl=${e.tileKey.level} col=${e.tileKey.column} row=${e.tileKey.row} DISCARDED - invisible`),this.finish(),!0}if(e.disposed){const t=o.PerformanceStatistics.instance;return t.enabled&&t.currentFrame.addMessage(`Decoded tile: ${e.dataSource.name} # lvl=${e.tileKey.level} col=${e.tileKey.column} row=${e.tileKey.row} DISCARDED - disposed`),this.finish(),!0}return!1}setGeometryKinds(e,t){var i,n;void 0!==e&&(this.m_enabledKinds=Object.assign(null!==(i=this.m_enabledKinds)&&void 0!==i?i:new r.GeometryKindSet,e)),void 0!==t&&(this.m_disabledKinds=Object.assign(null!==(n=this.m_disabledKinds)&&void 0!==n?n:new r.GeometryKindSet,t))}compareGeometryKinds(e,t){const i=this.m_enabledKinds===e,r=this.m_disabledKinds===t;if(i&&r)return!0;const n=!(void 0!==this.m_enabledKinds&&0!==this.m_enabledKinds.size||void 0!==e&&0!==e.size),o=!(void 0!==this.m_disabledKinds&&0!==this.m_disabledKinds.size||void 0!==t&&0!==t.size);if(n&&o||i&&o||r&&n)return!0;if(!n){if(void 0===e||void 0===this.m_enabledKinds)return!1;if(!e.has(this.m_enabledKinds))return!1}if(!o){if(void 0===t||void 0===this.m_disabledKinds)return!1;if(!t.has(this.m_disabledKinds))return!1}return!0}}t.TileGeometryLoader=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickingRaycaster=void 0;const r=i(0);class n extends r.Raycaster{constructor(e,t){super(),this.width=e,this.height=t}}t.PickingRaycaster=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiRendererFactory=void 0;const r=i(105);t.PoiRendererFactory=class{constructor(e){this.m_mapView=e}createPoiRenderer(e){return new r.PoiRenderer(this.m_mapView,e)}}},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(244),t),n(i(245),t),n(i(246),t),n(i(5),t),n(i(247),t),n(i(80),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDecodedTechnique=t.StyleSetEvaluator=void 0;const r=i(1),n=i(5),o=i(97),s=i(33),a=i(77),l=i(43),c=i(34),h=r.LoggerManager.instance.create("StyleSetEvaluator"),d=a.mergeTechniqueDescriptor({});class u{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if("all"===e.op){const t=e.args.map(t=>t.accept(this,e)).filter(e=>void 0!==e);return new n.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&"$layer"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&"$geometryType"===t.name)return void(this._style._geometryType=t.value)}}return e}visitStepExpr(e,t){throw new Error("todo")}visitInterpolateExpr(e,t){throw new Error("todo")}matchVarStringComparison(e){if("=="===e.op){const t=e.args[0],i=e.args[1];if(t instanceof n.VarExpr&&i instanceof n.StringLiteralExpr)return{name:t.name,value:i.value};if(i instanceof n.VarExpr&&t instanceof n.StringLiteralExpr)return{name:i.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class m{constructor(e,t){this.key="",this.set(e,t)}set(e,t,i){let r=!1;if(void 0===e){const t=void 0!==i?i.lookup("$layer"):void 0;e="string"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,r=!0),void 0===t){const e=void 0!==i?i.lookup("$geometryType"):void 0;t="string"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,r=!0),r&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key="all",this.cachedStyleSet=void 0}}function p(e){const t={};for(const i in e){if(!e.hasOwnProperty(i))continue;let r=e[i];"object"==typeof r&&(r.isVector2||r.isVector3||r.isVector4)&&(r=n.LiteralExpr.fromValue(r)),n.Expr.isExpr(r)&&(r=r.toJSON()),t[i]=r}return t}t.StyleSetEvaluator=class{constructor(e,t){this.m_techniques=[],this.m_exprPool=new o.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new u,this.m_subStyleSetCache=new Map,this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new m,this.m_emptyEnv=new n.Env,this.m_featureDependencies=[],this.m_definitions=t,this.styleSet=function(e,t){return e.map(e=>function e(t,i){if(n.isJsonExpr(t)){if(!c.isJsonExprReference(t))throw new Error("invalid expression in this context, only 'ref's are supported");const r=t[1],n=i&&i[r];if(!n)throw new Error(`invalid reference '${r}' - not found`);if(!c.isActualSelectorDefinition(n))throw new Error(`invalid reference '${r}' - expected style definition`);return e(n,i)}return Object.assign({},t)}(e,t))}(e,t),function(e){let t=0,i=0;for(const r of e)r._styleSetIndex=i++,void 0!==r.technique&&void 0===r.renderOrder&&(r.renderOrder=t++)}(this.styleSet),this.compileStyleSet()}getMatchingTechniques(e,t,i){if(this.m_previousResult&&this.m_previousEnv&&this.m_featureDependencies.every(t=>{var i;return(null===(i=this.m_previousEnv)||void 0===i?void 0:i.lookup(t))===e.lookup(t)}))return this.m_previousResult;const r=[];this.m_cachedResults.clear();const n=this.m_tmpOptimizedSubSetKey;n.set(t,i,e),this.m_layer=n.layer,this.m_geometryType=n.geometryType,this.m_zoomLevel=e.lookup("$zoom");const o=this.getOptimizedStyleSet(n);for(const t of o)if(this.processStyle(e,t,r))break;return this.m_previousResult=r,this.m_previousEnv=e,r}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}get expressionEvaluatorCache(){return this.m_cachedResults}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0,this.m_previousResult=void 0,this.m_previousEnv=void 0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(p)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:i}=e;return this.styleSet.filter(e=>(void 0===t||void 0===e.layer||e.layer===t)&&(void 0===i||void 0===e._geometryType||e._geometryType===i))}compileStyleSet(){this.m_featureDependencies=["$layer","$geometryType","$zoom"],this.styleSet.forEach(e=>this.compileStyle(e)),this.styleSet.forEach(e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))})}compileStyle(e){if(this.checkStyleDynamicAttributes(e),void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?n.Expr.fromJSON(e.when,this.m_definitions,this.m_definitionExprCache):n.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool));const t=e._whenExpr.dependencies();null==t||t.properties.forEach(e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)}),n.isJsonExpr(e.minZoomLevel)&&(e._minZoomLevelExpr=n.Expr.fromJSON(e.minZoomLevel).intern(this.m_exprPool)),n.isJsonExpr(e.maxZoomLevel)&&(e._maxZoomLevelExpr=n.Expr.fromJSON(e.maxZoomLevel).intern(this.m_exprPool))}catch(t){h.log("failed to evaluate expression",JSON.stringify(e.when),"error",String(t))}}processStyle(e,t,i){if(!this.checkZoomLevel(e,t))return!1;if(void 0!==this.m_layer&&void 0!==t.layer&&t.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return h.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&("none"!==t.technique&&i.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){if(void 0===t.minZoomLevel&&void 0===t.maxZoomLevel)return!0;const i=this.m_zoomLevel;if(void 0===i)return!0;if(void 0!==t.minZoomLevel){let r=t.minZoomLevel;if(t._minZoomLevelExpr)try{r=t._minZoomLevelExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults)}catch(e){h.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if("number"==typeof r&&i<r)return!1}if(void 0!==t.maxZoomLevel){let r=t.maxZoomLevel;if(t._maxZoomLevelExpr)try{r=t._maxZoomLevelExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults)}catch(e){h.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if("number"==typeof r&&i>r)return!1}return!0}getTechniqueForStyleMatch(e,t){let i;if(void 0!==t._dynamicTechniques){const r=this.evaluateTechniqueProperties(t,e),n=this.getDynamicTechniqueKey(t,r);i=t._dynamicTechniques.get(n),void 0===i&&(i=this.createTechnique(t,n,r),t._dynamicTechniques.set(n,i))}else i=t._staticTechnique,void 0===i&&(t._staticTechnique=i=this.createTechnique(t,`${t._styleSetIndex}`,[]));return void 0===i._index&&(i._index=this.m_techniques.length,this.m_techniques.push(i)),i}getDynamicTechniqueKey(e,t){const i=t.map(([e,t])=>void 0===t?"U":JSON.stringify(t)).join(":");return`${e._styleSetIndex}:${i}`}checkStyleDynamicAttributes(e){var t;if(void 0!==e._dynamicTechniqueAttributes||"none"===e.technique)return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[];const i=e._dynamicFeatureAttributes,r=e._dynamicTechniqueAttributes,o=e._dynamicForwardedAttributes,c=e._staticAttributes,u=l.techniqueDescriptors[e.technique]||d,m=(t,l)=>{if(void 0!==l){if(n.isJsonExpr(l)?l=n.Expr.fromJSON(l,this.m_definitions,this.m_definitionExprCache).intern(this.m_exprPool):s.isInterpolatedPropertyDefinition(l)&&(l=n.Expr.fromJSON(s.interpolatedPropertyDefinitionToJsonExpr(l)).intern(this.m_exprPool)),n.Expr.isExpr(l)){const i=l.dependencies();i.featureState&&("enabled"!==t?h.log("feature-state is not supported in this context"):e._usesFeatureState=!0),0!==i.properties.size||l.isDynamic()||(l=l.evaluate(this.m_emptyEnv))}if(n.Expr.isExpr(l)){let e=u.attrScopes[t];void 0===e&&(e=a.AttrScope.TechniqueGeometry);const n=l.dependencies();switch(n.properties.forEach(e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)}),e){case a.AttrScope.FeatureGeometry:i.push([t,l]);break;case a.AttrScope.TechniqueGeometry:r.push([t,l]);break;case a.AttrScope.TechniqueRendering:0===n.properties.size?o.push([t,l]):r.push([t,l])}}else null!=l&&c.push([t,l])}},p=new Map([["category","_category"],["secondaryCategory","_secondaryCategory"]]);for(const i in e){if(!e.hasOwnProperty(i))continue;if(i.startsWith("_"))continue;if(["when","technique","layer","attr","description"].includes(i))continue;m(null!==(t=p.get(i))&&void 0!==t?t:i,e[i])}if(void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&m(t,e.attr[t]);r.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){return void 0===e._dynamicTechniqueAttributes?[]:e._dynamicTechniqueAttributes.map(([e,i])=>{try{return[e,i.evaluate(t,n.ExprScope.Value,this.m_cachedResults)]}catch(t){return h.error(`failed to evaluate expression '${i.toJSON()}': ${t}`),[e,null]}})}createTechnique(e,t,i){const r={};if(r.name=e.technique,void 0!==e._staticAttributes)for(const[t,i]of e._staticAttributes)null!==i&&(r[t]=i);for(const[e,t]of i)null!==t&&(r[e]=t);if(void 0!==e._dynamicFeatureAttributes)for(const[t,i]of e._dynamicFeatureAttributes)r[t]=i;if(void 0!==e._dynamicForwardedAttributes)for(const[t,i]of e._dynamicForwardedAttributes)r[t]=i;return r._index=this.m_techniques.length,r._styleSetIndex=e._styleSetIndex,void 0!==e.styleSet&&(r._styleSet=e.styleSet),void 0!==e._usesFeatureState&&(r._usesFeatureState=e._usesFeatureState),this.m_techniques.push(r),r}},t.makeDecodedTechnique=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addPolygonEdges=void 0;const r=i(0),n=new r.Vector2,o=new r.Vector2,s=new r.Vector2,a=new r.Vector2;t.addPolygonEdges=function(e,t,i,r,l,c,h,d){for(let u=0;u<l.length;++u)if(l[u])if(!0===c){const c=t+2*u,m=c+1,p=t+(u+1)%l.length*2,f=p+1;!0===h&&e.push(c,p),e.push(m,f);const g=(0===u?l.length:u)-1;if(l[g])if(void 0!==d){const t=r[u*i],h=r[u*i+1],p=r[(u+1)%l.length*i],f=r[(u+1)%l.length*i+1];n.set(t,h),o.set(p,f),s.set(r[g*i],r[g*i+1]),a.set(n.x,n.y),a.sub(s).normalize().dot(o.sub(n).normalize())<=d&&e.push(c,m)}else e.push(c,m)}else{const i=t+u,r=t+(u+1)%l.length;e.push(i,r)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThreeBufferUtils=void 0;const r=i(79);!function(e){function t(e){if(e instanceof Int8Array)return"int8";if(e instanceof Uint8Array)return"uint8";if(e instanceof Int16Array)return"int16";if(e instanceof Uint16Array)return"uint16";if(e instanceof Int32Array)return"int32";if(e instanceof Uint32Array)return"uint32";if(e instanceof Float32Array)return"float";throw new Error(`Unsupported buffer type ${name}`)}function i(e){const i=e.array;return{name:e.name,buffer:i.buffer,type:t(i),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=i,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error("Not implemented yet")},e.fromThreeBufferGeometry=function(e,t){const n=[],o=Object.getOwnPropertyNames(e.attributes);for(const t of o){const r=i(e.attributes[t]);r.name=t,n.push(r)}const s=null!==e.index?i(e.index):void 0;let a=0;if(void 0!==s)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error("Missing position attibute to deduce item count");a=t.count}return{type:r.GeometryType.Unspecified,vertexAttributes:n,index:s,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenProjector=void 0;const r=i(0);function n(e){return e.z>-1&&e.z<1&&e.x>=-1&&e.x<=1&&e.y>=-1&&e.y<=1}let o=(()=>{class e{constructor(e){this.m_camera=e,this.m_width=0,this.m_height=0}get width(){return this.m_width}get height(){return this.m_height}project(t,i=new r.Vector2){const n=this.projectVector(t,e.tempV3);if(n.z>-1&&n.z<1)return this.ndcToScreen(n,i)}projectOnScreen(t,i=new r.Vector2){const o=this.projectVector(t,e.tempV3);if(n(o))return this.ndcToScreen(o,i)}project3(t,i=new r.Vector3){const n=this.projectVector(t,e.tempV3);if(n.z>-1&&n.z<1)return i.set(n.x*this.m_width/2,n.y*this.m_height/2,n.z),i}projectVector(e,t){return t.set(e.x,e.y,e.z).project(this.m_camera),t}onScreen(t){return n(this.projectVector(t,e.tempV3))}update(e,t,i){this.m_camera=e,this.m_width=t,this.m_height=i}ndcToScreen(e,t){return t.set(e.x*this.m_width/2,e.y*this.m_height/2)}}return e.tempV2=new r.Vector2,e.tempV3=new r.Vector3,e})();t.ScreenProjector=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBackground=void 0;const r=i(118),n=i(250);t.SkyBackground=class{constructor(e,t,i){switch(this.m_sky=e,this.m_projectionType=t,this.m_sky.type){case"gradient":this.m_skyTexture=new n.SkyGradientTexture(this.m_sky,this.m_projectionType),this.updateCamera(i);break;case"cubemap":this.m_skyTexture=new r.SkyCubemapTexture(this.m_sky)}}dispose(){this.m_skyTexture.dispose()}get texture(){return this.m_skyTexture.texture}updateCamera(e){"gradient"===this.m_sky.type&&this.m_skyTexture.update(e)}updateTexture(e,t){const i=this.m_sky.type===e.type&&this.m_projectionType===t;switch(e.type){case"gradient":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new n.SkyGradientTexture(e,t);break;case"cubemap":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new r.SkyCubemapTexture(e)}this.m_projectionType=t,this.m_sky=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyGradientTexture=t.DEFAULT_MONOMIAL_POWER=t.DEFAULT_TEXTURE_SIZE=void 0;const r=i(3),n=i(1),o=i(0);t.DEFAULT_TEXTURE_SIZE=512,t.DEFAULT_MONOMIAL_POWER=1;const s=[new o.Vector3(1,0,0),new o.Vector3(-1,0,0),new o.Vector3(0,-1,0),new o.Vector3(0,1,0),new o.Vector3(0,0,1),new o.Vector3(0,0,-1)],a=[new o.Vector3(0,0,-1),new o.Vector3(0,0,1),new o.Vector3(1,0,0),new o.Vector3(1,0,0),new o.Vector3(1,0,0),new o.Vector3(-1,0,0)],l=[new o.Vector3(0,1,0),new o.Vector3(0,1,0),new o.Vector3(0,0,1),new o.Vector3(0,0,-1),new o.Vector3(0,1,0),new o.Vector3(0,1,0)];t.SkyGradientTexture=class{constructor(e,i,n=t.DEFAULT_TEXTURE_SIZE){this.m_projectionType=i,this.m_height=n;const s=new o.Color(e.topColor),a=new o.Color(e.bottomColor),l=new o.Color(e.groundColor);this.m_width=this.m_projectionType===r.ProjectionType.Planar?1:this.m_height,this.m_faceCount=this.m_projectionType===r.ProjectionType.Planar?1:6,this.m_faces=[];for(let t=0;t<this.m_faceCount;++t){const i=new Uint8Array(3*this.m_width*this.m_height);this.fillTextureData(i,t,s,a,l,e.monomialPower);const r=new o.DataTexture(i,this.m_width,this.m_height,o.RGBFormat);r.needsUpdate=!0,r.unpackAlignment=1,this.m_faces.push(r)}this.m_projectionType===r.ProjectionType.Spherical?(this.m_skybox=new o.CubeTexture(this.m_faces),this.m_skybox.needsUpdate=!0):(this.m_farClipPlaneDividedVertically=new o.Line3,this.m_groundPlane=new o.Plane(new o.Vector3(0,0,1)),this.m_bottomMidFarPoint=new o.Vector3,this.m_topMidFarPoint=new o.Vector3,this.m_horizonPosition=new o.Vector3,this.m_farClipPlaneCorners=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3])}dispose(){for(let e=0;e<this.m_faceCount;++e)this.m_faces[e].dispose();this.m_projectionType===r.ProjectionType.Spherical&&this.m_skybox.dispose()}get texture(){return this.m_projectionType===r.ProjectionType.Planar?this.m_faces[0]:this.m_skybox}update(e){this.m_projectionType===r.ProjectionType.Planar&&(this.setHorizonPosition(e),this.updateTexturePosition())}updateTexture(e){for(let t=0;t<this.m_faceCount;++t)this.fillTextureData(this.m_faces[t].image.data,t,new o.Color(e.topColor),new o.Color(e.bottomColor),new o.Color(e.groundColor),e.monomialPower),this.m_faces[t].needsUpdate=!0;this.m_projectionType===r.ProjectionType.Spherical&&(this.m_skybox.needsUpdate=!0)}fillTextureData(e,i,c,h,d,u){const m=new o.Color,p=new o.Vector3,f=new o.Vector3,g=new o.Vector3,v=new o.Vector3(0,0,1);for(let o=0;o<this.m_height;++o)for(let y=0;y<this.m_width;++y){if(this.m_projectionType===r.ProjectionType.Spherical){const e=f.copy(a[i]).multiplyScalar((y+.5)/this.m_width*2-1),r=g.copy(l[i]).multiplyScalar((o+.5)/this.m_height*2-1);p.copy(s[i]).add(e).add(r).normalize();const _=Math.max(v.dot(p),0);m.copy(d).lerp(h,Math.min(100*_,1)).lerp(c,_**n.getOptionValue(u,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}else{const e=o/this.m_height;0===o?m.copy(d).multiplyScalar(255):m.copy(h).lerp(c,e**n.getOptionValue(u,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}e[o*this.m_width*3+3*y]=m.r,e[o*this.m_width*3+3*y+1]=m.g,e[o*this.m_width*3+3*y+2]=m.b}}setHorizonPosition(e){this.m_farClipPlaneCorners[0].set(-1,-1,1).unproject(e),this.m_farClipPlaneCorners[1].set(1,-1,1).unproject(e),this.m_farClipPlaneCorners[2].set(-1,1,1).unproject(e),this.m_farClipPlaneCorners[3].set(1,1,1).unproject(e),this.m_bottomMidFarPoint.copy(this.m_farClipPlaneCorners[0]).add(this.m_farClipPlaneCorners[1]).multiplyScalar(.5),this.m_topMidFarPoint.copy(this.m_farClipPlaneCorners[2]).add(this.m_farClipPlaneCorners[3]).multiplyScalar(.5),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint),this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)}updateTexturePosition(){const e=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance(),t=0===this.m_horizonPosition.length()?1:e-2/this.m_height;this.m_faces[0].offset.set(0,this.m_bottomMidFarPoint.z<=0?-t:e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FontCatalogLoader=t.DEFAULT_FONT_CATALOG_NAME=void 0;const r=i(6),n=i(1);t.DEFAULT_FONT_CATALOG_NAME="default";const o=n.LoggerManager.instance.create("FontCatalogLoader");t.FontCatalogLoader=class{constructor(e){this.m_theme=e,this.m_catalogsLoading=0}initialize(e){if(void 0===this.m_theme.fontCatalogs||0===this.m_theme.fontCatalogs.length)return this.m_theme.fontCatalogs=[{name:t.DEFAULT_FONT_CATALOG_NAME,url:e}],t.DEFAULT_FONT_CATALOG_NAME;return this.m_theme.fontCatalogs[0].name}async loadCatalogs(e){n.assert(void 0!==this.m_theme.fontCatalogs),n.assert(this.m_theme.fontCatalogs.length>0);const t=[];return this.m_theme.fontCatalogs.forEach(i=>{this.m_catalogsLoading+=1;const n=r.FontCatalog.load(i.url,1024).then(e.bind(void 0,i.name)).catch(e=>{o.error("Failed to load FontCatalog: ",e)}).finally(()=>{this.m_catalogsLoading-=1});t.push(n)}),Promise.all(t)}get loading(){return this.m_catalogsLoading>0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewState=void 0;const r=i(0);t.MapViewState=class{constructor(e,t){this.m_mapView=e,this.m_renderedTilesChangeCheck=t,this.m_lookAtVector=new r.Vector3}get worldCenter(){return this.m_mapView.worldCenter}get cameraIsMoving(){return this.m_mapView.cameraIsMoving}get maxVisibilityDist(){return this.m_mapView.viewRanges.maximum}get zoomLevel(){return this.m_mapView.zoomLevel}get env(){return this.m_mapView.env}get frameNumber(){return this.m_mapView.frameNumber}get lookAtVector(){return this.m_mapView.camera.getWorldDirection(this.m_lookAtVector)}get lookAtDistance(){return this.m_mapView.targetDistance}get isDynamic(){return this.m_mapView.isDynamicFrame}get hiddenGeometryKinds(){return void 0===this.m_mapView.tileGeometryManager?void 0:this.m_mapView.tileGeometryManager.hiddenGeometryKinds}get renderedTilesChanged(){return this.m_renderedTilesChangeCheck()}get projection(){return this.m_mapView.projection}get elevationProvider(){return this.m_mapView.elevationProvider}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvasFactory=void 0;const r=i(6),n=i(1);t.TextCanvasFactory=class{constructor(e){this.m_renderer=e,this.m_minGlyphCount=0,this.m_maxGlyphCount=0}setGlyphCountLimits(e,t){this.m_minGlyphCount=e,this.m_maxGlyphCount=t}createTextCanvas(e){return n.assert(this.m_maxGlyphCount>0),new r.TextCanvas({renderer:this.m_renderer,fontCatalog:e,minGlyphCount:this.m_minGlyphCount,maxGlyphCount:this.m_maxGlyphCount})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlCopyrightProvider=void 0;const r=i(122),n=i(121);class o extends n.CopyrightCoverageProvider{constructor(e,t,i,n=r.TransferManager.instance()){super(),this.m_fetchURL=e,this.m_baseScheme=t,this.m_requestHeaders=i,this.m_transferManager=n}setRequestHeaders(e){this.m_requestHeaders=e}getCopyrightCoverageData(){return void 0!==this.m_cachedCopyrightResponse||(this.m_cachedCopyrightResponse=this.m_transferManager.downloadJson(this.m_fetchURL,{headers:this.m_requestHeaders}).then(e=>e[this.m_baseScheme]).catch(e=>(this.logger.error(e),[]))),this.m_cachedCopyrightResponse}}t.UrlCopyrightProvider=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransferManager=void 0,i(11);const r=i(257);let n=(()=>{class e{constructor(e=fetch,t=5){this.fetchFunction=e,this.maxRetries=t,this.activeDownloadCount=0,this.downloadQueue=new Array,this.activeDownloads=new Map}static instance(){return e.defaultInstance}static async fetchRepeatedly(t,i,r,n,o){try{const e=await t(n,o);if(503!==e.status||i>r)return e}catch(e){if(e.hasOwnProperty("isCancelled")||e.hasOwnProperty("name")&&"AbortError"===e.name||i>r)throw e}return e.waitFor(e.retryTimeout*i).then(()=>e.fetchRepeatedly(t,r,i+1,n,o))}static waitFor(e){return new Promise(t=>setTimeout(t,e))}downloadJson(e,t){return this.downloadAs(e=>e.json(),e,t)}downloadArrayBuffer(e,t){return this.download(e,t).then(e=>e.arrayBuffer())}download(t,i){if(this.activeDownloadCount>=e.maxParallelDownloads){const e=new r.DeferredPromise(()=>this.doDownload(t,i));return this.downloadQueue.push(e),e.promise}return this.doDownload(t,i)}async doDownload(t,i){try{++this.activeDownloadCount;const r=await e.fetchRepeatedly(this.fetchFunction,0,this.maxRetries,t,i);return this.onDownloadDone(),r}catch(e){throw this.onDownloadDone(),e}}onDownloadDone(){--this.activeDownloadCount,this.execDeferredDownload()}execDeferredDownload(){const e=this.downloadQueue.pop();void 0!==e&&e.exec()}downloadAs(e,t,i){const r=t,n=this.activeDownloads.get(r);if(void 0!==n)return Promise.resolve(n);const o=this.download(t,i).then(t=>{if(this.activeDownloads.delete(r),t.ok)return e(t);throw new Error(JSON.stringify(t))}).catch(e=>{throw this.activeDownloads.delete(r),e});return this.activeDownloads.set(r,o),o}}return e.retryTimeout=500,e.maxParallelDownloads=16,e.defaultInstance=new e,e})();t.TransferManager=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredPromise=void 0;t.DeferredPromise=class{constructor(e){this.executor=e,this.promise=new Promise((e,t)=>{this.resolveFunc=e,this.rejectFunc=t})}exec(){this.executor().then(e=>this.resolveFunc(e)).catch(e=>this.rejectFunc(e))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageItem=void 0,function(e){e.isLoading=function(e){return void 0!==e.loadingPromise}}(t.ImageItem||(t.ImageItem={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewAtmosphere=t.AtmosphereLightMode=void 0;const r=i(3),n=i(4),o=i(1),s=i(0),a=i(49);var l,c,h;!function(e){e[e.Ground=1]="Ground",e[e.Sky=2]="Sky",e[e.SkyAndGround=3]="SkyAndGround"}(l||(l={})),function(e){e[e.ScatteringShader=0]="ScatteringShader",e[e.SimpleColor=1]="SimpleColor",e[e.Wireframe=2]="Wireframe"}(c||(c={})),function(e){e[e.LightOverhead=0]="LightOverhead",e[e.LightDynamic=1]="LightDynamic"}(h=t.AtmosphereLightMode||(t.AtmosphereLightMode={}));const d={clipPlanes:{near:0,far:0}};let u=(()=>{class e{constructor(e,t,i,n,o=l.SkyAndGround,h=c.ScatteringShader){this.m_mapAnchors=e,this.m_sceneCamera=t,this.m_projection=i,this.m_updateCallback=n,this.m_atmosphereVariant=o,this.m_materialVariant=h,this.m_enabled=!0,this.m_clipPlanesEvaluator=new a.TiltViewClipPlanesEvaluator(.025*r.EarthConstants.EQUATORIAL_RADIUS,0,1,.05,1e7),this.m_lightDirection=new s.Vector3(0,1,0),this.m_atmosphereVariant&l.Sky&&this.createSkyGeometry(),this.m_atmosphereVariant&l.Ground&&this.createGroundGeometry(),this.addToMapAnchors(this.m_mapAnchors)}static isPresent(t){for(const i of t.children)if(i.name===e.SkyAtmosphereUserName||i.name===e.GroundAtmosphereUserName)return!0;return!1}get skyMesh(){return this.m_skyMesh}get groundMesh(){return this.m_groundMesh}set enabled(t){if(this.disposed)return;if(this.m_enabled===t)return;this.m_enabled=t;const i=e.isPresent(this.m_mapAnchors);t&&!i?this.addToMapAnchors(this.m_mapAnchors):!t&&i&&this.removeFromMapAnchors(this.m_mapAnchors)}get enabled(){return this.m_enabled}set lightMode(e){if(this.m_materialVariant!==c.ScatteringShader)return;const t=e===h.LightDynamic;if(void 0!==this.m_groundMaterial){this.m_groundMaterial.setDynamicLighting(t)}if(void 0!==this.m_skyMaterial){this.m_skyMaterial.setDynamicLighting(t)}}dispose(){var e,t,i,r;this.enabled&&(this.enabled=!1),null===(e=this.m_skyMaterial)||void 0===e||e.dispose(),null===(t=this.m_groundMaterial)||void 0===t||t.dispose(),null===(i=this.m_skyGeometry)||void 0===i||i.dispose(),null===(r=this.m_groundGeometry)||void 0===r||r.dispose(),this.m_skyGeometry=void 0,this.m_groundGeometry=void 0,this.m_skyMaterial=void 0,this.m_groundMaterial=void 0,this.m_skyMesh=void 0,this.m_groundMesh=void 0}reset(e){}get disposed(){return void 0===this.m_skyMesh&&void 0===this.m_groundMesh}addToMapAnchors(t){o.assert(!e.isPresent(t),"Atmosphere already added"),void 0!==this.m_skyMesh&&t.add(m(this.m_skyMesh,Number.MIN_SAFE_INTEGER)),void 0!==this.m_groundMesh&&t.add(m(this.m_groundMesh,Number.MAX_SAFE_INTEGER)),this.m_updateCallback&&this.m_updateCallback()}removeFromMapAnchors(t){if(!e.isPresent(t))return;let i=!1;void 0!==this.m_skyMesh&&(t.remove(this.m_skyMesh),i=!0),void 0!==this.m_groundMesh&&(t.remove(this.m_groundMesh),i=!0),i&&this.m_updateCallback&&this.m_updateCallback()}createSkyGeometry(){let t;switch(this.m_projection.type){case r.ProjectionType.Spherical:t=new s.SphereGeometry(1.025*r.EarthConstants.EQUATORIAL_RADIUS,256,256);break;default:t=new s.PlaneGeometry(200,200)}t.translate(0,0,0),this.m_skyGeometry=new s.BufferGeometry,this.m_skyGeometry.fromGeometry(t),t.dispose(),this.m_materialVariant===c.ScatteringShader?this.m_skyMaterial=new n.SkyAtmosphereMaterial:this.m_materialVariant===c.SimpleColor?this.m_skyMaterial=new s.MeshBasicMaterial({color:new s.Color(12908781),opacity:.4,transparent:!1,depthTest:!0,depthWrite:!1,side:s.BackSide,blending:s.NormalBlending,fog:!1}):this.m_skyMaterial=new s.MeshStandardMaterial({color:8388607,depthTest:!1,depthWrite:!1,normalScale:new s.Vector2(-1,-1),side:s.BackSide,wireframe:!0}),this.m_skyMesh=new s.Mesh(this.m_skyGeometry,this.m_skyMaterial),this.m_skyMesh.name=e.SkyAtmosphereUserName,this.setupSkyForRendering()}createGroundGeometry(){let t;switch(this.m_projection.type){case r.ProjectionType.Spherical:t=new s.SphereGeometry(1.0001*r.EarthConstants.EQUATORIAL_RADIUS,256,256);break;default:t=new s.PlaneGeometry(200,200)}t.translate(0,0,0),this.m_groundGeometry=new s.BufferGeometry,this.m_groundGeometry.fromGeometry(t),t.dispose(),this.m_materialVariant===c.ScatteringShader?this.m_groundMaterial=new n.GroundAtmosphereMaterial:this.m_materialVariant===c.SimpleColor?this.m_groundMaterial=new s.MeshBasicMaterial({color:new s.Color(50687),opacity:.4,transparent:!0,depthTest:!1,depthWrite:!1,side:s.FrontSide,blending:s.NormalBlending,fog:!1}):this.m_groundMaterial=new s.MeshStandardMaterial({color:1149338,depthTest:!0,depthWrite:!1,side:s.FrontSide,wireframe:!0}),this.m_groundMesh=new s.Mesh(this.m_groundGeometry,this.m_groundMaterial),this.m_groundMesh.name=e.GroundAtmosphereUserName,this.setupGroundForRendering()}setupSkyForRendering(){if(void 0===this.m_skyMesh)return;let e;e=this.m_materialVariant!==c.ScatteringShader?(e,t)=>{this.overrideClipPlanes(e)}:(e,t)=>{this.overrideClipPlanes(e),o.assert(t instanceof n.SkyAtmosphereMaterial);const i=this.m_skyMaterial;i.updateUniforms(i,this.m_skyMesh,e,this.m_lightDirection)},o.assert(void 0!==this.m_skyMaterial),this.m_skyMesh.onBeforeRender=(t,i,r,n,o,s)=>{e(r,o)},this.m_skyMesh.onAfterRender=(e,t,i,r,n,o)=>{this.revertClipPlanes(i)}}setupGroundForRendering(){void 0!==this.m_groundMesh&&this.m_materialVariant===c.ScatteringShader&&(o.assert(void 0!==this.m_groundMaterial),this.m_groundMesh.onBeforeRender=(e,t,i,r,s,a)=>{o.assert(s instanceof n.GroundAtmosphereMaterial);const l=this.m_groundMaterial;l.updateUniforms(l,this.m_groundMesh,i,this.m_lightDirection)})}overrideClipPlanes(e){const t=this.m_sceneCamera;d.clipPlanes.near=t.near,d.clipPlanes.far=t.far;const i=this.m_clipPlanesEvaluator.evaluateClipPlanes(this.m_sceneCamera,this.m_projection);o.assert(e instanceof s.PerspectiveCamera);const n=e;n.near=i.near,n.far=i.far+.1*r.EarthConstants.EQUATORIAL_RADIUS,n.updateProjectionMatrix()}revertClipPlanes(e){o.assert(e instanceof s.PerspectiveCamera);const t=e;t.near=d.clipPlanes.near,t.far=d.clipPlanes.far,t.updateProjectionMatrix()}}return e.SkyAtmosphereUserName="SkyAtmosphere",e.GroundAtmosphereUserName="GroundAtmosphere",e})();function m(e,t){const i=e;return i.renderOrder=t,i.pickable=!1,i.anchor=new s.Vector3(0,0,0),i}t.MapViewAtmosphere=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageOrigin=void 0,function(e){e[e.TopLeft=0]="TopLeft",e[e.BottomLeft=1]="BottomLeft"}(t.ImageOrigin||(t.ImageOrigin={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLoader=void 0;const r=i(0);t.TextureLoader=class{constructor(){this.m_textureLoader=new r.TextureLoader}async load(e,t,i=!0){if(void 0===t)return this.loadWithThreeLoader(e);const n=await fetch(e,{headers:t,mode:i?"cors":"no-cors"}),o=await n.blob(),s=await this.loadWithThreeLoader(URL.createObjectURL(o)),a="image/jpeg/"===o.type||e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);return s.format=a?r.RGBFormat:r.RGBAFormat,s}loadWithThreeLoader(e){return new Promise((t,i)=>{this.m_textureLoader.setCrossOrigin(""),this.m_textureLoader.load(e,e=>t(e),void 0,()=>i(new Error("failed to load texture")))})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataAccessor=void 0;const r=i(2),n=i(1),o=i(123),s=n.LoggerManager.instance.create("TileDataAccessor");t.TileDataAccessor=class{constructor(e,t,i){this.tile=e,this.visitor=t,this.m_wantsPoints=!0,this.m_wantsLines=!0,this.m_wantsAreas=!0,this.m_wantsObject3D=!0;const r=!0===i.wantsAll;this.m_wantsPoints=r||!(!1===i.wantsPoints),this.m_wantsLines=r||!(!1===i.wantsLines),this.m_wantsAreas=r||!(!1===i.wantsAreas),this.m_wantsObject3D=r||!(!1===i.wantsObject3D)}visitAll(){const e=this.tile.objects;for(const t of e)this.visitObject(t)}visitObject(e){const t=void 0!==e.userData?e.userData.feature:void 0;if(void 0===t||void 0!==t.objInfos&&1===t.objInfos.length&&!this.visitor.wantsFeature(r.getFeatureId(t.objInfos[0])))return;const i=t.geometryType;if(void 0===i)return void s.warn("#visitObject: visiting object failed, no geometryType",e);switch(n.assert(void 0!==t.objInfos,"featureData.ids missing"),n.assert(void 0!==t.starts,"featureData.starts missing"),n.assert(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.objInfos&&void 0!==t.starts&&n.assert(t.objInfos.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),i){case r.GeometryType.Point:case r.GeometryType.Text:if(!this.m_wantsPoints)return;break;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case r.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:s.warn("#visitObject: invalid geometryType")}if("Mesh"!==e.type)return void s.warn("#visitObject: visiting object failed, not of type 'Mesh'",e);const o=e;this.visitMesh(o,t)}getBufferGeometry(e){const t=e.geometry;if("BufferGeometry"!==t.type)return void s.warn("#visitObject: object does not have BufferGeometry");const i=t;if(i.getAttribute("position"))return i;s.warn("#visitLines: BufferGeometry has no position attribute")}getGeometryAccessor(e,t,i){switch(e){case r.GeometryType.Point:case r.GeometryType.Text:return;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:return new o.BufferedGeometryLineAccessor(t,e,i);case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:return;case r.GeometryType.Object3D:return new o.BufferedGeometryObject3dAccessor(t,e,i);default:s.warn("#getGeometryAccessor: invalid geometryType")}}getIndexedGeometryAccessor(e,t,i){switch(e){case r.GeometryType.Point:case r.GeometryType.Text:return;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:return new o.IndexedBufferedGeometryLineAccessor(t,e,i);case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:case r.GeometryType.Object3D:return;default:s.warn("#getIndexedGeometryAccessor: invalid geometryType")}}visitMesh(e,t){const{objInfos:i,starts:a}=t,l=t.geometryType;if(void 0===i||void 0===a||void 0===l)return;let c;for(let t=0;t<i.length;t++){const h=r.getFeatureId(i[t]);if(!this.visitor.wantsFeature(h))continue;const d=a[t];let u=-1;if(void 0===c){const t=this.getBufferGeometry(e);if(void 0===t)continue;if(c=null!==t.index?this.getIndexedGeometryAccessor(l,e,t):this.getGeometryAccessor(l,e,t),void 0===c){s.warn("#visitObject: no accessor geometryType",l);continue}}switch(u=t<a.length-1?a[t+1]:c.getCount(),c.setRange(d,u),l){case r.GeometryType.Point:case r.GeometryType.Text:this.visitor.visitPoint(h);break;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:n.assert(o.isLineAccessor(c)),this.visitor.visitLine(h,c);break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:this.visitor.visitArea(h);break;case r.GeometryType.Object3D:n.assert(o.isObject3dAccessor(c)),this.visitor.visitObject3D(h,c);break;default:s.warn("#visitObject: invalid geometryType")}}}}},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(266),t),n(i(124),t),n(i(125),t),n(i(60),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineGroup=t.createSimpleLineGeometry=t.createLineGeometry=t.LineGeometry=void 0;const r=i(1),n=i(0),o=new n.Vector3,s=new n.Vector3,a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h={attributes:[{name:"extrusionCoord",itemSize:3,offset:0},{name:"position",itemSize:3,offset:3},{name:"tangent",itemSize:3,offset:6},{name:"bitangent",itemSize:4,offset:9}],stride:13},d={attributes:[{name:"uv",itemSize:2,offset:h.stride},{name:"normal",itemSize:3,offset:h.stride+2}],stride:5},u={attributes:[...h.attributes,...d.attributes],stride:h.stride+d.stride},m={attributes:[{name:"extrusionCoord",itemSize:2,offset:0},{name:"position",itemSize:3,offset:2},{name:"positionLow",itemSize:3,offset:5},{name:"tangent",itemSize:3,offset:8},{name:"bitangent",itemSize:4,offset:11}],stride:15},p={attributes:[...m.attributes,...d.attributes],stride:m.stride+d.stride};class f{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function g(e,t){return t?e?p:m:e?u:h}function v(e,t,i,n,h,d,u=new f,m=!1){if(0===t.length)return u;const p=g(void 0!==h,m).stride,v=t.length/3,y=new Array(v),_=new Array(t.length-3),x=u.vertices.length/p,S=void 0!==n&&n.length>0,b=void 0!==h&&h.length>0,T=void 0!==d&&d.length&&t.length;r.assert(!S||n.length===v),r.assert(!b||h.length/2===v),r.assert(!T||d.length===t.length);let w=.1;y[0]=w;for(let e=0;e<v-1;++e){let i=0;for(let r=0;r<3;++r){const n=t[3*(e+1)+r]-t[3*e+r];_[3*e+r]=n,i+=n*n}w+=Math.sqrt(i),y[e+1]=w}const M=S?Math.abs(n[n.length-1]-n[0]):1,E=y[y.length-1]/M;if(S)for(let e=0;e<v;++e)y[e]=n[e]*E+.1;let P=!0;for(let e=0;e<3;++e)P=P&&t[e]===t[t.length-3+e];const C=[],A=(r,n,p,f,g)=>{C.length=0,u.vertices.push(f,-1*g,E),C.push(f,1*g,E);for(let e=0;e<3;++e){if(m){const i=Math.fround(t[3*r+e]),n=t[3*r+e]-i;u.vertices.push(i,n),C.push(i,n)}else u.vertices.push(t[3*r+e]),C.push(t[3*r+e]);s.setComponent(e,t[3*r+e])}for(let e=0;e<3;++e)a.setComponent(e,_[n+e]),l.setComponent(e,_[p+e]);a.normalize(),u.vertices.push(a.x,a.y,a.z),C.push(a.x,a.y,a.z),s.add(e),i.surfaceNormal(s,s);const v=function(e,t,i,r){let n=0;t.equals(i)||(n=Math.acos(t.dot(i))*Math.sign(e.dot(o.copy(t).cross(i))),Number.isNaN(n)&&(n=0));return r.copy(t).add(i).normalize().cross(e).normalize(),n}(s,a,l.normalize(),c);u.vertices.push(c.x,c.y,c.z,v),C.push(c.x,c.y,c.z,v),b&&(u.vertices.push(h[2*r],h[2*r+1]),C.push(h[2*r],h[2*r+1]),u.vertices.push(s.x,s.y,s.z),C.push(s.x,s.y,s.z)),u.vertices.push(...C),T&&(u.vertexColors.push(d[3*r],d[3*r+1],d[3*r+2]),u.vertexColors.push(d[3*r],d[3*r+1],d[3*r+2]))};for(let e=0;e<v;++e){const t=P&&0===e?_.length-3:3*Math.max(0,e-1),i=P&&e===v-1?0:Math.min(3*e,_.length-3);e>0&&A(e,t,i,y[e-1],y[e]),e+1<v&&A(e,t,i,-1*y[Math.min(e,y.length-1)],y[Math.min(e+1,y.length-1)])}for(let e=0;e<v-1;++e){const t=x+4*e;u.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return u}function y(e,t,i=new f){if(0===e.length)return i;const r=e.length/3;let n=i.vertices.length/3;const o=void 0!==t&&t.length&&e.length;for(let s=0;s<r;++s,n++){s>0&&i.indices.push(n),s<r-1&&i.indices.push(n);for(let r=0;r<3;++r)i.vertices.push(e[3*s+r]),o&&i.vertexColors.push(t[3*s+r])}return i}t.LineGeometry=f,t.createLineGeometry=v,t.createSimpleLineGeometry=y;class _{constructor(e=!1,t=!1,i=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=i,this.m_geometry=new f}static createGeometry(e,t,i,r,o=!1,s=!1,a=!1){if(a)return r.setAttribute("position",new n.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r;{const a=g(o,s),l=new n.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach(e=>{const t=new n.InterleavedBufferAttribute(l,e.itemSize,e.offset,!1);r.setAttribute(e.name,t)}),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r}}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,i,n,o,s){return this.isSimple?y(t,s,this.m_geometry):(r.assert(!this.hasNormalsAndUvs||void 0!==o),v(e,t,i,n,o,s,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return g(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return g(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new n.BufferGeometry),_.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionPoints=void 0;const r=i(0),n=i(4),o=i(60);class s extends r.Points{constructor(e,t,i,o,s){void 0===t&&(t=new n.HighPrecisionPointMaterial({color:o||n.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:1})),super(void 0===e?new r.BufferGeometry:e,t),this.matrixWorldInverse=new r.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}clearGeometry(){return this.geometry=new r.BufferGeometry}get shaderMaterial(){return this.material}setPositions(e){o.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=(e,t,i,r,n,s)=>{o.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.getInverse(this.matrixWorld)}}t.HighPrecisionPoints=s},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(269),t),n(i(270),t),n(i(61),t),n(i(62),t),n(i(274),t),n(i(127),t),n(i(275),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvGenericFeatureModifier=t.ComposedDataFilter=t.OmvGenericFeatureFilter=t.OmvFeatureFilterDescriptionBuilder=void 0;const r=i(2),n=i(61);t.OmvFeatureFilterDescriptionBuilder=class{constructor(e){this.m_processLayersDefault=!0,this.m_processPointsDefault=!0,this.m_processLinesDefault=!0,this.m_processPolygonsDefault=!0,this.m_layersToProcess=new Array,this.m_layersToIgnore=new Array,this.m_pointsToProcess=new Array,this.m_ignoredPoints=new Array,this.m_linesToProcess=new Array,this.m_linesToIgnore=new Array,this.m_polygonsToProcess=new Array,this.m_polygonsToIgnore=new Array,this.m_kindsToProcess=[],this.m_kindsToIgnore=[],e&&(this.m_processLayersDefault=void 0===e.processLayersDefault||e.processLayersDefault,this.m_processPointsDefault=void 0===e.processPointsDefault||e.processPointsDefault,this.m_processLinesDefault=void 0===e.processLinesDefault||e.processLinesDefault,this.m_processPolygonsDefault=void 0===e.processPolygonsDefault||e.processPolygonsDefault)}processLayer(e,t=n.OmvFilterString.StringMatch.Match,i=0,r=1/0){this.m_layersToProcess.push({name:{value:e,match:t},minLevel:i,maxLevel:r})}ignoreLayer(e,t=n.OmvFilterString.StringMatch.Match,i=0,r=1/0){this.m_layersToIgnore.push({name:{value:e,match:t},minLevel:i,maxLevel:r})}processPoint(e){this.addItem(this.m_pointsToProcess,e)}processPoints(e){this.addItems(this.m_pointsToProcess,e)}ignorePoint(e){this.addItem(this.m_ignoredPoints,e)}ignorePoints(e){this.addItems(this.m_ignoredPoints,e)}processLine(e){this.addItem(this.m_linesToProcess,e)}processLines(e){this.addItems(this.m_linesToProcess,e)}ignoreLine(e){this.addItem(this.m_linesToIgnore,e)}ignoreLines(e){this.addItems(this.m_linesToIgnore,e)}processPolygon(e){this.addItem(this.m_polygonsToProcess,e)}processPolygons(e){this.addItems(this.m_polygonsToProcess,e)}ignorePolygon(e){this.addItem(this.m_polygonsToIgnore,e)}ignorePolygons(e){this.addItems(this.m_polygonsToIgnore,e)}processKinds(e){this.m_kindsToProcess=this.m_kindsToProcess.concat(e)}ignoreKinds(e){this.m_kindsToIgnore=this.m_kindsToIgnore.concat(e)}createDescription(){return{processLayersDefault:this.m_processLayersDefault,processPointsDefault:this.m_processPointsDefault,processLinesDefault:this.m_processLinesDefault,processPolygonsDefault:this.m_processPolygonsDefault,layersToProcess:this.m_layersToProcess,layersToIgnore:this.m_layersToIgnore,pointsToProcess:this.m_pointsToProcess,pointsToIgnore:this.m_ignoredPoints,linesToProcess:this.m_linesToProcess,linesToIgnore:this.m_linesToIgnore,polygonsToProcess:this.m_polygonsToProcess,polygonsToIgnore:this.m_polygonsToIgnore,kindsToProcess:this.m_kindsToProcess,kindsToIgnore:this.m_kindsToIgnore}}addItem(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const i={layerName:{value:t.layer,match:void 0===t.matchLayer?n.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomType?Array.isArray(t.geomType)?t.geomType:[t.geomType]:void 0,classes:[{value:t.featureClass,match:void 0===t.matchClass?n.OmvFilterString.StringMatch.Match:t.matchClass}],minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(i)}addItems(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const i={layerName:{value:t.layer,match:void 0===t.matchLayer?n.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomTypes?Array.isArray(t.geomTypes)?t.geomTypes:[t.geomTypes]:void 0,classes:t.featureClasses,minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(i)}};class o{constructor(e){this.description=e,this.description.kindsToProcess.length>0&&(this.enabledKinds=new r.GeometryKindSet(this.description.kindsToProcess)),this.description.kindsToIgnore.length>0&&(this.disabledKinds=new r.GeometryKindSet(this.description.kindsToIgnore))}static matchLayer(e,t,i){for(const r of t)if(!(i<r.minLevel||i>r.maxLevel)&&n.OmvFilterString.matchString(e,r.name))return!0;return!1}wantsLayer(e,t){return!!o.matchLayer(e,this.description.layersToProcess,t)||!o.matchLayer(e,this.description.layersToIgnore,t)&&this.description.processLayersDefault}wantsPointFeature(e,t,i){return this.wantsFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,i,this.description.processPointsDefault)}wantsLineFeature(e,t,i){return this.wantsFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,i,this.description.processLinesDefault)}wantsPolygonFeature(e,t,i){return this.wantsFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,i,this.description.processPolygonsDefault)}wantsKind(e){return void 0===e||(!(void 0!==this.disabledKinds&&this.disabledKinds.hasOrIntersects(e))||void 0!==this.enabledKinds&&this.enabledKinds.hasOrIntersects(e))}get hasKindFilter(){return void 0!==this.enabledKinds||void 0!==this.disabledKinds}wantsFeature(e,t,i,r,o,s){for(const t of e)if(!(o<t.minLevel||o>t.maxLevel)&&n.OmvFilterString.matchString(i,t.layerName)&&void 0!==t.geometryTypes&&t.geometryTypes.indexOf(r)>=0)return!0;for(const e of t)if(n.OmvFilterString.matchString(i,e.layerName)&&void 0!==e.geometryTypes&&e.geometryTypes.indexOf(r)>=0)return!1;return s}}t.OmvGenericFeatureFilter=o;t.ComposedDataFilter=class{constructor(e){this.filters=e}get hasKindFilter(){return this.filters.reduce((e,t)=>e&&t.hasKindFilter,!0)}wantsLayer(e,t){return this.filters.reduce((i,r)=>i&&r.wantsLayer(e,t),!0)}wantsPointFeature(e,t,i){return this.filters.reduce((r,n)=>r&&n.wantsPointFeature(e,t,i),!0)}wantsLineFeature(e,t,i){return this.filters.reduce((r,n)=>r&&n.wantsLineFeature(e,t,i),!0)}wantsPolygonFeature(e,t,i){return this.filters.reduce((r,n)=>r&&n.wantsPolygonFeature(e,t,i),!0)}wantsKind(e){return this.filters.reduce((t,i)=>t&&i.wantsKind(e),!0)}};class s{constructor(e){this.description=e}static matchItems(e,t,i){for(const r of i)if(void 0!==r.classes){if(!n.OmvFilterString.matchString(e,r.layerName))continue;for(const e of r.classes)if(n.OmvFilterString.matchString(t,e))return!0}return!1}static matchAttribute(e,t,i){for(const r of i)if(void 0!==r.featureAttribute&&n.OmvFilterString.matchString(e,r.layerName)&&t.lookup(r.featureAttribute.key)===r.featureAttribute.value)return!0;return!1}doProcessPointFeature(e,t){return this.doProcessFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,this.description.processPointsDefault)}doProcessLineFeature(e,t){return this.doProcessFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,this.description.processLinesDefault)}doProcessPolygonFeature(e,t){return this.doProcessFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,this.description.processPolygonsDefault)}doProcessFeature(e,t,i,r,n){if(void 0===i||0===e.length&&0===t.length)return n;let o;const a=r.lookup("class");return null!=a&&(o=a.toString()),!(!o||!s.matchItems(i,o,e))||(!o||!s.matchItems(i,o,t))&&(!!s.matchAttribute(i,r,e)||!s.matchAttribute(i,r,t)&&n)}}t.OmvGenericFeatureModifier=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDataSource=void 0;const r=i(2),n=i(3),o=i(271),s=i(1),a=i(61),l=i(127),c=i(62),h=s.LoggerManager.instance.create("OmvDataSource");function d(e){if(e.dataProvider)return e.dataProvider;if(e.baseUrl||e.url)return new l.OmvRestClient(e);throw new Error("OmvDataSource: missing url, baseUrl or dataProvider params")}let u=!1;const m="https://vector.hereapi.com/v2/vectortiles/base/mc",p={baseUrl:m,apiFormat:l.APIFormat.XYZOMV,styleSetName:"tilezen",authenticationMethod:{method:l.AuthenticationMethod.QueryString,name:"apikey"},copyrightInfo:[{id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"}]},f=new Map([[m,p]]);class g extends o.TileDataSource{constructor(e){var t,i,r,h,u;super(e.tileFactory||new o.TileFactory(c.OmvTile),Object.assign({styleSetName:null!==(t=e.styleSetName)&&void 0!==t?t:"omv",concurrentDecoderServiceName:a.OMV_TILE_DECODER_SERVICE_TYPE,minDataLevel:null!==(i=e.minDataLevel)&&void 0!==i?i:1,maxDataLevel:null!==(r=e.maxDataLevel)&&void 0!==r?r:17,storageLevelOffset:null!==(h=e.storageLevelOffset)&&void 0!==h?h:-1},function(e){var t;if(void 0===e.dataProvider&&void 0===e.url){const i=null!==(t=e.baseUrl)&&void 0!==t?t:m,r=Object.assign(Object.assign({},f.get(i)),e);return Object.assign(Object.assign({},r),{tilingScheme:n.webMercatorTilingScheme,dataProvider:new l.OmvRestClient(r)})}return Object.assign(Object.assign({},e),{tilingScheme:n.webMercatorTilingScheme,dataProvider:d(e)})}(e))),this.m_params=e,this.cacheable=!0,this.addGroundPlane=void 0===e.addGroundPlane||!0===e.addGroundPlane,this.m_decoderOptions={showMissingTechniques:!0===this.m_params.showMissingTechniques,filterDescription:this.m_params.filterDescr,gatherFeatureAttributes:!0===this.m_params.gatherFeatureAttributes,featureModifiers:this.m_params.featureModifierId?[this.m_params.featureModifierId]:void 0,politicalView:this.m_params.politicalView,skipShortLabels:this.m_params.skipShortLabels,storageLevelOffset:null!==(u=e.storageLevelOffset)&&void 0!==u?u:-1,enableElevationOverlay:!0===this.m_params.enableElevationOverlay},this.maxGeometryHeight=s.getOptionValue(e.maxGeometryHeight,n.EarthConstants.MAX_BUILDING_HEIGHT)}async connect(){try{await super.connect()}catch(e){throw r.WorkerServiceProtocol.isUnknownServiceError(e)&&!u&&(h.info("Unable to create decoder service in worker. Use  'OmvTileDecoderService.start();' in decoder script."),u=!0),e}this.configureDecoder(void 0,void 0,void 0,this.m_decoderOptions)}removeDataFilter(){this.configureDecoder(void 0,void 0,void 0,{filterDescription:null})}setDataFilter(e){this.m_decoderOptions.filterDescription=null!==e?e:void 0,this.configureDecoder(void 0,void 0,void 0,{filterDescription:e,featureModifiers:this.m_decoderOptions.featureModifiers,politicalView:this.m_decoderOptions.politicalView})}shouldPreloadTiles(){return!0}setLanguages(e){void 0!==e&&this.configureDecoder(void 0,void 0,e,void 0)}setPoliticalView(e){e=null==e?void 0:e.toLowerCase(),this.m_decoderOptions.politicalView!==e&&(this.m_decoderOptions.politicalView=e,this.configureDecoder(void 0,void 0,void 0,{filterDescription:this.m_decoderOptions.filterDescription,featureModifiers:this.m_decoderOptions.featureModifiers,politicalView:void 0!==e?e:""}))}get storageLevelOffset(){return super.storageLevelOffset}set storageLevelOffset(e){super.storageLevelOffset=e,this.m_decoderOptions.storageLevelOffset=this.storageLevelOffset,this.configureDecoder(void 0,void 0,void 0,{storageLevelOffset:this.storageLevelOffset})}setEnableElevationOverlay(e){this.m_decoderOptions.enableElevationOverlay!==e&&(this.m_decoderOptions.enableElevationOverlay=e,this.configureDecoder(void 0,void 0,void 0,{enableElevationOverlay:e}))}configureDecoder(e,t,i,r){this.clearCache(),this.decoder.configure(e,t,i,r),this.mapView.markTilesDirty(this)}}t.OmvDataSource=g},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(272),t),n(i(273),t),n(i(126),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(11)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataSource=t.TileFactory=void 0;const r=i(16),n=i(1),o=i(126);t.TileFactory=class{constructor(e){this.m_modelConstructor=e}create(e,t){return new this.m_modelConstructor(e,t)}};class s extends r.DataSource{constructor(e,t){if(super({name:t.name,styleSetName:t.styleSetName,minZoomLevel:t.minZoomLevel,maxZoomLevel:t.maxZoomLevel,minDataLevel:t.minDataLevel,maxDataLevel:t.maxDataLevel,minDisplayLevel:t.minDisplayLevel,maxDisplayLevel:t.maxDisplayLevel,storageLevelOffset:t.storageLevelOffset,allowOverlappingTiles:t.allowOverlappingTiles}),this.m_tileFactory=e,this.m_options=t,this.logger=n.LoggerManager.instance.create("TileDataSource"),this.m_isReady=!1,t.decoder)this.m_decoder=t.decoder;else{if(!t.concurrentDecoderServiceName)throw new Error(`TileDataSource[${this.name}]: unable to create, missing decoder or `+"concurrentDecoderServiceName");this.m_decoder=r.ConcurrentDecoderFacade.getTileDecoder(t.concurrentDecoderServiceName,t.concurrentDecoderScriptUrl,t.concurrentDecoderWorkerCount)}this.useGeometryLoader=!0,this.cacheable=!0}dispose(){this.decoder.dispose()}ready(){return this.m_isReady&&this.m_options.dataProvider.ready()}get decoder(){return this.m_decoder}async connect(){await Promise.all([this.m_options.dataProvider.connect(),this.m_decoder.connect()]),this.m_isReady=!0,this.m_decoder.configure(void 0,void 0,void 0,{storageLevelOffset:this.m_options.storageLevelOffset})}setStyleSet(e,t,i){this.m_decoder.configure(e,t,i),this.mapView.markTilesDirty(this)}setTheme(e,t){const i=void 0!==this.styleSetName&&e.styles?e.styles[this.styleSetName]:void 0;void 0!==i&&this.setStyleSet(i,e.definitions,t)}dataProvider(){return this.m_options.dataProvider}getTilingScheme(){return this.m_options.tilingScheme}getTile(e){const t=this.m_tileFactory.create(this,e);return t.tileLoader=new o.TileLoader(this,e,this.m_options.dataProvider,this.decoder,0),t.copyrightInfo=this.m_options.copyrightInfo,void 0!==this.m_options.copyrightProvider&&this.m_options.copyrightProvider.getCopyrights(t.geoBox,e.level).then(e=>{t.copyrightInfo=void 0===t.copyrightInfo?e:[...t.copyrightInfo,...e],this.requestUpdate()}),t.load(),t}getTileInfo(e){return new Promise((t,i)=>{const n=new o.TileInfoLoader(this,e,this.m_options.dataProvider,this.decoder,0);n.loadAndDecode().then(e=>{e===r.TileLoaderState.Ready?t(n.tileInfo):i(new Error(`TileDataSource#getInfoTile wrong final state: ${e}`))})})}}t.TileDataSource=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDebugLabelsTile=void 0;const r=i(2),n=i(16),o=i(57),s=i(6),a=i(0),l=i(54),c=i(62),h=new a.LineBasicMaterial({color:0,linewidth:1,depthTest:!1,depthFunc:a.NeverDepth}),d=new a.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:a.NeverDepth});new a.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:a.NeverDepth}).wireframe=!0,new a.MeshBasicMaterial({color:8421631,depthTest:!1,depthFunc:a.NeverDepth}).wireframe=!0;const u=new a.MeshBasicMaterial({color:0,depthTest:!1,depthFunc:a.NeverDepth}),m=new a.MeshBasicMaterial({color:255,depthTest:!1,depthFunc:a.NeverDepth,opacity:.75,transparent:!0}),p=new s.TextRenderStyle,f=new s.TextLayoutStyle;p.fontSize={unit:s.FontUnit.Point,size:9,backgroundSize:0},p.opacity=.75,p.backgroundOpacity=.75,p.color=new a.Color(.8,.2,.2);const g=Number.MAX_SAFE_INTEGER;class v extends c.OmvTile{constructor(e,t){super(e,t)}loadingFinished(){this.addLabelDebugInfo()}addLabelDebugInfo(){const e=o.debugContext.getValue("DEBUG_TEXT_PATHS"),t=o.debugContext.getValue("DEBUG_TEXT_PATHS_FULL"),i=o.debugContext.getValue("DEBUG_TEXT_POIS_FULL");if(!e&&!t||void 0===this.decodedTile)return;const c=l.TileGeometryCreator.instance,v=this.decodedTile;c.createTextElements(this,v);const y=new Map,_=o.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.TEXT"),x=o.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.INDEX"),S=this.mapView.env;void 0!==v.textPathGeometries&&(this.preparedTextPaths=c.prepareTextPaths(v.textPathGeometries,v));const b=this.center.x,T=this.center.y,w=this.center.z,M=this.mapView.pixelToWorld,E=this.computeWorldOffsetX();let P=0;if(this.textElementGroups.count()>0){const e=new a.BufferGeometry,t=new Array,r=new Array,o=[];this.textElementGroups.forEach(e=>{if(void 0!==e.path)return;const l=e.position.x-b,c=e.position.y-T,h=5-w,d=3*M;r.push(l,c-d,h),r.push(l+d,c,h),r.push(l,c+d,h),r.push(l-d,c,h);const u=r.length/3;if(t.push(u-4),t.push(u-3),t.push(u-2),t.push(u-4),t.push(u-2),t.push(u-1),i){const t=.5*d,i=`${e.text} [${P}]`,r=new n.TextElement(s.ContextualArabicConverter.instance.convert(i),new a.Vector3(l+E+b+t,c+T+t,h+w),p,f,g,0,0);r.minZoomLevel=0,r.mayOverlap=!0,r.reserveSpace=!1,r.alwaysOnTop=!0,r.ignoreDistance=!0,r.priority=n.TextElement.HIGHEST_PRIORITY,r._isDebug=!0,o.push(r)}P++});for(const e of o)this.addTextElement(e);if(t.length>0){e.addGroup(0,t.length,0),e.setAttribute("position",new a.BufferAttribute(new Float32Array(r),3)),e.setIndex(new a.BufferAttribute(new Uint32Array(t),1));const i=new a.Mesh(e,m);i.renderOrder=g,this.objects.push(i)}}if(void 0!==this.preparedTextPaths){const i=new a.BufferGeometry,o=new Array,l=new Array,c=new a.BufferGeometry,m=new Array,P=new Array,C=new a.BufferGeometry,A=new Array,L=new Array;let R=0;for(const i of this.preparedTextPaths){const c=v.techniques[i.technique];if(!r.isTextTechnique(c)||void 0!==i._isDebug)continue;void 0!==c.color&&y.set(i.technique,new a.Color(r.getPropertyValue(c.color,S))),R=l.length/3;const h=i.text,d=this.preparedTextPaths.indexOf(i);if((!_||h&&h.indexOf(_)>=0)&&(void 0===x||x===d)){const d=10;for(let o=0;o<i.path.length;o+=3){const u=o/3,g=i.path[o]-b,v=i.path[o+1]-T,y=d+i.path[o+2]+o/3-w;e&&l.push(g,v,y);const _=0===o;if(t||_){const e=M*(_?6:4),i=_?P:L,o=_?m:A;i.push(g,v-e,y),i.push(g+e,v,y),i.push(g,v+e,y),i.push(g-e,v,y);const l=i.length/3;if(o.push(l-4),o.push(l-3),o.push(l-2),o.push(l-4),o.push(l-2),o.push(l-1),t){const e=u%5==0?h+":"+u:Number(u).toString(),t=new n.TextElement(s.ContextualArabicConverter.instance.convert(e),new a.Vector3(g+E+b,v+T,y+w),p,f,r.getPropertyValue(c.priority||0,S),c.xOffset||0,c.yOffset||0);t.minZoomLevel=c.minZoomLevel,t.mayOverlap=!0,t.reserveSpace=!1,t.alwaysOnTop=!0,t.ignoreDistance=!0,t.priority=n.TextElement.HIGHEST_PRIORITY,this.addTextElement(t)}}}const u=i.path.length/3;for(let e=0;e<u;++e)e>0&&o.push(R+e),e+1<u&&o.push(R+e)}}if(o.length>0){i.addGroup(0,o.length,0),i.setAttribute("position",new a.BufferAttribute(new Float32Array(l),3)),i.setIndex(new a.BufferAttribute(new Uint32Array(o),1));const e=new a.LineSegments(i,h);e.renderOrder=g-2,this.objects.push(e)}if(m.length>0){c.addGroup(0,m.length,0),c.setAttribute("position",new a.BufferAttribute(new Float32Array(P),3)),c.setIndex(new a.BufferAttribute(new Uint32Array(m),1));const e=new a.Mesh(c,d);e.renderOrder=g,this.objects.push(e)}if(A.length>0){C.addGroup(0,A.length,0),C.setAttribute("position",new a.BufferAttribute(new Float32Array(L),3)),C.setIndex(new a.BufferAttribute(new Uint32Array(A),1));const e=new a.Mesh(C,u);e.renderOrder=g-1,this.objects.push(e)}}}}t.OmvDebugLabelsTile=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataProvider=void 0;const r=i(2);i(11);const n=i(16),o=i(1).LoggerManager.instance.create("GeoJsonDataProvider");let s=!1;t.GeoJsonDataProvider=class{constructor(e,t,i){this.name=e,this.input=t,this.m_registered=!1,this.m_tiler=i&&i.tiler||n.ConcurrentTilerFacade.getTiler("omv-tiler",i&&i.workerTilerUrl)}async connect(){try{await this.m_tiler.connect()}catch(e){throw r.WorkerServiceProtocol.isUnknownServiceError(e)&&!s&&(o.info("Unable to start GeoJson tiler service in worker. Use  'OmvTilerService.start();' in decoder script."),s=!0),e}await this.m_tiler.registerIndex(this.name,this.input),this.m_registered=!0}updateInput(e){this.input=e,this.m_tiler.updateIndex(this.name,this.input)}ready(){return this.m_registered}async getTile(e){return this.m_tiler.getTile(this.name,e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.copyrightInfo=t.apikey=void 0,t.apikey="J0IJdYzKDYS3nHVDDEWETIqK3nAcxqW42vz7xeSq61M",t.copyrightInfo=[{id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"}]},function(e){e.exports=JSON.parse('{"sky":{"type":"gradient","topColor":"#161719","bottomColor":"#262829","groundColor":"#262829","monomialPower":1},"fog":{"color":"#262829","startRatio":0.8},"clearColor":"#32353B","lights":[{"type":"ambient","color":"#C9CACC","name":"ambientLight","intensity":0.8},{"type":"directional","color":"#C5C7CA","name":"light1","intensity":0.4,"direction":{"x":1,"y":0,"z":1}},{"type":"directional","color":"#B6B6B6","name":"light2","intensity":0.4,"direction":{"x":-1,"y":0,"z":1}}],"styles":{"tilezen":[{"description":"pier","when":"$layer == \'roads\' && ((kind != \'rail\') && ((kind_detail == \'pier\') || (landuse_kind == \'pier\')))","technique":"solid-line","attr":{"color":"#333334","lineWidth":{"interpolation":"Linear","zoomLevels":[13,14,15],"values":[1.5,1.2,0.9]},"fadeNear":0.8,"fadeFar":0.9,"clipping":false},"renderOrder":10,"final":true},{"description":"residential - outline","category":"outline","technique":"solid-line","when":"$layer == \'roads\' && ((kind != \'rail\') && ((kind == \'minor_road\') && (((kind_detail == \'unclassified\') || (kind_detail == \'residential\')) || (kind_detail == \'service\'))))","attr":{"color":"#000","lineWidth":{"interpolation":"Linear","zoomLevels":[10,11,12,13,14],"values":[42,28,18,7,3.5]},"fadeNear":0.8,"fadeFar":0.9,"clipping":false},"renderOrder":11},{"category":"fill","when":"$layer == \'roads\' && ((kind != \'rail\') && ((kind == \'major_road\') && (kind_detail == \'secondary\')))","technique":"solid-line","attr":{"color":"#656565","secondaryColor":"#366E62","lineWidth":{"interpolation":"Linear","zoomLevels":[7,8,9,10,11,12,13,14],"values":[180,110,45,30,20,12,7,5]},"secondaryWidth":{"interpolation":"Linear","zoomLevels":[7,8,9,10,11,12,13,14],"values":[180,110,45,30,20,16,9,5.5]},"fadeNear":0.8,"fadeFar":0.9,"clipping":false},"renderOrder":15.3,"secondaryRenderOrder":10.3,"final":true},{"description":"tertiary","category":"outline","when":"$layer == \'roads\' && ((kind != \'rail\') && ((kind == \'major_road\') && kind_detail in [\'primary\',\'tertiary\']))","technique":"solid-line","attr":{"color":"#000","lineWidth":{"interpolation":"Linear","zoomLevels":[6,7,8,9,10,11,12,13,14],"values":[550,300,100,70,38,24,14,7,4.5]},"fadeNear":0.8,"fadeFar":0.9,"clipping":false},"renderOrder":10.3},{"description":"primary","category":"outline","when":"$layer == \'roads\' && ((kind != \'rail\') && ((kind == \'highway\') && ((kind_detail == \'motorway\') || (kind_detail == \'primary\'))))","technique":"solid-line","attr":{"color":"#000","lineWidth":{"interpolation":"Linear","zoomLevels":[6,7,8,9,10,11,12,13,14],"values":[700,400,200,90,50,33,16,11,6.5]},"fadeNear":0.8,"fadeFar":0.9,"clipping":false},"renderOrder":10.4},{"description":"ferry","when":"$layer == \'roads\' && ((kind != \'rail\') && kind in [\'ferry\'])","technique":"solid-line","attr":{"clipping":false,"color":"#484A4C","dashSize":{"interpolation":"Discrete","zoomLevels":[6,7,8,9,10,11,12,13,14,15,16,17,18],"values":[2000,1250,750,600,280,50,25,12,8,6,5,4,3]},"gapSize":{"interpolation":"Discrete","zoomLevels":[6,7,8,9,10,11,12,13,14,15,16,17,18],"values":[2000,1250,750,600,280,50,25,12,8,6,5,4,3]},"lineWidth":{"interpolation":"Linear","zoomLevels":[5,6,7,8,9,10,11,12,13,14,15,16,17],"values":[640,320,160,80,40,15,9,6,3,1.5,1,0.5,0.5]},"fadeNear":0.8,"fadeFar":0.9},"renderOrder":10,"final":true},{"description":"parkings etc","when":"$layer == \'roads\' && ((kind != \'rail\') && kind_detail in [\'driveway\',\'parking_aisle\',\'drive_through\'])","technique":"solid-line","attr":{"color":"#5E6062","lineWidth":5,"fadeNear":0.8,"fadeFar":0.9,"clipping":false},"renderOrder":10,"final":true},{"description":"pedestrian","when":"$layer == \'roads\' && ((kind != \'rail\') && ((kind == \'path\') && (kind_detail in [\'pedestrian\',\'path\',\'footway\'] || landuse_kind in [\'park\',\'residential\',\'footway\',\'garden\',\'pedestrian\',\'grass\',\'allotments\',\'forest\',\'cemetery\',\'natural_wood\'])))","category":"pedestrian","technique":"solid-line","attr":{"color":"#000","lineWidth":1.5,"fadeNear":0.8,"fadeFar":0.9,"clipping":false},"renderOrder":10.3},{"description":"tram","when":"$layer == \'roads\' && (((($geometryType ^= \'line\') && (kind == \'rail\')) && kind_detail in [\'rail\',\'light_rail\',\'tram\']) && (kind_detail == \'tram\'))","technique":"solid-line","attr":{"color":"#57585B","lineWidth":{"interpolation":"Linear","zoomLevels":[13,16,17],"values":[1.5,0.75,0.4]}},"renderOrder":50,"final":true},{"description":"industrial_railway","when":"$layer == \'roads\' && (((($geometryType ^= \'line\') && (kind == \'rail\')) && kind_detail in [\'rail\',\'light_rail\',\'tram\']) && service in [\'siding\',\'industrial\',\'yard\',\'spur\',\'crossover\'])","technique":"solid-line","attr":{"color":"#606164"},"renderOrder":5,"final":true},{"description":"Railway+S-Bahn background","category":"outline","when":"$layer == \'roads\' && (((($geometryType ^= \'line\') && (kind == \'rail\')) && kind_detail in [\'rail\',\'light_rail\',\'tram\']) && !(is_tunnel))","technique":"solid-line","attr":{"color":"#f0f","lineWidth":{"interpolation":"Linear","zoomLevels":[13,14.6,15],"values":[3.5,1.5,0.5]}},"renderOrder":5.2},{"description":"Railway+S-Bahn background","category":"outline","when":"$layer == \'roads\' && (((($geometryType ^= \'line\') && (kind == \'rail\')) && kind_detail in [\'rail\',\'light_rail\',\'tram\']) && is_tunnel)","technique":"solid-line","attr":{"color":"#6A6C6F","lineWidth":{"interpolation":"Linear","zoomLevels":[13,21],"values":[3.5,2.5]}},"renderOrder":5.1},{"description":"Railway+S-Bahn dashes","when":"$layer == \'roads\' && (((($geometryType ^= \'line\') && (kind == \'rail\')) && kind_detail in [\'rail\',\'light_rail\',\'tram\']) && !(is_tunnel))","technique":"solid-line","attr":{"color":"#7B7E81","dashSize":{"interpolation":"Discrete","zoomLevels":[10,11,12,13,14,15,20],"values":[30,20,12,7,4,2,1]},"gapSize":{"interpolation":"Discrete","zoomLevels":[10,11,12,13,14,15,20],"values":[100,55,50,40,25,12,8]},"lineWidth":{"interpolation":"Linear","zoomLevels":[13,21],"values":[2.75,1.75]}},"renderOrder":5.25,"final":true},{"description":"Railway+S-Bahn dashes","when":"$layer == \'roads\' && (((($geometryType ^= \'line\') && (kind == \'rail\')) && kind_detail in [\'rail\',\'light_rail\',\'tram\']) && is_tunnel)","technique":"solid-line","attr":{"color":"#454648","dashSize":{"interpolation":"Discrete","zoomLevels":[10,11,12,13,14,15,16],"values":[100,40,24,30,25,15,8]},"gapSize":{"interpolation":"Discrete","zoomLevels":[10,11,12,13,14,15,16],"values":[100,40,24,30,25,15,8]},"lineWidth":{"interpolation":"Linear","zoomLevels":[13,14],"values":[2.75,1.75]}},"renderOrder":5.15,"final":true},{"description":"water","when":"$layer == \'water\' && $geometryType ^= \'polygon\'","technique":"fill","attr":{"color":"#0F1621"},"renderOrder":5},{"description":"country border","category":"outline","when":"$layer ^= \'boundaries\' && (($geometryType ^= \'line\') && (kind == \'country\'))","technique":"solid-line","attr":{"color":"#373A3C","lineWidth":{"interpolation":"Linear","zoomLevels":[1,2,3,4,5,6,7,8,9,10,11,12,13,14],"values":[5000,4000,3500,2500,1500,1000,500,250,125,60,40,20,10,5]}},"renderOrder":5},{"description":"country border","category":"fill","when":"$layer ^= \'boundaries\' && (($geometryType ^= \'line\') && (kind == \'country\'))","technique":"solid-line","attr":{"color":"#2E3234","lineWidth":{"interpolation":"Linear","zoomLevels":[2,3,4,5,6,7,8,9,10,11,12,13,14],"values":[1000,700,500,250,110,45,25,15,10,7.5,5,2.5,1]}},"renderOrder":5},{"description":"disputed border line","when":"$layer ^= \'boundaries\' && (($geometryType ^= \'line\') && (kind in [\'disputed\',\'indefinite\',\'indeterminate\',\'lease_limit\',\'line_of_control\',\'overlay_limit\']))","technique":"solid-line","attr":{"color":"#2E3234","secondaryColor":"#373A3C","lineWidth":{"interpolation":"Linear","zoomLevels":[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"values":[4000,2600,1500,1000,720,520,270,140,90,60,30,15,10,5,2]},"secondaryWidth":{"interpolation":"Linear","zoomLevels":[1,2,3,4,5,6,7,8,9,10,11,12,13,14],"values":[10000,8000,7000,5000,3000,2000,1000,500,250,120,80,40,20,10]},"dashSize":{"interpolation":"Cubic","zoomLevels":[10,11,12,13,14],"values":[1024,512,256,128,64]},"gapSize":{"interpolation":"Cubic","zoomLevels":[10,11,12,13,14],"values":[512,256,128,64,32]}},"renderOrder":4.1,"secondaryRenderOrder":4},{"description":"region border","category":"outline","when":"$layer ^= \'boundaries\' && (($geometryType ^= \'line\') && (kind == \'region\'))","technique":"solid-line","attr":{"color":"#7C7C7C","lineWidth":{"interpolation":"Linear","zoomLevels":[2,3,4,5,6,7,8,9,10,11,12,13,14],"values":[600,300,150,100,60,30,20,12,8,5,3,2,1]}},"renderOrder":4.1},{"description":"region border","when":"$layer ^= \'boundaries\' && (($geometryType ^= \'line\') && (kind == \'region\'))","technique":"solid-line","attr":{"color":"#7C7C7C","lineWidth":{"interpolation":"Linear","zoomLevels":[2,3,4,5,6,7,8,9,10,11,12,13,14],"values":[600,300,150,100,60,30,20,12,8,5,3,2,1]}},"renderOrder":4.1},{"description":"urban","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && (kind ^= \'urban\'))","technique":"fill","attr":{"opacity":0.8,"color":"#3B3E45"},"renderOrder":0},{"description":"park","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && kind in [\'nature\',\'forest\',\'park\',\'wood\',\'natural_wood\',\'grass\',\'meadow\',\'village_green\',\'dog_park\',\'garden\',\'nature_reserve\',\'protected_area\'])","technique":"fill","attr":{"color":"#373A40"},"renderOrder":0.2},{"description":"runway","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && (kind == \'runway\'))","technique":"fill","attr":{"color":"#2E3036"},"renderOrder":20,"final":true},{"description":"aerodrome","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && (kind ^= \'aerodrome\'))","technique":"fill","attr":{"color":"#373A40"},"renderOrder":0.3},{"description":"national_park","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && (kind ^= \'national_park\'))","technique":"fill","attr":{"color":"#373A40"},"renderOrder":1},{"description":"pitch","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && kind in [\'pitch\'])","technique":"fill","attr":{"color":"#373A40"},"renderOrder":1},{"description":"hospital","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && (kind ^= \'hospital\'))","technique":"fill","attr":{"color":"#373A40"},"renderOrder":0.1},{"description":"cemetery","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && (kind ^= \'cemetery\'))","technique":"fill","attr":{"color":"#373A40"},"renderOrder":0.1},{"description":"bridge","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && kind in [\'bridge\'])","technique":"fill","attr":{"color":"#ff0000"},"renderOrder":1},{"description":"zoo","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && kind in [\'sport\',\'sports_centre\',\'attraction\',\'zoo\'])","technique":"fill","attr":{"color":"#373A40"},"renderOrder":1},{"description":"religion","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && (kind ^= \'religion\'))","technique":"fill","attr":{"color":"#373A40"},"renderOrder":1},{"description":"industrial","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && kind in [\'common\',\'surface\',\'commercial\',\'military\',\'industrial\'])","technique":"fill","attr":{"color":"#373A40"},"renderOrder":0},{"description":"farmyard","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && kind in [\'animal\',\'aviary\',\'zoo\',\'farm\',\'farmland\',\'farmyard\'])","technique":"fill","attr":{"color":"#373A40"},"renderOrder":0},{"description":"beach","when":"$layer ^= \'landuse\' && (($geometryType ^= \'polygon\') && (kind in [\'beach\'] || (kind $= \'_site\')))","technique":"fill","attr":{"color":"#373A40"},"renderOrder":1},{"description":"building_geometry","when":"$layer ^= \'buildings\' && ($geometryType ^= \'polygon\')","technique":"extruded-polygon","attr":{"color":"#95DFCC","opacity":0.85,"defaultHeight":1,"roughness":1,"metalness":0.9,"emissive":"#383C45","emissiveIntensity":0.5,"footprint":true,"maxSlope":0.8799999999999999,"lineWidth":1,"lineColor":"#95DFCC","lineColorMix":0.3,"fadeNear":0.1,"fadeFar":0.25,"lineFadeNear":0.05,"lineFadeFar":0.25},"renderOrder":2000}]}}')},function(e,t,i){}]);
//# sourceMappingURL=index.bundle.js.map